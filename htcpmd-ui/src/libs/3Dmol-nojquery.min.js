!function(global,factory){factory(global.MMTF=global.MMTF||{})}(this,(function(exports){"use strict";function utf8Write(view,offset,string){for(var byteLength=view.byteLength,i=0,l=string.length;i<l;i++){var codePoint=string.charCodeAt(i);if(codePoint<128)view.setUint8(offset++,codePoint>>>0&127|0);else if(codePoint<2048)view.setUint8(offset++,codePoint>>>6&31|192),view.setUint8(offset++,codePoint>>>0&63|128);else if(codePoint<65536)view.setUint8(offset++,codePoint>>>12&15|224),view.setUint8(offset++,codePoint>>>6&63|128),view.setUint8(offset++,codePoint>>>0&63|128);else{if(!(codePoint<1114112))throw new Error("bad codepoint "+codePoint);view.setUint8(offset++,codePoint>>>18&7|240),view.setUint8(offset++,codePoint>>>12&63|128),view.setUint8(offset++,codePoint>>>6&63|128),view.setUint8(offset++,codePoint>>>0&63|128)}}}function utf8ByteCount(string){for(var count=0,i=0,l=string.length;i<l;i++){var codePoint=string.charCodeAt(i);if(codePoint<128)count+=1;else if(codePoint<2048)count+=2;else if(codePoint<65536)count+=3;else{if(!(codePoint<1114112))throw new Error("bad codepoint "+codePoint);count+=4}}return count}function encode$1(value,view,offset){var type=typeof value;if("string"===type){var length;if((length=utf8ByteCount(value))<32)return view.setUint8(offset,160|length),utf8Write(view,offset+1,value),1+length;if(length<256)return view.setUint8(offset,217),view.setUint8(offset+1,length),utf8Write(view,offset+2,value),2+length;if(length<65536)return view.setUint8(offset,218),view.setUint16(offset+1,length),utf8Write(view,offset+3,value),3+length;if(length<4294967296)return view.setUint8(offset,219),view.setUint32(offset+1,length),utf8Write(view,offset+5,value),5+length}if(value instanceof Uint8Array){var length=value.byteLength,bytes=new Uint8Array(view.buffer);if(length<256)return view.setUint8(offset,196),view.setUint8(offset+1,length),bytes.set(value,offset+2),2+length;if(length<65536)return view.setUint8(offset,197),view.setUint16(offset+1,length),bytes.set(value,offset+3),3+length;if(length<4294967296)return view.setUint8(offset,198),view.setUint32(offset+1,length),bytes.set(value,offset+5),5+length}if("number"===type){if(!isFinite(value))throw new Error("Number not finite: "+value);if(Math.floor(value)!==value)return view.setUint8(offset,203),view.setFloat64(offset+1,value),9;if(value>=0){if(value<128)return view.setUint8(offset,value),1;if(value<256)return view.setUint8(offset,204),view.setUint8(offset+1,value),2;if(value<65536)return view.setUint8(offset,205),view.setUint16(offset+1,value),3;if(value<4294967296)return view.setUint8(offset,206),view.setUint32(offset+1,value),5;throw new Error("Number too big 0x"+value.toString(16))}if(value>=-32)return view.setInt8(offset,value),1;if(value>=-128)return view.setUint8(offset,208),view.setInt8(offset+1,value),2;if(value>=-32768)return view.setUint8(offset,209),view.setInt16(offset+1,value),3;if(value>=-2147483648)return view.setUint8(offset,210),view.setInt32(offset+1,value),5;throw new Error("Number too small -0x"+(-value).toString(16).substr(1))}if(null===value)return view.setUint8(offset,192),1;if("boolean"===type)return view.setUint8(offset,value?195:194),1;if("object"===type){var length,size=0,isArray=Array.isArray(value),size;if(isArray)length=value.length;else{var keys=Object.keys(value);length=keys.length}if(length<16?(view.setUint8(offset,length|(isArray?144:128)),size=1):length<65536?(view.setUint8(offset,isArray?220:222),view.setUint16(offset+1,length),size=3):length<4294967296&&(view.setUint8(offset,isArray?221:223),view.setUint32(offset+1,length),size=5),isArray)for(var i=0;i<length;i++)size+=encode$1(value[i],view,offset+size);else for(var i=0;i<length;i++){var key=keys[i];size+=encode$1(key,view,offset+size),size+=encode$1(value[key],view,offset+size)}return size}throw new Error("Unknown type "+type)}function encodedSize(value){var type=typeof value;if("string"===type){var length;if((length=utf8ByteCount(value))<32)return 1+length;if(length<256)return 2+length;if(length<65536)return 3+length;if(length<4294967296)return 5+length}if(value instanceof Uint8Array){var length;if((length=value.byteLength)<256)return 2+length;if(length<65536)return 3+length;if(length<4294967296)return 5+length}if("number"===type){if(Math.floor(value)!==value)return 9;if(value>=0){if(value<128)return 1;if(value<256)return 2;if(value<65536)return 3;if(value<4294967296)return 5;throw new Error("Number too big 0x"+value.toString(16))}if(value>=-32)return 1;if(value>=-128)return 2;if(value>=-32768)return 3;if(value>=-2147483648)return 5;throw new Error("Number too small -0x"+value.toString(16).substr(1))}if("boolean"===type||null===value)return 1;if("object"===type){var length,size=0;if(Array.isArray(value)){length=value.length;for(var i=0;i<length;i++)size+=encodedSize(value[i])}else{var keys=Object.keys(value);length=keys.length;for(var i=0;i<length;i++){var key=keys[i];size+=encodedSize(key)+encodedSize(value[key])}}if(length<16)return 1+size;if(length<65536)return 3+size;if(length<4294967296)return 5+size;throw new Error("Array or object too long 0x"+length.toString(16))}throw new Error("Unknown type "+type)}function encodeMsgpack(value){var buffer=new ArrayBuffer(encodedSize(value)),view;return encode$1(value,new DataView(buffer),0),new Uint8Array(buffer)}var PassThroughFields=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],EncodedFields=["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"],AllFields=PassThroughFields.concat(EncodedFields);function getView(ctor,typedArray,elemSize){return typedArray?new ctor(typedArray.buffer,typedArray.byteOffset,typedArray.byteLength/(elemSize||1)):void 0}function getDataView(typedArray){return getView(DataView,typedArray)}function getUint8View(typedArray){return getView(Uint8Array,typedArray)}function getInt8View(typedArray){return getView(Int8Array,typedArray)}function getInt32View(typedArray){return getView(Int32Array,typedArray,4)}function getFloat32View(typedArray){return getView(Float32Array,typedArray,4)}function decodeInt16(bytes,output){var n=bytes.length/2;output||(output=new Int16Array(n));for(var i=0,i2=0;i<n;++i,i2+=2)output[i]=bytes[i2]<<8^bytes[i2+1]<<0;return output}function encodeInt16(array,output){var n=array.length;output||(output=new Uint8Array(2*n));for(var dv=getDataView(output),i=0;i<n;++i)dv.setInt16(2*i,array[i]);return getUint8View(output)}function decodeInt32(bytes,output){var n=bytes.length/4;output||(output=new Int32Array(n));for(var i=0,i4=0;i<n;++i,i4+=4)output[i]=bytes[i4]<<24^bytes[i4+1]<<16^bytes[i4+2]<<8^bytes[i4+3]<<0;return output}function encodeInt32(array,output){var n=array.length;output||(output=new Uint8Array(4*n));for(var dv=getDataView(output),i=0;i<n;++i)dv.setInt32(4*i,array[i]);return getUint8View(output)}function decodeFloat32(bytes,output){var n=bytes.length;output||(output=new Float32Array(n/4));for(var dvOut=getDataView(output),dvIn=getDataView(bytes),i=0,i4=0,il=n/4;i<il;++i,i4+=4)dvOut.setFloat32(i4,dvIn.getFloat32(i4),!0);return output}function decodeInteger(intArray,divisor,output){var n=intArray.length,invDiv=1/divisor;output||(output=new Float32Array(n));for(var i=0;i<n;++i)output[i]=intArray[i]*invDiv;return output}function encodeInteger(floatArray,factor,output){var n=floatArray.length;output||(output=new Int32Array(n));for(var i=0;i<n;++i)output[i]=Math.round(floatArray[i]*factor);return output}function decodeRun(array,output){var i,il;if(!output){var fullLength=0;for(i=0,il=array.length;i<il;i+=2)fullLength+=array[i+1];output=new array.constructor(fullLength)}var dataOffset=0;for(i=0,il=array.length;i<il;i+=2)for(var value=array[i],length=array[i+1],j=0;j<length;++j)output[dataOffset]=value,++dataOffset;return output}function encodeRun(array){if(0===array.length)return new Int32Array;var i,il,fullLength=2;for(i=1,il=array.length;i<il;++i)array[i-1]!==array[i]&&(fullLength+=2);var output=new Int32Array(fullLength),offset=0,runLength=1;for(i=1,il=array.length;i<il;++i)array[i-1]!==array[i]?(output[offset]=array[i-1],output[offset+1]=runLength,runLength=1,offset+=2):++runLength;return output[offset]=array[array.length-1],output[offset+1]=runLength,output}function decodeDelta(array,output){var n=array.length;output||(output=new array.constructor(n)),n&&(output[0]=array[0]);for(var i=1;i<n;++i)output[i]=array[i]+output[i-1];return output}function encodeDelta(array,output){var n=array.length;output||(output=new array.constructor(n)),output[0]=array[0];for(var i=1;i<n;++i)output[i]=array[i]-array[i-1];return output}function decodePacking(int16or8,output){var upperLimit=int16or8 instanceof Int8Array?127:32767,lowerLimit=-upperLimit-1,n=int16or8.length,i,j;if(!output){var fullLength=0;for(i=0;i<n;++i)int16or8[i]<upperLimit&&int16or8[i]>lowerLimit&&++fullLength;output=new Int32Array(fullLength)}for(i=0,j=0;i<n;){for(var value=0;int16or8[i]===upperLimit||int16or8[i]===lowerLimit;)value+=int16or8[i],++i;value+=int16or8[i],++i,output[j]=value,++j}return output}function encodePacking(intArray,useInt8){var upperLimit=useInt8?127:32767,lowerLimit=-upperLimit-1,i,n=intArray.length,size=0;for(i=0;i<n;++i){var value;0===(value=intArray[i])?++size:size+=value===upperLimit||value===lowerLimit?2:value>0?Math.ceil(value/upperLimit):Math.ceil(value/lowerLimit)}var output=useInt8?new Int8Array(size):new Int16Array(size),j=0;for(i=0;i<n;++i){var value;if((value=intArray[i])>=0)for(;value>=upperLimit;)output[j]=upperLimit,++j,value-=upperLimit;else for(;value<=lowerLimit;)output[j]=lowerLimit,++j,value-=lowerLimit;output[j]=value,++j}return output}function decodeDeltaRun(array,output){return decodeDelta(decodeRun(array),output)}function encodeDeltaRun(array){return encodeRun(encodeDelta(array))}function decodeIntegerRun(intArray,divisor,output){return decodeInteger(decodeRun(intArray,getInt32View(output)),divisor,output)}function encodeIntegerRun(floatArray,factor){return encodeRun(encodeInteger(floatArray,factor))}function decodeIntegerDelta(intArray,divisor,output){return decodeInteger(decodeDelta(intArray,getInt32View(output)),divisor,output)}function encodeIntegerDelta(floatArray,factor,output){return encodeDelta(encodeInteger(floatArray,factor),output)}function decodeIntegerPacking(int16or8,divisor,output){return decodeInteger(decodePacking(int16or8,getInt32View(output)),divisor,output)}function decodeIntegerDeltaPacking(int16or8,divisor,output){var unpacked=decodePacking(int16or8,getInt32View(output));return decodeIntegerDelta(unpacked,divisor,getFloat32View(unpacked))}function encodeIntegerDeltaPacking(floatArray,factor,useInt8){return encodePacking(encodeIntegerDelta(floatArray,factor),useInt8)}function decodeBytes(bytes){var dv=getDataView(bytes),type=dv.getInt32(0),size=dv.getInt32(4),param=bytes.subarray(8,12),bytes;return[type,bytes=bytes.subarray(12),size,param]}function encodeBytes(type,size,param,bytes){var buffer=new ArrayBuffer(12+bytes.byteLength),out=new Uint8Array(buffer),dv=new DataView(buffer);return dv.setInt32(0,type),dv.setInt32(4,size),param&&out.set(param,8),out.set(bytes,12),out}function passInt8(int8){var size,bytes;return encodeBytes(2,int8.length,void 0,getUint8View(int8))}function passInt32(int32){var size,bytes;return encodeBytes(4,int32.length,void 0,encodeInt32(int32))}function passString(stringBytes,length){var size,param,bytes;return encodeBytes(5,stringBytes.length/length,encodeInt32([length]),getUint8View(stringBytes))}function runChar(charBytes){var size,bytes;return encodeBytes(6,charBytes.length,void 0,encodeInt32(encodeRun(charBytes)))}function deltaRun(int32){var size,bytes;return encodeBytes(8,int32.length,void 0,encodeInt32(encodeDeltaRun(int32)))}function integerRun(float32,factor){var size,param,bytes;return encodeBytes(9,float32.length,encodeInt32([factor]),encodeInt32(encodeIntegerRun(float32,factor)))}function integerDeltaPacking16(float32,factor){var size,param,bytes;return encodeBytes(10,float32.length,encodeInt32([factor]),encodeInt16(encodeIntegerDeltaPacking(float32,factor)))}function encodeMmtf(inputDict){var outputDict={};return PassThroughFields.forEach((function(name){void 0!==inputDict[name]&&(outputDict[name]=inputDict[name])})),inputDict.bondAtomList&&(outputDict.bondAtomList=passInt32(inputDict.bondAtomList)),inputDict.bondOrderList&&(outputDict.bondOrderList=passInt8(inputDict.bondOrderList)),outputDict.xCoordList=integerDeltaPacking16(inputDict.xCoordList,1e3),outputDict.yCoordList=integerDeltaPacking16(inputDict.yCoordList,1e3),outputDict.zCoordList=integerDeltaPacking16(inputDict.zCoordList,1e3),inputDict.bFactorList&&(outputDict.bFactorList=integerDeltaPacking16(inputDict.bFactorList,100)),inputDict.atomIdList&&(outputDict.atomIdList=deltaRun(inputDict.atomIdList)),inputDict.altLocList&&(outputDict.altLocList=runChar(inputDict.altLocList)),inputDict.occupancyList&&(outputDict.occupancyList=integerRun(inputDict.occupancyList,100)),outputDict.groupIdList=deltaRun(inputDict.groupIdList),outputDict.groupTypeList=passInt32(inputDict.groupTypeList),inputDict.secStructList&&(outputDict.secStructList=passInt8(inputDict.secStructList)),inputDict.insCodeList&&(outputDict.insCodeList=runChar(inputDict.insCodeList)),inputDict.sequenceIndexList&&(outputDict.sequenceIndexList=deltaRun(inputDict.sequenceIndexList)),outputDict.chainIdList=passString(inputDict.chainIdList,4),inputDict.chainNameList&&(outputDict.chainNameList=passString(inputDict.chainNameList,4)),outputDict}function decodeMsgpack(buffer){var offset=0,dataView=new DataView(buffer.buffer);function map(length){for(var value={},i=0;i<length;i++){var key;value[parse()]=parse()}return value}function bin(length){var value=buffer.subarray(offset,offset+length);return offset+=length,value}function str(length){var array=buffer.subarray(offset,offset+length);offset+=length;var chunkSize=65535;if(length>65535){for(var c=[],i=0;i<array.length;i+=65535)c.push(String.fromCharCode.apply(null,array.subarray(i,i+65535)));return c.join("")}return String.fromCharCode.apply(null,array)}function array(length){for(var value=new Array(length),i=0;i<length;i++)value[i]=parse();return value}function parse(){var type=buffer[offset],value,length,extType;if(0==(128&type))return offset++,type;if(128==(240&type))return offset++,map(length=15&type);if(144==(240&type))return offset++,array(length=15&type);if(160==(224&type))return offset++,str(length=31&type);if(224==(224&type))return value=dataView.getInt8(offset),offset++,value;switch(type){case 192:return offset++,null;case 194:return offset++,!1;case 195:return offset++,!0;case 196:return length=dataView.getUint8(offset+1),offset+=2,bin(length);case 197:return length=dataView.getUint16(offset+1),offset+=3,bin(length);case 198:return length=dataView.getUint32(offset+1),offset+=5,bin(length);case 202:return value=dataView.getFloat32(offset+1),offset+=5,value;case 203:return value=dataView.getFloat64(offset+1),offset+=9,value;case 204:return value=buffer[offset+1],offset+=2,value;case 205:return value=dataView.getUint16(offset+1),offset+=3,value;case 206:return value=dataView.getUint32(offset+1),offset+=5,value;case 208:return value=dataView.getInt8(offset+1),offset+=2,value;case 209:return value=dataView.getInt16(offset+1),offset+=3,value;case 210:return value=dataView.getInt32(offset+1),offset+=5,value;case 217:return length=dataView.getUint8(offset+1),offset+=2,str(length);case 218:return length=dataView.getUint16(offset+1),offset+=3,str(length);case 219:return length=dataView.getUint32(offset+1),offset+=5,str(length);case 220:return length=dataView.getUint16(offset+1),offset+=3,array(length);case 221:return length=dataView.getUint32(offset+1),offset+=5,array(length);case 222:return length=dataView.getUint16(offset+1),offset+=3,map(length);case 223:return length=dataView.getUint32(offset+1),offset+=5,map(length)}throw new Error("Unknown type 0x"+type.toString(16))}return parse()}function performDecoding(type,bytes,size,param){switch(type){case 1:return decodeFloat32(bytes);case 2:return getInt8View(bytes);case 3:return decodeInt16(bytes);case 4:return decodeInt32(bytes);case 5:return getUint8View(bytes);case 6:return decodeRun(decodeInt32(bytes),new Uint8Array(size));case 7:return decodeRun(decodeInt32(bytes));case 8:return decodeDeltaRun(decodeInt32(bytes));case 9:return decodeIntegerRun(decodeInt32(bytes),decodeInt32(param)[0]);case 10:return decodeIntegerDeltaPacking(decodeInt16(bytes),decodeInt32(param)[0]);case 11:return decodeInteger(decodeInt16(bytes),decodeInt32(param)[0]);case 12:return decodeIntegerPacking(decodeInt16(bytes),decodeInt32(param)[0]);case 13:return decodeIntegerPacking(getInt8View(bytes),decodeInt32(param)[0]);case 14:return decodePacking(decodeInt16(bytes));case 15:return decodePacking(getInt8View(bytes))}}function decodeMmtf(inputDict,params){var ignoreFields=(params=params||{}).ignoreFields,outputDict={};return AllFields.forEach((function(name){var ignore=!!ignoreFields&&-1!==ignoreFields.indexOf(name),data=inputDict[name];ignore||void 0===data||(data instanceof Uint8Array?outputDict[name]=performDecoding.apply(null,decodeBytes(data)):outputDict[name]=data)})),outputDict}function fromCharCode(charCodeArray){return String.fromCharCode.apply(null,charCodeArray).replace(/\0/g,"")}function traverseMmtf(mmtfData,eventCallbacks,params){var firstModelOnly=(params=params||{}).firstModelOnly,onModel=eventCallbacks.onModel,onChain=eventCallbacks.onChain,onGroup=eventCallbacks.onGroup,onAtom=eventCallbacks.onAtom,onBond=eventCallbacks.onBond,modelIndex=0,chainIndex=0,groupIndex=0,atomIndex=0,modelFirstAtomIndex=0,modelLastAtomIndex=-1,chainNameList=mmtfData.chainNameList,secStructList=mmtfData.secStructList,insCodeList=mmtfData.insCodeList,sequenceIndexList=mmtfData.sequenceIndexList,atomIdList=mmtfData.atomIdList,bFactorList=mmtfData.bFactorList,altLocList=mmtfData.altLocList,occupancyList=mmtfData.occupancyList,bondAtomList=mmtfData.bondAtomList,bondOrderList=mmtfData.bondOrderList,o,ol,i,j,k,kl;for(o=0,ol=mmtfData.chainsPerModel.length;o<ol&&!(firstModelOnly&&modelIndex>0);++o){var modelChainCount=mmtfData.chainsPerModel[modelIndex];for(onModel&&onModel({chainCount:modelChainCount,modelIndex:modelIndex}),i=0;i<modelChainCount;++i){var chainGroupCount=mmtfData.groupsPerChain[chainIndex];if(onChain){var chainId=fromCharCode(mmtfData.chainIdList.subarray(4*chainIndex,4*chainIndex+4)),chainName=null;chainNameList&&(chainName=fromCharCode(chainNameList.subarray(4*chainIndex,4*chainIndex+4))),onChain({groupCount:chainGroupCount,chainIndex:chainIndex,modelIndex:modelIndex,chainId:chainId,chainName:chainName})}for(j=0;j<chainGroupCount;++j){var groupData=mmtfData.groupList[mmtfData.groupTypeList[groupIndex]],groupAtomCount=groupData.atomNameList.length;if(onGroup){var secStruct=null;secStructList&&(secStruct=secStructList[groupIndex]);var insCode=null;mmtfData.insCodeList&&(insCode=String.fromCharCode(insCodeList[groupIndex]));var sequenceIndex=null;sequenceIndexList&&(sequenceIndex=sequenceIndexList[groupIndex]),onGroup({atomCount:groupAtomCount,groupIndex:groupIndex,chainIndex:chainIndex,modelIndex:modelIndex,groupId:mmtfData.groupIdList[groupIndex],groupType:mmtfData.groupTypeList[groupIndex],groupName:groupData.groupName,singleLetterCode:groupData.singleLetterCode,chemCompType:groupData.chemCompType,secStruct:secStruct,insCode:insCode,sequenceIndex:sequenceIndex})}for(k=0;k<groupAtomCount;++k){if(onAtom){var atomId=null;atomIdList&&(atomId=atomIdList[atomIndex]);var bFactor=null;bFactorList&&(bFactor=bFactorList[atomIndex]);var altLoc=null;altLocList&&(altLoc=String.fromCharCode(altLocList[atomIndex]));var occupancy=null;occupancyList&&(occupancy=occupancyList[atomIndex]),onAtom({atomIndex:atomIndex,groupIndex:groupIndex,chainIndex:chainIndex,modelIndex:modelIndex,atomId:atomId,element:groupData.elementList[k],atomName:groupData.atomNameList[k],formalCharge:groupData.formalChargeList[k],xCoord:mmtfData.xCoordList[atomIndex],yCoord:mmtfData.yCoordList[atomIndex],zCoord:mmtfData.zCoordList[atomIndex],bFactor:bFactor,altLoc:altLoc,occupancy:occupancy})}atomIndex+=1}if(onBond){var groupBondAtomList=groupData.bondAtomList;for(k=0,kl=groupData.bondOrderList.length;k<kl;++k)onBond({atomIndex1:atomIndex-groupAtomCount+groupBondAtomList[2*k],atomIndex2:atomIndex-groupAtomCount+groupBondAtomList[2*k+1],bondOrder:groupData.bondOrderList[k]})}groupIndex+=1}chainIndex+=1}if(modelFirstAtomIndex=modelLastAtomIndex+1,modelLastAtomIndex=atomIndex-1,onBond&&bondAtomList)for(k=0,kl=bondAtomList.length;k<kl;k+=2){var atomIndex1=bondAtomList[k],atomIndex2=bondAtomList[k+1];(atomIndex1>=modelFirstAtomIndex&&atomIndex1<=modelLastAtomIndex||atomIndex2>=modelFirstAtomIndex&&atomIndex2<=modelLastAtomIndex)&&onBond({atomIndex1:atomIndex1,atomIndex2:atomIndex2,bondOrder:bondOrderList?bondOrderList[k/2]:null})}modelIndex+=1}}var version="v1.0.0",baseUrl="http://mmtf.rcsb.org/v1.0/",fetchUrl=baseUrl+"full/",fetchReducedUrl=baseUrl+"reduced/";function encode(mmtfData){return encodeMsgpack(encodeMmtf(mmtfData))}function decode(binOrDict,params){var inputDict;return binOrDict instanceof ArrayBuffer&&(binOrDict=new Uint8Array(binOrDict)),decodeMmtf(inputDict=binOrDict instanceof Uint8Array?decodeMsgpack(binOrDict):binOrDict,params)}function _fetch(pdbid,baseUrl,onLoad,onError){var xhr=new XMLHttpRequest;function _onLoad(){try{var mmtfData=decode(xhr.response);onLoad(mmtfData)}catch(error){onError(error)}}xhr.addEventListener("load",_onLoad,!0),xhr.addEventListener("error",onError,!0),xhr.responseType="arraybuffer",xhr.open("GET",baseUrl+pdbid.toUpperCase()),xhr.send()}function fetch(pdbid,onLoad,onError){_fetch(pdbid,fetchUrl,onLoad,onError)}function fetchReduced(pdbid,onLoad,onError){_fetch(pdbid,fetchReducedUrl,onLoad,onError)}exports.encode=encode,exports.decode=decode,exports.traverse=traverseMmtf,exports.fetch=fetch,exports.fetchReduced=fetchReduced,exports.version=version,exports.fetchUrl=fetchUrl,exports.fetchReducedUrl=fetchReducedUrl,exports.encodeMsgpack=encodeMsgpack,exports.encodeMmtf=encodeMmtf,exports.decodeMsgpack=decodeMsgpack,exports.decodeMmtf=decodeMmtf,Object.defineProperty(exports,"__esModule",{value:!0})})),function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;(g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pako=f()}}((function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,(function(r){var n;return o(e[i][1][r]||r)}),p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){"use strict";var TYPED_OK="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function _has(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)}exports.assign=function(obj){for(var sources=Array.prototype.slice.call(arguments,1);sources.length;){var source=sources.shift();if(source){if("object"!=typeof source)throw new TypeError(source+"must be non-object");for(var p in source)_has(source,p)&&(obj[p]=source[p])}}return obj},exports.shrinkBuf=function(buf,size){return buf.length===size?buf:buf.subarray?buf.subarray(0,size):(buf.length=size,buf)};var fnTyped={arraySet:function(dest,src,src_offs,len,dest_offs){if(src.subarray&&dest.subarray)dest.set(src.subarray(src_offs,src_offs+len),dest_offs);else for(var i=0;i<len;i++)dest[dest_offs+i]=src[src_offs+i]},flattenChunks:function(chunks){var i,l,len,pos,chunk,result;for(len=0,i=0,l=chunks.length;i<l;i++)len+=chunks[i].length;for(result=new Uint8Array(len),pos=0,i=0,l=chunks.length;i<l;i++)chunk=chunks[i],result.set(chunk,pos),pos+=chunk.length;return result}},fnUntyped={arraySet:function(dest,src,src_offs,len,dest_offs){for(var i=0;i<len;i++)dest[dest_offs+i]=src[src_offs+i]},flattenChunks:function(chunks){return[].concat.apply([],chunks)}};exports.setTyped=function(on){on?(exports.Buf8=Uint8Array,exports.Buf16=Uint16Array,exports.Buf32=Int32Array,exports.assign(exports,fnTyped)):(exports.Buf8=Array,exports.Buf16=Array,exports.Buf32=Array,exports.assign(exports,fnUntyped))},exports.setTyped(TYPED_OK)},{}],2:[function(require,module,exports){"use strict";var utils=require("./common"),STR_APPLY_OK=!0,STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,[0])}catch(__){STR_APPLY_OK=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(__){STR_APPLY_UIA_OK=!1}for(var _utf8len=new utils.Buf8(256),q=0;q<256;q++)_utf8len[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1;function buf2binstring(buf,len){if(len<65534&&(buf.subarray&&STR_APPLY_UIA_OK||!buf.subarray&&STR_APPLY_OK))return String.fromCharCode.apply(null,utils.shrinkBuf(buf,len));for(var result="",i=0;i<len;i++)result+=String.fromCharCode(buf[i]);return result}_utf8len[254]=_utf8len[254]=1,exports.string2buf=function(str){var buf,c,c2,m_pos,i,str_len=str.length,buf_len=0;for(m_pos=0;m_pos<str_len;m_pos++)55296==(64512&(c=str.charCodeAt(m_pos)))&&m_pos+1<str_len&&56320==(64512&(c2=str.charCodeAt(m_pos+1)))&&(c=65536+(c-55296<<10)+(c2-56320),m_pos++),buf_len+=c<128?1:c<2048?2:c<65536?3:4;for(buf=new utils.Buf8(buf_len),i=0,m_pos=0;i<buf_len;m_pos++)55296==(64512&(c=str.charCodeAt(m_pos)))&&m_pos+1<str_len&&56320==(64512&(c2=str.charCodeAt(m_pos+1)))&&(c=65536+(c-55296<<10)+(c2-56320),m_pos++),c<128?buf[i++]=c:c<2048?(buf[i++]=192|c>>>6,buf[i++]=128|63&c):c<65536?(buf[i++]=224|c>>>12,buf[i++]=128|c>>>6&63,buf[i++]=128|63&c):(buf[i++]=240|c>>>18,buf[i++]=128|c>>>12&63,buf[i++]=128|c>>>6&63,buf[i++]=128|63&c);return buf},exports.buf2binstring=function(buf){return buf2binstring(buf,buf.length)},exports.binstring2buf=function(str){for(var buf=new utils.Buf8(str.length),i=0,len=buf.length;i<len;i++)buf[i]=str.charCodeAt(i);return buf},exports.buf2string=function(buf,max){var i,out,c,c_len,len=max||buf.length,utf16buf=new Array(2*len);for(out=0,i=0;i<len;)if((c=buf[i++])<128)utf16buf[out++]=c;else if((c_len=_utf8len[c])>4)utf16buf[out++]=65533,i+=c_len-1;else{for(c&=2===c_len?31:3===c_len?15:7;c_len>1&&i<len;)c=c<<6|63&buf[i++],c_len--;c_len>1?utf16buf[out++]=65533:c<65536?utf16buf[out++]=c:(c-=65536,utf16buf[out++]=55296|c>>10&1023,utf16buf[out++]=56320|1023&c)}return buf2binstring(utf16buf,out)},exports.utf8border=function(buf,max){var pos;for((max=max||buf.length)>buf.length&&(max=buf.length),pos=max-1;pos>=0&&128==(192&buf[pos]);)pos--;return pos<0?max:0===pos?max:pos+_utf8len[buf[pos]]>max?pos:max}},{"./common":1}],3:[function(require,module,exports){"use strict";function adler32(adler,buf,len,pos){for(var s1=65535&adler|0,s2=adler>>>16&65535|0,n=0;0!==len;){len-=n=len>2e3?2e3:len;do{s2=s2+(s1=s1+buf[pos++]|0)|0}while(--n);s1%=65521,s2%=65521}return s1|s2<<16|0}module.exports=adler32},{}],4:[function(require,module,exports){"use strict";module.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(require,module,exports){"use strict";function makeTable(){for(var c,table=[],n=0;n<256;n++){c=n;for(var k=0;k<8;k++)c=1&c?3988292384^c>>>1:c>>>1;table[n]=c}return table}var crcTable=makeTable();function crc32(crc,buf,len,pos){var t=crcTable,end=pos+len;crc^=-1;for(var i=pos;i<end;i++)crc=crc>>>8^t[255&(crc^buf[i])];return-1^crc}module.exports=crc32},{}],6:[function(require,module,exports){"use strict";function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}module.exports=GZheader},{}],7:[function(require,module,exports){"use strict";var BAD=30,TYPE=12;module.exports=function inflate_fast(strm,start){var state,_in,last,_out,beg,end,dmax,wsize,whave,wnext,s_window,hold,bits,lcode,dcode,lmask,dmask,here,op,len,dist,from,from_source,input,output;state=strm.state,_in=strm.next_in,input=strm.input,last=_in+(strm.avail_in-5),_out=strm.next_out,output=strm.output,beg=_out-(start-strm.avail_out),end=_out+(strm.avail_out-257),dmax=state.dmax,wsize=state.wsize,whave=state.whave,wnext=state.wnext,s_window=state.window,hold=state.hold,bits=state.bits,lcode=state.lencode,dcode=state.distcode,lmask=(1<<state.lenbits)-1,dmask=(1<<state.distbits)-1;top:do{bits<15&&(hold+=input[_in++]<<bits,bits+=8,hold+=input[_in++]<<bits,bits+=8),here=lcode[hold&lmask];dolen:for(;;){if(hold>>>=op=here>>>24,bits-=op,0===(op=here>>>16&255))output[_out++]=65535&here;else{if(!(16&op)){if(0==(64&op)){here=lcode[(65535&here)+(hold&(1<<op)-1)];continue dolen}if(32&op){state.mode=12;break top}strm.msg="invalid literal/length code",state.mode=30;break top}len=65535&here,(op&=15)&&(bits<op&&(hold+=input[_in++]<<bits,bits+=8),len+=hold&(1<<op)-1,hold>>>=op,bits-=op),bits<15&&(hold+=input[_in++]<<bits,bits+=8,hold+=input[_in++]<<bits,bits+=8),here=dcode[hold&dmask];dodist:for(;;){if(hold>>>=op=here>>>24,bits-=op,!(16&(op=here>>>16&255))){if(0==(64&op)){here=dcode[(65535&here)+(hold&(1<<op)-1)];continue dodist}strm.msg="invalid distance code",state.mode=30;break top}if(dist=65535&here,bits<(op&=15)&&(hold+=input[_in++]<<bits,(bits+=8)<op&&(hold+=input[_in++]<<bits,bits+=8)),(dist+=hold&(1<<op)-1)>dmax){strm.msg="invalid distance too far back",state.mode=30;break top}if(hold>>>=op,bits-=op,dist>(op=_out-beg)){if((op=dist-op)>whave&&state.sane){strm.msg="invalid distance too far back",state.mode=30;break top}if(from=0,from_source=s_window,0===wnext){if(from+=wsize-op,op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist,from_source=output}}else if(wnext<op){if(from+=wsize+wnext-op,(op-=wnext)<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);if(from=0,wnext<len){len-=op=wnext;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist,from_source=output}}}else if(from+=wnext-op,op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist,from_source=output}for(;len>2;)output[_out++]=from_source[from++],output[_out++]=from_source[from++],output[_out++]=from_source[from++],len-=3;len&&(output[_out++]=from_source[from++],len>1&&(output[_out++]=from_source[from++]))}else{from=_out-dist;do{output[_out++]=output[from++],output[_out++]=output[from++],output[_out++]=output[from++],len-=3}while(len>2);len&&(output[_out++]=output[from++],len>1&&(output[_out++]=output[from++]))}break}}break}}while(_in<last&&_out<end);_in-=len=bits>>3,hold&=(1<<(bits-=len<<3))-1,strm.next_in=_in,strm.next_out=_out,strm.avail_in=_in<last?last-_in+5:5-(_in-last),strm.avail_out=_out<end?end-_out+257:257-(_out-end),state.hold=hold,state.bits=bits}},{}],8:[function(require,module,exports){"use strict";var utils=require("../utils/common"),adler32=require("./adler32"),crc32=require("./crc32"),inflate_fast=require("./inffast"),inflate_table=require("./inftrees"),CODES=0,LENS=1,DISTS=2,Z_FINISH=4,Z_BLOCK=5,Z_TREES=6,Z_OK=0,Z_STREAM_END=1,Z_NEED_DICT=2,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR=-5,Z_DEFLATED=8,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD=30,MEM=31,SYNC=32,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=15;function zswap32(q){return(q>>>24&255)+(q>>>8&65280)+((65280&q)<<8)+((255&q)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new utils.Buf16(320),this.work=new utils.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(strm){var state;return strm&&strm.state?(state=strm.state,strm.total_in=strm.total_out=state.total=0,strm.msg="",state.wrap&&(strm.adler=1&state.wrap),state.mode=1,state.last=0,state.havedict=0,state.dmax=32768,state.head=null,state.hold=0,state.bits=0,state.lencode=state.lendyn=new utils.Buf32(852),state.distcode=state.distdyn=new utils.Buf32(592),state.sane=1,state.back=-1,0):-2}function inflateReset(strm){var state;return strm&&strm.state?((state=strm.state).wsize=0,state.whave=0,state.wnext=0,inflateResetKeep(strm)):-2}function inflateReset2(strm,windowBits){var wrap,state;return strm&&strm.state?(state=strm.state,windowBits<0?(wrap=0,windowBits=-windowBits):(wrap=1+(windowBits>>4),windowBits<48&&(windowBits&=15)),windowBits&&(windowBits<8||windowBits>15)?-2:(null!==state.window&&state.wbits!==windowBits&&(state.window=null),state.wrap=wrap,state.wbits=windowBits,inflateReset(strm))):-2}function inflateInit2(strm,windowBits){var ret,state;return strm?(state=new InflateState,strm.state=state,state.window=null,0!==(ret=inflateReset2(strm,windowBits))&&(strm.state=null),ret):-2}function inflateInit(strm){return inflateInit2(strm,15)}var virgin=!0,lenfix,distfix;function fixedtables(state){if(virgin){var sym;for(lenfix=new utils.Buf32(512),distfix=new utils.Buf32(32),sym=0;sym<144;)state.lens[sym++]=8;for(;sym<256;)state.lens[sym++]=9;for(;sym<280;)state.lens[sym++]=7;for(;sym<288;)state.lens[sym++]=8;for(inflate_table(1,state.lens,0,288,lenfix,0,state.work,{bits:9}),sym=0;sym<32;)state.lens[sym++]=5;inflate_table(2,state.lens,0,32,distfix,0,state.work,{bits:5}),virgin=!1}state.lencode=lenfix,state.lenbits=9,state.distcode=distfix,state.distbits=5}function updatewindow(strm,src,end,copy){var dist,state=strm.state;return null===state.window&&(state.wsize=1<<state.wbits,state.wnext=0,state.whave=0,state.window=new utils.Buf8(state.wsize)),copy>=state.wsize?(utils.arraySet(state.window,src,end-state.wsize,state.wsize,0),state.wnext=0,state.whave=state.wsize):((dist=state.wsize-state.wnext)>copy&&(dist=copy),utils.arraySet(state.window,src,end-copy,dist,state.wnext),(copy-=dist)?(utils.arraySet(state.window,src,end-copy,copy,0),state.wnext=copy,state.whave=state.wsize):(state.wnext+=dist,state.wnext===state.wsize&&(state.wnext=0),state.whave<state.wsize&&(state.whave+=dist))),0}function inflate(strm,flush){var state,input,output,next,put,have,left,hold,bits,_in,_out,copy,from,from_source,here=0,here_bits,here_op,here_val,last_bits,last_op,last_val,len,ret,hbuf=new utils.Buf8(4),opts,n,order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!strm||!strm.state||!strm.output||!strm.input&&0!==strm.avail_in)return-2;12===(state=strm.state).mode&&(state.mode=13),put=strm.next_out,output=strm.output,left=strm.avail_out,next=strm.next_in,input=strm.input,have=strm.avail_in,hold=state.hold,bits=state.bits,_in=have,_out=left,ret=0;inf_leave:for(;;)switch(state.mode){case 1:if(0===state.wrap){state.mode=13;break}for(;bits<16;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(2&state.wrap&&35615===hold){state.check=0,hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0),hold=0,bits=0,state.mode=2;break}if(state.flags=0,state.head&&(state.head.done=!1),!(1&state.wrap)||(((255&hold)<<8)+(hold>>8))%31){strm.msg="incorrect header check",state.mode=30;break}if(8!=(15&hold)){strm.msg="unknown compression method",state.mode=30;break}if(bits-=4,len=8+(15&(hold>>>=4)),0===state.wbits)state.wbits=len;else if(len>state.wbits){strm.msg="invalid window size",state.mode=30;break}state.dmax=1<<len,strm.adler=state.check=1,state.mode=512&hold?10:12,hold=0,bits=0;break;case 2:for(;bits<16;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(state.flags=hold,8!=(255&state.flags)){strm.msg="unknown compression method",state.mode=30;break}if(57344&state.flags){strm.msg="unknown header flags set",state.mode=30;break}state.head&&(state.head.text=hold>>8&1),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0)),hold=0,bits=0,state.mode=3;case 3:for(;bits<32;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.head&&(state.head.time=hold),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,hbuf[2]=hold>>>16&255,hbuf[3]=hold>>>24&255,state.check=crc32(state.check,hbuf,4,0)),hold=0,bits=0,state.mode=4;case 4:for(;bits<16;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.head&&(state.head.xflags=255&hold,state.head.os=hold>>8),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0)),hold=0,bits=0,state.mode=5;case 5:if(1024&state.flags){for(;bits<16;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.length=hold,state.head&&(state.head.extra_len=hold),512&state.flags&&(hbuf[0]=255&hold,hbuf[1]=hold>>>8&255,state.check=crc32(state.check,hbuf,2,0)),hold=0,bits=0}else state.head&&(state.head.extra=null);state.mode=6;case 6:if(1024&state.flags&&((copy=state.length)>have&&(copy=have),copy&&(state.head&&(len=state.head.extra_len-state.length,state.head.extra||(state.head.extra=new Array(state.head.extra_len)),utils.arraySet(state.head.extra,input,next,copy,len)),512&state.flags&&(state.check=crc32(state.check,input,copy,next)),have-=copy,next+=copy,state.length-=copy),state.length))break inf_leave;state.length=0,state.mode=7;case 7:if(2048&state.flags){if(0===have)break inf_leave;copy=0;do{len=input[next+copy++],state.head&&len&&state.length<65536&&(state.head.name+=String.fromCharCode(len))}while(len&&copy<have);if(512&state.flags&&(state.check=crc32(state.check,input,copy,next)),have-=copy,next+=copy,len)break inf_leave}else state.head&&(state.head.name=null);state.length=0,state.mode=8;case 8:if(4096&state.flags){if(0===have)break inf_leave;copy=0;do{len=input[next+copy++],state.head&&len&&state.length<65536&&(state.head.comment+=String.fromCharCode(len))}while(len&&copy<have);if(512&state.flags&&(state.check=crc32(state.check,input,copy,next)),have-=copy,next+=copy,len)break inf_leave}else state.head&&(state.head.comment=null);state.mode=9;case 9:if(512&state.flags){for(;bits<16;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold!==(65535&state.check)){strm.msg="header crc mismatch",state.mode=30;break}hold=0,bits=0}state.head&&(state.head.hcrc=state.flags>>9&1,state.head.done=!0),strm.adler=state.check=0,state.mode=12;break;case 10:for(;bits<32;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}strm.adler=state.check=zswap32(hold),hold=0,bits=0,state.mode=11;case 11:if(0===state.havedict)return strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,2;strm.adler=state.check=1,state.mode=12;case 12:if(5===flush||6===flush)break inf_leave;case 13:if(state.last){hold>>>=7&bits,bits-=7&bits,state.mode=27;break}for(;bits<3;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}switch(state.last=1&hold,bits-=1,3&(hold>>>=1)){case 0:state.mode=14;break;case 1:if(fixedtables(state),state.mode=20,6===flush){hold>>>=2,bits-=2;break inf_leave}break;case 2:state.mode=17;break;case 3:strm.msg="invalid block type",state.mode=30}hold>>>=2,bits-=2;break;case 14:for(hold>>>=7&bits,bits-=7&bits;bits<32;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if((65535&hold)!=(hold>>>16^65535)){strm.msg="invalid stored block lengths",state.mode=30;break}if(state.length=65535&hold,hold=0,bits=0,state.mode=15,6===flush)break inf_leave;case 15:state.mode=16;case 16:if(copy=state.length){if(copy>have&&(copy=have),copy>left&&(copy=left),0===copy)break inf_leave;utils.arraySet(output,input,next,copy,put),have-=copy,next+=copy,left-=copy,put+=copy,state.length-=copy;break}state.mode=12;break;case 17:for(;bits<14;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(state.nlen=257+(31&hold),hold>>>=5,bits-=5,state.ndist=1+(31&hold),hold>>>=5,bits-=5,state.ncode=4+(15&hold),hold>>>=4,bits-=4,state.nlen>286||state.ndist>30){strm.msg="too many length or distance symbols",state.mode=30;break}state.have=0,state.mode=18;case 18:for(;state.have<state.ncode;){for(;bits<3;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.lens[order[state.have++]]=7&hold,hold>>>=3,bits-=3}for(;state.have<19;)state.lens[order[state.have++]]=0;if(state.lencode=state.lendyn,state.lenbits=7,opts={bits:state.lenbits},ret=inflate_table(0,state.lens,0,19,state.lencode,0,state.work,opts),state.lenbits=opts.bits,ret){strm.msg="invalid code lengths set",state.mode=30;break}state.have=0,state.mode=19;case 19:for(;state.have<state.nlen+state.ndist;){for(;here_op=(here=state.lencode[hold&(1<<state.lenbits)-1])>>>16&255,here_val=65535&here,!((here_bits=here>>>24)<=bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(here_val<16)hold>>>=here_bits,bits-=here_bits,state.lens[state.have++]=here_val;else{if(16===here_val){for(n=here_bits+2;bits<n;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold>>>=here_bits,bits-=here_bits,0===state.have){strm.msg="invalid bit length repeat",state.mode=30;break}len=state.lens[state.have-1],copy=3+(3&hold),hold>>>=2,bits-=2}else if(17===here_val){for(n=here_bits+3;bits<n;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}bits-=here_bits,len=0,copy=3+(7&(hold>>>=here_bits)),hold>>>=3,bits-=3}else{for(n=here_bits+7;bits<n;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}bits-=here_bits,len=0,copy=11+(127&(hold>>>=here_bits)),hold>>>=7,bits-=7}if(state.have+copy>state.nlen+state.ndist){strm.msg="invalid bit length repeat",state.mode=30;break}for(;copy--;)state.lens[state.have++]=len}}if(30===state.mode)break;if(0===state.lens[256]){strm.msg="invalid code -- missing end-of-block",state.mode=30;break}if(state.lenbits=9,opts={bits:state.lenbits},ret=inflate_table(1,state.lens,0,state.nlen,state.lencode,0,state.work,opts),state.lenbits=opts.bits,ret){strm.msg="invalid literal/lengths set",state.mode=30;break}if(state.distbits=6,state.distcode=state.distdyn,opts={bits:state.distbits},ret=inflate_table(2,state.lens,state.nlen,state.ndist,state.distcode,0,state.work,opts),state.distbits=opts.bits,ret){strm.msg="invalid distances set",state.mode=30;break}if(state.mode=20,6===flush)break inf_leave;case 20:state.mode=21;case 21:if(have>=6&&left>=258){strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,inflate_fast(strm,_out),put=strm.next_out,output=strm.output,left=strm.avail_out,next=strm.next_in,input=strm.input,have=strm.avail_in,hold=state.hold,bits=state.bits,12===state.mode&&(state.back=-1);break}for(state.back=0;here_op=(here=state.lencode[hold&(1<<state.lenbits)-1])>>>16&255,here_val=65535&here,!((here_bits=here>>>24)<=bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(here_op&&0==(240&here_op)){for(last_bits=here_bits,last_op=here_op,last_val=here_val;here_op=(here=state.lencode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)])>>>16&255,here_val=65535&here,!(last_bits+(here_bits=here>>>24)<=bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}hold>>>=last_bits,bits-=last_bits,state.back+=last_bits}if(hold>>>=here_bits,bits-=here_bits,state.back+=here_bits,state.length=here_val,0===here_op){state.mode=26;break}if(32&here_op){state.back=-1,state.mode=12;break}if(64&here_op){strm.msg="invalid literal/length code",state.mode=30;break}state.extra=15&here_op,state.mode=22;case 22:if(state.extra){for(n=state.extra;bits<n;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.length+=hold&(1<<state.extra)-1,hold>>>=state.extra,bits-=state.extra,state.back+=state.extra}state.was=state.length,state.mode=23;case 23:for(;here_op=(here=state.distcode[hold&(1<<state.distbits)-1])>>>16&255,here_val=65535&here,!((here_bits=here>>>24)<=bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(0==(240&here_op)){for(last_bits=here_bits,last_op=here_op,last_val=here_val;here_op=(here=state.distcode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)])>>>16&255,here_val=65535&here,!(last_bits+(here_bits=here>>>24)<=bits);){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}hold>>>=last_bits,bits-=last_bits,state.back+=last_bits}if(hold>>>=here_bits,bits-=here_bits,state.back+=here_bits,64&here_op){strm.msg="invalid distance code",state.mode=30;break}state.offset=here_val,state.extra=15&here_op,state.mode=24;case 24:if(state.extra){for(n=state.extra;bits<n;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}state.offset+=hold&(1<<state.extra)-1,hold>>>=state.extra,bits-=state.extra,state.back+=state.extra}if(state.offset>state.dmax){strm.msg="invalid distance too far back",state.mode=30;break}state.mode=25;case 25:if(0===left)break inf_leave;if(copy=_out-left,state.offset>copy){if((copy=state.offset-copy)>state.whave&&state.sane){strm.msg="invalid distance too far back",state.mode=30;break}copy>state.wnext?(copy-=state.wnext,from=state.wsize-copy):from=state.wnext-copy,copy>state.length&&(copy=state.length),from_source=state.window}else from_source=output,from=put-state.offset,copy=state.length;copy>left&&(copy=left),left-=copy,state.length-=copy;do{output[put++]=from_source[from++]}while(--copy);0===state.length&&(state.mode=21);break;case 26:if(0===left)break inf_leave;output[put++]=state.length,left--,state.mode=21;break;case 27:if(state.wrap){for(;bits<32;){if(0===have)break inf_leave;have--,hold|=input[next++]<<bits,bits+=8}if(_out-=left,strm.total_out+=_out,state.total+=_out,_out&&(strm.adler=state.check=state.flags?crc32(state.check,output,_out,put-_out):adler32(state.check,output,_out,put-_out)),_out=left,(state.flags?hold:zswap32(hold))!==state.check){strm.msg="incorrect data check",state.mode=30;break}hold=0,bits=0}state.mode=28;case 28:if(state.wrap&&state.flags){for(;bits<32;){if(0===have)break inf_leave;have--,hold+=input[next++]<<bits,bits+=8}if(hold!==(4294967295&state.total)){strm.msg="incorrect length check",state.mode=30;break}hold=0,bits=0}state.mode=29;case 29:ret=1;break inf_leave;case 30:ret=-3;break inf_leave;case 31:return-4;case 32:default:return-2}return strm.next_out=put,strm.avail_out=left,strm.next_in=next,strm.avail_in=have,state.hold=hold,state.bits=bits,(state.wsize||_out!==strm.avail_out&&state.mode<30&&(state.mode<27||4!==flush))&&updatewindow(strm,strm.output,strm.next_out,_out-strm.avail_out)?(state.mode=31,-4):(_in-=strm.avail_in,_out-=strm.avail_out,strm.total_in+=_in,strm.total_out+=_out,state.total+=_out,state.wrap&&_out&&(strm.adler=state.check=state.flags?crc32(state.check,output,_out,strm.next_out-_out):adler32(state.check,output,_out,strm.next_out-_out)),strm.data_type=state.bits+(state.last?64:0)+(12===state.mode?128:0)+(20===state.mode||15===state.mode?256:0),(0===_in&&0===_out||4===flush)&&0===ret&&(ret=-5),ret)}function inflateEnd(strm){if(!strm||!strm.state)return-2;var state=strm.state;return state.window&&(state.window=null),strm.state=null,0}function inflateGetHeader(strm,head){var state;return strm&&strm.state?0==(2&(state=strm.state).wrap)?-2:(state.head=head,head.done=!1,0):-2}function inflateSetDictionary(strm,dictionary){var dictLength=dictionary.length,state,dictid,ret;return strm&&strm.state?0!==(state=strm.state).wrap&&11!==state.mode?-2:11===state.mode&&(dictid=adler32(dictid=1,dictionary,dictLength,0))!==state.check?-3:(ret=updatewindow(strm,dictionary,dictLength,dictLength))?(state.mode=31,-4):(state.havedict=1,0):-2}exports.inflateReset=inflateReset,exports.inflateReset2=inflateReset2,exports.inflateResetKeep=inflateResetKeep,exports.inflateInit=inflateInit,exports.inflateInit2=inflateInit2,exports.inflate=inflate,exports.inflateEnd=inflateEnd,exports.inflateGetHeader=inflateGetHeader,exports.inflateSetDictionary=inflateSetDictionary,exports.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(require,module,exports){"use strict";var utils=require("../utils/common"),MAXBITS=15,ENOUGH_LENS=852,ENOUGH_DISTS=592,CODES=0,LENS=1,DISTS=2,lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];module.exports=function inflate_table(type,lens,lens_index,codes,table,table_index,work,opts){var bits=opts.bits,len=0,sym=0,min=0,max=0,root=0,curr=0,drop=0,left=0,used=0,huff=0,incr,fill,low,mask,next,base=null,base_index=0,end,count=new utils.Buf16(16),offs=new utils.Buf16(16),extra=null,extra_index=0,here_bits,here_op,here_val;for(len=0;len<=15;len++)count[len]=0;for(sym=0;sym<codes;sym++)count[lens[lens_index+sym]]++;for(root=bits,max=15;max>=1&&0===count[max];max--);if(root>max&&(root=max),0===max)return table[table_index++]=20971520,table[table_index++]=20971520,opts.bits=1,0;for(min=1;min<max&&0===count[min];min++);for(root<min&&(root=min),left=1,len=1;len<=15;len++)if(left<<=1,(left-=count[len])<0)return-1;if(left>0&&(0===type||1!==max))return-1;for(offs[1]=0,len=1;len<15;len++)offs[len+1]=offs[len]+count[len];for(sym=0;sym<codes;sym++)0!==lens[lens_index+sym]&&(work[offs[lens[lens_index+sym]]++]=sym);if(0===type?(base=extra=work,end=19):1===type?(base=lbase,base_index-=257,extra=lext,extra_index-=257,end=256):(base=dbase,extra=dext,end=-1),huff=0,sym=0,len=min,next=table_index,curr=root,drop=0,low=-1,mask=(used=1<<root)-1,1===type&&used>852||2===type&&used>592)return 1;for(;;){here_bits=len-drop,work[sym]<end?(here_op=0,here_val=work[sym]):work[sym]>end?(here_op=extra[extra_index+work[sym]],here_val=base[base_index+work[sym]]):(here_op=96,here_val=0),incr=1<<len-drop,min=fill=1<<curr;do{table[next+(huff>>drop)+(fill-=incr)]=here_bits<<24|here_op<<16|here_val|0}while(0!==fill);for(incr=1<<len-1;huff&incr;)incr>>=1;if(0!==incr?(huff&=incr-1,huff+=incr):huff=0,sym++,0==--count[len]){if(len===max)break;len=lens[lens_index+work[sym]]}if(len>root&&(huff&mask)!==low){for(0===drop&&(drop=root),next+=min,left=1<<(curr=len-drop);curr+drop<max&&!((left-=count[curr+drop])<=0);)curr++,left<<=1;if(used+=1<<curr,1===type&&used>852||2===type&&used>592)return 1;table[low=huff&mask]=root<<24|curr<<16|next-table_index|0}}return 0!==huff&&(table[next+huff]=len-drop<<24|64<<16|0),opts.bits=root,0}},{"../utils/common":1}],10:[function(require,module,exports){"use strict";module.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(require,module,exports){"use strict";function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}module.exports=ZStream},{}],"/lib/inflate.js":[function(require,module,exports){"use strict";var zlib_inflate=require("./zlib/inflate"),utils=require("./utils/common"),strings=require("./utils/strings"),c=require("./zlib/constants"),msg=require("./zlib/messages"),ZStream=require("./zlib/zstream"),GZheader=require("./zlib/gzheader"),toString=Object.prototype.toString;function Inflate(options){if(!(this instanceof Inflate))return new Inflate(options);this.options=utils.assign({chunkSize:16384,windowBits:0,to:""},options||{});var opt=this.options;opt.raw&&opt.windowBits>=0&&opt.windowBits<16&&(opt.windowBits=-opt.windowBits,0===opt.windowBits&&(opt.windowBits=-15)),!(opt.windowBits>=0&&opt.windowBits<16)||options&&options.windowBits||(opt.windowBits+=32),opt.windowBits>15&&opt.windowBits<48&&0==(15&opt.windowBits)&&(opt.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZStream,this.strm.avail_out=0;var status=zlib_inflate.inflateInit2(this.strm,opt.windowBits);if(status!==c.Z_OK)throw new Error(msg[status]);if(this.header=new GZheader,zlib_inflate.inflateGetHeader(this.strm,this.header),opt.dictionary&&("string"==typeof opt.dictionary?opt.dictionary=strings.string2buf(opt.dictionary):"[object ArrayBuffer]"===toString.call(opt.dictionary)&&(opt.dictionary=new Uint8Array(opt.dictionary)),opt.raw&&(status=zlib_inflate.inflateSetDictionary(this.strm,opt.dictionary))!==c.Z_OK))throw new Error(msg[status])}function inflate(input,options){var inflator=new Inflate(options);if(inflator.push(input,!0),inflator.err)throw inflator.msg||msg[inflator.err];return inflator.result}function inflateRaw(input,options){return(options=options||{}).raw=!0,inflate(input,options)}Inflate.prototype.push=function(data,mode){var strm=this.strm,chunkSize=this.options.chunkSize,dictionary=this.options.dictionary,status,_mode,next_out_utf8,tail,utf8str,allowBufError=!1;if(this.ended)return!1;_mode=mode===~~mode?mode:!0===mode?c.Z_FINISH:c.Z_NO_FLUSH,"string"==typeof data?strm.input=strings.binstring2buf(data):"[object ArrayBuffer]"===toString.call(data)?strm.input=new Uint8Array(data):strm.input=data,strm.next_in=0,strm.avail_in=strm.input.length;do{if(0===strm.avail_out&&(strm.output=new utils.Buf8(chunkSize),strm.next_out=0,strm.avail_out=chunkSize),(status=zlib_inflate.inflate(strm,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&dictionary&&(status=zlib_inflate.inflateSetDictionary(this.strm,dictionary)),status===c.Z_BUF_ERROR&&!0===allowBufError&&(status=c.Z_OK,allowBufError=!1),status!==c.Z_STREAM_END&&status!==c.Z_OK)return this.onEnd(status),this.ended=!0,!1;strm.next_out&&(0!==strm.avail_out&&status!==c.Z_STREAM_END&&(0!==strm.avail_in||_mode!==c.Z_FINISH&&_mode!==c.Z_SYNC_FLUSH)||("string"===this.options.to?(next_out_utf8=strings.utf8border(strm.output,strm.next_out),tail=strm.next_out-next_out_utf8,utf8str=strings.buf2string(strm.output,next_out_utf8),strm.next_out=tail,strm.avail_out=chunkSize-tail,tail&&utils.arraySet(strm.output,strm.output,next_out_utf8,tail,0),this.onData(utf8str)):this.onData(utils.shrinkBuf(strm.output,strm.next_out)))),0===strm.avail_in&&0===strm.avail_out&&(allowBufError=!0)}while((strm.avail_in>0||0===strm.avail_out)&&status!==c.Z_STREAM_END);return status===c.Z_STREAM_END&&(_mode=c.Z_FINISH),_mode===c.Z_FINISH?(status=zlib_inflate.inflateEnd(this.strm),this.onEnd(status),this.ended=!0,status===c.Z_OK):_mode!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),strm.avail_out=0,!0)},Inflate.prototype.onData=function(chunk){this.chunks.push(chunk)},Inflate.prototype.onEnd=function(status){status===c.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=utils.flattenChunks(this.chunks)),this.chunks=[],this.err=status,this.msg=this.strm.msg},exports.Inflate=Inflate,exports.inflate=inflate,exports.inflateRaw=inflateRaw,exports.ungzip=inflate},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")})),
/**
 * netcdfjs - Read and explore NetCDF files
 * @version v1.0.0
 * @link https://github.com/cheminfo-js/netcdfjs
 * @license MIT
 */
function webpackUniversalModuleDefinition(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory():"function"==typeof define&&define.amd?define([],factory):"object"==typeof exports?exports.netcdfjs=factory():root.netcdfjs=factory()}("undefined"!=typeof self?self:this,(function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module.default}:function getModuleExports(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=3)}([function(module,exports,__webpack_require__){"use strict";function notNetcdf(statement,reason){if(statement)throw new TypeError("Not a valid NetCDF v3.x file: ".concat(reason))}function padding(buffer){buffer.offset%4!=0&&buffer.skip(4-buffer.offset%4)}function readName(buffer){var nameLength=buffer.readUint32(),name=buffer.readChars(nameLength);return padding(buffer),name}module.exports.notNetcdf=notNetcdf,module.exports.padding=padding,module.exports.readName=readName},function(module,exports,__webpack_require__){!function(root){var stringFromCharCode=String.fromCharCode,byteArray,byteCount,byteIndex;function ucs2decode(string){for(var output=[],counter=0,length=string.length,value,extra;counter<length;)(value=string.charCodeAt(counter++))>=55296&&value<=56319&&counter<length?56320==(64512&(extra=string.charCodeAt(counter++)))?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--):output.push(value);return output}function ucs2encode(array){for(var length=array.length,index=-1,value,output="";++index<length;)(value=array[index])>65535&&(output+=stringFromCharCode((value-=65536)>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value);return output}function checkScalarValue(codePoint){if(codePoint>=55296&&codePoint<=57343)throw Error("Lone surrogate U+"+codePoint.toString(16).toUpperCase()+" is not a scalar value")}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint){if(0==(4294967168&codePoint))return stringFromCharCode(codePoint);var symbol="";return 0==(4294965248&codePoint)?symbol=stringFromCharCode(codePoint>>6&31|192):0==(4294901760&codePoint)?(checkScalarValue(codePoint),symbol=stringFromCharCode(codePoint>>12&15|224),symbol+=createByte(codePoint,6)):0==(4292870144&codePoint)&&(symbol=stringFromCharCode(codePoint>>18&7|240),symbol+=createByte(codePoint,12),symbol+=createByte(codePoint,6)),symbol+=stringFromCharCode(63&codePoint|128)}function utf8encode(string){for(var codePoints=ucs2decode(string),length=codePoints.length,index=-1,codePoint,byteString="";++index<length;)byteString+=encodeCodePoint(codePoint=codePoints[index]);return byteString}function readContinuationByte(){if(byteIndex>=byteCount)throw Error("Invalid byte index");var continuationByte=255&byteArray[byteIndex];if(byteIndex++,128==(192&continuationByte))return 63&continuationByte;throw Error("Invalid continuation byte")}function decodeSymbol(){var byte1,byte2,byte3,byte4,codePoint;if(byteIndex>byteCount)throw Error("Invalid byte index");if(byteIndex==byteCount)return!1;if(byte1=255&byteArray[byteIndex],byteIndex++,0==(128&byte1))return byte1;if(192==(224&byte1)){if((codePoint=(31&byte1)<<6|(byte2=readContinuationByte()))>=128)return codePoint;throw Error("Invalid continuation byte")}if(224==(240&byte1)){if((codePoint=(15&byte1)<<12|(byte2=readContinuationByte())<<6|(byte3=readContinuationByte()))>=2048)return checkScalarValue(codePoint),codePoint;throw Error("Invalid continuation byte")}if(240==(248&byte1)&&(codePoint=(7&byte1)<<18|(byte2=readContinuationByte())<<12|(byte3=readContinuationByte())<<6|(byte4=readContinuationByte()))>=65536&&codePoint<=1114111)return codePoint;throw Error("Invalid UTF-8 detected")}function utf8decode(byteString){byteArray=ucs2decode(byteString),byteCount=byteArray.length,byteIndex=0;for(var codePoints=[],tmp;!1!==(tmp=decodeSymbol());)codePoints.push(tmp);return ucs2encode(codePoints)}root.version="3.0.0",root.encode=utf8encode,root.decode=utf8decode}(exports)},function(module,exports,__webpack_require__){"use strict";const notNetcdf=__webpack_require__(0).notNetcdf,types={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function num2str(type){switch(Number(type)){case types.BYTE:return"byte";case types.CHAR:return"char";case types.SHORT:return"short";case types.INT:return"int";case types.FLOAT:return"float";case types.DOUBLE:return"double";default:return"undefined"}}function num2bytes(type){switch(Number(type)){case types.BYTE:case types.CHAR:return 1;case types.SHORT:return 2;case types.INT:case types.FLOAT:return 4;case types.DOUBLE:return 8;default:return-1}}function str2num(type){switch(String(type)){case"byte":return types.BYTE;case"char":return types.CHAR;case"short":return types.SHORT;case"int":return types.INT;case"float":return types.FLOAT;case"double":return types.DOUBLE;default:return-1}}function readNumber(size,bufferReader){if(1!==size){for(var numbers=new Array(size),i=0;i<size;i++)numbers[i]=bufferReader();return numbers}return bufferReader()}function readType(buffer,type,size){switch(type){case types.BYTE:return buffer.readBytes(size);case types.CHAR:return trimNull(buffer.readChars(size));case types.SHORT:return readNumber(size,buffer.readInt16.bind(buffer));case types.INT:return readNumber(size,buffer.readInt32.bind(buffer));case types.FLOAT:return readNumber(size,buffer.readFloat32.bind(buffer));case types.DOUBLE:return readNumber(size,buffer.readFloat64.bind(buffer));default:return void notNetcdf(!0,"non valid type ".concat(type))}}function trimNull(value){return 0===value.charCodeAt(value.length-1)?value.substring(0,value.length-1):value}module.exports=types,module.exports.num2str=num2str,module.exports.num2bytes=num2bytes,module.exports.str2num=str2num,module.exports.readType=readType},function(module,exports,__webpack_require__){"use strict";const{IOBuffer:IOBuffer}=__webpack_require__(4),utils=__webpack_require__(0),data=__webpack_require__(5),readHeader=__webpack_require__(6),toString=__webpack_require__(7);class NetCDFReader{constructor(data){const buffer=new IOBuffer(data);buffer.setBigEndian(),utils.notNetcdf("CDF"!==buffer.readChars(3),"should start with CDF");const version=buffer.readByte();utils.notNetcdf(version>2,"unknown version"),this.header=readHeader(buffer,version),this.buffer=buffer}get version(){return 1===this.header.version?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}getAttribute(attributeName){const attribute=this.globalAttributes.find(val=>val.name===attributeName);return attribute?attribute.value:null}getDataVariableAsString(variableName){const variable=this.getDataVariable(variableName);return variable?variable.join(""):null}get variables(){return this.header.variables}toString(){return toString.call(this)}getDataVariable(variableName){let variable;return variable="string"==typeof variableName?this.header.variables.find((function(val){return val.name===variableName})):variableName,utils.notNetcdf(void 0===variable,"variable not found: ".concat(variableName)),this.buffer.seek(variable.offset),variable.record?data.record(this.buffer,variable,this.header.recordDimension):data.nonRecord(this.buffer,variable)}dataVariableExists(variableName){const variable=this.header.variables.find((function(val){return val.name===variableName}));return void 0!==variable}attributeExists(attributeName){const attribute=this.globalAttributes.find(val=>val.name===attributeName);return void 0!==attribute}}module.exports=NetCDFReader},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"IOBuffer",(function(){return IOBuffer}));var utf8__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),utf8__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(utf8__WEBPACK_IMPORTED_MODULE_0__);const defaultByteLength=8192;class IOBuffer{constructor(){let data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8192,options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},dataIsGiven=!1;"number"==typeof data?data=new ArrayBuffer(data):(dataIsGiven=!0,this.lastWrittenByte=data.byteLength);const offset=options.offset?options.offset>>>0:0,byteLength=data.byteLength-offset;let dvOffset=offset;(ArrayBuffer.isView(data)||data instanceof IOBuffer)&&(data.byteLength!==data.buffer.byteLength&&(dvOffset=data.byteOffset+offset),data=data.buffer),this.lastWrittenByte=dataIsGiven?byteLength:0,this.buffer=data,this.length=byteLength,this.byteLength=byteLength,this.byteOffset=dvOffset,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,dvOffset,byteLength),this._mark=0,this._marks=[]}available(){let byteLength=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.offset+byteLength<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.offset+=n,this}seek(offset){return this.offset=offset,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const offset=this._marks.pop();if(void 0===offset)throw new Error("Mark stack empty");return this.seek(offset),this}rewind(){return this.offset=0,this}ensureAvailable(){let byteLength=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(!this.available(byteLength)){const lengthNeeded=this.offset+byteLength,newLength=2*lengthNeeded,newArray=new Uint8Array(newLength);newArray.set(new Uint8Array(this.buffer)),this.buffer=newArray.buffer,this.length=this.byteLength=newLength,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const bytes=new Uint8Array(n);for(let i=0;i<n;i++)bytes[i]=this.readByte();return bytes}readInt16(){const value=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,value}readUint16(){const value=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,value}readInt32(){const value=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,value}readUint32(){const value=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,value}readFloat32(){const value=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,value}readFloat64(){const value=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,value}readChar(){return String.fromCharCode(this.readInt8())}readChars(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,result="";for(let i=0;i<n;i++)result+=this.readChar();return result}readUtf8(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const bString=this.readChars(n);return Object(utf8__WEBPACK_IMPORTED_MODULE_0__.decode)(bString)}writeBoolean(value){return this.writeUint8(value?255:0),this}writeInt8(value){return this.ensureAvailable(1),this._data.setInt8(this.offset++,value),this._updateLastWrittenByte(),this}writeUint8(value){return this.ensureAvailable(1),this._data.setUint8(this.offset++,value),this._updateLastWrittenByte(),this}writeByte(value){return this.writeUint8(value)}writeBytes(bytes){this.ensureAvailable(bytes.length);for(let i=0;i<bytes.length;i++)this._data.setUint8(this.offset++,bytes[i]);return this._updateLastWrittenByte(),this}writeInt16(value){return this.ensureAvailable(2),this._data.setInt16(this.offset,value,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(value){return this.ensureAvailable(2),this._data.setUint16(this.offset,value,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(value){return this.ensureAvailable(4),this._data.setInt32(this.offset,value,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(value){return this.ensureAvailable(4),this._data.setUint32(this.offset,value,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(value){return this.ensureAvailable(4),this._data.setFloat32(this.offset,value,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(value){return this.ensureAvailable(8),this._data.setFloat64(this.offset,value,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(str){return this.writeUint8(str.charCodeAt(0))}writeChars(str){for(let i=0;i<str.length;i++)this.writeUint8(str.charCodeAt(i));return this}writeUtf8(str){const bString=Object(utf8__WEBPACK_IMPORTED_MODULE_0__.encode)(str);return this.writeChars(bString)}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}},function(module,exports,__webpack_require__){"use strict";const types=__webpack_require__(2);function nonRecord(buffer,variable){const type=types.str2num(variable.type);for(var size=variable.size/types.num2bytes(type),data=new Array(size),i=0;i<size;i++)data[i]=types.readType(buffer,type,1);return data}function record(buffer,variable,recordDimension){const type=types.str2num(variable.type),width=variable.size?variable.size/types.num2bytes(type):1;var size=recordDimension.length,data=new Array(size);const step=recordDimension.recordStep;for(var i=0;i<size;i++){var currentOffset=buffer.offset;data[i]=types.readType(buffer,type,width),buffer.seek(currentOffset+step)}return data}module.exports.nonRecord=nonRecord,module.exports.record=record},function(module,exports,__webpack_require__){"use strict";const utils=__webpack_require__(0),types=__webpack_require__(2),ZERO=0,NC_DIMENSION=10,NC_VARIABLE=11,NC_ATTRIBUTE=12;function header(buffer,version){var header={recordDimension:{length:buffer.readUint32()}};header.version=version;var dimList=dimensionsList(buffer);header.recordDimension.id=dimList.recordId,header.recordDimension.name=dimList.recordName,header.dimensions=dimList.dimensions,header.globalAttributes=attributesList(buffer);var variables=variablesList(buffer,dimList.recordId,version);return header.variables=variables.variables,header.recordDimension.recordStep=variables.recordStep,header}const NC_UNLIMITED=0;function dimensionsList(buffer){var recordId,recordName;const dimList=buffer.readUint32();if(0===dimList)return utils.notNetcdf(0!==buffer.readUint32(),"wrong empty tag for list of dimensions"),[];{utils.notNetcdf(10!==dimList,"wrong tag for list of dimensions");const dimensionSize=buffer.readUint32();for(var dimensions=new Array(dimensionSize),dim=0;dim<dimensionSize;dim++){var name=utils.readName(buffer);const size=buffer.readUint32();0===size&&(recordId=dim,recordName=name),dimensions[dim]={name:name,size:size}}}return{dimensions:dimensions,recordId:recordId,recordName:recordName}}function attributesList(buffer){const gAttList=buffer.readUint32();if(0===gAttList)return utils.notNetcdf(0!==buffer.readUint32(),"wrong empty tag for list of attributes"),[];{utils.notNetcdf(12!==gAttList,"wrong tag for list of attributes");const attributeSize=buffer.readUint32();for(var attributes=new Array(attributeSize),gAtt=0;gAtt<attributeSize;gAtt++){var name=utils.readName(buffer),type=buffer.readUint32();utils.notNetcdf(type<1||type>6,"non valid type ".concat(type));var size=buffer.readUint32(),value=types.readType(buffer,type,size);utils.padding(buffer),attributes[gAtt]={name:name,type:types.num2str(type),value:value}}}return attributes}function variablesList(buffer,recordId,version){const varList=buffer.readUint32();var recordStep=0;if(0===varList)return utils.notNetcdf(0!==buffer.readUint32(),"wrong empty tag for list of variables"),[];{utils.notNetcdf(11!==varList,"wrong tag for list of variables");const variableSize=buffer.readUint32();for(var variables=new Array(variableSize),v=0;v<variableSize;v++){var name=utils.readName(buffer);const dimensionality=buffer.readUint32();for(var dimensionsIds=new Array(dimensionality),dim=0;dim<dimensionality;dim++)dimensionsIds[dim]=buffer.readUint32();var attributes=attributesList(buffer),type=buffer.readUint32();utils.notNetcdf(type<1&&type>6,"non valid type ".concat(type));const varSize=buffer.readUint32();var offset=buffer.readUint32();2===version&&(utils.notNetcdf(offset>0,"offsets larger than 4GB not supported"),offset=buffer.readUint32());let record=!1;void 0!==recordId&&dimensionsIds[0]===recordId&&(recordStep+=varSize,record=!0),variables[v]={name:name,dimensions:dimensionsIds,attributes:attributes,type:types.num2str(type),size:varSize,offset:offset,record:record}}}return{variables:variables,recordStep:recordStep}}module.exports=header},function(module,exports,__webpack_require__){"use strict";function toString(){let result=[];result.push("DIMENSIONS");for(let dimension of this.dimensions)result.push("  ".concat(dimension.name.padEnd(30)," = size: ").concat(dimension.size));result.push(""),result.push("GLOBAL ATTRIBUTES");for(let attribute of this.globalAttributes)result.push("  ".concat(attribute.name.padEnd(30)," = ").concat(attribute.value));let variables=JSON.parse(JSON.stringify(this.variables));result.push(""),result.push("VARIABLES:");for(let variable of variables){variable.value=this.getDataVariable(variable);let stringify=JSON.stringify(variable.value);stringify.length>50&&(stringify=stringify.substring(0,50)),isNaN(variable.value.length)||(stringify+=" (length: ".concat(variable.value.length,")")),result.push("  ".concat(variable.name.padEnd(30)," = ").concat(stringify))}return result.join("\n")}module.exports=toString}])})),$3Dmol=function(window){var my;return window.$3Dmol||{}}(window),"object"==typeof module&&"object"==typeof module.exports&&(module.exports=$3Dmol),$3Dmol.notrack,String.prototype.startsWith||(String.prototype.startsWith=function(str){return 0===this.lastIndexOf(str,0)}),String.prototype.endsWith||(String.prototype.endsWith=function(suffix){return-1!==this.indexOf(suffix,this.length-suffix.length)}),$.ajaxTransport("+binary",(function(options,originalOptions,jqXHR){if(window.FormData&&(options.dataType&&"binary"==options.dataType||options.data&&(window.ArrayBuffer&&options.data instanceof ArrayBuffer||window.Blob&&options.data instanceof Blob)))return{send:function(headers,callback){var xhr=new XMLHttpRequest,url=options.url,type=options.type,async=options.async||!0,dataType=options.responseType||"blob",data=options.data||null,username=options.username||null,password=options.password||null,xhrret=function(){var data={};data[options.dataType]=xhr.response,callback(xhr.status,xhr.statusText,data,xhr.getAllResponseHeaders())};for(var i in xhr.addEventListener("load",xhrret),xhr.addEventListener("error",xhrret),xhr.addEventListener("abort",xhrret),xhr.open(type,url,async,username,password),headers)xhr.setRequestHeader(i,headers[i]);xhr.responseType=dataType,xhr.send(data)},abort:function(){jqXHR.abort()}}})),$3Dmol.createViewer=function(element,config,shared_viewer_resources){if("string"==typeof element&&(element=$("#"+element)),element){config=config||{},shared_viewer_resources=shared_viewer_resources||{};try{return new $3Dmol.GLViewer(element,config,shared_viewer_resources)}catch(e){throw"error creating viewer: "+e}return null}},$3Dmol.createViewerGrid=function(element,config,viewer_config){if("string"==typeof element&&(element=$("#"+element)),element){config=config||{},viewer_config=viewer_config||{};var viewers=[],canvas=document.createElement("canvas");viewer_config.rows=config.rows,viewer_config.cols=config.cols,viewer_config.control_all=null!=config.control_all&&config.control_all,$(element).append($(canvas));try{for(var r=0;r<config.rows;r++){for(var row=[],c=0;c<config.cols;c++){viewer_config.row=r,viewer_config.col=c,viewer_config.canvas=canvas,viewer_config.viewers=viewers,viewer_config.control_all=config.control_all;var viewer=$3Dmol.createViewer(element,viewer_config);row.push(viewer)}viewers.unshift(row)}}catch(e){throw"error creating viewer grid: "+e}return viewers}},$3Dmol.viewers={},$3Dmol.getbin=function(uri,callback,request,postdata){var promise=new Promise((function(resolve,reject){request=null==request?"GET":request,$.ajax({url:uri,dataType:"binary",method:request,data:postdata,responseType:"arraybuffer",processData:!1}).done((function(ret){resolve(ret)})).fail((function(e,txt){console.log(txt),reject()}))}));return callback?promise.then(callback):promise},$3Dmol.base64ToArray=function(base64){for(var binary_string=window.atob(base64),len=binary_string.length,bytes=new Uint8Array(len),i=0;i<len;i++)bytes[i]=binary_string.charCodeAt(i);return bytes},$3Dmol.download=function(query,viewer,options,callback){var type="",pdbUri="",mmtfUri="",uri="",promise=null,m=viewer.addModel();if("mmtf:"===query.substr(0,5))pdbUri=options&&options.pdbUri?options.pdbUri:"https://mmtf.rcsb.org/v1.0/full/",query=query.substr(5).toUpperCase(),uri=pdbUri+query,options&&void 0===options.noComputeSecondaryStructure&&(options.noComputeSecondaryStructure=!0),promise=new Promise((function(resolve){$3Dmol.getbin(uri).then((function(ret){m.addMolData(ret,"mmtf",options),viewer.zoomTo(),viewer.render(),resolve(m)}))}));else{if("pdb:"===query.substr(0,4)){if(type="mmtf",options&&options.format&&(type=options.format),options&&void 0===options.noComputeSecondaryStructure&&(options.noComputeSecondaryStructure=!0),!(query=query.substr(4).toUpperCase()).match(/^[1-9][A-Za-z0-9]{3}$/))return void alert("Wrong PDB ID");"mmtf"==type?(mmtfUri=options&&options.mmtfUri?options.mmtfUri:"https://mmtf.rcsb.org/v1.0/full/",uri=mmtfUri+query.toUpperCase()):(pdbUri=options&&options.pdbUri?options.pdbUri:"https://files.rcsb.org/view/",uri=pdbUri+query+"."+type)}else if("cid:"==query.substr(0,4)){if(type="sdf",!(query=query.substr(4)).match(/^[0-9]+$/))return void alert("Wrong Compound ID");uri="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+query+"/SDF?record_type=3d"}else"url:"==query.substr(0,4)&&(uri=query.substr(4),type=uri);var handler=function(ret){m.addMolData(ret,type,options),viewer.zoomTo(),viewer.render()};promise=new Promise((function(resolve){"mmtf"==type?$3Dmol.getbin(uri).then((function(ret){handler(ret),resolve(m)})):$.get(uri,(function(ret){handler(ret),resolve(m)})).fail((function(e){console.log("fetch of "+uri+" failed: "+e.statusText)}))}))}return callback?(promise.then((function(m){callback(m)})),m):promise},$3Dmol.SurfaceType={VDW:1,MS:2,SAS:3,SES:4},$3Dmol.mergeGeos=function(geometry,mesh){var meshGeo=mesh.geometry;void 0!==meshGeo&&geometry.geometryGroups.push(meshGeo.geometryGroups[0])},$3Dmol.multiLineString=function(f){return f.toString().replace(/^[^\/]+\/\*!?/,"").replace(/\*\/[^\/]+$/,"")},$3Dmol.syncSurface=!1,(window.navigator.userAgent.indexOf("MSIE ")>=0||window.navigator.userAgent.indexOf("Trident/")>=0)&&($3Dmol.syncSurface=!0),$3Dmol.specStringToObject=function(str){if("object"==typeof str)return str;if(void 0===str||null==str)return str;var massage=function(val){return $3Dmol.isNumeric(val)?Math.floor(parseFloat(val))==parseInt(val)?parseFloat(val):val.indexOf(".")>=0?parseFloat(val):parseInt(val):"true"===val||"false"!==val&&val},ret={};if("all"===(str=str.replace(/%7E/,"~")))return ret;for(var fields=str.split(";"),i=0;i<fields.length;i++){var fv=fields[i].split(":"),f=fv[0],val={},vstr=fv[1];if(vstr)if(-1!==(vstr=vstr.replace(/~/g,"=")).indexOf("="))for(var kvs=vstr.split(","),j=0;j<kvs.length;j++){var kv=kvs[j].split("=",2);val[kv[0]]=massage(kv[1])}else val=-1!==vstr.indexOf(",")?vstr.split(","):massage(vstr);ret[f]=val}return ret},$3Dmol.getExtent=function(atomlist,ignoreSymmetries){var xmin,ymin,zmin,xmax,ymax,zmax,xsum,ysum,zsum,cnt,includeSym=!ignoreSymmetries;if(xmin=ymin=zmin=9999,xmax=ymax=zmax=-9999,xsum=ysum=zsum=cnt=0,0===atomlist.length)return[[0,0,0],[0,0,0],[0,0,0]];for(var i=0;i<atomlist.length;i++){var atom=atomlist[i];if(void 0!==atom&&isFinite(atom.x)&&isFinite(atom.y)&&isFinite(atom.z)&&(cnt++,xsum+=atom.x,ysum+=atom.y,zsum+=atom.z,xmin=xmin<atom.x?xmin:atom.x,ymin=ymin<atom.y?ymin:atom.y,zmin=zmin<atom.z?zmin:atom.z,xmax=xmax>atom.x?xmax:atom.x,ymax=ymax>atom.y?ymax:atom.y,zmax=zmax>atom.z?zmax:atom.z,atom.symmetries&&includeSym))for(var n=0;n<atom.symmetries.length;n++)cnt++,xsum+=atom.symmetries[n].x,ysum+=atom.symmetries[n].y,zsum+=atom.symmetries[n].z,xmin=xmin<atom.symmetries[n].x?xmin:atom.symmetries[n].x,ymin=ymin<atom.symmetries[n].y?ymin:atom.symmetries[n].y,zmin=zmin<atom.symmetries[n].z?zmin:atom.symmetries[n].z,xmax=xmax>atom.symmetries[n].x?xmax:atom.symmetries[n].x,ymax=ymax>atom.symmetries[n].y?ymax:atom.symmetries[n].y,zmax=zmax>atom.symmetries[n].z?zmax:atom.symmetries[n].z}return[[xmin,ymin,zmin],[xmax,ymax,zmax],[xsum/cnt,ysum/cnt,zsum/cnt]]},$3Dmol.getAtomProperty=function(atom,prop){var val=null;return atom.properties&&void 0!==atom.properties[prop]?val=atom.properties[prop]:void 0!==atom[prop]&&(val=atom[prop]),val},$3Dmol.getPropertyRange=function(atomlist,prop){for(var min=Number.POSITIVE_INFINITY,max=Number.NEGATIVE_INFINITY,i=0,n=atomlist.length;i<n;i++){var atom=atomlist[i],val=$3Dmol.getAtomProperty(atom,prop);null!=val&&(val<min&&(min=val),val>max&&(max=val))}return isFinite(min)||isFinite(max)?isFinite(min)?isFinite(max)||(max=min):min=max:min=max=0,[min,max]},"function"==typeof define&&define.amd&&define("$3Dmol",[],(function(){return $3Dmol})),$3Dmol.createStereoViewer=function(element){var that=this;if("string"==typeof element&&(element=$("#"+element)),element){var viewers=$3Dmol.createViewerGrid(element,{rows:1,cols:2,control_all:!0});this.glviewer1=viewers[0][0],this.glviewer2=viewers[0][1],this.glviewer1.setAutoEyeSeparation(!1),this.glviewer2.setAutoEyeSeparation(!0),this.glviewer1.linkViewer(this.glviewer2),this.glviewer2.linkViewer(this.glviewer1);for(var methods=Object.getOwnPropertyNames(this.glviewer1).filter((function(property){return"function"==typeof that.glviewer1[property]})),i=0;i<methods.length;i++)this[methods[i]]=function(method){return function(){var m1=this.glviewer1[method].apply(this.glviewer1,arguments),m2=this.glviewer2[method].apply(this.glviewer2,arguments);return[m1,m2]}}(methods[i]);this.setCoordinates=function(models,data,format){for(var i=0;i<models.length;i++)models[i].setCoordinates(data,format)},this.surfacesFinished=function(){return this.glviewer1.surfacesFinished()&&this.glviewer2.surfacesFinished()},this.isAnimated=function(){return this.glviewer1.isAnimated()||this.glviewer2.isAnimated()},this.render=function(callback){this.glviewer1.render(),this.glviewer2.render(),callback&&callback(this)},this.getCanvas=function(){return this.glviewer1.getCanvas()}}},$3Dmol.extend=function(obj1,src1){for(var key in src1)src1.hasOwnProperty(key)&&void 0!==src1[key]&&(obj1[key]=src1[key]);return obj1},$3Dmol.deepCopy=function(inObject){let outObject,value,key;if(null==inObject)return{};if("object"!=typeof inObject||null===inObject)return inObject;for(key in outObject=Array.isArray(inObject)?[]:{},inObject)value=inObject[key],outObject[key]=$3Dmol.deepCopy(value);return outObject},$3Dmol.isNumeric=function(obj){var type=typeof obj;return("number"===type||"string"===type)&&!isNaN(obj-parseFloat(obj))},$3Dmol.isEmptyObject=function(obj){var name;for(name in obj)return!1;return!0};var $3Dmol=$3Dmol||{};$3Dmol.Math={clamp:function(x,min,max){return Math.min(Math.max(x,min),max)},degToRad:function(){var degreeToRadiansFactor=Math.PI/180;return function(deg){return deg*degreeToRadiansFactor}}()},$3Dmol.Quaternion=function(x,y,z,w){this.x=x||0,this.y=y||0,this.z=z||0,this.w=void 0!==w?w:1},$3Dmol.Quaternion.prototype={constructor:$3Dmol.Quaternion,set:function(x,y,z,w){return this.x=x,this.y=y,this.z=z,this.w=w,this},copy:function(q){return this.x=q.x,this.y=q.y,this.z=q.z,this.w=q.w,this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},inverse:function(){return this.conjugate().normalize()},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthxyz:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var l=this.length();return 0===l?(this.x=0,this.y=0,this.z=0,this.w=1):(l=1/l,this.x*=l,this.y*=l,this.z*=l,this.w*=l),this},multiply:function(q){return this.multiplyQuaternions(this,q)},multiplyScalar:function(s){return this.x*=s,this.y*=s,this.z*=s,this.w*=s,this},multiplyQuaternions:function(a,b){var qax=a.x,qay=a.y,qaz=a.z,qaw=a.w,qbx=b.x,qby=b.y,qbz=b.z,qbw=b.w;return this.x=qax*qbw+qaw*qbx+qay*qbz-qaz*qby,this.y=qay*qbw+qaw*qby+qaz*qbx-qax*qbz,this.z=qaz*qbw+qaw*qbz+qax*qby-qay*qbx,this.w=qaw*qbw-qax*qbx-qay*qby-qaz*qbz,this},sub:function(q){return this.x-=q.x,this.y-=q.y,this.z-=q.z,this.w-=q.w,this},clone:function(){return new $3Dmol.Quaternion(this.x,this.y,this.z,this.w)},setFromEuler:function(e){var c1=Math.cos(e.x/2),c2=Math.cos(e.y/2),c3=Math.cos(e.z/2),s1=Math.sin(e.x/2),s2=Math.sin(e.y/2),s3=Math.sin(e.z/2);return this.x=s1*c2*c3+c1*s2*s3,this.y=c1*s2*c3-s1*c2*s3,this.z=c1*c2*s3+s1*s2*c3,this.w=c1*c2*c3-s1*s2*s3,this}},$3Dmol.Vector2=function(x,y){this.x=x||0,this.y=y||0},$3Dmol.Vector2.prototype={constructor:$3Dmol.Vector2,set:function(x,y){return this.x=x,this.y=y,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},copy:function(v){return this.x=v.x,this.y=v.y,this},clone:function(){return new $3Dmol.Vector2(this.x,this.y)}},$3Dmol.Vector3=function(x,y,z){this.x=x||0,this.y=y||0,this.z=z||0},$3Dmol.Vector3.prototype={constructor:$3Dmol.Vector3,set:function(x,y,z){return this.x=x,this.y=y,this.z=z,this},copy:function(v){return this.x=v.x,this.y=v.y,this.z=v.z,this},add:function(v){return this.x+=v.x,this.y+=v.y,this.z+=v.z,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},sub:function(v){return this.x-=v.x,this.y-=v.y,this.z-=v.z,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},multiplyScalar:function(s){return this.x*=s,this.y*=s,this.z*=s,this},divideScalar:function(s){return 0!==s?(this.x/=s,this.y/=s,this.z/=s):(this.x=0,this.y=0,this.z=0),this},max:function(s){return this.x=Math.max(this.x,s.x),this.y=Math.max(this.y,s.y),this.z=Math.max(this.z,s.z),this},min:function(s){return this.x=Math.min(this.x,s.x),this.y=Math.min(this.y,s.y),this.z=Math.min(this.z,s.z),this},distanceTo:function(v){return Math.sqrt(this.distanceToSquared(v))},distanceToSquared:function(v){var dx=this.x-v.x,dy=this.y-v.y,dz=this.z-v.z;return dx*dx+dy*dy+dz*dz},applyMatrix3:function(m){var x=this.x,y=this.y,z=this.z,e=m.elements;return this.x=e[0]*x+e[3]*y+e[6]*z,this.y=e[1]*x+e[4]*y+e[7]*z,this.z=e[2]*x+e[5]*y+e[8]*z,this},applyMatrix4:function(m){var x=this.x,y=this.y,z=this.z,e=m.elements;return this.x=e[0]*x+e[4]*y+e[8]*z+e[12],this.y=e[1]*x+e[5]*y+e[9]*z+e[13],this.z=e[2]*x+e[6]*y+e[10]*z+e[14],this},applyProjection:function(m){var x=this.x,y=this.y,z=this.z,e=m.elements,d=e[3]*x+e[7]*y+e[11]*z+e[15];return this.x=(e[0]*x+e[4]*y+e[8]*z+e[12])/d,this.y=(e[1]*x+e[5]*y+e[9]*z+e[13])/d,this.z=(e[2]*x+e[6]*y+e[10]*z+e[14])/d,this},applyQuaternion:function(q){var x=this.x,y=this.y,z=this.z,qx=q.x,qy=q.y,qz=q.z,qw=q.w,t={};t.x=2*(y*qz-z*qy),t.y=2*(z*qx-x*qz),t.z=2*(x*qy-y*qx);var t2={};return t2.x=t.y*qz-t.z*qy,t2.y=t.z*qx-t.x*qz,t2.z=t.x*qy-t.y*qx,this.x=x+qw*t.x+t2.x,this.y=y+qw*t.y+t2.y,this.z=z+qw*t.z+t2.z,this},negate:function(){return this.multiplyScalar(-1)},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(){return this.divideScalar(this.length())},cross:function(v){var x=this.x,y=this.y,z=this.z;return this.x=y*v.z-z*v.y,this.y=z*v.x-x*v.z,this.z=x*v.y-y*v.x,this},crossVectors:function(a,b){return this.x=a.y*b.z-a.z*b.y,this.y=a.z*b.x-a.x*b.z,this.z=a.x*b.y-a.y*b.x,this},getPositionFromMatrix:function(m){return this.x=m.elements[12],this.y=m.elements[13],this.z=m.elements[14],this},setEulerFromRotationMatrix:function(m,order){var te=m.elements,m11=te[0],m12=te[4],m13=te[8],m22=te[5],m23=te[9],m32=te[6],m33=te[10];return void 0===order||"XYZ"===order?(this.y=Math.asin($3Dmol.Math.clamp(m13,-1,1)),Math.abs(m13)<.99999?(this.x=Math.atan2(-m23,m33),this.z=Math.atan2(-m12,m11)):(this.x=Math.atan2(m32,m22),this.z=0)):console.error("Error with vector's setEulerFromRotationMatrix: Unknown order: "+order),this},rotateAboutVector:function(axis,ang){axis.normalize();var cosang=Math.cos(ang),sinang=Math.sin(ang),term1=this.clone().multiplyScalar(cosang),term2=axis.clone().cross(this).multiplyScalar(sinang),term3=axis.clone().multiplyScalar(axis.clone().dot(this)).multiplyScalar(1-cosang),rot=term1.add(term2).add(term3);return this.x=rot.x,this.y=rot.y,this.z=rot.z,this},setFromMatrixPosition:function(m){var e=m.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},transformDirection:function(m){var x=this.x,y=this.y,z=this.z,e=m.elements;return this.x=e[0]*x+e[4]*y+e[8]*z,this.y=e[1]*x+e[5]*y+e[9]*z,this.z=e[2]*x+e[6]*y+e[10]*z,this.normalize()},clone:function(){return new $3Dmol.Vector3(this.x,this.y,this.z)}},$3Dmol.Matrix3=function(n11,n12,n13,n21,n22,n23,n31,n32,n33){this.elements=new Float32Array(9),this.set(void 0!==n11?n11:1,n12||0,n13||0,n21||0,void 0!==n22?n22:1,n23||0,n31||0,n32||0,void 0!==n33?n33:1)},$3Dmol.square=function(n){return n*n},$3Dmol.conversionMatrix3=function(a,b,c,alpha,beta,gamma){alpha=alpha*Math.PI/180,beta=beta*Math.PI/180,gamma=gamma*Math.PI/180;let sqr=$3Dmol.square,cos_alpha=Math.cos(alpha),cos_beta=Math.cos(beta),cos_gamma=Math.cos(gamma),sin_gamma=Math.sin(gamma),conversionMatrix;return new $3Dmol.Matrix3(a,b*cos_gamma,c*cos_beta,0,b*sin_gamma,c*(cos_alpha-cos_beta*cos_gamma)/sin_gamma,0,0,c*Math.sqrt(1-sqr(cos_alpha)-sqr(cos_beta)-sqr(cos_gamma)+2*cos_alpha*cos_beta*cos_gamma)/sin_gamma)},$3Dmol.Matrix3.prototype={constructor:$3Dmol.Matrix3,set:function(n11,n12,n13,n21,n22,n23,n31,n32,n33){var te=this.elements;return te[0]=n11,te[3]=n12,te[6]=n13,te[1]=n21,te[4]=n22,te[7]=n23,te[2]=n31,te[5]=n32,te[8]=n33,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(m){var me=m.elements;this.set(me[0],me[3],me[6],me[1],me[4],me[7],me[2],me[5],me[8])},multiplyScalar:function(s){var te=this.elements;return te[0]*=s,te[3]*=s,te[6]*=s,te[1]*=s,te[4]*=s,te[7]*=s,te[2]*=s,te[5]*=s,te[8]*=s,this},getInverse3:function(matrix){let me=matrix.elements,te=this.elements;te[0]=me[4]*me[8]-me[5]*me[7],te[3]=me[6]*me[5]-me[3]*me[8],te[6]=me[3]*me[7]-me[6]*me[4],te[1]=me[7]*me[2]-me[1]*me[8],te[4]=me[0]*me[8]-me[6]*me[2],te[7]=me[1]*me[6]-me[0]*me[7],te[2]=me[1]*me[5]-me[2]*me[4],te[5]=me[2]*me[3]-me[0]*me[5],te[8]=me[0]*me[4]-me[1]*me[3];let det=me[0]*te[0]+me[3]*te[1]+me[6]*te[2];return this.multiplyScalar(1/det),this},getInverse:function(matrix,throwOnInvertible){var me=matrix.elements,te=this.elements;te[0]=me[10]*me[5]-me[6]*me[9],te[1]=-me[10]*me[1]+me[2]*me[9],te[2]=me[6]*me[1]-me[2]*me[5],te[3]=-me[10]*me[4]+me[6]*me[8],te[4]=me[10]*me[0]-me[2]*me[8],te[5]=-me[6]*me[0]+me[2]*me[4],te[6]=me[9]*me[4]-me[5]*me[8],te[7]=-me[9]*me[0]+me[1]*me[8],te[8]=me[5]*me[0]-me[1]*me[4];var det=me[0]*te[0]+me[1]*te[3]+me[2]*te[6];if(0===det){var msg="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(throwOnInvertible)throw new Error(msg);return console.warn(msg),this.identity(),this}return this.multiplyScalar(1/det),this},getDeterminant:function(){var m=this.elements,determinant;return m[0]*m[4]*m[8]+m[1]*m[5]*m[6]+m[2]*m[3]*m[7]-m[2]*m[4]*m[6]-m[1]*m[3]*m[8]-m[0]*m[5]*m[7]},getMatrix4:function(){var m=this.elements;return new $3Dmol.Matrix4(m[0],m[3],m[6],0,m[1],m[4],m[7],0,m[2],m[5],m[8],0)},transpose:function(){var tmp,m=this.elements;return tmp=m[1],m[1]=m[3],m[3]=tmp,tmp=m[2],m[2]=m[6],m[6]=tmp,tmp=m[5],m[5]=m[7],m[7]=tmp,this},clone:function(){var te=this.elements;return new $3Dmol.Matrix3(te[0],te[3],te[6],te[1],te[4],te[7],te[2],te[5],te[8])}},$3Dmol.Matrix4=function(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){if(void 0===n12&&void 0!==n11)this.elements=new Float32Array(n11);else{var te=this.elements=new Float32Array(16);te[0]=void 0!==n11?n11:1,te[4]=n12||0,te[8]=n13||0,te[12]=n14||0,te[1]=n21||0,te[5]=void 0!==n22?n22:1,te[9]=n23||0,te[13]=n24||0,te[2]=n31||0,te[6]=n32||0,te[10]=void 0!==n33?n33:1,te[14]=n34||0,te[3]=n41||0,te[7]=n42||0,te[11]=n43||0,te[15]=void 0!==n44?n44:1}},$3Dmol.Matrix4.prototype={constructor:$3Dmol.Matrix4,set:function(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){var te=this.elements;return te[0]=n11,te[4]=n12,te[8]=n13,te[12]=n14,te[1]=n21,te[5]=n22,te[9]=n23,te[13]=n24,te[2]=n31,te[6]=n32,te[10]=n33,te[14]=n34,te[3]=n41,te[7]=n42,te[11]=n43,te[15]=n44,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(m){var me=m.elements;return this.set(me[0],me[4],me[8],me[12],me[1],me[5],me[9],me[13],me[2],me[6],me[10],me[14],me[3],me[7],me[11],me[15]),this},matrix3FromTopLeft:function(){var te=this.elements;return new $3Dmol.Matrix3(te[0],te[4],te[8],te[1],te[5],te[9],te[2],te[6],te[10])},setRotationFromEuler:function(v,order){var te=this.elements,x=v.x,y=v.y,z=v.z,a=Math.cos(x),b=Math.sin(x),c=Math.cos(y),d=Math.sin(y),e=Math.cos(z),f=Math.sin(z);if(void 0===order||"XYZ"===order){var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e,te[4]=-c*f,te[8]=d,te[1]=af+be*d,te[5]=ae-bf*d,te[9]=-b*c,te[2]=bf-ae*d,te[6]=be+af*d,te[10]=a*c}else console.error("Error with matrix4 setRotationFromEuler. Order: "+order);return this},setRotationFromQuaternion:function(q){var te=this.elements,x=q.x,y=q.y,z=q.z,w=q.w,x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return te[0]=1-(yy+zz),te[4]=xy-wz,te[8]=xz+wy,te[1]=xy+wz,te[5]=1-(xx+zz),te[9]=yz-wx,te[2]=xz-wy,te[6]=yz+wx,te[10]=1-(xx+yy),this},lookAt:function(){var x=new $3Dmol.Vector3,y=new $3Dmol.Vector3,z=new $3Dmol.Vector3;return function(eye,target,up){var te=this.elements;return z.subVectors(eye,target).normalize(),0===z.length()&&(z.z=1),x.crossVectors(up,z).normalize(),0===x.length()&&(z.x+=1e-4,x.crossVectors(up,z).normalize()),y.crossVectors(z,x),te[0]=x.x,te[4]=y.x,te[8]=z.x,te[1]=x.y,te[5]=y.y,te[9]=z.y,te[2]=x.z,te[6]=y.z,te[10]=z.z,this}}(),multiplyMatrices:function(a,b){var ae=a.elements,be=b.elements,te=this.elements,a11=ae[0],a12=ae[4],a13=ae[8],a14=ae[12],a21=ae[1],a22=ae[5],a23=ae[9],a24=ae[13],a31=ae[2],a32=ae[6],a33=ae[10],a34=ae[14],a41=ae[3],a42=ae[7],a43=ae[11],a44=ae[15],b11=be[0],b12=be[4],b13=be[8],b14=be[12],b21=be[1],b22=be[5],b23=be[9],b24=be[13],b31=be[2],b32=be[6],b33=be[10],b34=be[14],b41=be[3],b42=be[7],b43=be[11],b44=be[15];return te[0]=a11*b11+a12*b21+a13*b31+a14*b41,te[4]=a11*b12+a12*b22+a13*b32+a14*b42,te[8]=a11*b13+a12*b23+a13*b33+a14*b43,te[12]=a11*b14+a12*b24+a13*b34+a14*b44,te[1]=a21*b11+a22*b21+a23*b31+a24*b41,te[5]=a21*b12+a22*b22+a23*b32+a24*b42,te[9]=a21*b13+a22*b23+a23*b33+a24*b43,te[13]=a21*b14+a22*b24+a23*b34+a24*b44,te[2]=a31*b11+a32*b21+a33*b31+a34*b41,te[6]=a31*b12+a32*b22+a33*b32+a34*b42,te[10]=a31*b13+a32*b23+a33*b33+a34*b43,te[14]=a31*b14+a32*b24+a33*b34+a34*b44,te[3]=a41*b11+a42*b21+a43*b31+a44*b41,te[7]=a41*b12+a42*b22+a43*b32+a44*b42,te[11]=a41*b13+a42*b23+a43*b33+a44*b43,te[15]=a41*b14+a42*b24+a43*b34+a44*b44,this},multiplyScalar:function(s){var te=this.elements;return te[0]*=s,te[4]*=s,te[8]*=s,te[12]*=s,te[1]*=s,te[5]*=s,te[9]*=s,te[13]*=s,te[2]*=s,te[6]*=s,te[10]*=s,te[14]*=s,te[3]*=s,te[7]*=s,te[11]*=s,te[15]*=s,this},makeTranslation:function(x,y,z){return this.set(1,0,0,x,0,1,0,y,0,0,1,z,0,0,0,1),this},snap:function(digits){digits||(digits=4);let mult=Math.pow(10,4),te=this.elements;for(let i=0;i<16;i++){let rounded=Math.round(te[i]);rounded==Math.round(te[i]*mult)/mult&&(te[i]=rounded)}return this},transpose:function(){var te=this.elements,tmp;return tmp=te[1],te[1]=te[4],te[4]=tmp,tmp=te[2],te[2]=te[8],te[8]=tmp,tmp=te[6],te[6]=te[9],te[9]=tmp,tmp=te[3],te[3]=te[12],te[12]=tmp,tmp=te[7],te[7]=te[13],te[13]=tmp,tmp=te[11],te[11]=te[14],te[14]=tmp,this},getPosition:function(){var v1=new $3Dmol.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.getPositionFromMatrix( matrix ) instead.");var te=this.elements;return v1.set(te[12],te[13],te[14])}}(),setPosition:function(v){var te=this.elements;return te[12]=v.x,te[13]=v.y,te[14]=v.z,this},translate:function(v){var te=this.elements;return te[12]+=v.x,te[13]+=v.y,te[14]+=v.z,this},getInverse:function(m,throwOnInvertible){var te=this.elements,me=m.elements,n11=me[0],n12=me[4],n13=me[8],n14=me[12],n21=me[1],n22=me[5],n23=me[9],n24=me[13],n31=me[2],n32=me[6],n33=me[10],n34=me[14],n41=me[3],n42=me[7],n43=me[11],n44=me[15];te[0]=n23*n34*n42-n24*n33*n42+n24*n32*n43-n22*n34*n43-n23*n32*n44+n22*n33*n44,te[4]=n14*n33*n42-n13*n34*n42-n14*n32*n43+n12*n34*n43+n13*n32*n44-n12*n33*n44,te[8]=n13*n24*n42-n14*n23*n42+n14*n22*n43-n12*n24*n43-n13*n22*n44+n12*n23*n44,te[12]=n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34,te[1]=n24*n33*n41-n23*n34*n41-n24*n31*n43+n21*n34*n43+n23*n31*n44-n21*n33*n44,te[5]=n13*n34*n41-n14*n33*n41+n14*n31*n43-n11*n34*n43-n13*n31*n44+n11*n33*n44,te[9]=n14*n23*n41-n13*n24*n41-n14*n21*n43+n11*n24*n43+n13*n21*n44-n11*n23*n44,te[13]=n13*n24*n31-n14*n23*n31+n14*n21*n33-n11*n24*n33-n13*n21*n34+n11*n23*n34,te[2]=n22*n34*n41-n24*n32*n41+n24*n31*n42-n21*n34*n42-n22*n31*n44+n21*n32*n44,te[6]=n14*n32*n41-n12*n34*n41-n14*n31*n42+n11*n34*n42+n12*n31*n44-n11*n32*n44,te[10]=n12*n24*n41-n14*n22*n41+n14*n21*n42-n11*n24*n42-n12*n21*n44+n11*n22*n44,te[14]=n14*n22*n31-n12*n24*n31-n14*n21*n32+n11*n24*n32+n12*n21*n34-n11*n22*n34,te[3]=n23*n32*n41-n22*n33*n41-n23*n31*n42+n21*n33*n42+n22*n31*n43-n21*n32*n43,te[7]=n12*n33*n41-n13*n32*n41+n13*n31*n42-n11*n33*n42-n12*n31*n43+n11*n32*n43,te[11]=n13*n22*n41-n12*n23*n41-n13*n21*n42+n11*n23*n42+n12*n21*n43-n11*n22*n43,te[15]=n12*n23*n31-n13*n22*n31+n13*n21*n32-n11*n23*n32-n12*n21*n33+n11*n22*n33;var det=me[0]*te[0]+me[1]*te[4]+me[2]*te[8]+me[3]*te[12];if(0===det){var msg="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(throwOnInvertible)throw new Error(msg);return console.warn(msg),this.identity(),this}return this.multiplyScalar(1/det),this},isReflected:function(){let te=this.elements,m0=te[0],m3=te[4],m6=te[8],m1=te[1],m4=te[5],m7=te[9],m2=te[2],m5=te[6],m8=te[10],determinant;return m0*m4*m8+m1*m5*m6+m2*m3*m7-m2*m4*m6-m1*m3*m8-m0*m5*m7<0},compose:function(){var mRotation=new $3Dmol.Matrix4,mScale=new $3Dmol.Matrix4;return function(translation,rotation,scale){var te=this.elements;return mRotation.identity(),mRotation.setRotationFromQuaternion(rotation),mScale.makeScale(scale.x,scale.y,scale.z),this.multiplyMatrices(mRotation,mScale),te[12]=translation.x,te[13]=translation.y,te[14]=translation.z,this}}(),getScale:function(){var x=new $3Dmol.Vector3,y=new $3Dmol.Vector3,z=new $3Dmol.Vector3;return function(scale){var te=this.elements;return scale=scale instanceof $3Dmol.Vector3?scale:new $3Dmol.Vector3,x.set(te[0],te[1],te[2]),y.set(te[4],te[5],te[6]),z.set(te[8],te[9],te[10]),scale.x=x.length(),scale.y=y.length(),scale.z=z.length(),scale}}(),decompose:function(){var x=new $3Dmol.Vector3,y=new $3Dmol.Vector3,z=new $3Dmol.Vector3,matrix=new $3Dmol.Matrix4;return function(translation,rotation,scale){var te=this.elements;return x.set(te[0],te[1],te[2]),y.set(te[4],te[5],te[6]),z.set(te[8],te[9],te[10]),translation=translation instanceof $3Dmol.Vector3?translation:new $3Dmol.Vector3,rotation=rotation instanceof $3Dmol.Quaternion?rotation:new $3Dmol.Quaternion,(scale=scale instanceof $3Dmol.Vector3?scale:new $3Dmol.Vector3).x=x.length(),scale.y=y.length(),scale.z=z.length(),translation.x=te[12],translation.y=te[13],translation.z=te[14],matrix.copy(this),matrix.elements[0]/=scale.x,matrix.elements[1]/=scale.x,matrix.elements[2]/=scale.x,matrix.elements[4]/=scale.y,matrix.elements[5]/=scale.y,matrix.elements[6]/=scale.y,matrix.elements[8]/=scale.z,matrix.elements[9]/=scale.z,matrix.elements[10]/=scale.z,rotation.setFromRotationMatrix(matrix),[translation,rotation,scale]}}(),scale:function(v){var te=this.elements,x=v.x,y=v.y,z=v.z;return te[0]*=x,te[4]*=y,te[8]*=z,te[1]*=x,te[5]*=y,te[9]*=z,te[2]*=x,te[6]*=y,te[10]*=z,te[3]*=x,te[7]*=y,te[11]*=z,this},getMaxScaleOnAxis:function(){var te=this.elements,scaleXSq=te[0]*te[0]+te[1]*te[1]+te[2]*te[2],scaleYSq=te[4]*te[4]+te[5]*te[5]+te[6]*te[6],scaleZSq=te[8]*te[8]+te[9]*te[9]+te[10]*te[10];return Math.sqrt(Math.max(scaleXSq,Math.max(scaleYSq,scaleZSq)))},makeFrustum:function(left,right,bottom,top,near,far){var te=this.elements,x=2*near/(right-left),y=2*near/(top-bottom),a=(right+left)/(right-left),b=(top+bottom)/(top-bottom),c=-(far+near)/(far-near),d=-2*far*near/(far-near);return te[0]=x,te[4]=0,te[8]=a,te[12]=0,te[1]=0,te[5]=y,te[9]=b,te[13]=0,te[2]=0,te[6]=0,te[10]=c,te[14]=d,te[3]=0,te[7]=0,te[11]=-1,te[15]=0,this},makePerspective:function(fov,aspect,near,far){var ymax=near*Math.tan($3Dmol.Math.degToRad(.5*fov)),ymin=-ymax,xmin=ymin*aspect,xmax=ymax*aspect;return this.makeFrustum(xmin,xmax,ymin,ymax,near,far)},makeOrthographic:function(left,right,top,bottom,near,far){var te=this.elements,w=1/(right-left),h=1/(top-bottom),p=1/(far-near),x=(right+left)*w,y=(top+bottom)*h,z=(far+near)*p;return te[0]=2*w,te[4]=0,te[8]=0,te[12]=-x,te[1]=0,te[5]=2*h,te[9]=0,te[13]=-y,te[2]=0,te[6]=0,te[10]=-2*p,te[14]=-z,te[3]=0,te[7]=0,te[11]=0,te[15]=1,this},isEqual:function(m){var me=m.elements,te=this.elements;return te[0]==me[0]&&te[4]==me[4]&&te[8]==me[8]&&te[12]==me[12]&&te[1]==me[1]&&te[5]==me[5]&&te[9]==me[9]&&te[13]==me[13]&&te[2]==me[2]&&te[6]==me[6]&&te[10]==me[10]&&te[14]==me[14]&&te[3]==me[3]&&te[7]==me[7]&&te[11]==me[11]&&te[15]==me[15]},clone:function(){var te=this.elements;return new $3Dmol.Matrix4(te[0],te[4],te[8],te[12],te[1],te[5],te[9],te[13],te[2],te[6],te[10],te[14],te[3],te[7],te[11],te[15])},isIdentity:function(){var te=this.elements;return 1==te[0]&&0==te[4]&&0==te[8]&&0==te[12]&&0==te[1]&&1==te[5]&&0==te[9]&&0==te[13]&&0==te[2]&&0==te[6]&&1==te[10]&&0==te[14]&&0==te[3]&&0==te[7]&&0==te[11]&&1==te[15]},isNearlyIdentity:function(digits){let snapped;return this.clone().snap(digits).isIdentity()}},$3Dmol.Vector3.prototype.unproject=function(){var matrix=new $3Dmol.Matrix4;return function unproject(camera){return matrix.multiplyMatrices(camera.matrixWorld,matrix.getInverse(camera.projectionMatrix)),this.applyMatrix4(matrix)}}(),$3Dmol.Ray=function(origin,direction){this.origin=void 0!==origin?origin:new $3Dmol.Vector3,this.direction=void 0!==direction?direction:new $3Dmol.Vector3},$3Dmol.Ray.prototype={constructor:$3Dmol.Ray,set:function(origin,direction){return this.origin.copy(origin),this.direction.copy(direction),this},copy:function(ray){return this.origin.copy(ray.origin),this.direction.copy(ray.direction),this},at:function(t,optionalTarget){var result;return(optionalTarget||new $3Dmol.Vector3).copy(this.direction).multiplyScalar(t).add(this.origin)},recast:function(){var v1=new $3Dmol.Vector3;return function(t){return this.origin.copy(this.at(t,v1)),this}}(),closestPointToPoint:function(point,optionalTarget){var result=optionalTarget||new $3Dmol.Vector3;result.subVectors(point,this.origin);var directionDistance=result.dot(this.direction);return result.copy(this.direction).multiplyScalar(directionDistance).add(this.origin)},distanceToPoint:function(){var v1=new $3Dmol.Vector3;return function(point){var directionDistance=v1.subVectors(point,this.origin).dot(this.direction);return v1.copy(this.direction).multiplyScalar(directionDistance).add(this.origin),v1.distanceTo(point)}}(),isIntersectionCylinder:function(){},isIntersectionSphere:function(sphere){return this.distanceToPoint(sphere.center)<=sphere.radius},isIntersectionPlane:function(plane){var denominator;return 0!==plane.normal.dot(this.direction)||0===plane.distanceToPoint(this.origin)},distanceToPlane:function(plane){var denominator=plane.normal.dot(this.direction),t;return 0===denominator?0===plane.distanceToPoint(this.origin)?0:void 0:-(this.origin.dot(plane.normal)+plane.constant)/denominator},intersectPlane:function(plane,optionalTarget){var t=this.distanceToPlane(plane);if(void 0!==t)return this.at(t,optionalTarget)},applyMatrix4:function(matrix4){return this.direction.add(this.origin).applyMatrix4(matrix4),this.origin.applyMatrix4(matrix4),this.direction.sub(this.origin),this},equals:function(ray){return ray.origin.equals(this.origin)&&ray.direction.equals(this.direction)},clone:function(){return(new $3Dmol.Ray).copy(this)}},$3Dmol.Sphere=function(center,radius){this.center=void 0!==center?center:new $3Dmol.Vector3,this.radius=void 0!==radius?radius:0},$3Dmol.Sphere.prototype={constructor:$3Dmol.Sphere,set:function(center,radius){return this.center.copy(center),this.radius=radius,this},copy:function(sphere){return this.center.copy(sphere.center),this.radius=sphere.radius,this},applyMatrix4:function(matrix){return this.center.applyMatrix4(matrix),this.radius=this.radius*matrix.getMaxScaleOnAxis(),this},translate:function(offset){return this.center.add(offset),this},equals:function(sphere){return sphere.center.equals(this.center)&&sphere.radius===this.radius},clone:function(){return(new $3Dmol.Sphere).copy(this)}},$3Dmol.Cylinder=function(c1,c2,radius){this.c1=void 0!==c1?c1:new $3Dmol.Vector3,this.c2=void 0!==c2?c2:new $3Dmol.Vector3,this.direction=(new $3Dmol.Vector3).subVectors(this.c2,this.c1).normalize(),this.radius=void 0!==radius?radius:0},$3Dmol.Cylinder.prototype={constructor:$3Dmol.Cylinder,copy:function(cylinder){return this.c1.copy(cylinder.c1),this.c2.copy(cylinder.c2),this.direction.copy(cylinder.direction),this.radius=cylinder.radius,this},lengthSq:function(){var vector=new $3Dmol.Vector3;return function(){return vector.subVectors(this.c2,this.c1).lengthSq()}}(),applyMatrix4:function(matrix){return this.direction.add(this.c1).applyMatrix4(matrix),this.c1.applyMatrix4(matrix),this.c2.applyMatrix4(matrix),this.direction.sub(this.c1).normalize(),this.radius=this.radius*matrix.getMaxScaleOnAxis(),this}},$3Dmol.Triangle=function(a,b,c){this.a=void 0!==a?a:new $3Dmol.Vector3,this.b=void 0!==b?b:new $3Dmol.Vector3,this.c=void 0!==c?c:new $3Dmol.Vector3},$3Dmol.Triangle.prototype={constructor:$3Dmol.Triangle,copy:function(triangle){return this.a.copy(triangle.a),this.b.copy(triangle.b),this.c.copy(triangle.c),this},applyMatrix4:function(matrix){return this.a.applyMatrix4(matrix),this.b.applyMatrix4(matrix),this.c.applyMatrix4(matrix),this},getNormal:function(){var v1=new $3Dmol.Vector3;return function(){var norm=this.a.clone();return norm.sub(this.b),v1.subVectors(this.c,this.b),norm.cross(v1),norm.normalize(),norm}}()},$3Dmol.EventDispatcher=function(){var listeners={};this.addEventListener=function(type,listener){void 0===listeners[type]&&(listeners[type]=[]),-1===listeners[type].indexOf(listener)&&listeners[type].push(listener)},this.removeEventListener=function(type,listener){var index=listeners[type].indexOf(listener);-1!==index&&listeners[type].splice(index,1)},this.dispatchEvent=function(event){var listenerArray=listeners[event.type];if(void 0!==listenerArray){event.target=this;for(var i=0,l=listenerArray.length;i<l;i++)listenerArray[i].call(this,event)}}},$3Dmol.Color=function(color){return arguments.length>1?(this.r=arguments[0]||0,this.g=arguments[1]||0,this.b=arguments[2]||0,this):this.set(color)},$3Dmol.Color.prototype={constructor:$3Dmol.Color,r:0,g:0,b:0,set:function(val){if(val instanceof $3Dmol.Color)return val.clone();"number"==typeof val?this.setHex(val):"object"==typeof val&&"r"in val&&"g"in val&&"b"in val&&(this.r=val.r,this.g=val.g,this.b=val.b)},setHex:function(hex){return hex=Math.floor(hex),this.r=(hex>>16&255)/255,this.g=(hex>>8&255)/255,this.b=(255&hex)/255,this},getHex:function(){var R,G,B;return Math.round(255*this.r)<<16|Math.round(255*this.g)<<8|Math.round(255*this.b)},clone:function(){return new $3Dmol.Color(this.r,this.g,this.b)},copy:function(color){return this.r=color.r,this.g=color.g,this.b=color.b,this},scaled:function(){var ret={};return ret.r=Math.round(255*this.r),ret.g=Math.round(255*this.g),ret.b=Math.round(255*this.b),ret.a=1,ret}},$3Dmol.Object3D=function(){this.id=$3Dmol.Object3DIDCount++,this.name="",this.parent=void 0,this.children=[],this.position=new $3Dmol.Vector3,this.rotation=new $3Dmol.Vector3,this.matrix=new $3Dmol.Matrix4,this.matrixWorld=new $3Dmol.Matrix4,this.quaternion=new $3Dmol.Quaternion,this.eulerOrder="XYZ",this.up=new $3Dmol.Vector3(0,1,0),this.scale=new $3Dmol.Vector3(1,1,1),this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.rotationAutoUpdate=!0,this.useQuaternion=!1,this.visible=!0},$3Dmol.Object3D.prototype={constructor:$3Dmol.Object3D,lookAt:function(vector){this.matrix.lookAt(vector,this.position,this.up),this.rotationAutoUpdate&&(!0===this.useQuaternion?this.quaternion.copy(this.matrix.decompose()[1]):this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder))},add:function(object){if(object!==this){object.parent=this,this.children.push(object);for(var scene=this;void 0!==scene.parent;)scene=scene.parent;void 0!==scene&&scene instanceof $3Dmol.Scene&&scene.__addObject(object)}else console.error("Can't add $3Dmol.Object3D to itself")},remove:function(object){var index=this.children.indexOf(object);if(-1!==index){object.parent=void 0,this.children.splice(index,1);for(var scene=this;void 0!==scene.parent;)scene=scene.parent;void 0!==scene&&scene instanceof $3Dmol.Scene&&scene.__removeObject(object)}},vrml:function(indent){indent||(indent=" ");var theta=2*Math.atan2(this.quaternion.lengthxyz(),this.quaternion.w),x=0,y=0,z=0;if(0!=theta){let st=Math.sin(theta/2);x=this.quaternion.x/st,y=this.quaternion.y/st,z=this.quaternion.z/st}var ret=indent+"Transform {\n"+indent+" center "+this.position.x+" "+this.position.y+" "+this.position.z+"\n"+indent+" rotation "+x+" "+y+" "+z+" "+theta+"\n"+indent+" children [\n";this.geometry&&(ret+=this.geometry.vrml(indent,this.material));for(var i=0;i<this.children.length;i++)ret+=this.children[i].vrml(indent+" ")+",\n";return ret+=" ]\n",ret+="}"},updateMatrix:function(){this.matrix.setPosition(this.position),!1===this.useQuaternion?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),1===this.scale.x&&1===this.scale.y&&1===this.scale.z||this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(force){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==force||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1;for(var i=0;i<this.children.length;i++)this.children[i].updateMatrixWorld(!0)},clone:function(object){void 0===object&&(object=new $3Dmol.Object3D),object.name=this.name,object.up.copy(this.up),object.position.copy(this.position),object.rotation.copy(this.rotation),object.eulerOrder=this.eulerOrder,object.scale.copy(this.scale),object.rotationAutoUpdate=this.rotationAutoUpdate,object.matrix.copy(this.matrix),object.matrixWorld.copy(this.matrixWorld),object.quaternion.copy(this.quaternion),object.matrixAutoUpdate=this.matrixAutoUpdate,object.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,object.useQuaternion=this.useQuaternion,object.visible=this.visible;for(var i=0;i<this.children.length;i++){var child=this.children[i];object.add(child.clone())}return object},setVisible:function(val){this.visible=val;for(var i=0;i<this.children.length;i++){var child;this.children[i].setVisible(val)}}},$3Dmol.Object3DIDCount=0,$3Dmol.Geometry=function(){var BUFFERSIZE=65535,geometryGroup=function(id){this.id=id||0,this.vertexArray=null,this.colorArray=null,this.normalArray=null,this.faceArray=null,this.radiusArray=null,this.lineArray=null,this.vertices=0,this.faceidx=0,this.lineidx=0};geometryGroup.prototype.setColors=function(setcolor){var v=this.vertexArray,c=this.colorArray;if(v.length==c.length)for(var i=0;i<v.length;i+=3){var col=setcolor(v[i],v[i+1],v[i+2]);col instanceof $3Dmol.Color||(col=$3Dmol.CC.color(col)),c[i]=col.r,c[i+1]=col.g,c[i+2]=col.b}else console.log("Cannot re-color geometry group due to mismatched lengths.")},geometryGroup.prototype.getNumVertices=function(){return this.vertices},geometryGroup.prototype.getVertices=function(){return this.vertexArray},geometryGroup.prototype.getCentroid=function(){for(var centroid=new $3Dmol.Vector3,offset,x,y,z,i=0;i<this.vertices;++i)offset=3*i,x=this.vertexArray[offset],y=this.vertexArray[offset+1],z=this.vertexArray[offset+2],centroid.x+=x,centroid.y+=y,centroid.z+=z;return centroid.divideScalar(this.vertices),centroid},geometryGroup.prototype.setNormals=function(){var faces=this.faceArray,verts=this.vertexArray,norms=this.normalArray;if(this.vertices&&this.faceidx)for(var a,b,c,vA,vB,vC,norm,i=0;i<faces.length/3;++i)a=3*faces[3*i],b=3*faces[3*i+1],c=3*faces[3*i+2],vA=new $3Dmol.Vector3(verts[a],verts[a+1],verts[a+2]),vB=new $3Dmol.Vector3(verts[b],verts[b+1],verts[b+2]),vC=new $3Dmol.Vector3(verts[c],verts[c+1],verts[c+2]),vA.subVectors(vA,vB),vC.subVectors(vC,vB),vC.cross(vA),(norm=vC).normalize(),norms[a]+=norm.x,norms[b]+=norm.x,norms[c]+=norm.x,norms[a+1]+=norm.y,norms[b+1]+=norm.y,norms[c+1]+=norm.y,norms[a+2]+=norm.z,norms[b+2]+=norm.z,norms[c+2]+=norm.z},geometryGroup.prototype.setLineIndices=function(){if(this.faceidx&&(!this.lineArray||this.lineArray.length!=2*this.faceidx||this.lineidx!=2*this.faceidx)){var faceArr=this.faceArray,lineArr=this.lineArray=new Uint16Array(2*this.faceidx);this.lineidx=2*this.faceidx;for(var i=0;i<this.faceidx/3;++i){var faceoffset=3*i,lineoffset=2*faceoffset,a=faceArr[faceoffset],b=faceArr[faceoffset+1],c=faceArr[faceoffset+2];lineArr[lineoffset]=a,lineArr[lineoffset+1]=b,lineArr[lineoffset+2]=a,lineArr[lineoffset+3]=c,lineArr[lineoffset+4]=b,lineArr[lineoffset+5]=c}}},geometryGroup.prototype.vrml=function(indent,material){var ret="";ret+=indent+"Shape {\n"+indent+" appearance Appearance {\n"+indent+"  material Material {\n"+indent+"   diffuseColor "+material.color.r+" "+material.color.g+" "+material.color.b+"\n",material.transparent&&(ret+=indent+"   transparency "+(1-material.opacity)+"\n"),ret+=indent+"  }\n",ret+=indent+" }\n";var oldindent=indent;if(indent+=" ",material instanceof $3Dmol.LineBasicMaterial){let x,y,z;ret+=indent+"geometry IndexedLineSet {\n"+indent+" colorPerVertex TRUE\n"+indent+" coord Coordinate {\n"+indent+"  point [\n";for(let i=0;i<this.vertices;++i){let offset=3*i;x=this.vertexArray[offset],y=this.vertexArray[offset+1],z=this.vertexArray[offset+2],ret+=indent+"   "+x+" "+y+" "+z+",\n"}if(ret+=indent+"  ]\n",ret+=indent+" }\n",this.colorArray){ret+=indent+" color Color {\n"+indent+"  color [\n";for(let i=0;i<this.vertices;++i){let offset=3*i;x=this.colorArray[offset],y=this.colorArray[offset+1],z=this.colorArray[offset+2],ret+=indent+"   "+x+" "+y+" "+z+",\n"}ret+=indent+"  ]\n",ret+=indent+" }\n"}ret+=indent+" coordIndex [\n";for(let i=0;i<this.vertices;i+=2)ret+=indent+"  "+i+", "+(i+1)+", -1,\n";ret+=indent+" ]\n",ret+=indent+"}\n"}else{let x,y,z;ret+=indent+"geometry IndexedFaceSet {\n"+indent+" colorPerVertex TRUE\n"+indent+" normalPerVertex TRUE\n"+indent+" solid FALSE\n",ret+=indent+" coord Coordinate {\n"+indent+"  point [\n";for(let i=0;i<this.vertices;++i){let offset=3*i;x=this.vertexArray[offset],y=this.vertexArray[offset+1],z=this.vertexArray[offset+2],ret+=indent+"   "+x+" "+y+" "+z+",\n"}ret+=indent+"  ]\n",ret+=indent+" }\n",ret+=indent+" normal Normal {\n"+indent+"  vector [\n";for(let i=0;i<this.vertices;++i){let offset=3*i;x=this.normalArray[offset],y=this.normalArray[offset+1],z=this.normalArray[offset+2],ret+=indent+"   "+x+" "+y+" "+z+",\n"}if(ret+=indent+"  ]\n",ret+=indent+" }\n",this.colorArray){ret+=indent+" color Color {\n"+indent+"  color [\n";for(let i=0;i<this.vertices;++i){let offset=3*i;x=this.colorArray[offset],y=this.colorArray[offset+1],z=this.colorArray[offset+2],ret+=indent+"   "+x+" "+y+" "+z+",\n"}ret+=indent+"  ]\n",ret+=indent+" }\n"}ret+=indent+" coordIndex [\n";for(var i=0;i<this.faceidx;i+=3)x=this.faceArray[i],y=this.faceArray[i+1],z=this.faceArray[i+2],ret+=indent+"  "+x+", "+y+", "+z+", -1,\n";ret+=indent+" ]\n",ret+=indent+"}\n"}return ret+=oldindent+"}"},geometryGroup.prototype.truncateArrayBuffers=function(mesh,reallocatemem){mesh=!0===mesh;var vertexArr=this.vertexArray,colorArr=this.colorArray,normalArr=this.normalArray,faceArr=this.faceArray,lineArr=this.lineArray,radiusArr=this.radiusArray;this.vertexArray=vertexArr.subarray(0,3*this.vertices),this.colorArray=colorArr.subarray(0,3*this.vertices),mesh?(this.normalArray=normalArr.subarray(0,3*this.vertices),this.faceArray=faceArr.subarray(0,this.faceidx),this.lineidx>0?this.lineArray=lineArr.subarray(0,this.lineidx):this.lineArray=new Uint16Array(0)):(this.normalArray=new Float32Array(0),this.faceArray=new Uint16Array(0),this.lineArray=new Uint16Array(0)),radiusArr&&(this.radiusArray=radiusArr.subarray(0,this.vertices)),reallocatemem&&(this.normalArray&&(this.normalArray=new Float32Array(this.normalArray)),this.faceArray&&(this.faceArray=new Uint16Array(this.faceArray)),this.lineArray&&(this.lineArray=new Uint16Array(this.lineArray)),this.vertexArray&&(this.vertexArray=new Float32Array(this.vertexArray)),this.colorArray&&(this.colorArray=new Float32Array(this.colorArray)),this.radiusArray&&(this.radiusArray=new Float32Array(this.radiusArray))),this.__inittedArrays=!0};var addGroup=function(geo){var ret=new geometryGroup(geo.geometryGroups.length);return geo.geometryGroups.push(ret),geo.groups=geo.geometryGroups.length,ret.vertexArray=new Float32Array(196605),ret.colorArray=new Float32Array(196605),geo.mesh&&(ret.normalArray=new Float32Array(196605),ret.faceArray=new Uint16Array(393210),ret.lineArray=new Uint16Array(393210)),geo.radii&&(ret.radiusArray=new Float32Array(65535)),ret.useOffset=geo.offset,ret},Geometry=function(mesh,radii,offset){$3Dmol.EventDispatcher.call(this),this.id=$3Dmol.GeometryIDCount++,this.name="",this.hasTangents=!1,this.dynamic=!0,this.mesh=!0===mesh,this.radii=radii||!1,this.offset=offset||!1,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.buffersNeedUpdate=!1,this.geometryGroups=[],this.groups=0};return Geometry.prototype={constructor:Geometry,updateGeoGroup:function(addVertices){addVertices=addVertices||0;var retGroup=this.groups>0?this.geometryGroups[this.groups-1]:null;return(!retGroup||retGroup.vertices+addVertices>retGroup.vertexArray.length/3)&&(retGroup=addGroup(this)),retGroup},vrml:function(indent,material){for(var ret="",len=this.geometryGroups.length,g=0;g<len;g++){var geoGroup;ret+=this.geometryGroups[g].vrml(indent,material)+",\n"}return ret},addGeoGroup:function(){return addGroup(this)},setUpNormals:function(three){three=three||!1;for(var g=0;g<this.groups;g++){var geoGroup;this.geometryGroups[g].setNormals(three)}},setColors:function(setcolor){for(var len=this.geometryGroups.length,g=0;g<len;g++){var geoGroup;this.geometryGroups[g].setColors(setcolor)}},setUpWireframe:function(){for(var g=0;g<this.groups;g++){var geoGroup;this.geometryGroups[g].setLineIndices()}},initTypedArrays:function(){for(var g=0;g<this.groups;g++){var group=this.geometryGroups[g];!0!==group.__inittedArrays&&group.truncateArrayBuffers(this.mesh,!1)}},dispose:function(){this.dispatchEvent({type:"dispose"})}},Geometry}(),Object.defineProperty($3Dmol.Geometry.prototype,"vertices",{get:function(){for(var vertices=0,g=0;g<this.groups;g++)vertices+=this.geometryGroups[g].vertices;return vertices}}),$3Dmol.GeometryIDCount=0,$3Dmol.Raycaster=function(){var Raycaster=function(origin,direction,far,near){this.ray=new $3Dmol.Ray(origin,direction),this.ray.direction.lengthSq()>0&&this.ray.direction.normalize(),this.near=near||0,this.far=far||1/0},sphere=new $3Dmol.Sphere,cylinder=new $3Dmol.Cylinder,triangle=new $3Dmol.Triangle,w_0=new $3Dmol.Vector3,v1=new $3Dmol.Vector3,v2=new $3Dmol.Vector3,v3=new $3Dmol.Vector3,matrixPosition=new $3Dmol.Vector3,descSort=function(a,b){return a.distance-b.distance},clamp=function(x){return Math.min(Math.max(x,-1),1)},intersectObject=function(group,clickable,raycaster,intersects){if(matrixPosition.getPositionFromMatrix(group.matrixWorld),void 0===clickable.intersectionShape)return intersects;var intersectionShape=clickable.intersectionShape,precision=raycaster.linePrecision,precisionSq=(precision*=group.matrixWorld.getMaxScaleOnAxis())*precision,i,il,norm,normProj,cylProj,rayProj,distance,closestDistSq,denom,discriminant,s,t,s_c,t_c;if(void 0!==clickable.boundingSphere&&clickable.boundingSphere instanceof $3Dmol.Sphere&&(sphere.copy(clickable.boundingSphere),sphere.applyMatrix4(group.matrixWorld),!raycaster.ray.isIntersectionSphere(sphere)))return intersects;for(i=0,il=intersectionShape.triangle.length;i<il;i++)if(intersectionShape.triangle[i]instanceof $3Dmol.Triangle){if(triangle.copy(intersectionShape.triangle[i]),triangle.applyMatrix4(group.matrixWorld),norm=triangle.getNormal(),(normProj=raycaster.ray.direction.dot(norm))>=0)continue;if(w_0.subVectors(triangle.a,raycaster.ray.origin),(distance=norm.dot(w_0)/normProj)<0)continue;v1.copy(raycaster.ray.direction).multiplyScalar(distance).add(raycaster.ray.origin),v1.sub(triangle.a),v2.copy(triangle.b).sub(triangle.a),v3.copy(triangle.c).sub(triangle.a);var b_dot_c=v2.dot(v3),b_sq=v2.lengthSq(),c_sq=v3.lengthSq();if((t=(b_sq*v1.dot(v3)-b_dot_c*v1.dot(v2))/(b_sq*c_sq-b_dot_c*b_dot_c))<0||t>1)continue;if((s=(v1.dot(v2)-t*b_dot_c)/b_sq)<0||s>1||s+t>1)continue;intersects.push({clickable:clickable,distance:distance})}for(i=0,il=intersectionShape.cylinder.length;i<il;i++)if(intersectionShape.cylinder[i]instanceof $3Dmol.Cylinder){if(cylinder.copy(intersectionShape.cylinder[i]),cylinder.applyMatrix4(group.matrixWorld),w_0.subVectors(cylinder.c1,raycaster.ray.origin),cylProj=w_0.dot(cylinder.direction),rayProj=w_0.dot(raycaster.ray.direction),0===(denom=1-(normProj=clamp(raycaster.ray.direction.dot(cylinder.direction)))*normProj))continue;s_c=(normProj*rayProj-cylProj)/denom,t_c=(rayProj-normProj*cylProj)/denom,v1.copy(cylinder.direction).multiplyScalar(s_c).add(cylinder.c1),v2.copy(raycaster.ray.direction).multiplyScalar(t_c).add(raycaster.ray.origin),closestDistSq=v3.subVectors(v1,v2).lengthSq();var radiusSq=cylinder.radius*cylinder.radius;if(closestDistSq<=radiusSq){if((s=normProj*(t=distance=(discriminant=(normProj*cylProj-rayProj)*(normProj*cylProj-rayProj)-denom*(w_0.lengthSq()-cylProj*cylProj-radiusSq))<=0?Math.sqrt(closestDistSq):(rayProj-normProj*cylProj-Math.sqrt(discriminant))/denom)-cylProj)<0||s*s>cylinder.lengthSq()||t<0)continue;intersects.push({clickable:clickable,distance:distance})}}for(i=0,il=intersectionShape.line.length;i<il;i+=2){v1.copy(intersectionShape.line[i]),v1.applyMatrix4(group.matrixWorld),v2.copy(intersectionShape.line[i+1]),v2.applyMatrix4(group.matrixWorld),v3.subVectors(v2,v1);var bondLengthSq=v3.lengthSq();v3.normalize(),w_0.subVectors(v1,raycaster.ray.origin);var lineProj=w_0.dot(v3);rayProj=w_0.dot(raycaster.ray.direction),0!==(denom=1-(normProj=clamp(raycaster.ray.direction.dot(v3)))*normProj)&&(s_c=(normProj*rayProj-lineProj)/denom,t_c=(rayProj-normProj*lineProj)/denom,v1.add(v3.multiplyScalar(s_c)),v2.copy(raycaster.ray.direction).multiplyScalar(t_c).add(raycaster.ray.origin),(closestDistSq=v3.subVectors(v2,v1).lengthSq())<precisionSq&&s_c*s_c<bondLengthSq&&intersects.push({clickable:clickable,distance:t_c}))}for(i=0,il=intersectionShape.sphere.length;i<il;i++)if(intersectionShape.sphere[i]instanceof $3Dmol.Sphere&&(sphere.copy(intersectionShape.sphere[i]),sphere.applyMatrix4(group.matrixWorld),raycaster.ray.isIntersectionSphere(sphere))){v1.subVectors(sphere.center,raycaster.ray.origin);var distanceToCenter=v1.dot(raycaster.ray.direction);return discriminant=distanceToCenter*distanceToCenter-(v1.lengthSq()-sphere.radius*sphere.radius),distanceToCenter<0?intersects:(distance=discriminant<=0?distanceToCenter:distanceToCenter-Math.sqrt(discriminant),intersects.push({clickable:clickable,distance:distance}),intersects)}},_viewProjectionMatrix;return Raycaster.prototype.precision=1e-4,Raycaster.prototype.linePrecision=.2,Raycaster.prototype.set=function(origin,direction){this.ray.set(origin,direction)},Raycaster.prototype.setFromCamera=(_viewProjectionMatrix=new $3Dmol.Matrix4,function(coords,camera){camera.ortho?(this.ray.origin.set(coords.x,coords.y,(camera.near+camera.far)/(camera.near-camera.far)).unproject(camera),this.ray.direction.set(0,0,-1).transformDirection(camera.matrixWorld)):(this.ray.origin.setFromMatrixPosition(camera.matrixWorld),this.ray.direction.set(coords.x,coords.y,coords.z),camera.projectionMatrixInverse.getInverse(camera.projectionMatrix),_viewProjectionMatrix.multiplyMatrices(camera.matrixWorld,camera.projectionMatrixInverse),this.ray.direction.applyProjection(_viewProjectionMatrix),this.ray.direction.sub(this.ray.origin).normalize())}),Raycaster.prototype.intersectObjects=function(group,objects){for(var intersects=[],i=0,l=objects.length;i<l;i++)intersectObject(group,objects[i],this,intersects);return intersects.sort(descSort),intersects},Raycaster}(),$3Dmol.Projector=function(){let _viewProjectionMatrix=new $3Dmol.Matrix4;this.projectVector=function(vector,camera){return camera.matrixWorldInverse.getInverse(camera.matrixWorld),_viewProjectionMatrix.multiplyMatrices(camera.projectionMatrix,camera.matrixWorldInverse),vector.applyProjection(_viewProjectionMatrix)},this.unprojectVector=function(vector,camera){return camera.projectionMatrixInverse.getInverse(camera.projectionMatrix),_viewProjectionMatrix.multiplyMatrices(camera.matrixWorld,camera.projectionMatrixInverse),vector.applyProjection(_viewProjectionMatrix)}},$3Dmol.Camera=function(fov,aspect,near,far,ortho){$3Dmol.Object3D.call(this),this.fov=void 0!==fov?fov:50,this.aspect=void 0!==aspect?aspect:1,this.near=void 0!==near?near:.1,this.far=void 0!==far?far:2e3,this.projectionMatrix=new $3Dmol.Matrix4,this.projectionMatrixInverse=new $3Dmol.Matrix4,this.matrixWorldInverse=new $3Dmol.Matrix4;var center=this.position.z;this.right=center*Math.tan(Math.PI/180*fov),this.left=-this.right,this.top=this.right/this.aspect,this.bottom=-this.top,this.ortho=!!ortho,this.updateProjectionMatrix()},$3Dmol.Camera.prototype=Object.create($3Dmol.Object3D.prototype),$3Dmol.Camera.prototype.lookAt=function(vector){this.matrix.lookAt(this.position,vector,this.up),this.rotationAutoUpdate&&(!1===this.useQuaternion?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1]))},$3Dmol.Camera.prototype.updateProjectionMatrix=function(){this.ortho?this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far):this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},$3Dmol.SpritePlugin=function(){var _gl,_renderer,_precision,_sprite={};function createProgram(shader,precision){var program=_gl.createProgram(),fragmentShader=_gl.createShader(_gl.FRAGMENT_SHADER),vertexShader=_gl.createShader(_gl.VERTEX_SHADER),prefix="precision "+precision+" float;\n";return _gl.shaderSource(fragmentShader,prefix+shader.fragmentShader),_gl.shaderSource(vertexShader,prefix+shader.vertexShader),_gl.compileShader(fragmentShader),_gl.compileShader(vertexShader),_gl.getShaderParameter(fragmentShader,_gl.COMPILE_STATUS)&&_gl.getShaderParameter(vertexShader,_gl.COMPILE_STATUS)?(_gl.attachShader(program,fragmentShader),_gl.attachShader(program,vertexShader),_gl.linkProgram(program),_gl.getProgramParameter(program,_gl.LINK_STATUS)||console.error("Could not initialize shader"),program):(console.error(_gl.getShaderInfoLog(fragmentShader)),console.error("could not initialize shader"),null)}function painterSortStable(a,b){return a.z!==b.z?b.z-a.z:b.id-a.id}this.init=function(renderer){_gl=renderer.context,_renderer=renderer,_precision=renderer.getPrecision(),_sprite.vertices=new Float32Array(16),_sprite.faces=new Uint16Array(6);var i=0;_sprite.vertices[i++]=-1,_sprite.vertices[i++]=-1,_sprite.vertices[i++]=0,_sprite.vertices[i++]=0,_sprite.vertices[i++]=1,_sprite.vertices[i++]=-1,_sprite.vertices[i++]=1,_sprite.vertices[i++]=0,_sprite.vertices[i++]=1,_sprite.vertices[i++]=1,_sprite.vertices[i++]=1,_sprite.vertices[i++]=1,_sprite.vertices[i++]=-1,_sprite.vertices[i++]=1,_sprite.vertices[i++]=0,_sprite.vertices[i++]=1,i=0,_sprite.faces[i++]=0,_sprite.faces[i++]=1,_sprite.faces[i++]=2,_sprite.faces[i++]=0,_sprite.faces[i++]=2,_sprite.faces[i++]=3,_sprite.vertexBuffer=_gl.createBuffer(),_sprite.elementBuffer=_gl.createBuffer(),_gl.bindBuffer(_gl.ARRAY_BUFFER,_sprite.vertexBuffer),_gl.bufferData(_gl.ARRAY_BUFFER,_sprite.vertices,_gl.STATIC_DRAW),_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer),_gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,_sprite.faces,_gl.STATIC_DRAW),_sprite.program=createProgram($3Dmol.ShaderLib.sprite,_precision),_sprite.attributes={},_sprite.uniforms={},_sprite.attributes.position=_gl.getAttribLocation(_sprite.program,"position"),_sprite.attributes.uv=_gl.getAttribLocation(_sprite.program,"uv"),_sprite.uniforms.uvOffset=_gl.getUniformLocation(_sprite.program,"uvOffset"),_sprite.uniforms.uvScale=_gl.getUniformLocation(_sprite.program,"uvScale"),_sprite.uniforms.rotation=_gl.getUniformLocation(_sprite.program,"rotation"),_sprite.uniforms.scale=_gl.getUniformLocation(_sprite.program,"scale"),_sprite.uniforms.alignment=_gl.getUniformLocation(_sprite.program,"alignment"),_sprite.uniforms.color=_gl.getUniformLocation(_sprite.program,"color"),_sprite.uniforms.map=_gl.getUniformLocation(_sprite.program,"map"),_sprite.uniforms.opacity=_gl.getUniformLocation(_sprite.program,"opacity"),_sprite.uniforms.useScreenCoordinates=_gl.getUniformLocation(_sprite.program,"useScreenCoordinates"),_sprite.uniforms.screenPosition=_gl.getUniformLocation(_sprite.program,"screenPosition"),_sprite.uniforms.modelViewMatrix=_gl.getUniformLocation(_sprite.program,"modelViewMatrix"),_sprite.uniforms.projectionMatrix=_gl.getUniformLocation(_sprite.program,"projectionMatrix"),_sprite.uniforms.fogType=_gl.getUniformLocation(_sprite.program,"fogType"),_sprite.uniforms.fogDensity=_gl.getUniformLocation(_sprite.program,"fogDensity"),_sprite.uniforms.fogNear=_gl.getUniformLocation(_sprite.program,"fogNear"),_sprite.uniforms.fogFar=_gl.getUniformLocation(_sprite.program,"fogFar"),_sprite.uniforms.fogColor=_gl.getUniformLocation(_sprite.program,"fogColor"),_sprite.uniforms.alphaTest=_gl.getUniformLocation(_sprite.program,"alphaTest")},this.render=function(scene,camera,viewportWidth,viewportHeight){var sprites=scene.__webglSprites,nSprites=sprites.length;if(nSprites){var attributes=_sprite.attributes,uniforms=_sprite.uniforms,halfViewportWidth=.5*viewportWidth,halfViewportHeight=.5*viewportHeight;_gl.useProgram(_sprite.program),_gl.enableVertexAttribArray(attributes.position),_gl.enableVertexAttribArray(attributes.uv),_gl.disable(_gl.CULL_FACE),_gl.enable(_gl.BLEND),_gl.bindBuffer(_gl.ARRAY_BUFFER,_sprite.vertexBuffer),_gl.vertexAttribPointer(attributes.position,2,_gl.FLOAT,!1,16,0),_gl.vertexAttribPointer(attributes.uv,2,_gl.FLOAT,!1,16,8),_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,_sprite.elementBuffer),_gl.uniformMatrix4fv(uniforms.projectionMatrix,!1,camera.projectionMatrix.elements),_gl.activeTexture(_gl.TEXTURE0),_gl.uniform1i(uniforms.map,0);var oldFogType=0,sceneFogType=0,fog=scene.fog;fog?(_gl.uniform3f(uniforms.fogColor,fog.color.r,fog.color.g,fog.color.b),_gl.uniform1f(uniforms.fogNear,fog.near),_gl.uniform1f(uniforms.fogFar,fog.far),_gl.uniform1i(uniforms.fogType,1),oldFogType=1,sceneFogType=1):(_gl.uniform1i(uniforms.fogType,0),oldFogType=0,sceneFogType=0);var i,sprite,material,size,fogType,scale=[];for(i=0;i<nSprites;i++)material=(sprite=sprites[i]).material,sprite.visible&&0!==material.opacity&&(material.useScreenCoordinates?sprite.z=-sprite.position.z:(sprite._modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,sprite.matrixWorld),sprite.z=-sprite._modelViewMatrix.elements[14]));for(sprites.sort(painterSortStable),i=0;i<nSprites;i++)if(material=(sprite=sprites[i]).material,sprite.visible&&0!==material.opacity&&material.map&&material.map.image&&material.map.image.width){_gl.uniform1f(uniforms.alphaTest,material.alphaTest);var w=material.map.image.width,h=material.map.image.height;scale[0]=w*_renderer.devicePixelRatio/viewportWidth,scale[1]=h*_renderer.devicePixelRatio/viewportHeight,!0===material.useScreenCoordinates?(_gl.uniform1i(uniforms.useScreenCoordinates,1),_gl.uniform3f(uniforms.screenPosition,(sprite.position.x*_renderer.devicePixelRatio-halfViewportWidth)/halfViewportWidth,(halfViewportHeight-sprite.position.y*_renderer.devicePixelRatio)/halfViewportHeight,Math.max(0,Math.min(1,sprite.position.z)))):(_gl.uniform1i(uniforms.useScreenCoordinates,0),_gl.uniformMatrix4fv(uniforms.modelViewMatrix,!1,sprite._modelViewMatrix.elements)),oldFogType!==(fogType=scene.fog&&material.fog?sceneFogType:0)&&(_gl.uniform1i(uniforms.fogType,fogType),oldFogType=fogType),size=1/(material.scaleByViewport?viewportHeight:1),scale[0]*=size*sprite.scale.x,scale[1]*=size*sprite.scale.y,_gl.uniform2f(uniforms.uvScale,material.uvScale.x,material.uvScale.y),_gl.uniform2f(uniforms.uvOffset,material.uvOffset.x,material.uvOffset.y),_gl.uniform2f(uniforms.alignment,material.alignment.x,material.alignment.y),_gl.uniform1f(uniforms.opacity,material.opacity),_gl.uniform3f(uniforms.color,material.color.r,material.color.g,material.color.b),_gl.uniform1f(uniforms.rotation,sprite.rotation),_gl.uniform2fv(uniforms.scale,scale),_renderer.setDepthTest(material.depthTest),_renderer.setDepthWrite(material.depthWrite),_renderer.setTexture(material.map,0),_gl.drawElements(_gl.TRIANGLES,6,_gl.UNSIGNED_SHORT,0)}_gl.enable(_gl.CULL_FACE)}}},$3Dmol.Light=function(hex,intensity){$3Dmol.Object3D.call(this),this.color=new $3Dmol.Color(hex),this.position=new $3Dmol.Vector3(0,1,0),this.target=new $3Dmol.Object3D,this.intensity=void 0!==intensity?intensity:1,this.castShadow=!1,this.onlyShadow=!1},$3Dmol.Light.prototype=Object.create($3Dmol.Object3D.prototype),$3Dmol.Material=function(){$3Dmol.EventDispatcher.call(this),this.id=$3Dmol.MaterialIdCount++,this.name="",this.side=$3Dmol.FrontSide,this.opacity=1,this.transparent=!1,this.depthTest=!0,this.depthWrite=!0,this.stencilTest=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.visible=!0,this.needsUpdate=!0},$3Dmol.Material.prototype.setValues=function(values){if(void 0!==values)for(var key in values){var newValue=values[key];if(void 0!==newValue){if(key in this){var currentValue=this[key];currentValue instanceof $3Dmol.Color&&newValue instanceof $3Dmol.Color?currentValue.copy(newValue):currentValue instanceof $3Dmol.Color?currentValue.set(newValue):currentValue instanceof $3Dmol.Vector3&&newValue instanceof $3Dmol.Vector3?currentValue.copy(newValue):this[key]=newValue}}else console.warn("$3Dmol.Material: '"+key+"' parameter is undefined.")}},$3Dmol.Material.prototype.clone=function(material){return void 0===material&&(material=new $3Dmol.Material),material.name=this.name,material.side=this.side,material.opacity=this.opacity,material.transparent=this.transparent,material.depthTest=this.depthTest,material.depthWrite=this.depthWrite,material.stencilTest=this.stencilTest,material.polygonOffset=this.polygonOffset,material.polygonOffsetFactor=this.polygonOffsetFactor,material.polygonOffsetUnits=this.polygonOffsetUnits,material.alphaTest=this.alphaTest,material.overdraw=this.overdraw,material.visible=this.visible,material},$3Dmol.Material.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},$3Dmol.MaterialIdCount=0,$3Dmol.LineBasicMaterial=function(parameters){$3Dmol.Material.call(this),this.color=new $3Dmol.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.shaderID="basic",this.setValues(parameters)},$3Dmol.LineBasicMaterial.prototype=Object.create($3Dmol.Material.prototype),$3Dmol.LineBasicMaterial.prototype.clone=function(){var material=new $3Dmol.LineBasicMaterial;return $3Dmol.Material.prototype.clone.call(this,material),material.color.copy(this.color),material},$3Dmol.MeshLambertMaterial=function(parameters){$3Dmol.Material.call(this),this.color=new $3Dmol.Color(16777215),this.ambient=new $3Dmol.Color(1048575),this.emissive=new $3Dmol.Color(0),this.wrapAround=!1,this.wrapRGB=new $3Dmol.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=$3Dmol.SmoothShading,this.shaderID="lambert",this.vertexColors=$3Dmol.NoColors,this.skinning=!1,this.setValues(parameters)},$3Dmol.MeshLambertMaterial.prototype=Object.create($3Dmol.Material.prototype),$3Dmol.MeshLambertMaterial.prototype.clone=function(material){return void 0===material&&(material=new $3Dmol.MeshLambertMaterial),$3Dmol.Material.prototype.clone.call(this,material),material.color.copy(this.color),material.ambient.copy(this.ambient),material.emissive.copy(this.emissive),material.wrapAround=this.wrapAround,material.wrapRGB.copy(this.wrapRGB),material.map=this.map,material.lightMap=this.lightMap,material.specularMap=this.specularMap,material.envMap=this.envMap,material.combine=this.combine,material.reflectivity=this.reflectivity,material.refractionRatio=this.refractionRatio,material.fog=this.fog,material.shading=this.shading,material.shaderID=this.shaderID,material.vertexColors=this.vertexColors,material.skinning=this.skinning,material.morphTargets=this.morphTargets,material.morphNormals=this.morphNormals,material},$3Dmol.MeshDoubleLambertMaterial=function(parameters){$3Dmol.MeshLambertMaterial.call(this,parameters),this.shaderID="lambertdouble",this.side=$3Dmol.DoubleSide},$3Dmol.MeshDoubleLambertMaterial.prototype=Object.create($3Dmol.MeshLambertMaterial.prototype),$3Dmol.MeshDoubleLambertMaterial.prototype.clone=function(){var material=new $3Dmol.MeshDoubleLambertMaterial;return $3Dmol.MeshLambertMaterial.prototype.clone.call(this,material),material},$3Dmol.MeshOutlineMaterial=function(parameters){$3Dmol.Material.call(this),parameters=parameters||{},this.fog=!0,this.shaderID="outline",this.wireframe=!1,this.outlineColor=parameters.color||new $3Dmol.Color(0,0,0),this.outlineWidth=parameters.width||.1,this.outlinePushback=parameters.pushback||1},$3Dmol.MeshOutlineMaterial.prototype=Object.create($3Dmol.Material.prototype),$3Dmol.MeshOutlineMaterial.prototype.clone=function(material){return void 0===material&&(material=new $3Dmol.MeshOutlineMaterial),$3Dmol.Material.prototype.clone.call(this,material),material.fog=this.fog,material.shaderID=this.shaderID,material.wireframe=this.wireframe,material},$3Dmol.ImposterMaterial=function(parameters){$3Dmol.Material.call(this),this.color=new $3Dmol.Color(16777215),this.ambient=new $3Dmol.Color(1048575),this.emissive=new $3Dmol.Color(0),this.imposter=!0,this.wrapAround=!1,this.wrapRGB=new $3Dmol.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=$3Dmol.SmoothShading,this.shaderID=null,this.vertexColors=$3Dmol.NoColors,this.skinning=!1,this.setValues(parameters)},$3Dmol.ImposterMaterial.prototype=Object.create($3Dmol.Material.prototype),$3Dmol.ImposterMaterial.prototype.clone=function(){var material=new $3Dmol.ImposterMaterial;return $3Dmol.Material.prototype.clone.call(this,material),material.color.copy(this.color),material.ambient.copy(this.ambient),material.emissive.copy(this.emissive),material.wrapAround=this.wrapAround,material.wrapRGB.copy(this.wrapRGB),material.map=this.map,material.lightMap=this.lightMap,material.specularMap=this.specularMap,material.envMap=this.envMap,material.combine=this.combine,material.reflectivity=this.reflectivity,material.refractionRatio=this.refractionRatio,material.fog=this.fog,material.shading=this.shading,material.shaderID=this.shaderID,material.vertexColors=this.vertexColors,material.skinning=this.skinning,material.morphTargets=this.morphTargets,material.morphNormals=this.morphNormals,material},$3Dmol.SphereImposterMaterial=function(parameters){$3Dmol.ImposterMaterial.call(this),this.shaderID="sphereimposter",this.setValues(parameters)},$3Dmol.SphereImposterMaterial.prototype=Object.create($3Dmol.ImposterMaterial.prototype),$3Dmol.SphereImposterMaterial.prototype.clone=function(){var material=new $3Dmol.SphereImposterMaterial;return $3Dmol.ImposterMaterial.prototype.clone.call(this,material),material},$3Dmol.SphereImposterOutlineMaterial=function(parameters){$3Dmol.ImposterMaterial.call(this),parameters=parameters||{},this.shaderID="sphereimposteroutline",this.outlineColor=parameters.color||new $3Dmol.Color(0,0,0),this.outlineWidth=parameters.width||.1,this.outlinePushback=parameters.pushback||1,this.setValues(parameters)},$3Dmol.SphereImposterOutlineMaterial.prototype=Object.create($3Dmol.ImposterMaterial.prototype),$3Dmol.SphereImposterOutlineMaterial.prototype.clone=function(){var material=new $3Dmol.SphereImposterOutlineMaterial;return $3Dmol.ImposterMaterial.prototype.clone.call(this,material),material.outlineColor=this.outlineColor,material.outlineWidth=this.outlineWidth,material.outlinePushback=this.outlinePushback,material},$3Dmol.StickImposterMaterial=function(parameters){$3Dmol.ImposterMaterial.call(this),this.shaderID="stickimposter",this.setValues(parameters)},$3Dmol.StickImposterMaterial.prototype=Object.create($3Dmol.ImposterMaterial.prototype),$3Dmol.StickImposterMaterial.prototype.clone=function(){var material=new $3Dmol.StickImposterMaterial;return $3Dmol.ImposterMaterial.prototype.clone.call(this,material),material},$3Dmol.StickImposterOutlineMaterial=function(parameters){$3Dmol.ImposterMaterial.call(this),parameters=parameters||{},this.shaderID="stickimposteroutline",this.outlineColor=parameters.color||new $3Dmol.Color(0,0,0),this.outlineWidth=parameters.width||.1,this.outlinePushback=parameters.pushback||1,this.setValues(parameters)},$3Dmol.StickImposterOutlineMaterial.prototype=Object.create($3Dmol.ImposterMaterial.prototype),$3Dmol.StickImposterOutlineMaterial.prototype.clone=function(){var material=new $3Dmol.StickImposterOutlineMaterial;return $3Dmol.ImposterMaterial.prototype.clone.call(this,material),material.outlineColor=this.outlineColor,material.outlineWidth=this.outlineWidth,material.outlinePushback=this.outlinePushback,material},$3Dmol.InstancedMaterial=function(parameters){$3Dmol.Material.call(this),this.color=new $3Dmol.Color(16777215),this.ambient=new $3Dmol.Color(1048575),this.emissive=new $3Dmol.Color(0),this.wrapAround=!1,this.wrapRGB=new $3Dmol.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=$3Dmol.SmoothShading,this.shaderID="instanced",this.vertexColors=$3Dmol.NoColors,this.skinning=!1,this.sphere=null,this.setValues(parameters)},$3Dmol.InstancedMaterial.prototype=Object.create($3Dmol.Material.prototype),$3Dmol.InstancedMaterial.prototype.clone=function(){var material=new $3Dmol.InstancedMaterial;return $3Dmol.Material.prototype.clone.call(this,material),material.color.copy(this.color),material.ambient.copy(this.ambient),material.emissive.copy(this.emissive),material.wrapAround=this.wrapAround,material.wrapRGB.copy(this.wrapRGB),material.map=this.map,material.lightMap=this.lightMap,material.specularMap=this.specularMap,material.envMap=this.envMap,material.combine=this.combine,material.reflectivity=this.reflectivity,material.refractionRatio=this.refractionRatio,material.fog=this.fog,material.shading=this.shading,material.shaderID=this.shaderID,material.vertexColors=this.vertexColors,material.skinning=this.skinning,material.morphTargets=this.morphTargets,material.morphNormals=this.morphNormals,material.sphere=this.sphere,material},$3Dmol.VolumetricMaterial=function(parameters){$3Dmol.Material.call(this),this.transparent=!1,this.volumetric=!0,this.color=new $3Dmol.Color(16777215),this.transferfn=null,this.map=null,this.volumetric=!0,this.extent=[],this.maxdepth=100,this.unit=0,this.texmatrix=null,this.transfermin=-1,this.transfermax=1,this.subsamples=5,this.shaderID="volumetric",this.side=$3Dmol.FrontSide,this.setValues(parameters)},$3Dmol.VolumetricMaterial.prototype=Object.create($3Dmol.Material.prototype),$3Dmol.VolumetricMaterial.prototype.clone=function(){var material=Object.assign(new $3Dmol.VolumetricMaterial,this);return $3Dmol.Material.prototype.clone.call(this,material),material},$3Dmol.SpriteMaterial=function(parameters){$3Dmol.Material.call(this),this.color=new $3Dmol.Color(16777215),this.map=new $3Dmol.Texture,this.useScreenCoordinates=!0,this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.scaleByViewPort=!this.sizeAttenuation,this.alignment=$3Dmol.SpriteAlignment.center.clone(),this.fog=!1,this.uvOffset=new $3Dmol.Vector2(0,0),this.uvScale=new $3Dmol.Vector2(1,1),this.setValues(parameters),void 0===(parameters=parameters||{}).depthTest&&(this.depthTest=!this.useScreenCoordinates),void 0===parameters.sizeAttenuation&&(this.sizeAttenuation=!this.useScreenCoordinates),void 0===parameters.scaleByViewPort&&(this.scaleByViewPort=!this.sizeAttenuation)},$3Dmol.SpriteMaterial.prototype=Object.create($3Dmol.Material.prototype),$3Dmol.SpriteMaterial.prototype.clone=function(){var material=new $3Dmol.SpriteMaterial;return $3Dmol.Material.prototype.clone.call(this,material),material.color.copy(this.color),material.map=this.map,material.useScreenCoordinates=this.useScreenCoordinates,material.sizeAttenuation=this.sizeAttenuation,material.scaleByViewport=this.scaleByViewPort,material.alignment.copy(this.alignment),material.uvOffset.copy(this.uvOffset),material},$3Dmol.SpriteAlignment={},$3Dmol.SpriteAlignment.topLeft=new $3Dmol.Vector2(1,-1),$3Dmol.SpriteAlignment.topCenter=new $3Dmol.Vector2(0,-1),$3Dmol.SpriteAlignment.topRight=new $3Dmol.Vector2(-1,-1),$3Dmol.SpriteAlignment.centerLeft=new $3Dmol.Vector2(1,0),$3Dmol.SpriteAlignment.center=new $3Dmol.Vector2(0,0),$3Dmol.SpriteAlignment.centerRight=new $3Dmol.Vector2(-1,0),$3Dmol.SpriteAlignment.bottomLeft=new $3Dmol.Vector2(1,1),$3Dmol.SpriteAlignment.bottomCenter=new $3Dmol.Vector2(0,1),$3Dmol.SpriteAlignment.bottomRight=new $3Dmol.Vector2(-1,1),$3Dmol.Texture=function(image,is3D){$3Dmol.EventDispatcher.call(this),this.id=$3Dmol.TextureIdCount++,this.name="",this.image=image,this.mapping=new $3Dmol.UVMapping,this.wrapS=$3Dmol.ClampToEdgeWrapping,this.wrapT=$3Dmol.ClampToEdgeWrapping,this.anisotropy=1,is3D?(this.format=$3Dmol.RFormat,this.type=$3Dmol.FloatType,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.magFilter=$3Dmol.NearestFilter,this.minFilter=$3Dmol.NearestFilter):(this.format=$3Dmol.RGBAFormat,this.type=$3Dmol.UnsignedByteType,this.offset=new $3Dmol.Vector2(0,0),this.repeat=new $3Dmol.Vector2(1,1),this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.magFilter=$3Dmol.LinearFilter,this.minFilter=$3Dmol.LinearMipMapLinearFilter),this.needsUpdate=!1,this.onUpdate=null},$3Dmol.Texture.prototype={constructor:$3Dmol.Texture,clone:function(texture){return void 0===texture&&(texture=new $3Dmol.Texture),texture.image=this.image,texture.mapping=this.mapping,texture.wrapS=this.wrapS,texture.wrapT=this.wrapT,texture.magFilter=this.magFilter,texture.minFilter=this.minFilter,texture.anisotropy=this.anisotropy,texture.format=this.format,texture.type=this.type,texture.offset.copy(this.offset),texture.repeat.copy(this.repeat),texture.premultiplyAlpha=this.premultiplyAlpha,texture.flipY=this.flipY,texture.unpackAlignment=this.unpackAlignment,texture},dispose:function(){this.dispatchEvent({type:"dispose"})}},$3Dmol.TextureIdCount=0,$3Dmol.FrontSide=0,$3Dmol.BackSide=1,$3Dmol.DoubleSide=2,$3Dmol.NoShading=0,$3Dmol.FlatShading=1,$3Dmol.SmoothShading=2,$3Dmol.NoColors=0,$3Dmol.FaceColors=1,$3Dmol.VertexColors=2,$3Dmol.MultiplyOperation=0,$3Dmol.MixOperation=1,$3Dmol.AddOperation=2,$3Dmol.UVMapping=function(){},$3Dmol.ClampToEdgeWrapping=1001,$3Dmol.LinearFilter=1006,$3Dmol.NearestFilter=1007,$3Dmol.LinearMipMapLinearFilter=1008,$3Dmol.UnsignedByteType=1009,$3Dmol.FloatType=1010,$3Dmol.RGBAFormat=1021,$3Dmol.RFormat=1022,$3Dmol.R32Format=1023,$3Dmol.Line=function(geometry,material,type){$3Dmol.Object3D.call(this),this.geometry=geometry,this.material=void 0!==material?material:new $3Dmol.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==type?type:$3Dmol.LineStrip},$3Dmol.LineStrip=0,$3Dmol.LinePieces=1,$3Dmol.Line.prototype=Object.create($3Dmol.Object3D.prototype),$3Dmol.Line.prototype.clone=function(object){return void 0===object&&(object=new $3Dmol.Line(this.geometry,this.material,this.type)),$3Dmol.Object3D.prototype.clone.call(this,object),object},$3Dmol.Mesh=function(geometry,material){$3Dmol.Object3D.call(this),this.geometry=geometry,this.material=void 0!==material?material:new $3Dmol.MeshBasicMaterial({color:16777215*Math.random(),wireframe:!0})},$3Dmol.Mesh.prototype=Object.create($3Dmol.Object3D.prototype),$3Dmol.Mesh.prototype.clone=function(object){return void 0===object&&(object=new $3Dmol.Mesh(this.geometry,this.material)),$3Dmol.Object3D.prototype.clone.call(this,object),object},$3Dmol.Sprite=function(material){$3Dmol.Object3D.call(this),this.material=void 0!==material?material:new $3Dmol.SpriteMaterial,this.rotation3d=this.rotation,this.rotation=0},$3Dmol.Sprite.prototype=Object.create($3Dmol.Object3D.prototype),$3Dmol.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),1===this.scale.x&&1===this.scale.y||this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0},$3Dmol.Sprite.prototype.clone=function(object){return void 0===object&&(object=new $3Dmol.Sprite(this.material)),$3Dmol.Object3D.prototype.clone.call(this,object),object},$3Dmol.Renderer=function(parameters){parameters=parameters||{},this.row=parameters.row,this.col=parameters.col,this.rows=parameters.rows,this.cols=parameters.cols;var _canvas=void 0!==parameters.canvas?parameters.canvas:document.createElement("canvas"),_precision=void 0!==parameters.precision?parameters.precision:"highp",_alpha=void 0===parameters.alpha||parameters.alpha,_premultipliedAlpha=void 0===parameters.premultipliedAlpha||parameters.premultipliedAlpha,_antialias=void 0!==parameters.antialias&&parameters.antialias,_stencil=void 0===parameters.stencil||parameters.stencil,_preserveDrawingBuffer=void 0!==parameters.preserveDrawingBuffer&&parameters.preserveDrawingBuffer,_clearColor=void 0!==parameters.clearColor?new $3Dmol.Color(parameters.clearColor):new $3Dmol.Color(0),_clearAlpha=void 0!==parameters.clearAlpha?parameters.clearAlpha:0,_outlineMaterial=new $3Dmol.MeshOutlineMaterial(parameters.outline),_outlineSphereImposterMaterial=new $3Dmol.SphereImposterOutlineMaterial(parameters.outline),_outlineStickImposterMaterial=new $3Dmol.StickImposterOutlineMaterial(parameters.outline),_outlineEnabled=!!parameters.outline;this.domElement=_canvas,this.context=null,this.devicePixelRatio=1,_canvas.id=parameters.id,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.autoUpdateScene=!0,this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var _this=this,_programs=[],_programs_counter=0,_webglversion=1,_currentProgram=null,_currentMaterialId=-1,_currentGeometryGroupHash=null,_currentCamera=null,_geometryGroupCounter=0,_oldDoubleSided=-1,_oldFlipSided=-1,_oldBlending=-1,_oldDepthTest=-1,_oldDepthWrite=-1,_oldPolygonOffset=null,_oldLineWidth=null,_viewportWidth=0,_viewportHeight=0,_currentWidth=0,_currentHeight=0,_enabledAttributes={},_projScreenMatrix=new $3Dmol.Matrix4,_vector3=new $3Dmol.Vector3,_worldInverse=new $3Dmol.Matrix4,_projInverse=new $3Dmol.Matrix4,_textureMatrix=new $3Dmol.Matrix4,_direction=new $3Dmol.Vector3,_lightsNeedUpdate=!0,_lights={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},_screenshader=null,_vertexattribpos=null,_screenQuadVBO=null,_fb=null,_targetTexture=null,_depthTexture=null,_gl;initGL(),setDefaultGLState(),this.context=_gl;var _extInstanced=_gl.getExtension("ANGLE_instanced_arrays"),_extFragDepth=_gl.getExtension("EXT_frag_depth"),_extFloatLinear=_gl.getExtension("OES_texture_float_linear"),_extColorBufferFloat=_gl.getExtension("EXT_color_buffer_float");function enableAttribute(attribute){_enabledAttributes[attribute]||(_gl.enableVertexAttribArray(attribute),_enabledAttributes[attribute]=!0)}function disableAttributes(){for(let attribute in _enabledAttributes)_enabledAttributes[attribute]&&(_gl.disableVertexAttribArray(attribute),_enabledAttributes[attribute]=!1)}function setPolygonOffset(polygonOffset){null!==polygonOffset&&(polygonOffset?_gl.enable(_gl.POLYGON_OFFSET_FILL):_gl.disable(_gl.POLYGON_OFFSET_FILL))}function setLineWidth(width){width!==_oldLineWidth&&(_gl.lineWidth(width),_oldLineWidth=width)}this.supportedExtensions=function(){return{supportsAIA:Boolean(_extInstanced),supportsImposters:Boolean(_extFragDepth)||!isWebGL1()}},this.getContext=function(){return _gl},this.getPrecision=function(){return _precision},this.setClearColorHex=function(hex,alpha){_clearColor.setHex(hex),_clearAlpha=alpha,_gl.clearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha)},this.enableOutline=function(parameters){_outlineMaterial=new $3Dmol.MeshOutlineMaterial(parameters),_outlineSphereImposterMaterial=new $3Dmol.SphereImposterOutlineMaterial(parameters),_outlineStickImposterMaterial=new $3Dmol.StickImposterOutlineMaterial(parameters),_outlineEnabled=!0},this.disableOutline=function(){_outlineEnabled=!1},this.setViewport=function(){if(null!=this.rows&&null!=this.cols&&null!=this.row&&null!=this.col){var wid=_canvas.width/this.cols,hei=_canvas.height/this.rows;_viewportWidth=wid,_viewportHeight=hei,_gl.enable(_gl.SCISSOR_TEST),_gl.scissor(wid*this.col,hei*this.row,wid,hei),_gl.viewport(wid*this.col,hei*this.row,wid,hei)}},this.setSize=function(width,height){if(this.devicePixelRatio=void 0!==window.devicePixelRatio?window.devicePixelRatio:1,_antialias&&this.devicePixelRatio<2&&(this.devicePixelRatio*=2),null!=this.rows&&null!=this.cols&&null!=this.row&&null!=this.col){var wid=width/this.cols,hei=height/this.rows;_canvas.width=width*this.devicePixelRatio,_canvas.height=height*this.devicePixelRatio,_viewportWidth=wid*this.devicePixelRatio,_viewportHeight=hei*this.devicePixelRatio,_canvas.style.width=width+"px",_canvas.style.height=height+"px",this.setViewport()}else _viewportWidth=_canvas.width=width*this.devicePixelRatio,_viewportHeight=_canvas.height=height*this.devicePixelRatio,_canvas.style.width=width+"px",_canvas.style.height=height+"px",_gl.viewport(0,0,_gl.drawingBufferWidth,_gl.drawingBufferHeight);this.initFrameBuffer()},this.clear=function(color,depth,stencil){var bits=0;(void 0===color||color)&&(bits|=_gl.COLOR_BUFFER_BIT),(void 0===depth||depth)&&(bits|=_gl.DEPTH_BUFFER_BIT),(void 0===stencil||stencil)&&(bits|=_gl.STENCIL_BUFFER_BIT),_gl.clear(bits)},this.clearTarget=function(color,depth,stencil){this.clear(color,depth,stencil)},this.setMaterialFaces=function(material,reflected){var doubleSided=material.side===$3Dmol.DoubleSide,flipSided=material.side===$3Dmol.BackSide;material.imposter||(flipSided=reflected?!flipSided:flipSided),_oldDoubleSided!==doubleSided&&(doubleSided?_gl.disable(_gl.CULL_FACE):_gl.enable(_gl.CULL_FACE),_oldDoubleSided=doubleSided),_oldFlipSided!==flipSided&&(flipSided?_gl.frontFace(_gl.CW):_gl.frontFace(_gl.CCW),_oldFlipSided=flipSided),_gl.cullFace(_gl.BACK)},this.setDepthTest=function(depthTest){_oldDepthTest!==depthTest&&(depthTest?_gl.enable(_gl.DEPTH_TEST):_gl.disable(_gl.DEPTH_TEST),_oldDepthTest=depthTest)},this.setDepthWrite=function(depthWrite){_oldDepthWrite!==depthWrite&&(_gl.depthMask(depthWrite),_oldDepthWrite=depthWrite)},this.setBlending=function(blending){blending?(_gl.enable(_gl.BLEND),_gl.blendEquationSeparate(_gl.FUNC_ADD,_gl.FUNC_ADD),_gl.blendFuncSeparate(_gl.SRC_ALPHA,_gl.ONE_MINUS_SRC_ALPHA,_gl.ONE,_gl.ONE_MINUS_SRC_ALPHA)):_gl.disable(_gl.BLEND),_oldBlending=blending},this.addPostPlugin=function(plugin){plugin.init(this),this.renderPluginsPost.push(plugin)};var deallocateGeometry=function(geometry){if(geometry.__webglInit=void 0,void 0!==geometry.__webglVertexBuffer&&_gl.deleteBuffer(geometry.__webglVertexBuffer),void 0!==geometry.__webglColorBuffer&&_gl.deleteBuffer(geometry.__webglColorBuffer),void 0!==geometry.geometryGroups)for(var g=0,gl=geometry.groups;g<gl;g++){var geometryGroup=geometry.geometryGroups[g];void 0!==geometryGroup.__webglVertexBuffer&&_gl.deleteBuffer(geometryGroup.__webglVertexBuffer),void 0!==geometryGroup.__webglColorBuffer&&_gl.deleteBuffer(geometryGroup.__webglColorBuffer),void 0!==geometryGroup.__webglNormalBuffer&&_gl.deleteBuffer(geometryGroup.__webglNormalBuffer),void 0!==geometryGroup.__webglFaceBuffer&&_gl.deleteBuffer(geometryGroup.__webglFaceBuffer),void 0!==geometryGroup.__webglLineBuffer&&_gl.deleteBuffer(geometryGroup.__webglLineBuffer)}},deallocateMaterial=function(material){var program=material.program;if(void 0!==program){var i,il,programInfo;material.program=void 0;var deleteProgram=!1;for(i=0,il=_programs.length;i<il;i++)if((programInfo=_programs[i]).program===program){programInfo.usedTimes--,0===programInfo.usedTimes&&(deleteProgram=!0);break}if(!0===deleteProgram){var newPrograms=[];for(i=0,il=_programs.length;i<il;i++)(programInfo=_programs[i]).program!==program&&newPrograms.push(programInfo);_programs=newPrograms,_gl.deleteProgram(program),_this.info.memory.programs--}}},deallocateTexture=function(texture){if(texture.image&&texture.image.__webglTextureCube)_gl.deleteTexture(texture.image.__webglTextureCube);else{if(!texture.__webglInit)return;texture.__webglInit=!1,_gl.deleteTexture(texture.__webglTexture)}},onGeometryDispose=function(event){var geometry=event.target;geometry.removeEventListener("dispose",onGeometryDispose),deallocateGeometry(geometry),_this.info.memory.geometries--},onTextureDispose=function(event){var texture=event.target;texture.removeEventListener("dispose",onTextureDispose),deallocateTexture(texture),_this.info.memory.textures--},onMaterialDispose=function(event){var material=event.target;material.removeEventListener("dispose",onMaterialDispose),deallocateMaterial(material)};function getShader(type,str){var shader;return isWebGL1()||str.startsWith("#version")||(str=str.replace(/gl_FragDepthEXT/g,"gl_FragDepth"),str="#version 300 es\n"+(str=(str=(str=(str=(str="fragment"==type?str.replace(/varying/g,"in"):str.replace(/varying/g,"out")).replace(/attribute/g,"in")).replace(/texture2D/g,"texture")).replace(/\/\/DEFINEFRAGCOLOR/g,"out vec4 glFragColor;")).replace(/gl_FragColor/g,"glFragColor"))),"fragment"===type?shader=_gl.createShader(_gl.FRAGMENT_SHADER):"vertex"===type&&(shader=_gl.createShader(_gl.VERTEX_SHADER)),_gl.shaderSource(shader,str),_gl.compileShader(shader),_gl.getShaderParameter(shader,_gl.COMPILE_STATUS)?shader:(console.error(_gl.getShaderInfoLog(shader)),console.error("could not initialize shader"),null)}function buildProgram(fragmentShader,vertexShader,uniforms,parameters){var p,pl,program,code,chunks=[];for(p in chunks.push(fragmentShader),chunks.push(vertexShader),parameters)chunks.push(p),chunks.push(parameters[p]);for(code=chunks.join(),p=0,pl=_programs.length;p<pl;p++){var programInfo=_programs[p];if(programInfo.code===code)return programInfo.usedTimes++,programInfo.program}if(isWebGL1()&&parameters.volumetric)throw new Error("Volumetric rendering requires webgl2 which is not supported by your hardware.");program=_gl.createProgram();var precision,prefix="precision "+_precision+" float;",prefix_vertex=[parameters.volumetric?"#version 300 es":"",prefix].join("\n"),prefix_fragment,glFragmentShader=getShader("fragment",[parameters.volumetric?"#version 300 es":"",parameters.fragdepth&&isWebGL1()?"#extension GL_EXT_frag_depth: enable":"",parameters.wireframe?"#define WIREFRAME 1":"",prefix].join("\n")+fragmentShader),glVertexShader=getShader("vertex",prefix_vertex+vertexShader),identifiers,u,i;for(u in _gl.attachShader(program,glVertexShader),_gl.attachShader(program,glFragmentShader),_gl.linkProgram(program),_gl.getProgramParameter(program,_gl.LINK_STATUS)||console.error("Could not initialize shader"),program.uniforms={},program.attributes={},identifiers=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix"],uniforms)identifiers.push(u);for(i=0;i<identifiers.length;i++){var uniformVar=identifiers[i];program.uniforms[uniformVar]=_gl.getUniformLocation(program,uniformVar)}for(identifiers=["position","normal","color","lineDistance","offset","radius"],i=0;i<identifiers.length;i++){var attributeVar=identifiers[i];program.attributes[attributeVar]=_gl.getAttribLocation(program,attributeVar)}return program.id=_programs_counter++,_programs.push({program:program,code:code,usedTimes:1}),_this.info.memory.programs=_programs.length,program}function setProgram(camera,lights,fog,material,object,renderer){material.needsUpdate&&(material.program&&deallocateMaterial(material),_this.initMaterial(material,lights,fog,object),material.needsUpdate=!1);var refreshMaterial=!1,program=material.program,p_uniforms=program.uniforms,m_uniforms=material.uniforms;if(program!=_currentProgram&&(_gl.useProgram(program),_currentProgram=program,refreshMaterial=!0),material.id!=_currentMaterialId&&(_currentMaterialId=material.id,refreshMaterial=!0),camera!=_currentCamera&&(_currentCamera=camera,refreshMaterial=!0),_gl.uniformMatrix4fv(p_uniforms.projectionMatrix,!1,camera.projectionMatrix.elements),_gl.uniformMatrix4fv(p_uniforms.modelViewMatrix,!1,object._modelViewMatrix.elements),_gl.uniformMatrix3fv(p_uniforms.normalMatrix,!1,object._normalMatrix.elements),refreshMaterial){if(m_uniforms.fogColor.value=fog.color,m_uniforms.fogNear.value=fog.near,m_uniforms.fogFar.value=fog.far,material.shaderID.startsWith("lambert")||"instanced"===material.shaderID||material.shaderID.endsWith("imposter"))_gl.uniformMatrix4fv(p_uniforms.viewMatrix,!1,camera.matrixWorldInverse.elements),_lightsNeedUpdate&&(setupLights(program,lights),_lightsNeedUpdate=!1),m_uniforms.directionalLightColor.value=_lights.directional.colors,m_uniforms.directionalLightDirection.value=_lights.directional.positions;else if(material.shaderID.endsWith("outline"))m_uniforms.outlineColor.value=material.outlineColor,m_uniforms.outlineWidth.value=material.outlineWidth,m_uniforms.outlinePushback.value=material.outlinePushback;else if("sphereimposter"===material.shaderID)_gl.uniformMatrix4fv(p_uniforms.viewMatrix,!1,camera.matrixWorldInverse.elements),m_uniforms.directionalLightColor.value=_lights.directional.colors,m_uniforms.directionalLightDirection.value=_lights.directional.positions;else if("volumetric"===material.shaderID){object._modelViewMatrix.getScale(_direction),_worldInverse.getInverse(object._modelViewMatrix),_projInverse.getInverse(camera.projectionMatrix),_textureMatrix.multiplyMatrices(object.material.texmatrix,_worldInverse),_gl.uniformMatrix4fv(p_uniforms.textmat,!1,_textureMatrix.elements),_gl.uniformMatrix4fv(p_uniforms.projinv,!1,_projInverse.elements);let invscale=Math.min(Math.min(_direction.x,_direction.y),_direction.z);m_uniforms.step.value=object.material.unit*invscale,m_uniforms.maxdepth.value=object.material.maxdepth*invscale,m_uniforms.transfermax.value=object.material.transfermax,m_uniforms.transfermin.value=object.material.transfermin,m_uniforms.subsamples.value=object.material.subsamples,renderer.setTexture(object.material.transferfn,4,!1),renderer.setTexture(object.material.map,3,!0),_gl.activeTexture(_gl.TEXTURE5),_gl.bindTexture(_gl.TEXTURE_2D,_depthTexture)}m_uniforms.opacity.value=material.opacity,loadMaterialUniforms(p_uniforms,m_uniforms)}return program}function loadMaterialUniforms(p_uniforms,m_uniforms){var uniformVar,type,uniformVal,uniformLoc;for(uniformVar in m_uniforms)p_uniforms[uniformVar]&&(type=m_uniforms[uniformVar].type,uniformVal=m_uniforms[uniformVar].value,uniformLoc=p_uniforms[uniformVar],"f"===type?_gl.uniform1f(uniformLoc,uniformVal):"i"===type?_gl.uniform1i(uniformLoc,uniformVal):"fv"===type?_gl.uniform3fv(uniformLoc,uniformVal):"c"===type?_gl.uniform3f(uniformLoc,uniformVal.r,uniformVal.g,uniformVal.b):"f4"===type&&_gl.uniform4f(uniformLoc,uniformVal[0],uniformVal[1],uniformVal[2],uniformVal[3]))}function renderObjects(renderList,reverse,materialType,camera,lights,fog,useBlending){var webglObject,object,buffer,material,start,end,delta;reverse?(start=renderList.length-1,end=-1,delta=-1):(start=0,end=renderList.length,delta=1);for(var i=start;i!==end;i+=delta)if((webglObject=renderList[i]).render){if(object=webglObject.object,buffer=webglObject.buffer,!(material=webglObject[materialType]))continue;useBlending&&_this.setBlending(!0),_this.setDepthTest(material.depthTest),_this.setDepthWrite(material.depthWrite),setPolygonOffset(material.polygonOffset,material.polygonOffsetFactor,material.polygonOffsetUnits);var reflected=object._modelViewMatrix.isReflected();_this.setMaterialFaces(material,reflected),_this.renderBuffer(camera,lights,fog,material,buffer,object),(_outlineEnabled||material.outline)&&("sphereimposter"==material.shaderID?_this.renderBuffer(camera,lights,fog,_outlineSphereImposterMaterial,buffer,object):"stickimposter"==material.shaderID?_this.renderBuffer(camera,lights,fog,_outlineStickImposterMaterial,buffer,object):material.wireframe||"basic"===material.shaderID||0===material.opacity||_this.renderBuffer(camera,lights,fog,_outlineMaterial,buffer,object))}}function renderPlugins(plugins,scene,camera){if(_currentGeometryGroupHash=-1,_currentProgram=null,_currentCamera=null,_oldBlending=-1,_oldDepthWrite=-1,_oldDepthTest=-1,_oldDoubleSided=-1,_currentMaterialId=-1,_oldFlipSided=-1,plugins.length)for(var i=0,il=plugins.length;i<il;i++)_lightsNeedUpdate=!0,plugins[i].render(scene,camera,_currentWidth,_currentHeight),_currentGeometryGroupHash=-1,_currentProgram=null,_currentCamera=null,_oldBlending=-1,_oldDepthWrite=-1,_oldDepthTest=-1,_oldDoubleSided=-1,_currentMaterialId=-1,_oldFlipSided=-1}function addObject(object,scene){var g,gl,geometry,material,geometryGroup;if(!object.__webglInit&&(object.__webglInit=!0,object._modelViewMatrix=new $3Dmol.Matrix4,object._normalMatrix=new $3Dmol.Matrix3,void 0!==object.geometry&&void 0===object.geometry.__webglInit&&(object.geometry.__webglInit=!0,object.geometry.addEventListener("dispose",onGeometryDispose)),object instanceof $3Dmol.Mesh||object instanceof $3Dmol.Line))for(geometry=object.geometry,material=object.material,g=0,gl=geometry.geometryGroups.length;g<gl;g++)(geometryGroup=geometry.geometryGroups[g]).id=_geometryGroupCounter++,geometryGroup.__webglVertexBuffer||(object instanceof $3Dmol.Mesh?(createMeshBuffers(geometryGroup),geometry.elementsNeedUpdate=!0,geometry.normalsNeedUpdate=!0):object instanceof $3Dmol.Line&&createLineBuffers(geometryGroup),geometry.verticesNeedUpdate=!0,geometry.colorsNeedUpdate=!0);if(!object.__webglActive){if(object instanceof $3Dmol.Mesh||object instanceof $3Dmol.Line)for(g=0,gl=(geometry=object.geometry).geometryGroups.length;g<gl;g++)geometryGroup=geometry.geometryGroups[g],addBuffer(scene.__webglObjects,geometryGroup,object);else object instanceof $3Dmol.Sprite&&scene.__webglSprites.push(object);object.__webglActive=!0}}function updateObject(object){var geometry=object.geometry,geometryGroup;if(object instanceof $3Dmol.Mesh||object instanceof $3Dmol.Line){for(var g=0,gl=geometry.geometryGroups.length;g<gl;g++)geometryGroup=geometry.geometryGroups[g],(geometry.verticesNeedUpdate||geometry.elementsNeedUpdate||geometry.colorsNeedUpdate||geometry.normalsNeedUpdate)&&setBuffers(geometryGroup,_gl.STATIC_DRAW);geometry.verticesNeedUpdate=!1,geometry.elementsNeedUpdate=!1,geometry.normalsNeedUpdate=!1,geometry.colorsNeedUpdate=!1,geometry.buffersNeedUpdate=!1}}function removeObject(object,scene){object instanceof $3Dmol.Mesh||object instanceof $3Dmol.Line?removeInstances(scene.__webglObjects,object):object instanceof $3Dmol.Sprite&&removeInstancesDirect(scene.__webglSprites,object),object.__webglActive=!1}function removeInstances(objList,object){for(var o=objList.length-1;o>=0;--o)objList[o].object===object&&objList.splice(o,1)}function removeInstancesDirect(objList,object){for(var o=objList.length-1;o>=0;--o)objList[o]===object&&objList.splice(o,1)}function unrollBufferMaterial(globject){var object,material=globject.object.material;if(material.volumetric)globject.opaque=null,globject.transparent=null,globject.volumetric=material;else if(material.transparent){if(globject.opaque=null,globject.volumetric=null,globject.transparent=material,!material.wireframe){var blankMaterial=material.clone();blankMaterial.opacity=0,globject.blank=blankMaterial}}else globject.opaque=material,globject.transparent=null,globject.volumetric=null}function setBuffers(geometryGroup,hint){var vertexArray=geometryGroup.vertexArray,colorArray=geometryGroup.colorArray;if(void 0!==geometryGroup.__webglOffsetBuffer?(_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglOffsetBuffer),_gl.bufferData(_gl.ARRAY_BUFFER,vertexArray,hint)):(_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglVertexBuffer),_gl.bufferData(_gl.ARRAY_BUFFER,vertexArray,hint)),_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglColorBuffer),_gl.bufferData(_gl.ARRAY_BUFFER,colorArray,hint),geometryGroup.normalArray&&void 0!==geometryGroup.__webglNormalBuffer){var normalArray=geometryGroup.normalArray;_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglNormalBuffer),_gl.bufferData(_gl.ARRAY_BUFFER,normalArray,hint)}if(geometryGroup.radiusArray&&void 0!==geometryGroup.__webglRadiusBuffer&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglRadiusBuffer),_gl.bufferData(_gl.ARRAY_BUFFER,geometryGroup.radiusArray,hint)),geometryGroup.faceArray&&void 0!==geometryGroup.__webglFaceBuffer){var faceArray=geometryGroup.faceArray;_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglFaceBuffer),_gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,faceArray,hint)}if(geometryGroup.lineArray&&void 0!==geometryGroup.__webglLineBuffer){var lineArray=geometryGroup.lineArray;_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglLineBuffer),_gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,lineArray,hint)}}function createMeshBuffers(geometryGroup){geometryGroup.radiusArray&&(geometryGroup.__webglRadiusBuffer=_gl.createBuffer()),geometryGroup.useOffset&&(geometryGroup.__webglOffsetBuffer=_gl.createBuffer()),geometryGroup.__webglVertexBuffer=_gl.createBuffer(),geometryGroup.__webglNormalBuffer=_gl.createBuffer(),geometryGroup.__webglColorBuffer=_gl.createBuffer(),geometryGroup.__webglFaceBuffer=_gl.createBuffer(),geometryGroup.__webglLineBuffer=_gl.createBuffer(),_this.info.memory.geometries++}function createLineBuffers(geometry){geometry.__webglVertexBuffer=_gl.createBuffer(),geometry.__webglColorBuffer=_gl.createBuffer(),_this.info.memory.geometries++}function addBuffer(objlist,buffer,object){objlist.push({buffer:buffer,object:object,opaque:null,transparent:null})}function setupMatrices(object,camera){object._modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,object.matrixWorld),object._normalMatrix.getInverse(object._modelViewMatrix),object._normalMatrix.transpose()}function filterFallback(){return _gl.LINEAR}function setTextureParameters(textureType,texture){textureType==_gl.TEXTURE_2D?(_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,_gl.CLAMP_TO_EDGE),_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,_gl.CLAMP_TO_EDGE),_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,filterFallback(texture.magFilter)),_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,filterFallback(texture.minFilter))):(_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,_gl.CLAMP_TO_EDGE),_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,_gl.CLAMP_TO_EDGE),_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_R,_gl.CLAMP_TO_EDGE),_extColorBufferFloat&&_extFloatLinear?(_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,_gl.LINEAR),_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,_gl.LINEAR)):(_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,_gl.NEAREST),_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,_gl.NEAREST)))}function paramToGL(p){return p===$3Dmol.UnsignedByteType?_gl.UNSIGNED_BYTE:p===$3Dmol.RGBAFormat?_gl.RGBA:p===$3Dmol.NearestFilter?_gl.NEAREST:0}function setupLights(program,lights){var l,ll,light,r=0,g=0,b=0,color,intensity,distance,zlights=_lights,dirColors=zlights.directional.colors,dirPositions=zlights.directional.positions,dirCount=0,dirLength=0,dirOffset=0;for(l=0,ll=lights.length;l<ll;l++)if(color=(light=lights[l]).color,intensity=light.intensity,distance=light.distance,light instanceof $3Dmol.Light){if(dirCount++,_direction.getPositionFromMatrix(light.matrixWorld),_vector3.getPositionFromMatrix(light.target.matrixWorld),_direction.sub(_vector3),_direction.normalize(),0===_direction.x&&0===_direction.y&&0===_direction.z)continue;dirPositions[dirOffset]=_direction.x,dirPositions[dirOffset+1]=_direction.y,dirPositions[dirOffset+2]=_direction.z,dirColors[dirOffset]=color.r*intensity,dirColors[dirOffset+1]=color.g*intensity,dirColors[dirOffset+2]=color.b*intensity,dirOffset+=3,dirLength++}zlights.ambient[0]=0,zlights.ambient[1]=0,zlights.ambient[2]=0,zlights.directional.length=dirLength}function initGL(){try{if(!(_gl=_canvas.getContext("webgl2",{alpha:_alpha,premultipliedAlpha:_premultipliedAlpha,antialias:_antialias,stencil:_stencil,preserveDrawingBuffer:_preserveDrawingBuffer}))&&!(_gl=_canvas.getContext("experimental-webgl",{alpha:_alpha,premultipliedAlpha:_premultipliedAlpha,antialias:_antialias,stencil:_stencil,preserveDrawingBuffer:_preserveDrawingBuffer}))&&!(_gl=_canvas.getContext("webgl",{alpha:_alpha,premultipliedAlpha:_premultipliedAlpha,antialias:_antialias,stencil:_stencil,preserveDrawingBuffer:_preserveDrawingBuffer})))throw"Error creating WebGL context.";var vers=_gl.getParameter(_gl.VERSION);_webglversion=parseInt(vers[6])}catch(error){console.error(error)}}function isWebGL1(){return 1==_webglversion}function setDefaultGLState(){_gl.clearColor(0,0,0,1),_gl.clearDepth(1),_gl.clearStencil(0),_gl.enable(_gl.DEPTH_TEST),_gl.depthFunc(_gl.LEQUAL),_gl.frontFace(_gl.CCW),_gl.cullFace(_gl.BACK),_gl.enable(_gl.CULL_FACE),_gl.enable(_gl.BLEND),_gl.blendEquation(_gl.FUNC_ADD),_gl.blendFunc(_gl.SRC_ALPHA,_gl.ONE_MINUS_SRC_ALPHA),_gl.clearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha)}this.initMaterial=function(material){var parameters,shaderID;if(material.addEventListener("dispose",onMaterialDispose),shaderID=material.shaderID){var shader=$3Dmol.ShaderLib[shaderID];material.vertexShader=shader.vertexShader,material.fragmentShader=shader.fragmentShader,material.uniforms=$3Dmol.ShaderUtils.clone(shader.uniforms)}parameters={wireframe:material.wireframe,fragdepth:material.imposter,volumetric:material.volumetric},material.program=buildProgram(material.fragmentShader,material.vertexShader,material.uniforms,parameters)},this.renderBuffer=function(camera,lights,fog,material,geometryGroup,object){if(material.visible){var program,attributes;attributes=(program=setProgram(camera,lights,fog,material,object,this)).attributes;var updateBuffers=!1,wireframeBit=material.wireframe?1:0,geometryGroupHash=16777215*geometryGroup.id+2*program.id+wireframeBit,faceCount,lineCount;if(geometryGroupHash!==_currentGeometryGroupHash&&(_currentGeometryGroupHash=geometryGroupHash,updateBuffers=!0),updateBuffers&&(disableAttributes(),attributes.position>=0&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglVertexBuffer),enableAttribute(attributes.position),_gl.vertexAttribPointer(attributes.position,3,_gl.FLOAT,!1,0,0)),attributes.color>=0&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglColorBuffer),enableAttribute(attributes.color),_gl.vertexAttribPointer(attributes.color,3,_gl.FLOAT,!1,0,0)),attributes.normal>=0&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglNormalBuffer),enableAttribute(attributes.normal),_gl.vertexAttribPointer(attributes.normal,3,_gl.FLOAT,!1,0,0)),attributes.offset>=0&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglOffsetBuffer),enableAttribute(attributes.offset),_gl.vertexAttribPointer(attributes.offset,3,_gl.FLOAT,!1,0,0)),attributes.radius>=0&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglRadiusBuffer),enableAttribute(attributes.radius),_gl.vertexAttribPointer(attributes.radius,1,_gl.FLOAT,!1,0,0))),object instanceof $3Dmol.Mesh){if("instanced"===material.shaderID){var sphereGeometryGroup=material.sphere.geometryGroups[0];updateBuffers&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglVertexBuffer),_gl.bufferData(_gl.ARRAY_BUFFER,sphereGeometryGroup.vertexArray,_gl.STATIC_DRAW),_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglNormalBuffer),_gl.bufferData(_gl.ARRAY_BUFFER,sphereGeometryGroup.normalArray,_gl.STATIC_DRAW),_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglFaceBuffer),_gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,sphereGeometryGroup.faceArray,_gl.STATIC_DRAW)),faceCount=sphereGeometryGroup.faceidx,_extInstanced.vertexAttribDivisorANGLE(attributes.offset,1),_extInstanced.vertexAttribDivisorANGLE(attributes.radius,1),_extInstanced.vertexAttribDivisorANGLE(attributes.color,1),_extInstanced.drawElementsInstancedANGLE(_gl.TRIANGLES,faceCount,_gl.UNSIGNED_SHORT,0,geometryGroup.radiusArray.length),_extInstanced.vertexAttribDivisorANGLE(attributes.offset,0),_extInstanced.vertexAttribDivisorANGLE(attributes.radius,0),_extInstanced.vertexAttribDivisorANGLE(attributes.color,0)}else material.wireframe?(lineCount=geometryGroup.lineidx,setLineWidth(material.wireframeLinewidth),updateBuffers&&_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglLineBuffer),_gl.drawElements(_gl.LINES,lineCount,_gl.UNSIGNED_SHORT,0)):(faceCount=geometryGroup.faceidx,updateBuffers&&_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglFaceBuffer),_gl.drawElements(_gl.TRIANGLES,faceCount,_gl.UNSIGNED_SHORT,0));_this.info.render.calls++,_this.info.render.vertices+=faceCount,_this.info.render.faces+=faceCount/3}else object instanceof $3Dmol.Line&&(lineCount=geometryGroup.vertices,setLineWidth(material.linewidth),_gl.drawArrays(_gl.LINES,0,lineCount),_this.info.render.calls++)}},this.render=function(scene,camera,forceClear){if(camera instanceof $3Dmol.Camera!=!1){var i,il,webglObject,object,renderList,lights=scene.__lights,fog=scene.fog;_currentMaterialId=-1,_lightsNeedUpdate=!0,this.autoUpdateScene&&scene.updateMatrixWorld(),void 0===camera.parent&&camera.updateMatrixWorld(),camera.matrixWorldInverse.getInverse(camera.matrixWorld),_projScreenMatrix.multiplyMatrices(camera.projectionMatrix,camera.matrixWorldInverse),this.autoUpdateObjects&&this.initWebGLObjects(scene),_this.info.render.calls=0,_this.info.render.vertices=0,_this.info.render.faces=0,_this.info.render.points=0,_currentWidth=_viewportWidth,_currentHeight=_viewportHeight,this.setViewport(),this.setFrameBuffer(),(this.autoClear||forceClear)&&(_gl.clearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha),this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil));var hasvolumetric=!1;for(i=0,il=(renderList=scene.__webglObjects).length;i<il;i++)object=(webglObject=renderList[i]).object,webglObject.render=!1,object.visible&&(setupMatrices(object,camera),unrollBufferMaterial(webglObject),webglObject.render=!0,webglObject.volumetric&&(hasvolumetric=!0));var material=null;this.setBlending(!1),renderObjects(scene.__webglObjects,!0,"opaque",camera,lights,fog,!1,null),renderPlugins(this.renderPluginsPost,scene,camera),renderObjects(scene.__webglObjects,!0,"blank",camera,lights,fog,!0,null),renderObjects(scene.__webglObjects,!1,"transparent",camera,lights,fog,!0,null),hasvolumetric&&_fb&&(this.reinitFrameBuffer(),renderObjects(scene.__webglObjects,!1,"volumetric",camera,lights,fog,!0,null)),this.renderFrameBuffertoScreen(),this.setDepthTest(!0),this.setDepthWrite(!0)}else console.error("$3Dmol.Renderer.render: camera is not an instance of $3Dmol.Camera.")},this.reinitFrameBuffer=function(){isWebGL1()||(_fb=_gl.createFramebuffer(),_gl.bindFramebuffer(_gl.FRAMEBUFFER,_fb),_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,_gl.TEXTURE_2D,_targetTexture,0))},this.setFrameBuffer=function(){if(isWebGL1()||!_fb)return;let width=_viewportWidth,height=_viewportHeight;_gl.enable(_gl.SCISSOR_TEST),_gl.scissor(0,0,width,height),_gl.viewport(0,0,width,height),_gl.bindTexture(_gl.TEXTURE_2D,_targetTexture),_gl.texImage2D(_gl.TEXTURE_2D,0,_gl.RGBA,width,height,0,_gl.RGBA,_gl.UNSIGNED_BYTE,null),_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_MIN_FILTER,_gl.LINEAR),_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_MAG_FILTER,_gl.LINEAR),_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_WRAP_S,_gl.CLAMP_TO_EDGE),_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_WRAP_T,_gl.CLAMP_TO_EDGE),_gl.bindTexture(_gl.TEXTURE_2D,_depthTexture),_gl.texImage2D(_gl.TEXTURE_2D,0,_gl.DEPTH_COMPONENT32F,width,height,0,_gl.DEPTH_COMPONENT,_gl.FLOAT,null),_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_MIN_FILTER,_gl.NEAREST),_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_MAG_FILTER,_gl.NEAREST),_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_WRAP_S,_gl.CLAMP_TO_EDGE),_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_WRAP_T,_gl.CLAMP_TO_EDGE),_gl.bindFramebuffer(_gl.FRAMEBUFFER,_fb),_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,_gl.TEXTURE_2D,_targetTexture,0),_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.DEPTH_ATTACHMENT,_gl.TEXTURE_2D,_depthTexture,0)},this.initFrameBuffer=function(){if(isWebGL1())return;let width=_viewportWidth,height=_viewportHeight;_gl.enable(_gl.SCISSOR_TEST),_gl.scissor(0,0,width,height),_gl.viewport(0,0,width,height),_targetTexture=_gl.createTexture(),_depthTexture=_gl.createTexture(),_fb=_gl.createFramebuffer();var screenshader=$3Dmol.ShaderLib.screen;_screenshader=buildProgram(screenshader.fragmentShader,screenshader.vertexShader,screenshader.uniforms,{}),_vertexattribpos=_gl.getAttribLocation(_screenshader,"vertexPosition");var verts=[1,1,-1,1,-1,-1,-1,-1,1,-1,1,1];_screenQuadVBO=_gl.createBuffer(),_gl.bindBuffer(_gl.ARRAY_BUFFER,_screenQuadVBO),_gl.bufferData(_gl.ARRAY_BUFFER,new Float32Array(verts),_gl.STATIC_DRAW)},this.renderFrameBuffertoScreen=function(){isWebGL1()||null===_fb||(this.setViewport(),_gl.bindFramebuffer(_gl.FRAMEBUFFER,null),_gl.clear(_gl.COLOR_BUFFER_BIT|_gl.DEPTH_BUFFER_BIT),_gl.frontFace(_gl.CCW),_gl.cullFace(_gl.BACK),_gl.useProgram(_screenshader),_currentProgram=_screenshader,this.setDepthTest(-1),this.setDepthWrite(-1),_gl.bindBuffer(_gl.ARRAY_BUFFER,_screenQuadVBO),_gl.enableVertexAttribArray(_vertexattribpos),_gl.vertexAttribPointer(_vertexattribpos,2,_gl.FLOAT,!1,0,0),_gl.activeTexture(_gl.TEXTURE0),_gl.bindTexture(_gl.TEXTURE_2D,_targetTexture),_gl.drawArrays(_gl.TRIANGLES,0,6))},this.initWebGLObjects=function(scene){if(scene.__webglObjects||(scene.__webglObjects=[],scene.__webglObjectsImmediate=[],scene.__webglSprites=[],scene.__webglFlares=[]),scene.__objectsAdded.length){for(;scene.__objectsAdded.length;)addObject(scene.__objectsAdded[0],scene),scene.__objectsAdded.splice(0,1);_currentGeometryGroupHash=-1}for(;scene.__objectsRemoved.length;)removeObject(scene.__objectsRemoved[0],scene),scene.__objectsRemoved.splice(0,1);for(var o=0,ol=scene.__webglObjects.length;o<ol;o++)updateObject(scene.__webglObjects[o].object)},this.getYRatio=function(){return void 0!==this.rows&&void 0!==this.row?this.rows:1},this.getXRatio=function(){return void 0!==this.cols&&void 0!==this.col?this.cols:1},this.getAspect=function(width,height){null!=width&&null!=height||(width=_canvas.width,height=_canvas.height);var aspect=width/height,wid,hei;null!=this.rows&&null!=this.cols&&null!=this.row&&null!=this.col&&(aspect=width/this.cols/(height/this.rows));return aspect},this.setTexture=function(texture,slot,is3D){if(texture.needsUpdate){texture.__webglInit||(texture.__webglInit=!0,texture.addEventListener("dispose",onTextureDispose),texture.__webglTexture=_gl.createTexture(),_this.info.memory.textures++),_gl.activeTexture(_gl.TEXTURE0+slot);var gltextureType=is3D?_gl.TEXTURE_3D:_gl.TEXTURE_2D;_gl.bindTexture(gltextureType,texture.__webglTexture),_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,texture.flipY),_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,texture.premultiplyAlpha),_gl.pixelStorei(_gl.UNPACK_ALIGNMENT,texture.unpackAlignment),_gl.pixelStorei(_gl.PACK_ALIGNMENT,texture.unpackAlignment);var glFormat=paramToGL(texture.format),glType=paramToGL(texture.type);if(is3D)setTextureParameters(_gl.TEXTURE_3D,texture),_gl.texImage3D(_gl.TEXTURE_3D,0,_gl.R32F,texture.image.size.z,texture.image.size.y,texture.image.size.x,0,_gl.RED,_gl.FLOAT,texture.image.data);else{var image=texture.image,width=image.width,height=image.height;void 0===width&&(width=image.length,glFormat==_gl.RGBA&&(width/=4),height=1),setTextureParameters(_gl.TEXTURE_2D,texture),isWebGL1()?_gl.texImage2D(_gl.TEXTURE_2D,0,glFormat,glFormat,glType,texture.image):_gl.texImage2D(_gl.TEXTURE_2D,0,glFormat,width,height,0,glFormat,glType,texture.image)}texture.needsUpdate=!1,texture.onUpdate&&texture.onUpdate()}else _gl.activeTexture(_gl.TEXTURE0+slot),is3D?_gl.bindTexture(_gl.TEXTURE_3D,texture.__webglTexture):_gl.bindTexture(_gl.TEXTURE_2D,texture.__webglTexture)},this.supportsVolumetric=function(){return!isWebGL1()},this.addPostPlugin(new $3Dmol.SpritePlugin)},$3Dmol.Scene=function(){$3Dmol.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},$3Dmol.Scene.prototype=Object.create($3Dmol.Object3D.prototype),$3Dmol.Scene.prototype.__addObject=function(object){if(object instanceof $3Dmol.Light)-1===this.__lights.indexOf(object)&&this.__lights.push(object),object.target&&void 0===object.target.parent&&this.add(object.target);else if(-1===this.__objects.indexOf(object)){this.__objects.push(object),this.__objectsAdded.push(object);var idx=this.__objectsRemoved.indexOf(object);-1!==idx&&this.__objectsRemoved.splice(idx,1)}for(var i=0;i<object.children.length;i++)this.__addObject(object.children[i])},$3Dmol.Scene.prototype.__removeObject=function(object){var idx,ai;object instanceof $3Dmol.Light?-1!==(idx=this.__lights.indexOf(object))&&this.__lights.splice(idx,1):-1!==(idx=this.__objects.indexOf(object))&&(this.__objects.splice(idx,1),this.__objectsRemoved.push(object),-1!==this.__objectsAdded.indexOf(object)&&this.__objectsAdded.splice(idx,1));for(var i=0;i<object.children.length;i++)this.__removeObject(object.children[i])},$3Dmol.Fog=function(hex,near,far){this.name="",this.color=new $3Dmol.Color(hex),this.near=void 0!==near?near:1,this.far=void 0!==far?far:1e3},$3Dmol.Fog.prototype.clone=function(){return new $3Dmol.Fog(this.color.getHex(),this.near,this.far)},$3Dmol.ShaderUtils={clone:function(uniforms_src){var u,uniforms_clone={};for(u in uniforms_src){uniforms_clone[u]={},uniforms_clone[u].type=uniforms_src[u].type;var srcValue=uniforms_src[u].value;srcValue instanceof $3Dmol.Color?uniforms_clone[u].value=srcValue.clone():"number"==typeof srcValue?uniforms_clone[u].value=srcValue:srcValue instanceof Array?uniforms_clone[u].value=[]:console.error("Error copying shader uniforms from ShaderLib: unknown type for uniform")}return uniforms_clone},stickimposterFragmentShader:["uniform float opacity;","uniform mat4 projectionMatrix;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vLight;","varying vec3 vColor;","varying vec3 cposition;","varying vec3 p1;","varying vec3 p2;","varying float r;","//DEFINEFRAGCOLOR","void main() {","    vec3 color = abs(vColor);","    vec3 pos = cposition;","    vec3 p = pos;","    vec3 v = normalize(pos);","    vec3 pa = p1;","    vec3 va = normalize(p2-p1);","    vec3 tmp1 = v-(dot(v,va)*va);","    vec3 deltap = p-pa;","    float A = dot(tmp1,tmp1);","    if(A == 0.0) discard;","    vec3 tmp2 = deltap-(dot(deltap,va)*va);","    float B = 2.0*dot(tmp1, tmp2);","    float C = dot(tmp2,tmp2)-r*r;","    float det = (B*B) - (4.0*A*C);","    if(det < 0.0) discard;","    float sqrtDet = sqrt(det);","    float posT = (-B+sqrtDet)/(2.0*A);","    float negT = (-B-sqrtDet)/(2.0*A);","    float intersectionT = min(posT,negT);","    vec3 qi = p+v*intersectionT;","    float dotp1 = dot(va,qi-p1);","    float dotp2 = dot(va,qi-p2);","    vec3 norm;","    if( dotp1 < 0.0 || dotp2 > 0.0) {","       vec3 cp;","       if( dotp1 < 0.0) {        cp = p1;","       } else {","          cp = p2;","       }","       vec3 diff = p-cp;","       A = dot(v,v);","       B = dot(diff,v)*2.0;","       C = dot(diff,diff)-r*r;","       det = (B*B) - (4.0*C);","       if(det < 0.0) discard;","       sqrtDet = sqrt(det);","       posT = (-B+sqrtDet)/(2.0);","       negT = (-B-sqrtDet)/(2.0);","       float t = min(posT,negT);","       qi = p+v*t;","       norm = normalize(qi-cp);","    } else {","       norm = normalize(qi-(dotp1*va + p1));","    }","    vec4 clipPos = projectionMatrix * vec4(qi, 1.0);","    float ndcDepth = clipPos.z / clipPos.w;","    float depth = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;","    gl_FragDepthEXT = depth;"].join("\n")},$3Dmol.ShaderLib={basic:{fragmentShader:["uniform mat4 viewMatrix;","uniform float opacity;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vColor;","//DEFINEFRAGCOLOR","void main() {","    gl_FragColor = vec4( vColor, opacity );","    float depth = gl_FragCoord.z / gl_FragCoord.w;","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","attribute vec3 position;","attribute vec3 color;","varying vec3 vColor;","void main() {","    vColor = color;","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3}}},sphereimposter:{fragmentShader:["uniform mat4 viewMatrix;","uniform float opacity;","uniform mat4 projectionMatrix;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","uniform float uDepth;","uniform vec3 directionalLightColor[ 1 ];","varying vec3 vColor;","varying vec2 mapping;","varying float rval;","varying vec3 vLight;","varying vec3 center;","//DEFINEFRAGCOLOR","void main() {","    float lensqr = dot(mapping,mapping);","    float rsqr = rval*rval;","    if(lensqr > rsqr)","       discard;","    float z = sqrt(rsqr-lensqr);","    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z);","    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);","    float ndcDepth = clipPos.z / clipPos.w;","    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;","    vec3 norm = normalize(vec3(mapping.x,mapping.y,z));","    float dotProduct = dot( norm, vLight );","    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","    vec3 vLight = directionalLightColor[ 0 ] * directionalLightWeighting;","    gl_FragColor = vec4(vLight*vColor, opacity*opacity );","    float fogFactor = smoothstep( fogNear, fogFar, gl_FragDepthEXT/gl_FragCoord.w );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","varying vec2 mapping;","varying vec3 vColor;","varying float rval;","varying vec3 vLight;","varying vec3 center;","void main() {","    vColor = color;","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    center = mvPosition.xyz;","    vec4 projPosition = projectionMatrix * mvPosition;","    vec4 adjust = projectionMatrix* vec4(normal,0.0); adjust.z = 0.0; adjust.w = 0.0;","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vLight = normalize( lDirection.xyz );","    mapping = normal.xy;","    rval = abs(normal.x);","    gl_Position = projPosition+adjust;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},lambert:{fragmentShader:["uniform mat4 viewMatrix;","uniform float opacity;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vLightFront;","varying vec3 vColor;","//DEFINEFRAGCOLOR","void main() {","    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","    #ifndef WIREFRAME","    gl_FragColor.xyz *= vLightFront;","    #endif","    gl_FragColor = gl_FragColor * vec4( vColor, opacity );","    float depth = gl_FragCoord.z / gl_FragCoord.w;","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","varying vec3 vColor;","varying vec3 vLightFront;","void main() {","    vColor = color;","    vec3 objectNormal = normal;","    vec3 transformedNormal = normalMatrix * objectNormal;","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    vLightFront = vec3( 0.0 );","    transformedNormal = normalize( transformedNormal );","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vec3 dirVector = normalize( lDirection.xyz );","    float dotProduct = dot( transformedNormal, dirVector );","    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},instanced:{fragmentShader:["uniform mat4 viewMatrix;","uniform float opacity;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vLightFront;","varying vec3 vColor;","//DEFINEFRAGCOLOR","void main() {","    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","    #ifndef WIREFRAME","    gl_FragColor.xyz *= vLightFront;","    #endif","    gl_FragColor = gl_FragColor * vec4( vColor, opacity );","    float depth = gl_FragCoord.z / gl_FragCoord.w;","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 offset;","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","attribute float radius;","varying vec3 vColor;","varying vec3 vLightFront;","void main() {","    vColor = color;","    vec3 objectNormal = normal;","    vec3 transformedNormal = normalMatrix * objectNormal;","    vec4 mvPosition = modelViewMatrix * vec4( position * radius + offset, 1.0 );","    vLightFront = vec3( 0.0 );","    transformedNormal = normalize( transformedNormal );","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vec3 dirVector = normalize( lDirection.xyz );","    float dotProduct = dot( transformedNormal, dirVector );","    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},outline:{fragmentShader:["uniform float opacity;","uniform vec3 outlineColor;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","//DEFINEFRAGCOLOR","void main() {","    gl_FragColor = vec4( outlineColor, 1 );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float outlineWidth;","uniform float outlinePushback;","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","void main() {","    vec4 norm = modelViewMatrix*vec4(normalize(normal),0.0);","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    mvPosition.xy += norm.xy*outlineWidth;","    gl_Position = projectionMatrix * mvPosition;","    mvPosition.z -= outlinePushback;","    vec4 pushpos = projectionMatrix*mvPosition;","    gl_Position.z = gl_Position.w*pushpos.z/pushpos.w;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},outlineColor:{type:"c",value:new $3Dmol.Color(0,0,0)},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},sphereimposteroutline:{fragmentShader:["uniform float opacity;","uniform vec3 outlineColor;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","uniform mat4 projectionMatrix;","varying vec2 mapping;","varying float rval;","varying vec3 center;","uniform float outlinePushback;","//DEFINEFRAGCOLOR","void main() {","    float lensqr = dot(mapping,mapping);","    float rsqr = rval*rval;","    if(lensqr > rsqr)","       discard;","    float z = sqrt(rsqr-lensqr);","    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z-outlinePushback);","    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);","    float ndcDepth = clipPos.z / clipPos.w;","    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;","    gl_FragColor = vec4(outlineColor, 1 );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float outlineWidth;","uniform float outlinePushback;","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","varying vec2 mapping;","varying float rval;","varying vec3 center;","void main() {","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    center = mvPosition.xyz;","    vec4 projPosition = projectionMatrix * mvPosition;","    vec2 norm = normal.xy + vec2(sign(normal.x)*outlineWidth,sign(normal.y)*outlineWidth);","    vec4 adjust = projectionMatrix* vec4(norm,normal.z,0.0); adjust.z = 0.0; adjust.w = 0.0;","    mapping = norm.xy;","    rval = abs(norm.x);","    gl_Position = projPosition+adjust;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},outlineColor:{type:"c",value:new $3Dmol.Color(0,0,0)},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},stickimposter:{fragmentShader:[$3Dmol.ShaderUtils.stickimposterFragmentShader,"    float dotProduct = dot( norm, vLight );","    vec3 light = vec3( max( dotProduct, 0.0 ) );","    gl_FragColor = vec4(light*color, opacity*opacity );","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","attribute float radius;","varying vec3 vColor;","varying vec3 vLight;","varying vec3 cposition;","varying vec3 p1;","varying vec3 p2;","varying float r;","void main() {","    vColor = color; vColor.z = abs(vColor.z);","    r = abs(radius);","    vec4 to = modelViewMatrix*vec4(normal, 1.0);","    vec4 pt = modelViewMatrix*vec4(position, 1.0);","    vec4 mvPosition = pt;","    p1 = pt.xyz; p2 = to.xyz;","    vec3 norm = to.xyz-pt.xyz;","    float mult = 1.1;","    if(length(p1) > length(p2)) {","       mvPosition = to;","    }","    vec3 n = normalize(mvPosition.xyz);","    if(color.z >= 0.0) {","       vec3 pnorm = normalize(p1);","       float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);","       mvPosition.xyz = p1+t*pnorm;","    } else {","       vec3 pnorm = normalize(p2);","       float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);","       mvPosition.xyz = p2+t*pnorm;","       mult *= -1.0;","    }","    vec3 cr = normalize(cross(mvPosition.xyz,norm))*radius;","    vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*radius;","    mvPosition.xy +=  mult*(cr + doublecr).xy;","    cposition = mvPosition.xyz;","    gl_Position = projectionMatrix * mvPosition;","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vLight = normalize( lDirection.xyz )*directionalLightColor[0];","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},stickimposteroutline:{fragmentShader:$3Dmol.ShaderUtils.stickimposterFragmentShader+"gl_FragColor = vec4(color,1.0);}",vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","uniform vec3 outlineColor;","uniform float outlineWidth;","uniform float outlinePushback;","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","attribute float radius;","varying vec3 vColor;","varying vec3 vLight;","varying vec3 cposition;","varying vec3 p1;","varying vec3 p2;","varying float r;","void main() {","    vColor = outlineColor;","    float rad = radius+sign(radius)*outlineWidth;","    r = abs(rad);","    vec4 to = modelViewMatrix*vec4(normal, 1.0);","    vec4 pt = modelViewMatrix*vec4(position, 1.0);","    to.xyz += normalize(to.xyz)*outlinePushback;","    pt.xyz += normalize(pt.xyz)*outlinePushback;","    vec4 mvPosition = pt;","    p1 = pt.xyz; p2 = to.xyz;","    vec3 norm = to.xyz-pt.xyz;","    float mult = 1.1;","    if(length(p1) > length(p2)) {","       mvPosition = to;","    }","    vec3 n = normalize(mvPosition.xyz);","    if(color.z >= 0.0) {","       vec3 pnorm = normalize(p1);","       float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);","       mvPosition.xyz = p1+t*pnorm;","    } else {","       vec3 pnorm = normalize(p2);","       float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);","       mvPosition.xyz = p2+t*pnorm;","       mult *= -1.0;","    }","    vec3 cr = normalize(cross(mvPosition.xyz,norm))*rad;","    vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*rad;","    mvPosition.xy +=  mult*(cr + doublecr).xy;","    cposition = mvPosition.xyz;","    gl_Position = projectionMatrix * mvPosition;","    vLight = vec3(1.0,1.0,1.0);","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineColor:{type:"c",value:new $3Dmol.Color(0,0,0)},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},lambertdouble:{fragmentShader:["uniform mat4 viewMatrix;","uniform float opacity;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vLightFront;","varying vec3 vLightBack;","varying vec3 vColor;","//DEFINEFRAGCOLOR","void main() {","    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","    #ifndef WIREFRAME","    if ( gl_FrontFacing )","       gl_FragColor.xyz *= vLightFront;","    else","       gl_FragColor.xyz *= vLightBack;","    #endif","    gl_FragColor = gl_FragColor * vec4( vColor, opacity );","    float depth = gl_FragCoord.z / gl_FragCoord.w;","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","varying vec3 vColor;","varying vec3 vLightFront;","varying vec3 vLightBack;","void main() {","    vColor = color;","    vec3 objectNormal = normal;","    vec3 transformedNormal = normalMatrix * objectNormal;","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    vLightFront = vec3( 0.0 );","    vLightBack = vec3( 0.0 );","    transformedNormal = normalize( transformedNormal );","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vec3 dirVector = normalize( lDirection.xyz );","    float dotProduct = dot( transformedNormal, dirVector );","    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","    vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;","    vLightBack += directionalLightColor[ 0 ] * directionalLightWeightingBack;","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},sprite:{fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","//DEFINEFRAGCOLOR","void main() {","    vec4 texture = texture2D(map, vUV);","    if (texture.a < alphaTest) discard;","    gl_FragColor = vec4(color * texture.xyz, texture.a * opacity);","    if (fogType > 0) {","        float depth = gl_FragCoord.z / gl_FragCoord.w;","        float fogFactor = 0.0;","        if (fogType == 1) {","            fogFactor = smoothstep(fogNear, fogFar, depth);","        }","        else {","            const float LOG2 = 1.442695;","            float fogFactor = exp2(- fogDensity * fogDensity * depth * depth * LOG2);","            fogFactor = 1.0 - clamp(fogFactor, 0.0, 1.0);","        }","        gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);","    }","}"].join("\n"),vertexShader:["uniform int useScreenCoordinates;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","    vUV = uvOffset + uv * uvScale;","    vec2 alignedPosition = position + alignment;","    vec2 rotatedPosition;","    rotatedPosition.x = ( cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y ) * scale.x;","    rotatedPosition.y = ( sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y ) * scale.y;","    vec4 finalPosition;","    if(useScreenCoordinates != 0) {","        finalPosition = vec4(screenPosition.xy + rotatedPosition, screenPosition.z, 1.0);","    }","    else {","        finalPosition = projectionMatrix * modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0); finalPosition /= finalPosition.w;","        finalPosition.xy += rotatedPosition; ","    }","    gl_Position = finalPosition;","}"].join("\n"),uniforms:{}},volumetric:{fragmentShader:["uniform highp sampler3D data;","uniform highp sampler2D colormap;","uniform highp sampler2D depthmap;","uniform mat4 textmat;","uniform mat4 projinv;","uniform mat4 projectionMatrix;","uniform float step;","uniform float subsamples;","uniform float maxdepth;","uniform float transfermin;","uniform float transfermax;","in  vec4 mvPosition;","out vec4 color;","void main(void) {","   vec4 pos = mvPosition;","   bool seengood = false;","   float i = 0.0;","   color = vec4(1,1,1,0);","   float increment = 1.0/subsamples;","   float maxsteps = (maxdepth*subsamples/step);","   vec4 maxpos = vec4(pos.x,pos.y,pos.z-maxdepth,1.0);","   maxpos = projectionMatrix*maxpos;","   vec4 startp = projectionMatrix*pos;","   maxpos /= maxpos.w;","   startp /= startp.w;","   maxpos = vec4(startp.x,startp.y,maxpos.z,1.0);","   maxpos = projinv*maxpos;","   maxpos /= maxpos.w;","   float incr = step/subsamples;","   vec2 tpos = startp.xy/2.0+0.5;","   float depth = texture(depthmap, tpos).r;","   vec4 direction = maxpos-pos;","   for( i = 0.0; i <= maxsteps; i++) {","      vec4 pt = (pos+(i/maxsteps)*direction);","      vec4 ppt = projectionMatrix*pt;","      float ptdepth = ppt.z/ppt.w;","      ptdepth = ((gl_DepthRange.diff * ptdepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;","      if(ptdepth > depth) break;","      pt = textmat*pt;","      if(pt.x >= -0.01 && pt.y >= -0.01 && pt.z >= -0.01 && pt.x <= 1.01 && pt.y <= 1.01 && pt.z <= 1.01) {","         seengood = true;","      } else if(seengood) {","         break;","      }","      float val = texture(data, pt.zyx).r;","      if(isinf(val)) continue;","      float cval = (val-transfermin)/(transfermax-transfermin);","      vec4 val_color = texture(colormap, vec2(cval,0.5));","      color.rgb = color.rgb*color.a + (1.0-color.a)*val_color.a*val_color.rgb;","      color.a += (1.0 - color.a) * val_color.a; ","      if(color.a > 0.0) color.rgb /= color.a;","    }","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","in vec3 position;","out vec4 mvPosition;","void main() {","    mvPosition = modelViewMatrix * vec4( position, 1.0 );","    gl_Position = projectionMatrix*mvPosition;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new $3Dmol.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},data:{type:"i",value:3},colormap:{type:"i",value:4},depthmap:{type:"i",value:5},step:{type:"f",value:1},maxdepth:{type:"f",value:100},subsamples:{type:"f",value:5},textmat:{type:"mat4",value:[]},projinv:{type:"mat4",value:[]},transfermin:{type:"f",value:-.2},transfermax:{type:"f",value:.2}}},screen:{fragmentShader:["uniform sampler2D colormap;","varying highp vec2 vTexCoords;","uniform vec2 dimensions;","//DEFINEFRAGCOLOR","void main (void) {","   gl_FragColor = texture2D(colormap, vTexCoords);","}"].join("\n"),vertexShader:["attribute vec2 vertexPosition;","varying highp vec2 vTexCoords;","const vec2 scale = vec2(0.5, 0.5);","void main() {","   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range","   gl_Position = vec4(vertexPosition, 0.0, 1.0);","}"].join("\n"),uniforms:{}},screenaa:{fragmentShader:["uniform sampler2D colormap;","varying highp vec2 vTexCoords;","uniform vec2 dimensions;","// Basic FXAA implementation based on the code on geeks3d.com ","#define FXAA_REDUCE_MIN   (1.0/ 128.0)","#define FXAA_REDUCE_MUL   (1.0 / 8.0)","#define FXAA_SPAN_MAX     8.0","vec4 applyFXAA(vec2 fragCoord, sampler2D tex)","{","    vec4 color;","    vec2 inverseVP = vec2(1.0 / dimensions.x, 1.0 / dimensions.y);","    vec3 rgbNW = texture2D(tex, fragCoord + vec2(-1.0, -1.0) * inverseVP).xyz;","    vec3 rgbNE = texture2D(tex, fragCoord + vec2(1.0, -1.0) * inverseVP).xyz;","    vec3 rgbSW = texture2D(tex, fragCoord + vec2(-1.0, 1.0) * inverseVP).xyz;","    vec3 rgbSE = texture2D(tex, fragCoord + vec2(1.0, 1.0) * inverseVP).xyz;","    vec3 rgbM  = texture2D(tex, fragCoord  * inverseVP).xyz;","    vec3 luma = vec3(0.299, 0.587, 0.114);","    float lumaNW = dot(rgbNW, luma);","    float lumaNE = dot(rgbNE, luma);","    float lumaSW = dot(rgbSW, luma);","    float lumaSE = dot(rgbSE, luma);","    float lumaM  = dot(rgbM,  luma);","    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));","    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));","    vec2 dir;","    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));","    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));","    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *","                        (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);","    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);","    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),","            max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),","            dir * rcpDirMin)) * inverseVP;","    vec3 rgbA = 0.5 * (","        texture2D(tex, fragCoord + dir * (1.0 / 3.0 - 0.5)).xyz +","        texture2D(tex, fragCoord  + dir * (2.0 / 3.0 - 0.5)).xyz);","    vec3 rgbB = rgbA * 0.5 + 0.25 * (","        texture2D(tex, fragCoord  + dir * -0.5).xyz +","        texture2D(tex, fragCoord  + dir * 0.5).xyz);","    float lumaB = dot(rgbB, luma);","    if ((lumaB < lumaMin) || (lumaB > lumaMax))","        color = vec4(rgbA, 1.0);","    else","        color = vec4(rgbB, 1.0);","    return color;","}","//DEFINEFRAGCOLOR","void main (void) {","   gl_FragColor = applyFXAA(vTexCoords, colormap);","}"].join("\n"),vertexShader:["attribute vec2 vertexPosition;","varying highp vec2 vTexCoords;","const vec2 scale = vec2(0.5, 0.5);","void main() {","   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range","   gl_Position = vec4(vertexPosition, 0.0, 1.0);","}"].join("\n"),uniforms:{}}},"undefined"==typeof console&&(console={log:function(){}}),$3Dmol.ProteinSurface=function(){var INOUT=1,ISDONE=2,ISBOUND=4,ptranx=0,ptrany=0,ptranz=0,probeRadius=1.4,defaultScaleFactor=2,scaleFactor=2,pHeight=0,pWidth=0,pLength=0,cutRadius=0,vpBits=null,vpDistance=null,vpAtomID=null,pminx=0,pminy=0,pminz=0,pmaxx=0,pmaxy=0,pmaxz=0,vdwRadii={H:1.2,Li:1.82,Na:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,BR:1.85,SE:1.9,ZN:1.39,CU:1.4,NI:1.63,X:2},getVDWIndex=function(atom){return atom.elem&&void 0!==vdwRadii[atom.elem]?atom.elem:"X"},depty={},widxz={},faces,verts,nb=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];this.getFacesAndVertices=function(atomlist){var atomsToShow={};for(let i=0,il=atomlist.length;i<il;i++)atomsToShow[atomlist[i]]=!0;var vertices=verts;for(let i=0,il=vertices.length;i<il;i++)vertices[i].x=vertices[i].x/scaleFactor-ptranx,vertices[i].y=vertices[i].y/scaleFactor-ptrany,vertices[i].z=vertices[i].z/scaleFactor-ptranz;var finalfaces=[];for(let i=0,il=faces.length;i<il;i+=3){var fa=faces[i],fb=faces[i+1],fc=faces[i+2],a=vertices[fa].atomid,b=vertices[fb].atomid,c=vertices[fc].atomid,which=a;b<which&&(which=b),c<which&&(which=c),atomsToShow[which]&&(fa!==fb&&fb!==fc&&fa!==fc&&(finalfaces.push(fa),finalfaces.push(fb),finalfaces.push(fc)))}return vpBits=null,vpDistance=null,vpAtomID=null,{vertices:vertices,faces:finalfaces}},this.initparm=function(extent,btype,volume){volume>1e6&&(scaleFactor=1);var margin=1/scaleFactor*5.5;pminx=extent[0][0],pmaxx=extent[1][0],pminy=extent[0][1],pmaxy=extent[1][1],pminz=extent[0][2],pmaxz=extent[1][2],btype?(pminx-=1.4+margin,pminy-=1.4+margin,pminz-=1.4+margin,pmaxx+=1.4+margin,pmaxy+=1.4+margin,pmaxz+=1.4+margin):(pminx-=margin,pminy-=margin,pminz-=margin,pmaxx+=margin,pmaxy+=margin,pmaxz+=margin),pminx=Math.floor(pminx*scaleFactor)/scaleFactor,pminy=Math.floor(pminy*scaleFactor)/scaleFactor,pminz=Math.floor(pminz*scaleFactor)/scaleFactor,pmaxx=Math.ceil(pmaxx*scaleFactor)/scaleFactor,pmaxy=Math.ceil(pmaxy*scaleFactor)/scaleFactor,pmaxz=Math.ceil(pmaxz*scaleFactor)/scaleFactor,ptranx=-pminx,ptrany=-pminy,ptranz=-pminz,pLength=Math.ceil(scaleFactor*(pmaxx-pminx))+1,pWidth=Math.ceil(scaleFactor*(pmaxy-pminy))+1,pHeight=Math.ceil(scaleFactor*(pmaxz-pminz))+1,this.boundingatom(btype),cutRadius=1.4*scaleFactor,vpBits=new Uint8Array(pLength*pWidth*pHeight),vpDistance=new Float64Array(pLength*pWidth*pHeight),vpAtomID=new Int32Array(pLength*pWidth*pHeight)},this.boundingatom=function(btype){var tradius=[],txz,tdept,sradius;for(var i in vdwRadii)if(vdwRadii.hasOwnProperty(i)){var r=vdwRadii[i];tradius[i]=btype?(r+1.4)*scaleFactor+.5:r*scaleFactor+.5,sradius=tradius[i]*tradius[i],widxz[i]=Math.floor(tradius[i])+1,depty[i]=new Int32Array(widxz[i]*widxz[i]);var indx=0;for(let j=0;j<widxz[i];j++)for(let k=0;k<widxz[i];k++)(txz=j*j+k*k)>sradius?depty[i][indx]=-1:(tdept=Math.sqrt(sradius-txz),depty[i][indx]=Math.floor(tdept)),indx++}},this.fillvoxels=function(atoms,atomlist){for(let i=0,il=vpBits.length;i<il;i++)vpBits[i]=0,vpDistance[i]=-1,vpAtomID[i]=-1;for(let i in atomlist){var atom=atoms[atomlist[i]];void 0!==atom&&this.fillAtom(atom,atoms)}for(let i=0,il=vpBits.length;i<il;i++)1&vpBits[i]&&(vpBits[i]|=2)},this.fillAtom=function(atom,atoms){var cx,cy,cz,ox,oy,oz,mi,mj,mk,i,j,k,si,sj,sk,ii,jj,kk,n;cx=Math.floor(.5+scaleFactor*(atom.x+ptranx)),cy=Math.floor(.5+scaleFactor*(atom.y+ptrany)),cz=Math.floor(.5+scaleFactor*(atom.z+ptranz));var at=getVDWIndex(atom),nind=0,pWH=pWidth*pHeight;for(i=0,n=widxz[at];i<n;i++)for(j=0;j<n;j++){if(-1!=depty[at][nind])for(ii=-1;ii<2;ii++)for(jj=-1;jj<2;jj++)for(kk=-1;kk<2;kk++)if(0!==ii&&0!==jj&&0!==kk)for(mi=ii*i,mk=kk*j,k=0;k<=depty[at][nind];k++)if(sj=cy+(mj=k*jj),sk=cz+mk,!((si=cx+mi)<0||sj<0||sk<0||si>=pLength||sj>=pWidth||sk>=pHeight)){var index=si*pWH+sj*pHeight+sk;if(1&vpBits[index]){var atom2=atoms[vpAtomID[index]];atom2.serial!=atom.serial&&mi*mi+mj*mj+mk*mk<(ox=cx+mi-Math.floor(.5+scaleFactor*(atom2.x+ptranx)))*ox+(oy=cy+mj-Math.floor(.5+scaleFactor*(atom2.y+ptrany)))*oy+(oz=cz+mk-Math.floor(.5+scaleFactor*(atom2.z+ptranz)))*oz&&(vpAtomID[index]=atom.serial)}else vpBits[index]|=1,vpAtomID[index]=atom.serial}nind++}},this.fillvoxelswaals=function(atoms,atomlist){for(let i=0,il=vpBits.length;i<il;i++)vpBits[i]&=-3;for(let i in atomlist){let atom=atoms[atomlist[i]];void 0!==atom&&this.fillAtomWaals(atom,atoms)}},this.fillAtomWaals=function(atom,atoms){var cx,cy,cz,ox,oy,oz,nind=0,mi,mj,mk,si,sj,sk,i,j,k,ii,jj,kk,n;cx=Math.floor(.5+scaleFactor*(atom.x+ptranx)),cy=Math.floor(.5+scaleFactor*(atom.y+ptrany)),cz=Math.floor(.5+scaleFactor*(atom.z+ptranz));var at=getVDWIndex(atom),pWH=pWidth*pHeight;for(i=0,n=widxz[at];i<n;i++)for(j=0;j<n;j++){if(-1!=depty[at][nind])for(ii=-1;ii<2;ii++)for(jj=-1;jj<2;jj++)for(kk=-1;kk<2;kk++)if(0!==ii&&0!==jj&&0!==kk)for(mi=ii*i,mk=kk*j,k=0;k<=depty[at][nind];k++)if(sj=cy+(mj=k*jj),sk=cz+mk,!((si=cx+mi)<0||sj<0||sk<0||si>=pLength||sj>=pWidth||sk>=pHeight)){var index=si*pWH+sj*pHeight+sk;if(2&vpBits[index]){var atom2=atoms[vpAtomID[index]];atom2.serial!=atom.serial&&mi*mi+mj*mj+mk*mk<(ox=cx+mi-Math.floor(.5+scaleFactor*(atom2.x+ptranx)))*ox+(oy=cy+mj-Math.floor(.5+scaleFactor*(atom2.y+ptrany)))*oy+(oz=cz+mk-Math.floor(.5+scaleFactor*(atom2.z+ptranz)))*oz&&(vpAtomID[index]=atom.serial)}else vpBits[index]|=2,vpAtomID[index]=atom.serial}nind++}},this.buildboundary=function(){var pWH=pWidth*pHeight;for(let i=0;i<pLength;i++)for(let j=0;j<pHeight;j++)for(let k=0;k<pWidth;k++){var index=i*pWH+k*pHeight+j;if(1&vpBits[index])for(var ii=0;ii<26;){var ti=i+nb[ii][0],tj=j+nb[ii][2],tk=k+nb[ii][1];if(ti>-1&&ti<pLength&&tk>-1&&tk<pWidth&&tj>-1&&tj<pHeight&&!(1&vpBits[ti*pWH+tk*pHeight+tj])){vpBits[index]|=4;break}ii++}}};var PointGrid=function(length,width,height){var data=new Int32Array(length*width*height*3);this.set=function(x,y,z,pt){var index=3*((x*width+y)*height+z);data[index]=pt.ix,data[index+1]=pt.iy,data[index+2]=pt.iz},this.get=function(x,y,z){var index=3*((x*width+y)*height+z);return{ix:data[index],iy:data[index+1],iz:data[index+2]}}};this.fastdistancemap=function(){var i,j,k,n,boundPoint=new PointGrid(pLength,pWidth,pHeight),pWH=pWidth*pHeight,cutRSq=cutRadius*cutRadius,inarray=[],outarray=[],index;for(i=0;i<pLength;i++)for(j=0;j<pWidth;j++)for(k=0;k<pHeight;k++)if(vpBits[index=i*pWH+j*pHeight+k]&=-3,1&vpBits[index]&&4&vpBits[index]){var triple={ix:i,iy:j,iz:k};boundPoint.set(i,j,k,triple),inarray.push(triple),vpDistance[index]=0,vpBits[index]|=2,vpBits[index]&=-5}do{for(outarray=this.fastoneshell(inarray,boundPoint),inarray=[],i=0,n=outarray.length;i<n;i++)index=pWH*outarray[i].ix+pHeight*outarray[i].iy+outarray[i].iz,vpBits[index]&=-5,vpDistance[index]<=1.0404*cutRSq&&inarray.push({ix:outarray[i].ix,iy:outarray[i].iy,iz:outarray[i].iz})}while(0!==inarray.length);inarray=[],outarray=[],boundPoint=null;var cutsf=scaleFactor-.5;cutsf<0&&(cutsf=0);var cutoff=cutRSq-.5/(.1+cutsf);for(i=0;i<pLength;i++)for(j=0;j<pWidth;j++)for(k=0;k<pHeight;k++)vpBits[index=i*pWH+j*pHeight+k]&=-5,1&vpBits[index]&&(2&vpBits[index]&&!(2&vpBits[index]&&vpDistance[index]>=cutoff)||(vpBits[index]|=4))},this.fastoneshell=function(inarray,boundPoint){var tx,ty,tz,dx,dy,dz,i,j,n,square,bp,index,outarray=[];if(0===inarray.length)return outarray;var tnv={ix:-1,iy:-1,iz:-1},pWH=pWidth*pHeight;for(i=0,n=inarray.length;i<n;i++)for(tx=inarray[i].ix,ty=inarray[i].iy,tz=inarray[i].iz,bp=boundPoint.get(tx,ty,tz),j=0;j<6;j++)tnv.ix=tx+nb[j][0],tnv.iy=ty+nb[j][1],tnv.iz=tz+nb[j][2],tnv.ix<pLength&&tnv.ix>-1&&tnv.iy<pWidth&&tnv.iy>-1&&tnv.iz<pHeight&&tnv.iz>-1&&(index=tnv.ix*pWH+pHeight*tnv.iy+tnv.iz,1&vpBits[index]&&!(2&vpBits[index])?(boundPoint.set(tnv.ix,tnv.iy,tz+nb[j][2],bp),square=(dx=tnv.ix-bp.ix)*dx+(dy=tnv.iy-bp.iy)*dy+(dz=tnv.iz-bp.iz)*dz,vpDistance[index]=square,vpBits[index]|=2,vpBits[index]|=4,outarray.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):1&vpBits[index]&&2&vpBits[index]&&(square=(dx=tnv.ix-bp.ix)*dx+(dy=tnv.iy-bp.iy)*dy+(dz=tnv.iz-bp.iz)*dz)<vpDistance[index]&&(boundPoint.set(tnv.ix,tnv.iy,tnv.iz,bp),vpDistance[index]=square,4&vpBits[index]||(vpBits[index]|=4,outarray.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz}))));for(i=0,n=inarray.length;i<n;i++)for(tx=inarray[i].ix,ty=inarray[i].iy,tz=inarray[i].iz,bp=boundPoint.get(tx,ty,tz),j=6;j<18;j++)tnv.ix=tx+nb[j][0],tnv.iy=ty+nb[j][1],tnv.iz=tz+nb[j][2],tnv.ix<pLength&&tnv.ix>-1&&tnv.iy<pWidth&&tnv.iy>-1&&tnv.iz<pHeight&&tnv.iz>-1&&(index=tnv.ix*pWH+pHeight*tnv.iy+tnv.iz,1&vpBits[index]&&!(2&vpBits[index])?(boundPoint.set(tnv.ix,tnv.iy,tz+nb[j][2],bp),square=(dx=tnv.ix-bp.ix)*dx+(dy=tnv.iy-bp.iy)*dy+(dz=tnv.iz-bp.iz)*dz,vpDistance[index]=square,vpBits[index]|=2,vpBits[index]|=4,outarray.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):1&vpBits[index]&&2&vpBits[index]&&(square=(dx=tnv.ix-bp.ix)*dx+(dy=tnv.iy-bp.iy)*dy+(dz=tnv.iz-bp.iz)*dz)<vpDistance[index]&&(boundPoint.set(tnv.ix,tnv.iy,tnv.iz,bp),vpDistance[index]=square,4&vpBits[index]||(vpBits[index]|=4,outarray.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz}))));for(i=0,n=inarray.length;i<n;i++)for(tx=inarray[i].ix,ty=inarray[i].iy,tz=inarray[i].iz,bp=boundPoint.get(tx,ty,tz),j=18;j<26;j++)tnv.ix=tx+nb[j][0],tnv.iy=ty+nb[j][1],tnv.iz=tz+nb[j][2],tnv.ix<pLength&&tnv.ix>-1&&tnv.iy<pWidth&&tnv.iy>-1&&tnv.iz<pHeight&&tnv.iz>-1&&(index=tnv.ix*pWH+pHeight*tnv.iy+tnv.iz,1&vpBits[index]&&!(2&vpBits[index])?(boundPoint.set(tnv.ix,tnv.iy,tz+nb[j][2],bp),square=(dx=tnv.ix-bp.ix)*dx+(dy=tnv.iy-bp.iy)*dy+(dz=tnv.iz-bp.iz)*dz,vpDistance[index]=square,vpBits[index]|=2,vpBits[index]|=4,outarray.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):1&vpBits[index]&&2&vpBits[index]&&(square=(dx=tnv.ix-bp.ix)*dx+(dy=tnv.iy-bp.iy)*dy+(dz=tnv.iz-bp.iz)*dz)<vpDistance[index]&&(boundPoint.set(tnv.ix,tnv.iy,tnv.iz,bp),vpDistance[index]=square,4&vpBits[index]||(vpBits[index]|=4,outarray.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz}))));return outarray},this.marchingcubeinit=function(stype){for(var i=0,lim=vpBits.length;i<lim;i++)1==stype?vpBits[i]&=-5:4==stype?(vpBits[i]&=-3,4&vpBits[i]&&(vpBits[i]|=2),vpBits[i]&=-5):2==stype?4&vpBits[i]&&2&vpBits[i]?vpBits[i]&=-5:4&vpBits[i]&&!(2&vpBits[i])&&(vpBits[i]|=2):3==stype&&(vpBits[i]&=-5)},this.marchingcube=function(stype){this.marchingcubeinit(stype),verts=[],faces=[],$3Dmol.MarchingCube.march(vpBits,verts,faces,{smooth:1,nX:pLength,nY:pWidth,nZ:pHeight});for(var pWH=pWidth*pHeight,i=0,vlen=verts.length;i<vlen;i++)verts[i].atomid=vpAtomID[verts[i].x*pWH+pHeight*verts[i].y+verts[i].z];$3Dmol.MarchingCube.laplacianSmooth(1,verts,faces)}},$3Dmol.autoload=function(viewer,callback){var i,dataname,type;if(void 0!==$(".viewer_3Dmoljs")[0]&&($3Dmol.autoinit=!0),$3Dmol.autoinit){viewer=null!=viewer?viewer:null,$3Dmol.viewers={};var nviewers=0;$(".viewer_3Dmoljs").each((function(){var viewerdiv=$(this),datauri=[],datatypes=[],uri="";"static"==viewerdiv.css("position")&&viewerdiv.css("position","relative"),type=null,viewerdiv.data("pdb")?(datauri.push("https://files.rcsb.org/view/"+viewerdiv.data("pdb")+".pdb"),datatypes.push("pdb")):viewerdiv.data("cid")?(datatypes.push("sdf"),datauri.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+viewerdiv.data("cid")+"/SDF?record_type=3d")):(viewerdiv.data("href")||viewerdiv.data("url"))&&(uri=viewerdiv.data("href"),datauri.push(uri),type=uri.substr(uri.lastIndexOf(".")+1),datatypes.push(type));var divdata=viewerdiv.data();for(i in divdata)"pdb"===i.substring(0,3)&&"pdb"!==i?(datauri.push("https://files.rcsb.org/view/"+divdata[i]+".pdb"),datatypes.push("pdb")):"href"===i.substring(0,4)&&"href"!==i?(uri=divdata[i],datauri.push(uri),datatypes.push(uri.substr(uri.lastIndexOf(".")+1))):"cid"===i.substring(0,3)&&"cid"!==i&&(datauri.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+divdata[i]+"/SDF?record_type=3d"),datatypes.push("sdf"));var options={};viewerdiv.data("options")&&(options=$3Dmol.specStringToObject(viewerdiv.data("options")));var bgcolor=$3Dmol.CC.color(viewerdiv.data("backgroundcolor")),style={line:{}};viewerdiv.data("style")&&(style=$3Dmol.specStringToObject(viewerdiv.data("style")));var select={};viewerdiv.data("select")&&(select=$3Dmol.specStringToObject(viewerdiv.data("select")));var selectstylelist=[],surfaces=[],labels=[],zoomto={},d=viewerdiv.data(),stylere=/style(.+)/,surfre=/surface(.*)/,reslabre=/labelres(.*)/,keys=[];for(dataname in d)Object.prototype.hasOwnProperty.call(d,dataname)&&keys.push(dataname);for(keys.sort(),i=0;i<keys.length;i++){dataname=keys[i];var m=stylere.exec(dataname),selname,newsel,styleobj;m&&(selname="select"+m[1],newsel=$3Dmol.specStringToObject(d[selname]),styleobj=$3Dmol.specStringToObject(d[dataname]),selectstylelist.push([newsel,styleobj])),m=surfre.exec(dataname),m&&(selname="select"+m[1],newsel=$3Dmol.specStringToObject(d[selname]),styleobj=$3Dmol.specStringToObject(d[dataname]),surfaces.push([newsel,styleobj])),m=reslabre.exec(dataname),m&&(selname="select"+m[1],newsel=$3Dmol.specStringToObject(d[selname]),styleobj=$3Dmol.specStringToObject(d[dataname]),labels.push([newsel,styleobj])),"zoomto"==dataname&&(zoomto=$3Dmol.specStringToObject(d[dataname]))}var applyStyles=function(glviewer){var sel,sty;for(glviewer.setStyle(select,style),i=0;i<selectstylelist.length;i++)sel=selectstylelist[i][0]||{},sty=selectstylelist[i][1]||{line:{}},glviewer.setStyle(sel,sty);for(i=0;i<surfaces.length;i++)sel=surfaces[i][0]||{},sty=surfaces[i][1]||{},glviewer.addSurface($3Dmol.SurfaceType.VDW,sty,sel,sel);for(i=0;i<labels.length;i++)sel=labels[i][0]||{},sty=labels[i][1]||{},glviewer.addResLabels(sel,sty);glviewer.zoomTo(zoomto),glviewer.render()},glviewer=viewer;try{if(null==glviewer){var config=viewerdiv.data("config")||{};config.defaultcolors=config.defaultcolors||$3Dmol.rasmolElementColors,glviewer=$3Dmol.viewers[this.id||nviewers++]=$3Dmol.createViewer(viewerdiv,config)}glviewer.setBackgroundColor(bgcolor)}catch(error){console.log(error),window.location="http://get.webgl.org"}if(0!=datauri.length){i=0;var process=function(moldata){uri=datauri[i];var type=viewerdiv.data("type")||viewerdiv.data("datatype")||datatypes[i];if(glviewer.addModel(moldata,type,options),i+=1,i<datauri.length)$.get(datauri[i],process,"text");else{if(applyStyles(glviewer),viewerdiv.data("callback")){var runres=eval(viewerdiv.data("callback"));"function"==typeof runres&&runres(glviewer)}callback&&callback(glviewer)}};$.get(datauri[0],process,"text")}else{if(viewerdiv.data("element")){var moldata=$("#"+viewerdiv.data("element")).val()||"";type=viewerdiv.data("type")||viewerdiv.data("datatype"),type||(console.log("Warning: No type specified for embedded viewer with moldata from "+viewerdiv.data("element")+"\n assuming type 'pdb'"),type="pdb"),glviewer.addModel(moldata,type,options)}if(applyStyles(glviewer),viewerdiv.data("callback")){var runres=eval(viewerdiv.data("callback"));"function"==typeof runres&&runres(glviewer)}callback&&callback(glviewer)}}))}},$(document).ready((function(){$3Dmol.autoload()}));var htmlColors=$3Dmol.htmlColors={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgrey:11119017,darkgreen:25600,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,grey:8421504,green:32768,greenyellow:11403055,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgrey:13882323,lightgreen:9498256,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};$3Dmol.CC={cache:{0:new $3Dmol.Color(0)},color:function color_(hex){if(!hex)return this.cache[0];if(void 0!==this.cache[hex])return this.cache[hex];if(hex&&hex.constructor===Array)return hex.map(color_,this);if("number"==typeof(hex=this.getHex(hex))){var c=new $3Dmol.Color(hex);return this.cache[hex]=c,c}return hex},getHex:function(hex){return isNaN(parseInt(hex))?"string"==typeof hex?(4==(hex=hex.trim()).length&&"#"==hex[0]&&(hex="#"+hex[1]+hex[1]+hex[2]+hex[2]+hex[3]+hex[3]),7==hex.length&&"#"==hex[0]?parseInt(hex.substring(1),16):htmlColors[hex.toLowerCase()]||0):hex:parseInt(hex)}},$3Dmol.CC=$3Dmol.CC,$3Dmol.CC.color=$3Dmol.CC.color,$3Dmol.ssColors=$3Dmol.ssColors||{},$3Dmol.ssColors.pyMol={h:16711680,s:16776960,c:65280},$3Dmol.ssColors.Jmol={h:16711808,s:16762880,c:16777215},$3Dmol.elementColors=$3Dmol.elementColors||{},$3Dmol.elementColors.defaultColor=16716947,$3Dmol.elementColors.Jmol={H:16777215,He:14286847,HE:14286847,Li:13402367,LI:13402367,Be:12779264,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,Ne:11789301,NE:11789301,Na:11230450,NA:11230450,Mg:9109248,MG:9109248,Al:12560038,AL:12560038,Si:1578e4,SI:1578e4,P:16744448,S:16777008,Cl:2093087,CL:2093087,Ar:8442339,AR:8442339,K:9388244,Ca:4062976,CA:4062976,Sc:15132390,SC:15132390,Ti:12567239,TI:12567239,V:10921643,Cr:9083335,CR:9083335,Mn:10255047,MN:10255047,Fe:14706227,FE:14706227,Co:15765664,CO:15765664,Ni:5296208,NI:5296208,Cu:13140019,CU:13140019,Zn:8224944,ZN:8224944,Ga:12750735,GA:12750735,Ge:6721423,GE:6721423,As:12419299,AS:12419299,Se:16752896,SE:16752896,Br:10889513,BR:10889513,Kr:6076625,KR:6076625,Rb:7351984,RB:7351984,Sr:65280,SR:65280,Y:9764863,Zr:9756896,ZR:9756896,Nb:7586505,NB:7586505,Mo:5551541,MO:5551541,Tc:3907230,TC:3907230,Ru:2396047,RU:2396047,Rh:687500,RH:687500,Pd:27013,PD:27013,Ag:12632256,AG:12632256,Cd:16767375,CD:16767375,In:10909043,IN:10909043,Sn:6717568,SN:6717568,Sb:10380213,SB:10380213,Te:13924864,TE:13924864,I:9699476,Xe:4366e3,XE:4366e3,Cs:5707663,CS:5707663,Ba:51456,BA:51456,La:7394559,LA:7394559,Ce:16777159,CE:16777159,Pr:14286791,PR:14286791,Nd:13107143,ND:13107143,Pm:10747847,PM:10747847,Sm:9437127,SM:9437127,Eu:6422471,EU:6422471,Gd:4587463,GD:4587463,Tb:3211207,TB:3211207,Dy:2097095,DY:2097095,Ho:65436,HO:65436,Er:58997,ER:58997,Tm:54354,TM:54354,Yb:48952,YB:48952,Lu:43812,LU:43812,Hf:5096191,HF:5096191,Ta:5089023,TA:5089023,W:2200790,Re:2522539,RE:2522539,Os:2516630,OS:2516630,Ir:1528967,IR:1528967,Pt:13684960,PT:13684960,Au:16765219,AU:16765219,Hg:12105936,HG:12105936,Tl:10900557,TL:10900557,Pb:5724513,PB:5724513,Bi:10375093,BI:10375093,Po:11230208,PO:11230208,At:7688005,AT:7688005,Rn:4358806,RN:4358806,Fr:4325478,FR:4325478,Ra:32e3,RA:32e3,Ac:7384058,AC:7384058,Th:47871,TH:47871,Pa:41471,PA:41471,U:36863,Np:33023,NP:33023,Pu:27647,PU:27647,Am:5528818,AM:5528818,Cm:7888099,CM:7888099,Bk:9064419,BK:9064419,Cf:10565332,CF:10565332,Es:11739092,ES:11739092,Fm:11739066,FM:11739066,Md:11734438,MD:11734438,No:12389767,NO:12389767,Lr:13041766,LR:13041766,Rf:13369433,RF:13369433,Db:13697103,DB:13697103,Sg:14221381,SG:14221381,Bh:14680120,BH:14680120,Hs:15073326,HS:15073326,Mt:15400998,MT:15400998},$3Dmol.elementColors.rasmol={H:16777215,He:16761035,HE:16761035,Li:11674146,LI:11674146,B:65280,C:13158600,N:9408511,O:15728640,F:14329120,Na:255,NA:255,Mg:2263842,MG:2263842,Al:8421520,AL:8421520,Si:14329120,SI:14329120,P:16753920,S:16762930,Cl:65280,CL:65280,Ca:8421520,CA:8421520,Ti:8421520,TI:8421520,Cr:8421520,CR:8421520,Mn:8421520,MN:8421520,Fe:16753920,FE:16753920,Ni:10824234,NI:10824234,Cu:10824234,CU:10824234,Zn:10824234,ZN:10824234,Br:10824234,BR:10824234,Ag:8421520,AG:8421520,I:10494192,Ba:16753920,BA:16753920,Au:14329120,AU:14329120},$3Dmol.elementColors.defaultColors=$3Dmol.elementColors.rasmol,$3Dmol.elementColors.greenCarbon=$3Dmol.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.greenCarbon.C=65280,$3Dmol.elementColors.cyanCarbon=$3Dmol.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.cyanCarbon.C=65535,$3Dmol.elementColors.magentaCarbon=$3Dmol.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.magentaCarbon.C=16711935,$3Dmol.elementColors.yellowCarbon=$3Dmol.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.yellowCarbon.C=16776960,$3Dmol.elementColors.whiteCarbon=$3Dmol.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.whiteCarbon.C=16777215,$3Dmol.elementColors.orangeCarbon=$3Dmol.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.orangeCarbon.C=16753920,$3Dmol.elementColors.purpleCarbon=$3Dmol.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.purpleCarbon.C=8388736,$3Dmol.elementColors.blueCarbon=$3Dmol.extend({},$3Dmol.elementColors.defaultColors),$3Dmol.elementColors.blueCarbon.C=255,$3Dmol.residues={},$3Dmol.residues.amino={ALA:13158600,ARG:1334015,ASN:56540,ASP:15075850,CYS:15132160,GLN:56540,GLU:15075850,GLY:15461355,HIS:8553170,ILE:1016335,LEU:1016335,LYS:1334015,MET:15132160,PHE:3289770,PRO:14456450,SER:16422400,THR:16422400,TRP:11819700,TYR:3289770,VAL:1016335,ASX:16738740,GLX:16738740},$3Dmol.residues.shapely={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935},$3Dmol.residues.nucleic={A:10526975,G:16740464,I:8454143,C:16747595,T:10551200,U:16744576},$3Dmol.chains={},$3Dmol.chains.atom={A:12636415,B:11599792,C:16761032,D:16777088,E:16761087,F:11596016,G:16765040,H:15761536,I:16113331,J:49151,K:13458524,L:6737322,M:10145074,N:15631086,O:52945,P:65407,Q:3978097,R:139,S:12433259,T:25600,U:8388608,V:8421376,W:8388736,X:32896,Y:12092939,Z:11674146},$3Dmol.chains.hetatm={A:9478351,B:8441752,C:13602992,D:13619056,E:13603023,F:8437952,G:13607008,H:12603504,I:12955267,J:42959,K:11881548,L:5682578,M:9090346,N:12481214,O:46753,P:53103,Q:3447649,R:187,S:10854235,T:37888,U:11534336,V:11579392,W:11534512,X:45232,Y:15250963,Z:12726834},$3Dmol.builtinColorSchemes={ssPyMol:{prop:"ss",map:$3Dmol.ssColors.pyMol},ssJmol:{prop:"ss",map:$3Dmol.ssColors.Jmol},Jmol:{prop:"elem",map:$3Dmol.elementColors.Jmol},greenCarbon:{prop:"elem",map:$3Dmol.elementColors.greenCarbon},default:{prop:"elem",map:$3Dmol.elementColors.defaultColors},amino:{prop:"resn",map:$3Dmol.residues.amino},shapely:{prop:"resn",map:$3Dmol.residues.shapely},nucleic:{prop:"resn",map:$3Dmol.residues.nucleic},chain:{prop:"chain",map:$3Dmol.chains.atom},chainHetatm:{prop:"chain",map:$3Dmol.chains.hetatm}},$3Dmol.getColorFromStyle=function(atom,style){var scheme=style.colorscheme;if(void 0!==$3Dmol.builtinColorSchemes[scheme])scheme=$3Dmol.builtinColorSchemes[scheme];else if("string"==typeof scheme&&scheme.endsWith("Carbon")){var ccolor=scheme.substring(0,scheme.lastIndexOf("Carbon")).toLowerCase();if(void 0!==htmlColors[ccolor]){var newscheme=$3Dmol.extend({},$3Dmol.elementColors.defaultColors);newscheme.C=htmlColors[ccolor],$3Dmol.builtinColorSchemes[scheme]={prop:"elem",map:newscheme},scheme=$3Dmol.builtinColorSchemes[scheme]}}var color=atom.color,prop,val,C;if(void 0!==style.color&&"spectrum"!=style.color&&(color=style.color),void 0!==scheme)if(void 0!==$3Dmol.elementColors[scheme])void 0!==(scheme=$3Dmol.elementColors[scheme])[atom[scheme.prop]]&&(color=scheme.map[atom[scheme.prop]]);else if(void 0!==scheme[atom[scheme.prop]])color=scheme.map[atom[scheme.prop]];else if(void 0!==scheme.prop&&void 0!==scheme.gradient){prop=scheme.prop;var grad=scheme.gradient;void 0!==$3Dmol.Gradient.builtinGradients[grad]&&(grad=new $3Dmol.Gradient.builtinGradients[grad](scheme.min,scheme.max,scheme.mid));var range=grad.range()||[-1,1];null!=(val=$3Dmol.getAtomProperty(atom,prop))&&(color=grad.valueToHex(val,range))}else void 0!==scheme.prop&&void 0!==scheme.map?(prop=scheme.prop,val=$3Dmol.getAtomProperty(atom,prop),void 0!==scheme.map[val]&&(color=scheme.map[val])):void 0!==style.colorscheme[atom.elem]?color=style.colorscheme[atom.elem]:console.log("Could not interpret colorscheme "+scheme);else void 0!==style.colorfunc&&(color=style.colorfunc(atom));return $3Dmol.CC.color(color)};var $3Dmol=$3Dmol||{};$3Dmol.subdivide_spline=function(_points,DIV){var ret=[],points=_points,i,lim,size,p0,p1,p2,p3,v0,v1;for((points=[]).push(_points[0]),i=1,lim=_points.length-1;i<lim;i++)if(p1=_points[i],p2=_points[i+1],p1.smoothen){var np=new $3Dmol.Vector3((p1.x+p2.x)/2,(p1.y+p2.y)/2,(p1.z+p2.z)/2);np.atom=p1.atom,points.push(np)}else points.push(p1);for(points.push(_points[_points.length-1]),i=-1,size=points.length;i<=size-3;i++)if(p0=points[-1===i?0:i],p1=points[i+1],p2=points[i+2],p3=points[i===size-3?size-1:i+3],v0=(new $3Dmol.Vector3).subVectors(p2,p0).multiplyScalar(.5),v1=(new $3Dmol.Vector3).subVectors(p3,p1).multiplyScalar(.5),!p2.skip)for(var j=0;j<DIV;j++){var t=1/DIV*j,x=p1.x+t*v0.x+t*t*(-3*p1.x+3*p2.x-2*v0.x-v1.x)+t*t*t*(2*p1.x-2*p2.x+v0.x+v1.x),y=p1.y+t*v0.y+t*t*(-3*p1.y+3*p2.y-2*v0.y-v1.y)+t*t*t*(2*p1.y-2*p2.y+v0.y+v1.y),z=p1.z+t*v0.z+t*t*(-3*p1.z+3*p2.z-2*v0.z-v1.z)+t*t*t*(2*p1.z-2*p2.z+v0.z+v1.z),pt=new $3Dmol.Vector3(x,y,z);pt.atom=j<DIV/2?p1.atom:p2.atom,ret.push(pt)}return ret.push(points[points.length-1]),ret},$3Dmol.drawCartoon=function(){var defaultNum=5,defaultDiv=5,coilWidth=.5,helixSheetWidth=1.3,nucleicAcidWidth=.8,defaultThickness=.4,drawThinStrip=function(geo,p1,p2,colors){for(var offset,vertoffset,color,colori,i=0,lim=p1.length;i<lim;i++){colori=Math.round(i*(colors.length-1)/lim),color=$3Dmol.CC.color(colors[colori]);var geoGroup=geo.updateGeoGroup(2),vertexArray=geoGroup.vertexArray,colorArray=geoGroup.colorArray,faceArray=geoGroup.faceArray;vertexArray[vertoffset=3*(offset=geoGroup.vertices)]=p1[i].x,vertexArray[vertoffset+1]=p1[i].y,vertexArray[vertoffset+2]=p1[i].z,vertexArray[vertoffset+3]=p2[i].x,vertexArray[vertoffset+4]=p2[i].y,vertexArray[vertoffset+5]=p2[i].z;for(var j=0;j<6;++j)colorArray[vertoffset+3*j]=color.r,colorArray[vertoffset+1+3*j]=color.g,colorArray[vertoffset+2+3*j]=color.b;if(i>0){var faces=[offset,offset+1,offset-1,offset-2],faceoffset=geoGroup.faceidx;faceArray[faceoffset]=faces[0],faceArray[faceoffset+1]=faces[1],faceArray[faceoffset+2]=faces[3],faceArray[faceoffset+3]=faces[1],faceArray[faceoffset+4]=faces[2],faceArray[faceoffset+5]=faces[3],geoGroup.faceidx+=6}geoGroup.vertices+=2}},drawShapeStrip=function(geo,points,colors,div,thickness,opacity,shape){var i,j,num,len;if(!((num=points.length)<2||points[0].length<2)){for(i=0;i<num;i++)points[i]=$3Dmol.subdivide_spline(points[i],div);if(len=points[0].length,!thickness)return drawThinStrip(geo,points[0],points[num-1],colors,div,opacity);var axis,cs_shape,cs_bottom,cs_top,last_cs_bottom,last_cs_top,cs_ellipse=[],cs_rectangle=[],cs_parabola=[];for(j=0;j<num;j++)cs_ellipse.push(.25+1.5*Math.sqrt((num-1)*j-Math.pow(j,2))/(num-1)),cs_rectangle.push(.5),cs_parabola.push(2*(Math.pow(j/num,2)-j/num)+.6);var face_refs=[],v_offset,va_offset,f_offset,currentAtom,lastAtom,color,colori;for(j=0;j<2*num-1;j++)face_refs[j]=[j,j+1,j+1-2*num,j-2*num];face_refs[2*num-1]=[j,j+1-2*num,j+1-4*num,j-2*num];var geoGroup=geo.updateGeoGroup(2*num*len),vertexArray,colorArray,faceArray,face;for(i=0;i<len;i++){var toNext,toSide;for(colori=Math.round(i*(colors.length-1)/len),color=$3Dmol.CC.color(colors[colori]),last_cs_bottom=cs_bottom,last_cs_top=cs_top,cs_bottom=[],cs_top=[],axis=[],void 0!==points[0][i].atom&&(currentAtom=points[0][i].atom,"oval"===shape?cs_shape=cs_ellipse:"rectangle"===shape?cs_shape=cs_rectangle:"parabola"===shape&&(cs_shape=cs_parabola)),cs_shape||(cs_shape=cs_rectangle),j=0;j<num;j++)toNext=i<len-1?points[j][i+1].clone().sub(points[j][i]):points[j][i-1].clone().sub(points[j][i]).negate(),toSide=j<num-1?points[j+1][i].clone().sub(points[j][i]):points[j-1][i].clone().sub(points[j][i]).negate(),axis[j]=toSide.cross(toNext).normalize().multiplyScalar(thickness*cs_shape[j]);for(j=0;j<num;j++)cs_bottom[j]=points[j][i].clone().add(axis[j].clone().negate());for(j=0;j<num;j++)cs_top[j]=points[j][i].clone().add(axis[j]);for(vertexArray=geoGroup.vertexArray,colorArray=geoGroup.colorArray,faceArray=geoGroup.faceArray,va_offset=3*(v_offset=geoGroup.vertices),j=0;j<num;j++)vertexArray[va_offset+3*j+0]=cs_bottom[j].x,vertexArray[va_offset+3*j+1]=cs_bottom[j].y,vertexArray[va_offset+3*j+2]=cs_bottom[j].z;for(j=0;j<num;j++)vertexArray[va_offset+3*j+0+3*num]=cs_top[num-1-j].x,vertexArray[va_offset+3*j+1+3*num]=cs_top[num-1-j].y,vertexArray[va_offset+3*j+2+3*num]=cs_top[num-1-j].z;for(j=0;j<2*num;++j)colorArray[va_offset+3*j+0]=color.r,colorArray[va_offset+3*j+1]=color.g,colorArray[va_offset+3*j+2]=color.b;if(i>0){for(j=0;j<2*num;j++)face=[v_offset+face_refs[j][0],v_offset+face_refs[j][1],v_offset+face_refs[j][2],v_offset+face_refs[j][3]],faceArray[f_offset=geoGroup.faceidx]=face[0],faceArray[f_offset+1]=face[1],faceArray[f_offset+2]=face[3],faceArray[f_offset+3]=face[1],faceArray[f_offset+4]=face[2],faceArray[f_offset+5]=face[3],geoGroup.faceidx+=6;if(currentAtom.clickable||currentAtom.hoverable){var faces=[];for(j in faces.push(new $3Dmol.Triangle(last_cs_bottom[0],cs_bottom[0],cs_bottom[num-1])),faces.push(new $3Dmol.Triangle(last_cs_bottom[0],cs_bottom[num-1],last_cs_bottom[num-1])),faces.push(new $3Dmol.Triangle(last_cs_bottom[num-1],cs_bottom[num-1],cs_top[num-1])),faces.push(new $3Dmol.Triangle(last_cs_bottom[num-1],cs_top[num-1],last_cs_top[num-1])),faces.push(new $3Dmol.Triangle(cs_top[0],last_cs_top[0],last_cs_top[num-1])),faces.push(new $3Dmol.Triangle(cs_top[num-1],cs_top[0],last_cs_top[num-1])),faces.push(new $3Dmol.Triangle(cs_bottom[0],last_cs_bottom[0],last_cs_top[0])),faces.push(new $3Dmol.Triangle(cs_top[0],cs_bottom[0],last_cs_top[0])),faces)currentAtom.intersectionShape.triangle.push(faces[j])}}geoGroup.vertices+=2*num,lastAtom=currentAtom}for(vertexArray=geoGroup.vertexArray,colorArray=geoGroup.colorArray,faceArray=geoGroup.faceArray,va_offset=3*(v_offset=geoGroup.vertices),f_offset=geoGroup.faceidx,i=0;i<num-1;i++)face=[i,i+1,2*num-2-i,2*num-1-i],faceArray[f_offset=geoGroup.faceidx]=face[0],faceArray[f_offset+1]=face[1],faceArray[f_offset+2]=face[3],faceArray[f_offset+3]=face[1],faceArray[f_offset+4]=face[2],faceArray[f_offset+5]=face[3],geoGroup.faceidx+=6;for(i=0;i<num-1;i++)face=[v_offset-1-i,v_offset-2-i,v_offset-2*num+i+1,v_offset-2*num+i],faceArray[f_offset=geoGroup.faceidx]=face[0],faceArray[f_offset+1]=face[1],faceArray[f_offset+2]=face[3],faceArray[f_offset+3]=face[1],faceArray[f_offset+4]=face[2],faceArray[f_offset+5]=face[3],geoGroup.faceidx+=6}},drawPlainStrip=function(geo,points,colors,div,thickness,opacity){if(!(points.length<2)){var p1,p2;if(p1=points[0],p2=points[points.length-1],p1=$3Dmol.subdivide_spline(p1,div),p2=$3Dmol.subdivide_spline(p2,div),!thickness)return drawThinStrip(geo,p1,p2,colors,div,opacity);var vs=[],axis,p1v,p2v,a1v,a2v,faces=[[0,2,-6,-8],[-4,-2,6,4],[7,-1,-5,3],[-3,5,1,-7]],offset,vertoffset,faceoffset,color,colori,currentAtom,lastAtom,i,lim,j,face1,face2,face3,geoGroup,vertexArray,colorArray,faceArray;for(i=0,lim=p1.length;i<lim;i++){if(colori=Math.round(i*(colors.length-1)/lim),color=$3Dmol.CC.color(colors[colori]),vs.push(p1v=p1[i]),vs.push(p1v),vs.push(p2v=p2[i]),vs.push(p2v),i<lim-1){var toNext=p1[i+1].clone().sub(p1[i]),toSide;axis=p2[i].clone().sub(p1[i]).cross(toNext).normalize().multiplyScalar(thickness)}for(vs.push(a1v=p1[i].clone().add(axis)),vs.push(a1v),vs.push(a2v=p2[i].clone().add(axis)),vs.push(a2v),void 0!==p1v.atom&&(currentAtom=p1v.atom),vertexArray=(geoGroup=geo.updateGeoGroup(8)).vertexArray,colorArray=geoGroup.colorArray,faceArray=geoGroup.faceArray,vertexArray[vertoffset=3*(offset=geoGroup.vertices)]=p1v.x,vertexArray[vertoffset+1]=p1v.y,vertexArray[vertoffset+2]=p1v.z,vertexArray[vertoffset+3]=p1v.x,vertexArray[vertoffset+4]=p1v.y,vertexArray[vertoffset+5]=p1v.z,vertexArray[vertoffset+6]=p2v.x,vertexArray[vertoffset+7]=p2v.y,vertexArray[vertoffset+8]=p2v.z,vertexArray[vertoffset+9]=p2v.x,vertexArray[vertoffset+10]=p2v.y,vertexArray[vertoffset+11]=p2v.z,vertexArray[vertoffset+12]=a1v.x,vertexArray[vertoffset+13]=a1v.y,vertexArray[vertoffset+14]=a1v.z,vertexArray[vertoffset+15]=a1v.x,vertexArray[vertoffset+16]=a1v.y,vertexArray[vertoffset+17]=a1v.z,vertexArray[vertoffset+18]=a2v.x,vertexArray[vertoffset+19]=a2v.y,vertexArray[vertoffset+20]=a2v.z,vertexArray[vertoffset+21]=a2v.x,vertexArray[vertoffset+22]=a2v.y,vertexArray[vertoffset+23]=a2v.z,j=0;j<8;++j)colorArray[vertoffset+3*j]=color.r,colorArray[vertoffset+1+3*j]=color.g,colorArray[vertoffset+2+3*j]=color.b;if(i>0){var diffAtoms=void 0!==lastAtom&&void 0!==currentAtom&&lastAtom.serial!==currentAtom.serial;for(j=0;j<4;j++){var face=[offset+faces[j][0],offset+faces[j][1],offset+faces[j][2],offset+faces[j][3]];if(faceArray[faceoffset=geoGroup.faceidx]=face[0],faceArray[faceoffset+1]=face[1],faceArray[faceoffset+2]=face[3],faceArray[faceoffset+3]=face[1],faceArray[faceoffset+4]=face[2],faceArray[faceoffset+5]=face[3],geoGroup.faceidx+=6,currentAtom.clickable||lastAtom.clickable||currentAtom.hoverable||lastAtom.hoverable){var p1a=vs[face[3]].clone(),p1b=vs[face[0]].clone(),p2a=vs[face[2]].clone(),p2b=vs[face[1]].clone();if(p1a.atom=vs[face[3]].atom||null,p2a.atom=vs[face[2]].atom||null,p1b.atom=vs[face[0]].atom||null,p2b.atom=vs[face[1]].atom||null,diffAtoms){var m1=p1a.clone().add(p1b).multiplyScalar(.5),m2=p2a.clone().add(p2b).multiplyScalar(.5),m=p1a.clone().add(p2b).multiplyScalar(.5);j%2==0?((lastAtom.clickable||lastAtom.hoverable)&&(face1=new $3Dmol.Triangle(m1,m,p1a),face2=new $3Dmol.Triangle(m2,p2a,m),face3=new $3Dmol.Triangle(m,p2a,p1a),lastAtom.intersectionShape.triangle.push(face1),lastAtom.intersectionShape.triangle.push(face2),lastAtom.intersectionShape.triangle.push(face3)),(currentAtom.clickable||currentAtom.hoverable)&&(face1=new $3Dmol.Triangle(p1b,p2b,m),face2=new $3Dmol.Triangle(p2b,m2,m),face3=new $3Dmol.Triangle(p1b,m,m1),currentAtom.intersectionShape.triangle.push(face1),currentAtom.intersectionShape.triangle.push(face2),currentAtom.intersectionShape.triangle.push(face3))):((currentAtom.clickable||currentAtom.hoverable)&&(face1=new $3Dmol.Triangle(m1,m,p1a),face2=new $3Dmol.Triangle(m2,p2a,m),face3=new $3Dmol.Triangle(m,p2a,p1a),currentAtom.intersectionShape.triangle.push(face1),currentAtom.intersectionShape.triangle.push(face2),currentAtom.intersectionShape.triangle.push(face3)),(lastAtom.clickable||lastAtom.hoverable)&&(face1=new $3Dmol.Triangle(p1b,p2b,m),face2=new $3Dmol.Triangle(p2b,m2,m),face3=new $3Dmol.Triangle(p1b,m,m1),lastAtom.intersectionShape.triangle.push(face1),lastAtom.intersectionShape.triangle.push(face2),lastAtom.intersectionShape.triangle.push(face3)))}else(currentAtom.clickable||currentAtom.hoverable)&&(face1=new $3Dmol.Triangle(p1b,p2b,p1a),face2=new $3Dmol.Triangle(p2b,p2a,p1a),currentAtom.intersectionShape.triangle.push(face1),currentAtom.intersectionShape.triangle.push(face2))}}}geoGroup.vertices+=8,lastAtom=currentAtom}var vsize=vs.length-8;for(vertexArray=(geoGroup=geo.updateGeoGroup(8)).vertexArray,colorArray=geoGroup.colorArray,faceArray=geoGroup.faceArray,vertoffset=3*(offset=geoGroup.vertices),faceoffset=geoGroup.faceidx,i=0;i<4;i++){vs.push(vs[2*i]),vs.push(vs[vsize+2*i]);var v1=vs[2*i],v2=vs[vsize+2*i];vertexArray[vertoffset+6*i]=v1.x,vertexArray[vertoffset+1+6*i]=v1.y,vertexArray[vertoffset+2+6*i]=v1.z,vertexArray[vertoffset+3+6*i]=v2.x,vertexArray[vertoffset+4+6*i]=v2.y,vertexArray[vertoffset+5+6*i]=v2.z,colorArray[vertoffset+6*i]=color.r,colorArray[vertoffset+1+6*i]=color.g,colorArray[vertoffset+2+6*i]=color.b,colorArray[vertoffset+3+6*i]=color.r,colorArray[vertoffset+4+6*i]=color.g,colorArray[vertoffset+5+6*i]=color.b}vsize+=8,face1=[offset,offset+2,offset+6,offset+4],face2=[offset+1,offset+5,offset+7,offset+3],faceArray[faceoffset]=face1[0],faceArray[faceoffset+1]=face1[1],faceArray[faceoffset+2]=face1[3],faceArray[faceoffset+3]=face1[1],faceArray[faceoffset+4]=face1[2],faceArray[faceoffset+5]=face1[3],faceArray[faceoffset+6]=face2[0],faceArray[faceoffset+7]=face2[1],faceArray[faceoffset+8]=face2[3],faceArray[faceoffset+9]=face2[1],faceArray[faceoffset+10]=face2[2],faceArray[faceoffset+11]=face2[3],geoGroup.faceidx+=12,geoGroup.vertices+=8}},drawSmoothCurve=function(group,_points,width,colors,div){if(0!==_points.length){div=void 0===div?5:div;var geo=new $3Dmol.Geometry,lineMaterial=new $3Dmol.LineBasicMaterial({linewidth:width});lineMaterial.vertexColors=!0;var line=new $3Dmol.Line(geo,lineMaterial);line.type=$3Dmol.LineStrip,group.add(line)}},drawStrip=function(geo,points,colors,div,thickness,opacity,shape){shape&&"default"!==shape||(shape="rectangle"),"edged"===shape?drawPlainStrip(geo,points,colors,div,thickness,opacity):"rectangle"!==shape&&"oval"!==shape&&"parabola"!==shape||drawShapeStrip(geo,points,colors,div,thickness,opacity,shape)},isAlphaCarbon=function(atom){return atom&&"C"===atom.elem&&"CA"===atom.atom},inConnectedResidues=function(a,b){if(a&&b&&a.chain===b.chain){if(!(a.hetflag||b.hetflag||a.reschain!==b.reschain||a.resi!==b.resi&&a.resi!==b.resi-1))return!0;if(a.resi<b.resi){var dx=a.x-b.x,dy=a.y-b.y,dz=a.z-b.z,dist=dx*dx+dy*dy+dz*dz;if("CA"==a.atom&&"CA"==b.atom&&dist<16)return!0;if(("P"==a.atom||"P"==b.atom)&&dist<64)return!0}}return!1},setGeo=function(group,geo,opacity,outline,setNormals){if(null!=geo&&0!=geo.vertices){setNormals&&(geo.initTypedArrays(),geo.setUpNormals());var cartoonMaterial=new $3Dmol.MeshDoubleLambertMaterial;cartoonMaterial.vertexColors=$3Dmol.FaceColors,"number"==typeof opacity&&opacity>=0&&opacity<1&&(cartoonMaterial.transparent=!0,cartoonMaterial.opacity=opacity),cartoonMaterial.outline=outline;var cartoonMesh=new $3Dmol.Mesh(geo,cartoonMaterial);group.add(cartoonMesh)}},addBackbonePoints=function(points,num,smoothen,backbonePt,orientPt,prevOrientPt,backboneAtom,atoms,atomi){var widthScalar,i,delta,v,addArrowPoints,testStyle;if(backbonePt&&orientPt&&backboneAtom){var sideVec=orientPt.sub(backbonePt);sideVec.normalize();var forwardVec=atoms[atomi];for(i=atomi+1;i<atoms.length&&(forwardVec=atoms[i]).atom!=backboneAtom.atom;i++);if((forwardVec=forwardVec?new $3Dmol.Vector3(forwardVec.x,forwardVec.y,forwardVec.z):new $3Dmol.Vector3(0,0,0)).sub(backbonePt),"arrow start"===backboneAtom.ss){var adjustment=forwardVec.clone().multiplyScalar(.3).cross(orientPt);backbonePt.add(adjustment);var upVec=forwardVec.clone().cross(sideVec).normalize();sideVec.rotateAboutVector(upVec,.43)}for(backboneAtom.style.cartoon.ribbon?widthScalar=backboneAtom.style.cartoon.thickness||.4:backboneAtom.style.cartoon.width?widthScalar=backboneAtom.style.cartoon.width:"c"===backboneAtom.ss?widthScalar="P"===backboneAtom.atom?.8:.5:"arrow start"===backboneAtom.ss?(widthScalar=1.3,addArrowPoints=!0):widthScalar="arrow end"===backboneAtom.ss?.5:"h"===backboneAtom.ss&&backboneAtom.style.cartoon.tubes||"tube start"===backboneAtom.ss?.5:1.3,null!=prevOrientPt&&sideVec.dot(prevOrientPt)<0&&sideVec.negate(),sideVec.multiplyScalar(widthScalar),i=0;i<num;i++)delta=2*i/(num-1)-1,(v=new $3Dmol.Vector3(backbonePt.x+delta*sideVec.x,backbonePt.y+delta*sideVec.y,backbonePt.z+delta*sideVec.z)).atom=backboneAtom,smoothen&&"s"===backboneAtom.ss&&(v.smoothen=!0),points[i].push(v);if(addArrowPoints)for(sideVec.multiplyScalar(2),i=0;i<num;i++)delta=2*i/(num-1)-1,(v=new $3Dmol.Vector3(backbonePt.x+delta*sideVec.x,backbonePt.y+delta*sideVec.y,backbonePt.z+delta*sideVec.z)).atom=backboneAtom,v.smoothen=!1,v.skip=!0,points[i].push(v);return testStyle=backboneAtom.style.cartoon.style||"default",points.style?points.style!=testStyle&&(console.log("Warning: a cartoon chain's strand-style is ambiguous"),points.style="default"):points.style=testStyle,"arrow start"!==backboneAtom.ss&&"arrow end"!==backboneAtom.ss||(backboneAtom.ss="s"),addArrowPoints}},cartoonAtoms={C:!0,CA:!0,O:!0,P:!0,OP2:!0,O2P:!0,"O5'":!0,"O3'":!0,"C5'":!0,"C2'":!0,"O5*":!0,"O3*":!0,"C5*":!0,"C2*":!0,N1:!0,N3:!0},purResns={DA:!0,DG:!0,A:!0,G:!0},pyrResns={DT:!0,DC:!0,U:!0,C:!0,T:!0},naResns={DA:!0,DG:!0,A:!0,G:!0,DT:!0,DC:!0,U:!0,C:!0,T:!0},drawCartoon=function(group,atomList,gradientrange,fill,doNotSmoothen,num,div){var cartoon,prev,curr,next,currColor,nextColor,thickness,i,backbonePt,orientPt,prevOrientPt,terminalPt,termOrientPt,baseStartPt,baseEndPt,tubeStart,tubeEnd,drawingTube;num=num||5,div=div||5;var shapeGeo=new $3Dmol.Geometry(!0),geo=new $3Dmol.Geometry(!0),colors=[],points=[],opacity=1,outline=!1,gradients={};for(var g in $3Dmol.Gradient.builtinGradients)$3Dmol.Gradient.builtinGradients.hasOwnProperty(g)&&(gradients[g]=new $3Dmol.Gradient.builtinGradients[g](gradientrange[1],gradientrange[0]));var cartoonColor=function(next,cartoon){return gradientrange&&"spectrum"===cartoon.color?cartoon.colorscheme in gradients?gradients[cartoon.colorscheme].valueToHex(next.resi):gradients.sinebow.valueToHex(next.resi):$3Dmol.getColorFromStyle(next,cartoon).getHex()};for(i=0;i<num;i++)points[i]=[];var inSheet=!1,inHelix=!1,atoms=[];for(i in atomList){if("C"===(next=atomList[i]).elem&&"CA"===next.atom){var connected=inConnectedResidues(curr,next);connected&&"s"===next.ss?inSheet=!0:inSheet&&(curr&&prev&&curr.style.cartoon.arrows&&prev.style.cartoon.arrows&&(curr.ss="arrow end",prev.ss="arrow start"),inSheet=!1),connected&&("h"===curr.ss||"tube start"==curr.ss)&&curr.style.cartoon.tubes?!inHelix&&"tube start"!=curr.ss&&next.style.cartoon.tubes&&(next.ss="tube start",inHelix=!0):inHelix&&("tube start"===curr.ss?curr.ss="tube end":prev&&prev.style.cartoon.tubes&&(prev.ss="tube end"),inHelix=!1),prev=curr,curr=next}next&&next.atom in cartoonAtoms&&atoms.push(next)}inHelix&&curr.style.cartoon.tubes&&(curr.ss="tube end",inHelix=!1);var flushGeom=function(connect){for(var i=0;!thickness&&i<num;i++)drawSmoothCurve(group,points[i],1,colors,div,opacity);fill&&points[0].length>0&&drawStrip(geo,points,colors,div,thickness,opacity,points.style);var saved=[],savedc=null;if(connect){for(i=0;i<num;i++)saved[i]=points[i][points[i].length-1];savedc=colors[colors.length-1]}for(points=[],i=0;i<num;i++)points[i]=[];if(colors=[],connect){for(i=0;i<num;i++)points[i].push(saved[i]);colors.push(savedc)}setGeo(group,geo,opacity,outline,!0),setGeo(group,shapeGeo,opacity,outline,!1),geo=new $3Dmol.Geometry(!0),shapeGeo=new $3Dmol.Geometry(!0)};curr=void 0;for(var a=0;a<atoms.length;a++){var nextresn=(next=atoms[a]).resn.trim(),inNucleicAcid=nextresn in naResns;if(opacity=1,cartoon=next.style.cartoon,curr&&curr.style.cartoon&&(opacity=curr.style.cartoon.opacity),curr&&curr.style.cartoon&&curr.style.cartoon.outline&&(outline=curr.style.cartoon.outline),!curr||!curr.style.cartoon||next.style.cartoon&&curr.style.cartoon.opacity==next.style.cartoon.opacity||flushGeom(curr.chain==next.chain),points.length&&points[0].length>3e4/num/div/2&&flushGeom(!0),"trace"===cartoon.style){if(next.hetflag);else if("C"===next.elem&&"CA"===next.atom||inNucleicAcid&&"P"===next.atom){if(nextColor=cartoonColor(next,cartoon),thickness=$3Dmol.isNumeric(cartoon.thickness)?cartoon.thickness:.4,inConnectedResidues(curr,next))if(nextColor==currColor){var color=$3Dmol.CC.color(nextColor);$3Dmol.GLDraw.drawCylinder(shapeGeo,curr,next,thickness,color,2,2)}else{var midpoint=(new $3Dmol.Vector3).addVectors(curr,next).multiplyScalar(.5),color1=$3Dmol.CC.color(currColor),color2=$3Dmol.CC.color(nextColor);$3Dmol.GLDraw.drawCylinder(shapeGeo,curr,midpoint,thickness,color1,2,0),$3Dmol.GLDraw.drawCylinder(shapeGeo,midpoint,next,thickness,color2,0,2)}if((!0===next.clickable||next.hoverable)&&void 0!==next.intersectionShape){var center=new $3Dmol.Vector3(next.x,next.y,next.z);next.intersectionShape.sphere.push(new $3Dmol.Sphere(center,thickness))}curr=next,currColor=nextColor}}else{if(isAlphaCarbon(next)||inNucleicAcid&&("P"===next.atom||0==next.atom.indexOf("O5"))){if(drawingTube)if("tube end"===next.ss)drawingTube=!1,tubeEnd=new $3Dmol.Vector3(next.x,next.y,next.z),$3Dmol.GLDraw.drawCylinder(shapeGeo,tubeStart,tubeEnd,2,$3Dmol.CC.color(currColor),1,1),next.ss="h";else{if(curr.chain==next.chain&&"tube end"!==curr.ss)continue;drawingTube=!1,curr.ss="h",tubeEnd=new $3Dmol.Vector3(curr.x,curr.y,curr.z),$3Dmol.GLDraw.drawCylinder(shapeGeo,tubeStart,tubeEnd,2,$3Dmol.CC.color(currColor),1,1)}if(curr&&(!inConnectedResidues(curr,next)||"tube start"===curr.ss)){for("tube start"===curr.ss&&(drawingTube=!0,tubeStart=new $3Dmol.Vector3(curr.x,curr.y,curr.z),curr.ss="h"),baseEndPt&&(baseStartPt=terminalPt?(new $3Dmol.Vector3).addVectors(curr,terminalPt).multiplyScalar(.5):new $3Dmol.Vector3(curr.x,curr.y,curr.z),$3Dmol.GLDraw.drawCylinder(shapeGeo,baseStartPt,baseEndPt,.4,$3Dmol.CC.color(baseEndPt.color),0,2),addBackbonePoints(points,num,!doNotSmoothen,terminalPt,termOrientPt,prevOrientPt,curr,atoms,a),colors.push(nextColor),baseStartPt=null,baseEndPt=null),i=0;!thickness&&i<num;i++)drawSmoothCurve(group,points[i],1,colors,div,opacity);for(fill&&points[0].length>0&&drawStrip(geo,points,colors,div,thickness,opacity,points.style),points=[],i=0;i<num;i++)points[i]=[];colors=[]}if(void 0===curr||curr.rescode!=next.rescode||curr.resi!=next.resi){if(baseEndPt){var startFix=(baseStartPt=(new $3Dmol.Vector3).addVectors(curr,next).multiplyScalar(.5)).clone().sub(baseEndPt).multiplyScalar(.02);baseStartPt.add(startFix),$3Dmol.GLDraw.drawCylinder(shapeGeo,baseStartPt,baseEndPt,.4,$3Dmol.CC.color(baseEndPt.color),0,2),baseStartPt=null,baseEndPt=null}nextColor=cartoonColor(next,cartoon),colors.push(nextColor),thickness=$3Dmol.isNumeric(cartoon.thickness)?cartoon.thickness:.4,curr=next,(backbonePt=new $3Dmol.Vector3(curr.x,curr.y,curr.z)).resi=curr.resi,currColor=nextColor}!0!==next.clickable&&!0!==next.hoverable||void 0!==next.intersectionShape&&void 0!==next.intersectionShape.triangle||(next.intersectionShape={sphere:null,cylinder:[],line:[],triangle:[]})}else isAlphaCarbon(curr)&&"O"===next.atom||inNucleicAcid&&"P"===curr.atom&&("OP2"===next.atom||"O2P"===next.atom)||inNucleicAcid&&0==curr.atom.indexOf("O5")&&0==next.atom.indexOf("C5")?((orientPt=new $3Dmol.Vector3(next.x,next.y,next.z)).resi=next.resi,"OP2"!==next.atom&&"O2P"!==next.atom||(termOrientPt=new $3Dmol.Vector3(next.x,next.y,next.z))):inNucleicAcid&&0==next.atom.indexOf("O3")?terminalPt=new $3Dmol.Vector3(next.x,next.y,next.z):("N1"===next.atom&&nextresn in purResns||"N3"===next.atom&&nextresn in pyrResns)&&((baseEndPt=new $3Dmol.Vector3(next.x,next.y,next.z)).color=$3Dmol.getColorFromStyle(next,cartoon).getHex());orientPt&&backbonePt&&orientPt.resi===backbonePt.resi&&(addBackbonePoints(points,num,!doNotSmoothen,backbonePt,orientPt,prevOrientPt,curr,atoms,a),prevOrientPt=orientPt,backbonePt=null,orientPt=null,colors.push(nextColor))}}baseEndPt&&(baseStartPt=terminalPt?(new $3Dmol.Vector3).addVectors(curr,terminalPt).multiplyScalar(.5):new $3Dmol.Vector3(curr.x,curr.y,curr.z),$3Dmol.GLDraw.drawCylinder(shapeGeo,baseStartPt,baseEndPt,.4,$3Dmol.CC.color(baseEndPt.color),0,2),addBackbonePoints(points,num,!doNotSmoothen,terminalPt,termOrientPt,prevOrientPt,curr,atoms,a),colors.push(nextColor)),flushGeom()},defaultDrawCartoon;return function(group,atomList,gradientrange,quality){drawCartoon(group,atomList,gradientrange,!0,!1,quality=quality||5,quality)}}();var $3Dmol=$3Dmol||{};$3Dmol.CAP={NONE:0,FLAT:1,ROUND:2},$3Dmol.GLDraw=function(){var draw={},getRotationMatrix=(d=new $3Dmol.Vector3,function(dir){d.set(dir[0],dir[1],dir[2]);var dx=d.x,dy=d.y,dz=d.z,dxy=Math.sqrt(dx*dx+dy*dy),dyz,sinA,cosA,sinB,cosB;dxy<1e-4?(sinA=0,cosA=1):(sinA=-dx/dxy,cosA=dy/dxy),dy=-sinA*dx+cosA*dy,(dyz=Math.sqrt(dy*dy+dz*dz))<1e-4?(sinB=0,cosB=1):(sinB=dz/dyz,cosB=dy/dyz);var rot=new Float32Array(9);return rot[0]=cosA,rot[1]=sinA,rot[2]=0,rot[3]=-sinA*cosB,rot[4]=cosA*cosB,rot[5]=sinB,rot[6]=sinA*sinB,rot[7]=-cosA*sinB,rot[8]=cosB,rot}),d,basisVectors=function(){var nvecs=[],subdivisions=4,N=Math.pow(2,4),i=2,M=Math.pow(2,i),spacing=N/M,j;for(nvecs[0]=new $3Dmol.Vector3(-1,0,0),nvecs[spacing]=new $3Dmol.Vector3(0,0,1),nvecs[2*spacing]=new $3Dmol.Vector3(1,0,0),nvecs[3*spacing]=new $3Dmol.Vector3(0,0,-1),i=3;i<=4;i++){for(spacing=N/(M=Math.pow(2,i-1)),j=0;j<M-1;j++)nvecs[spacing/2+j*spacing]=nvecs[j*spacing].clone().add(nvecs[(j+1)*spacing]).normalize();nvecs[spacing/2+(j=M-1)*spacing]=nvecs[j*spacing].clone().add(nvecs[0]).normalize()}return nvecs}(),cylVertexCache={cache:{},getVerticesForRadius:function(radius,cap,capType){if(void 0!==typeof this.chache&&void 0!==this.cache[radius]&&void 0!==this.cache[radius][cap+capType])return this.cache[radius][cap+capType];for(var w=basisVectors.length,nvecs=[],norms=[],n,i=0;i<w;i++)nvecs.push(basisVectors[i].clone().multiplyScalar(radius)),nvecs.push(basisVectors[i].clone().multiplyScalar(radius)),n=basisVectors[i].clone().normalize(),norms.push(n),norms.push(n);var verticesRows=[],heightSegments=10,widthSegments=w;var phiStart=0,phiLength=2*Math.PI,thetaStart=0,thetaLength=Math.PI,x,y,polar=!1,equator=!1;for(y=0;y<=10;y++){polar=0===y||10===y,equator=5===y;var verticesRow=[],toRow=[];for(x=0;x<=widthSegments;x++)if(equator){var xi=x<widthSegments?2*x:0;toRow.push(xi+1),verticesRow.push(xi)}else{var u=x/widthSegments,v=y/10;if(polar&&0!==x)polar&&verticesRow.push(nvecs.length-1);else if(x<widthSegments){var vertex=new $3Dmol.Vector3;vertex.x=-radius*Math.cos(0+u*phiLength)*Math.sin(0+v*thetaLength),vertex.y=1==cap?0:radius*Math.cos(0+v*thetaLength),vertex.z=radius*Math.sin(0+u*phiLength)*Math.sin(0+v*thetaLength),Math.abs(vertex.x)<1e-5&&(vertex.x=0),Math.abs(vertex.y)<1e-5&&(vertex.y=0),Math.abs(vertex.z)<1e-5&&(vertex.z=0),cap==$3Dmol.CAP.FLAT?(n=new $3Dmol.Vector3(0,Math.cos(0+v*thetaLength),0)).normalize():(n=new $3Dmol.Vector3(vertex.x,vertex.y,vertex.z)).normalize(),nvecs.push(vertex),norms.push(n),verticesRow.push(nvecs.length-1)}else verticesRow.push(nvecs.length-widthSegments)}equator&&verticesRows.push(toRow),verticesRows.push(verticesRow)}var obj={vertices:nvecs,normals:norms,verticesRows:verticesRows,w:widthSegments,h:10};return radius in this.cache||(this.cache[radius]={}),this.cache[radius][cap+capType]=obj,obj}},drawnC=0;draw.drawCylinder=function(geo,from,to,radius,color,fromCap,toCap){if(from&&to){drawnC++;var drawcaps=toCap||fromCap;color=color||{r:0,g:0,b:0};var dir=[to.x,to.y,to.z];dir[0]-=from.x,dir[1]-=from.y,dir[2]-=from.z;var e=getRotationMatrix(dir),vobj=cylVertexCache.getVerticesForRadius(radius,toCap,"to"),n=vobj.w,h=vobj.h,n_verts=drawcaps?h*n+2:2*n,geoGroup=geo.updateGeoGroup(n_verts),vertices=vobj.vertices,normals=vobj.normals,verticesRows=vobj.verticesRows,toRow=verticesRows[h/2],fromRow=verticesRows[h/2+1],start=geoGroup.vertices,offset,faceoffset,i,x,y,z,vertexArray=geoGroup.vertexArray,normalArray=geoGroup.normalArray,colorArray=geoGroup.colorArray,faceArray=geoGroup.faceArray;for(i=0;i<n;++i){var vi=2*i;x=e[0]*vertices[vi].x+e[3]*vertices[vi].y+e[6]*vertices[vi].z,y=e[1]*vertices[vi].x+e[4]*vertices[vi].y+e[7]*vertices[vi].z,z=e[5]*vertices[vi].y+e[8]*vertices[vi].z,offset=3*(start+vi),faceoffset=geoGroup.faceidx,vertexArray[offset]=x+from.x,vertexArray[offset+1]=y+from.y,vertexArray[offset+2]=z+from.z,vertexArray[offset+3]=x+to.x,vertexArray[offset+4]=y+to.y,vertexArray[offset+5]=z+to.z,normalArray[offset]=x,normalArray[offset+3]=x,normalArray[offset+1]=y,normalArray[offset+4]=y,normalArray[offset+2]=z,normalArray[offset+5]=z,colorArray[offset]=color.r,colorArray[offset+3]=color.r,colorArray[offset+1]=color.g,colorArray[offset+4]=color.g,colorArray[offset+2]=color.b,colorArray[offset+5]=color.b,faceArray[faceoffset]=fromRow[i]+start,faceArray[faceoffset+1]=fromRow[i+1]+start,faceArray[faceoffset+2]=toRow[i]+start,faceArray[faceoffset+3]=toRow[i]+start,faceArray[faceoffset+4]=fromRow[i+1]+start,faceArray[faceoffset+5]=toRow[i+1]+start,geoGroup.faceidx+=6}if(drawcaps){var ystart,yend=fromCap?h+1:h/2+1,v1,v2,v3,v4,x1,x2,x3,x4,y1,y2,y3,y4,z1,z2,z3,z4,nx1,nx2,nx3,nx4,ny1,ny2,ny3,ny4,nz1,nz2,nz3,nz4,v1offset,v2offset,v3offset,v4offset;for(y=toCap?0:h/2;y<yend;y++)if(y!==h/2){var cap=y<=h/2?to:from,toObj=cylVertexCache.getVerticesForRadius(radius,toCap,"to"),fromObj=cylVertexCache.getVerticesForRadius(radius,fromCap,"from");for(cap===to?(vertices=toObj.vertices,normals=toObj.normals,verticesRows=toObj.verticesRows):cap==from&&(vertices=fromObj.vertices,normals=fromObj.normals,verticesRows=fromObj.verticesRows),x=0;x<n;x++)faceoffset=geoGroup.faceidx,v1offset=3*((v1=verticesRows[y][x+1])+start),v2offset=3*((v2=verticesRows[y][x])+start),v3offset=3*((v3=verticesRows[y+1][x])+start),v4offset=3*((v4=verticesRows[y+1][x+1])+start),x1=e[0]*vertices[v1].x+e[3]*vertices[v1].y+e[6]*vertices[v1].z,x2=e[0]*vertices[v2].x+e[3]*vertices[v2].y+e[6]*vertices[v2].z,x3=e[0]*vertices[v3].x+e[3]*vertices[v3].y+e[6]*vertices[v3].z,x4=e[0]*vertices[v4].x+e[3]*vertices[v4].y+e[6]*vertices[v4].z,y1=e[1]*vertices[v1].x+e[4]*vertices[v1].y+e[7]*vertices[v1].z,y2=e[1]*vertices[v2].x+e[4]*vertices[v2].y+e[7]*vertices[v2].z,y3=e[1]*vertices[v3].x+e[4]*vertices[v3].y+e[7]*vertices[v3].z,y4=e[1]*vertices[v4].x+e[4]*vertices[v4].y+e[7]*vertices[v4].z,z1=e[5]*vertices[v1].y+e[8]*vertices[v1].z,z2=e[5]*vertices[v2].y+e[8]*vertices[v2].z,z3=e[5]*vertices[v3].y+e[8]*vertices[v3].z,z4=e[5]*vertices[v4].y+e[8]*vertices[v4].z,vertexArray[v1offset]=x1+cap.x,vertexArray[v2offset]=x2+cap.x,vertexArray[v3offset]=x3+cap.x,vertexArray[v4offset]=x4+cap.x,vertexArray[v1offset+1]=y1+cap.y,vertexArray[v2offset+1]=y2+cap.y,vertexArray[v3offset+1]=y3+cap.y,vertexArray[v4offset+1]=y4+cap.y,vertexArray[v1offset+2]=z1+cap.z,vertexArray[v2offset+2]=z2+cap.z,vertexArray[v3offset+2]=z3+cap.z,vertexArray[v4offset+2]=z4+cap.z,colorArray[v1offset]=color.r,colorArray[v2offset]=color.r,colorArray[v3offset]=color.r,colorArray[v4offset]=color.r,colorArray[v1offset+1]=color.g,colorArray[v2offset+1]=color.g,colorArray[v3offset+1]=color.g,colorArray[v4offset+1]=color.g,colorArray[v1offset+2]=color.b,colorArray[v2offset+2]=color.b,colorArray[v3offset+2]=color.b,colorArray[v4offset+2]=color.b,nx1=e[0]*normals[v1].x+e[3]*normals[v1].y+e[6]*normals[v1].z,nx2=e[0]*normals[v2].x+e[3]*normals[v2].y+e[6]*normals[v2].z,nx3=e[0]*normals[v3].x+e[3]*normals[v3].y+e[6]*normals[v3].z,nx4=e[0]*normals[v4].x+e[3]*normals[v4].y+e[6]*normals[v4].z,ny1=e[1]*normals[v1].x+e[4]*normals[v1].y+e[7]*normals[v1].z,ny2=e[1]*normals[v2].x+e[4]*normals[v2].y+e[7]*normals[v2].z,ny3=e[1]*normals[v3].x+e[4]*normals[v3].y+e[7]*normals[v3].z,ny4=e[1]*normals[v4].x+e[4]*normals[v4].y+e[7]*normals[v4].z,nz1=e[5]*normals[v1].y+e[8]*normals[v1].z,nz2=e[5]*normals[v2].y+e[8]*normals[v2].z,nz3=e[5]*normals[v3].y+e[8]*normals[v3].z,nz4=e[5]*normals[v4].y+e[8]*normals[v4].z,0===y?(normalArray[v1offset]=nx1,normalArray[v3offset]=nx3,normalArray[v4offset]=nx4,normalArray[v1offset+1]=ny1,normalArray[v3offset+1]=ny3,normalArray[v4offset+1]=ny4,normalArray[v1offset+2]=nz1,normalArray[v3offset+2]=nz3,normalArray[v4offset+2]=nz4,faceArray[faceoffset]=v1+start,faceArray[faceoffset+1]=v3+start,faceArray[faceoffset+2]=v4+start,geoGroup.faceidx+=3):y===yend-1?(normalArray[v1offset]=nx1,normalArray[v2offset]=nx2,normalArray[v3offset]=nx3,normalArray[v1offset+1]=ny1,normalArray[v2offset+1]=ny2,normalArray[v3offset+1]=ny3,normalArray[v1offset+2]=nz1,normalArray[v2offset+2]=nz2,normalArray[v3offset+2]=nz3,faceArray[faceoffset]=v1+start,faceArray[faceoffset+1]=v2+start,faceArray[faceoffset+2]=v3+start,geoGroup.faceidx+=3):(normalArray[v1offset]=nx1,normalArray[v2offset]=nx2,normalArray[v4offset]=nx4,normalArray[v1offset+1]=ny1,normalArray[v2offset+1]=ny2,normalArray[v4offset+1]=ny4,normalArray[v1offset+2]=nz1,normalArray[v2offset+2]=nz2,normalArray[v4offset+2]=nz4,normalArray[v2offset]=nx2,normalArray[v3offset]=nx3,normalArray[v4offset]=nx4,normalArray[v2offset+1]=ny2,normalArray[v3offset+1]=ny3,normalArray[v4offset+1]=ny4,normalArray[v2offset+2]=nz2,normalArray[v3offset+2]=nz3,normalArray[v4offset+2]=nz4,faceArray[faceoffset]=v1+start,faceArray[faceoffset+1]=v2+start,faceArray[faceoffset+2]=v4+start,faceArray[faceoffset+3]=v2+start,faceArray[faceoffset+4]=v3+start,faceArray[faceoffset+5]=v4+start,geoGroup.faceidx+=6)}}geoGroup.vertices+=n_verts}},draw.drawCone=function(geo,from,to,radius,color){if(from&&to){color=color||{r:0,g:0,b:0};var dir=[to.x,to.y,to.z];dir.x-=from.x,dir.y-=from.y,dir.z-=from.z;var e=getRotationMatrix(dir),n=basisVectors.length,basis=basisVectors,n_verts=n+2,geoGroup=geo.updateGeoGroup(n_verts),start=geoGroup.vertices,offset,faceoffset,i,x,y,z,vertexArray=geoGroup.vertexArray,normalArray=geoGroup.normalArray,colorArray=geoGroup.colorArray,faceArray=geoGroup.faceArray;offset=3*start;var ndir=new $3Dmol.Vector3(dir[0],dir[1],dir[2]).normalize();for(vertexArray[offset]=from.x,vertexArray[offset+1]=from.y,vertexArray[offset+2]=from.z,normalArray[offset]=-ndir.x,normalArray[offset+1]=-ndir.y,normalArray[offset+2]=-ndir.z,colorArray[offset]=color.r,colorArray[offset+1]=color.g,colorArray[offset+2]=color.b,vertexArray[offset+3]=to.x,vertexArray[offset+4]=to.y,vertexArray[offset+5]=to.z,normalArray[offset+3]=ndir.x,normalArray[offset+4]=ndir.y,normalArray[offset+5]=ndir.z,colorArray[offset+3]=color.r,colorArray[offset+4]=color.g,colorArray[offset+5]=color.b,offset+=6,i=0;i<n;++i){var vec=basis[i].clone();vec.multiplyScalar(radius),x=e[0]*vec.x+e[3]*vec.y+e[6]*vec.z,y=e[1]*vec.x+e[4]*vec.y+e[7]*vec.z,z=e[5]*vec.y+e[8]*vec.z,vertexArray[offset]=x+from.x,vertexArray[offset+1]=y+from.y,vertexArray[offset+2]=z+from.z,normalArray[offset]=x,normalArray[offset+1]=y,normalArray[offset+2]=z,colorArray[offset]=color.r,colorArray[offset+1]=color.g,colorArray[offset+2]=color.b,offset+=3}for(geoGroup.vertices+=n+2,faceoffset=geoGroup.faceidx,i=0;i<n;i++){var v1=start+2+i,v2=start+2+(i+1)%n;faceArray[faceoffset]=v1,faceArray[faceoffset+1]=v2,faceArray[faceoffset+2]=start,faceArray[faceoffset+=3]=v1,faceArray[faceoffset+1]=v2,faceArray[faceoffset+2]=start+1,faceoffset+=3}geoGroup.faceidx+=6*n}};var sphereVertexCache={cache:{},getVerticesForRadius:function(radius){if(void 0!==this.cache[radius])return this.cache[radius];var obj={vertices:[],verticesRows:[],normals:[]},sphereQuality=1,widthSegments=16,heightSegments=10;radius<1&&(widthSegments=10,heightSegments=8);var phiStart=0,phiLength=2*Math.PI,thetaStart=0,thetaLength=Math.PI,x,y;for(y=0;y<=heightSegments;y++){var verticesRow=[];for(x=0;x<=widthSegments;x++){var u=x/widthSegments,v=y/heightSegments,vertex={};vertex.x=-radius*Math.cos(0+u*phiLength)*Math.sin(0+v*thetaLength),vertex.y=radius*Math.cos(0+v*thetaLength),vertex.z=radius*Math.sin(0+u*phiLength)*Math.sin(0+v*thetaLength);var n=new $3Dmol.Vector3(vertex.x,vertex.y,vertex.z);n.normalize(),obj.vertices.push(vertex),obj.normals.push(n),verticesRow.push(obj.vertices.length-1)}obj.verticesRows.push(verticesRow)}return this.cache[radius]=obj,obj}};return draw.drawSphere=function(geo,pos,radius,color){for(var x,y,vobj=sphereVertexCache.getVerticesForRadius(radius),vertices=vobj.vertices,normals=vobj.normals,geoGroup=geo.updateGeoGroup(vertices.length),start=geoGroup.vertices,vertexArray=geoGroup.vertexArray,colorArray=geoGroup.colorArray,faceArray=geoGroup.faceArray,lineArray=geoGroup.lineArray,normalArray=geoGroup.normalArray,i=0,il=vertices.length;i<il;++i){var offset=3*(start+i),v=vertices[i];vertexArray[offset]=v.x+pos.x,vertexArray[offset+1]=v.y+pos.y,vertexArray[offset+2]=v.z+pos.z,colorArray[offset]=color.r,colorArray[offset+1]=color.g,colorArray[offset+2]=color.b}geoGroup.vertices+=vertices.length;var verticesRows=vobj.verticesRows,h=verticesRows.length-1;for(y=0;y<h;y++){var w=verticesRows[y].length-1;for(x=0;x<w;x++){var faceoffset=geoGroup.faceidx,lineoffset=geoGroup.lineidx,v1=verticesRows[y][x+1]+start,v1offset=3*v1,v2=verticesRows[y][x]+start,v2offset=3*v2,v3=verticesRows[y+1][x]+start,v3offset=3*v3,v4=verticesRows[y+1][x+1]+start,v4offset=3*v4,n1=normals[v1-start],n2=normals[v2-start],n3=normals[v3-start],n4=normals[v4-start];Math.abs(vertices[v1-start].y)===radius?(normalArray[v1offset]=n1.x,normalArray[v3offset]=n3.x,normalArray[v4offset]=n4.x,normalArray[v1offset+1]=n1.y,normalArray[v3offset+1]=n3.y,normalArray[v4offset+1]=n4.y,normalArray[v1offset+2]=n1.z,normalArray[v3offset+2]=n3.z,normalArray[v4offset+2]=n4.z,faceArray[faceoffset]=v1,faceArray[faceoffset+1]=v3,faceArray[faceoffset+2]=v4,lineArray[lineoffset]=v1,lineArray[lineoffset+1]=v3,lineArray[lineoffset+2]=v1,lineArray[lineoffset+3]=v4,lineArray[lineoffset+4]=v3,lineArray[lineoffset+5]=v4,geoGroup.faceidx+=3,geoGroup.lineidx+=6):Math.abs(vertices[v3-start].y)===radius?(normalArray[v1offset]=n1.x,normalArray[v2offset]=n2.x,normalArray[v3offset]=n3.x,normalArray[v1offset+1]=n1.y,normalArray[v2offset+1]=n2.y,normalArray[v3offset+1]=n3.y,normalArray[v1offset+2]=n1.z,normalArray[v2offset+2]=n2.z,normalArray[v3offset+2]=n3.z,faceArray[faceoffset]=v1,faceArray[faceoffset+1]=v2,faceArray[faceoffset+2]=v3,lineArray[lineoffset]=v1,lineArray[lineoffset+1]=v2,lineArray[lineoffset+2]=v1,lineArray[lineoffset+3]=v3,lineArray[lineoffset+4]=v2,lineArray[lineoffset+5]=v3,geoGroup.faceidx+=3,geoGroup.lineidx+=6):(normalArray[v1offset]=n1.x,normalArray[v2offset]=n2.x,normalArray[v4offset]=n4.x,normalArray[v1offset+1]=n1.y,normalArray[v2offset+1]=n2.y,normalArray[v4offset+1]=n4.y,normalArray[v1offset+2]=n1.z,normalArray[v2offset+2]=n2.z,normalArray[v4offset+2]=n4.z,normalArray[v2offset]=n2.x,normalArray[v3offset]=n3.x,normalArray[v4offset]=n4.x,normalArray[v2offset+1]=n2.y,normalArray[v3offset+1]=n3.y,normalArray[v4offset+1]=n4.y,normalArray[v2offset+2]=n2.z,normalArray[v3offset+2]=n3.z,normalArray[v4offset+2]=n4.z,faceArray[faceoffset]=v1,faceArray[faceoffset+1]=v2,faceArray[faceoffset+2]=v4,faceArray[faceoffset+3]=v2,faceArray[faceoffset+4]=v3,faceArray[faceoffset+5]=v4,lineArray[lineoffset]=v1,lineArray[lineoffset+1]=v2,lineArray[lineoffset+2]=v1,lineArray[lineoffset+3]=v4,lineArray[lineoffset+4]=v2,lineArray[lineoffset+5]=v3,lineArray[lineoffset+6]=v3,lineArray[lineoffset+7]=v4,geoGroup.faceidx+=6,geoGroup.lineidx+=8)}}},draw}();var $3Dmol=$3Dmol||{};$3Dmol.GLModel=function(){var defaultAtomStyle={line:{}},defaultlineWidth=1,vdwRadii={H:1.2,He:1.4,Li:1.82,Be:1.53,B:1.92,C:1.7,N:1.55,O:1.52,F:1.47,Ne:1.54,Na:2.27,Mg:1.73,Al:1.84,Si:2.1,P:1.8,S:1.8,Cl:1.75,Ar:1.88,K:2.75,Ca:2.31,Ni:1.63,Cu:1.4,Zn:1.39,Ga:1.87,Ge:2.11,As:1.85,Se:1.9,Br:1.85,Kr:2.02,Rb:3.03,Sr:2.49,Pd:1.63,Ag:1.72,Cd:1.58,In:1.93,Sn:2.17,Sb:2.06,Te:2.06,I:1.98,Xe:2.16,Cs:3.43,Ba:2.68,Pt:1.75,Au:1.66,Hg:1.55,Tl:1.96,Pb:2.02,Bi:2.07,Po:1.97,At:2.02,Rn:2.2,Fr:3.48,Ra:2.83,U:1.86};GLModel.validElements=["H","Li","LI","Na","NA","K","C","N","O","F","P","S","CL","Cl","BR","Br","SE","Se","ZN","Zn","CU","Cu","NI","Ni"],GLModel.validAtomSpecs={resn:{type:"string",valid:!0},x:{type:"number",valid:!1,step:.1},y:{type:"number",valid:!1,step:.1},z:{type:"number",valid:!1,step:.1},color:{type:"color",gui:!0},surfaceColor:{type:"color",gui:!0},elem:{type:"element",gui:!0},hetflag:{type:"boolean",valid:!1},chain:{type:"string",gui:!0},resi:{type:"number",gui:!0},icode:{type:"number",valid:!1,step:.1},rescode:{type:"number",valid:!1,step:.1},serial:{type:"number",valid:!1,step:.1},atom:{type:"string",valid:!1},bonds:{type:"array",valid:!1},ss:{type:"string",valid:!1},singleBonds:{type:"boolean",valid:!1},bondOrder:{type:"array",valid:!1},properties:{type:"properties",valid:!1},b:{type:"number",valid:!1,step:.1},pdbline:{type:"string",valid:!1},clickable:{type:"boolean",valid:!1},callback:{type:"function",valid:!1},invert:{type:"boolean",valid:!1},reflectivity:{type:"number",gui:!0,step:.1},altLoc:{type:"invalid",valid:!1},sym:{type:"number",gui:!1}};var validExtras={model:{type:"string",valid:!1},bonds:{type:"string",valid:!1},predicate:{type:"string",valid:!1},invert:{type:"string",valid:!1},byres:{type:"string",valid:!1},expand:{type:"string",valid:!1},within:{type:"string",valid:!1},and:{type:"string",valid:!1},or:{type:"string",valid:!1},not:{type:"string",valid:!1}};GLModel.validAtomSelectionSpecs=$3Dmol.extend(GLModel.validAtomSpecs,validExtras);var validLineSpec={hidden:{type:"boolean",gui:!0},linewidth:{type:"number",gui:!0,step:.1,default:1},colorscheme:{type:"colorscheme",gui:!0},color:{type:"color",gui:!0}},validCrossSpec={hidden:{type:"boolean",gui:!0},linewidth:{type:"number",gui:!1,step:.1,default:1,min:0},colorscheme:{type:"colorscheme",gui:!0},color:{type:"color",gui:!0},radius:{type:"number",gui:!0,step:.1,default:1,min:.1},scale:{type:"number",gui:!0,step:.1,default:1,min:0}},validStickSpec={hidden:{type:"boolean",gui:!0},colorscheme:{type:"colorscheme",gui:!0},color:{type:"color",gui:!0},radius:{type:"number",gui:!0,step:.1,default:.25,min:.1},singleBonds:{type:"boolean",gui:!0}},validSphereSpec={hidden:{type:"boolean",gui:!0},singleBonds:{type:"boolean",gui:!0},colorscheme:{type:"colorscheme",gui:!0},color:{type:"color",gui:!0},radius:{type:"number",gui:!0,step:.1,default:1.5,min:0},scale:{type:"number",gui:!0,step:.1,default:1,min:.1}},validCartoonSpec={style:{validItems:["trace","oval","rectangle","parabola","edged"],gui:!0},color:{type:"color",gui:!0},arrows:{type:"boolean",gui:!0},ribbon:{type:"boolean",gui:!0},hidden:{type:"boolean",gui:!0},tubes:{type:"boolean",gui:!0},thickness:{type:"number",gui:!0,step:.1,default:1,min:0},width:{type:"number",gui:!0,step:.1,default:1,min:0},opacity:{type:"number",gui:!0,step:.1,default:1,min:0,max:1}};GLModel.validAtomStyleSpecs={line:{validItems:validLineSpec,gui:!0},cross:{validItems:validCrossSpec,gui:!0},stick:{validItems:validStickSpec,gui:!0},sphere:{validItems:validSphereSpec,gui:!0},cartoon:{validItems:validCartoonSpec,gui:!0},colorfunc:{validItems:null,valid:!1},clicksphere:{validItems:validSphereSpec}},GLModel.validSurfaceSpecs={opacity:{type:"number",gui:!0,step:.1,default:1,min:0,max:1},colorscheme:{type:"colorscheme",gui:!0},color:{type:"color",gui:!0},voldata:{type:"number",gui:!1},volscheme:{type:"number",gui:!1},map:{type:"number",gui:!1}},GLModel.validLabelResSpecs={font:{type:"string",gui:!0},fontSize:{type:"number",gui:!0,step:1,default:12,min:1},fontColor:{type:"color",gui:!0},fontOpacity:{type:"number",gui:!0,step:.1,default:1,min:0,max:1},borderThickness:{type:"number",gui:!0,step:.1,default:1,min:0},borderColor:{type:"color",gui:!0},borderOpacity:{type:"number",gui:!0,step:.1,default:1,min:0,max:1},backgroundColor:{type:"color",gui:!0},backgroundOpacity:{type:"number",gui:!0,step:.1,default:1,min:0,max:1},position:{type:"array",valid:!1},inFront:{type:"boolean",gui:!0},showBackground:{type:"boolean",gui:!0},fixed:{type:"boolean",gui:!0},alignment:{validItems:["topLeft","topCenter","topRight","centerLeft","center","centerRight","bottomLeft","bottomCenter","bottomRight"],gui:!0},scale:{type:"boolean",gui:!1}};var sameObj=function(a,b){return a&&b?JSON.stringify(a)==JSON.stringify(b):a==b};function GLModel(mid,options){var atoms=[],frames=[],box=null,atomdfs=null,id=mid,hidden=!1,molObj=null,renderedMolObj=null,lastColors=null,modelData={},modelDatas=null,idMatrix=new $3Dmol.Matrix4,dontDuplicateAtoms=!0,defaultColor=$3Dmol.elementColors.defaultColor,ElementColors=(options=options||{}).defaultcolors?options.defaultcolors:$3Dmol.elementColors.defaultColors,defaultSphereRadius=options.defaultSphereRadius?options.defaultSphereRadius:1.5,defaultCartoonQuality=options.cartoonQuality?options.cartoonQuality:5,getRadiusFromStyle=function(atom,style){var r=defaultSphereRadius;if(void 0!==style.radius)r=style.radius;else if(vdwRadii[atom.elem])r=vdwRadii[atom.elem];else if(atom.elem.length>1){let e=atom.elem;e[1]=e[1].toLowerCase(),vdwRadii[e]&&(r=vdwRadii[e])}return void 0!==style.scale&&(r*=style.scale),r},drawAtomCross=function(atom,geos){if(atom.style.cross){var style=atom.style.cross;if(!style.hidden){var linewidth=style.linewidth||1;geos[linewidth]||(geos[linewidth]=new $3Dmol.Geometry);var geoGroup=geos[linewidth].updateGeoGroup(6),delta=getRadiusFromStyle(atom,style),points=[[delta,0,0],[-delta,0,0],[0,delta,0],[0,-delta,0],[0,0,delta],[0,0,-delta]],clickable=atom.clickable||atom.hoverable;clickable&&void 0===atom.intersectionShape&&(atom.intersectionShape={sphere:[],cylinder:[],line:[]});for(var c=$3Dmol.getColorFromStyle(atom,style),vertexArray=geoGroup.vertexArray,colorArray=geoGroup.colorArray,j=0;j<6;j++){var offset=3*geoGroup.vertices;if(geoGroup.vertices++,vertexArray[offset]=atom.x+points[j][0],vertexArray[offset+1]=atom.y+points[j][1],vertexArray[offset+2]=atom.z+points[j][2],colorArray[offset]=c.r,colorArray[offset+1]=c.g,colorArray[offset+2]=c.b,clickable){var point=new $3Dmol.Vector3(points[j][0],points[j][1],points[j][2]);point.multiplyScalar(.1),point.set(point.x+atom.x,point.y+atom.y,point.z+atom.z),atom.intersectionShape.line.push(point)}}}}},getSideBondV=function(atom,atom2,i){var i2,j2,atom3,p3,dir2,p1=new $3Dmol.Vector3(atom.x,atom.y,atom.z),p2,dir=new $3Dmol.Vector3(atom2.x,atom2.y,atom2.z).clone(),v=null;dir.sub(p1);var getGoodCross=function(atom,atom2){for(var bestv=null,bestlen=-1,j=0,n=atom.bonds.length;j<n;j++)if(atom.bonds[j]!=atom2.index){j2=atom.bonds[j],atom3=atoms[j2],p3=new $3Dmol.Vector3(atom3.x,atom3.y,atom3.z),(dir2=p3.clone()).sub(p1),(v=dir2.clone()).cross(dir);var l=v.lengthSq();if(l>bestlen&&(bestv=v,(bestlen=l)>.1))return bestv}return bestv};if(1===atom.bonds.length)1===atom2.bonds.length?(v=dir.clone(),Math.abs(v.x)>1e-4?v.y+=1:v.x+=1):(i2=(i+1)%atom2.bonds.length,j2=atom2.bonds[i2],atom3=atoms[j2],p3=new $3Dmol.Vector3(atom3.x,atom3.y,atom3.z),(dir2=p3.clone()).sub(p1),(v=dir2.clone()).cross(dir));else if((v=getGoodCross(atom,atom2)).lengthSq()<.01){var v2=getGoodCross(atom2,atom);null!=v2&&(v=v2)}return v.lengthSq()<.01&&(v=dir.clone(),Math.abs(v.x)>1e-4?v.y+=1:v.x+=1),v.cross(dir),v.normalize(),v},addLine=function(vertexArray,colorArray,offset,p1,p2,c1){vertexArray[offset]=p1.x,vertexArray[offset+1]=p1.y,vertexArray[offset+2]=p1.z,colorArray[offset]=c1.r,colorArray[offset+1]=c1.g,colorArray[offset+2]=c1.b,vertexArray[offset+3]=p2.x,vertexArray[offset+4]=p2.y,vertexArray[offset+5]=p2.z,colorArray[offset+3]=c1.r,colorArray[offset+4]=c1.g,colorArray[offset+5]=c1.b},drawBondLines=function(atom,atoms,geos){if(atom.style.line){var style=atom.style.line;if(!style.hidden){var p1a,p1b,p2a,p2b,linewidth=style.linewidth||1;geos[linewidth]||(geos[linewidth]=new $3Dmol.Geometry);for(var geoGroup=geos[linewidth].updateGeoGroup(6*atom.bonds.length),vertexArray=geoGroup.vertexArray,colorArray=geoGroup.colorArray,i=0;i<atom.bonds.length;i++){var j,atom2=atoms[atom.bonds[i]];if(atom2.style.line&&!(atom.index>=atom2.index)){var p1=new $3Dmol.Vector3(atom.x,atom.y,atom.z),p2=new $3Dmol.Vector3(atom2.x,atom2.y,atom2.z),mp=p1.clone().add(p2).multiplyScalar(.5),singleBond=!1,atomneedsi=atom.clickable||atom.hoverable,atom2needsi=atom2.clickable||atom2.hoverable;(atomneedsi||atom2needsi)&&(atomneedsi&&(void 0===atom.intersectionShape&&(atom.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),atom.intersectionShape.line.push(p1),atom.intersectionShape.line.push(mp)),atom2needsi&&(void 0===atom2.intersectionShape&&(atom2.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),atom2.intersectionShape.line.push(mp),atom2.intersectionShape.line.push(p2)));var c1=$3Dmol.getColorFromStyle(atom,atom.style.line),c2=$3Dmol.getColorFromStyle(atom2,atom2.style.line);if(atom.bondStyles&&atom.bondStyles[i]){var bstyle=atom.bondStyles[i];if(!bstyle.iswire)continue;bstyle.singleBond&&(singleBond=!0),void 0!==bstyle.color1&&(c1=$3Dmol.CC.color(bstyle.color1)),void 0!==bstyle.color2&&(c2=$3Dmol.CC.color(bstyle.color2))}var offset=3*geoGroup.vertices,mpa,mpb;if(atom.bondOrder[i]>1&&atom.bondOrder[i]<4&&!singleBond){var v=getSideBondV(atom,atom2,i),dir=p2.clone();dir.sub(p1),2==atom.bondOrder[i]?(v.multiplyScalar(.1),(p1a=p1.clone()).add(v),(p1b=p1.clone()).sub(v),(p2a=p1a.clone()).add(dir),(p2b=p1b.clone()).add(dir),c1==c2?(geoGroup.vertices+=4,addLine(vertexArray,colorArray,offset,p1a,p2a,c1),addLine(vertexArray,colorArray,offset+6,p1b,p2b,c1)):(geoGroup.vertices+=8,dir.multiplyScalar(.5),(mpa=p1a.clone()).add(dir),(mpb=p1b.clone()).add(dir),addLine(vertexArray,colorArray,offset,p1a,mpa,c1),addLine(vertexArray,colorArray,offset+6,mpa,p2a,c2),addLine(vertexArray,colorArray,offset+12,p1b,mpb,c1),addLine(vertexArray,colorArray,offset+18,mpb,p2b,c2))):3==atom.bondOrder[i]&&(v.multiplyScalar(.1),(p1a=p1.clone()).add(v),(p1b=p1.clone()).sub(v),(p2a=p1a.clone()).add(dir),(p2b=p1b.clone()).add(dir),c1==c2?(geoGroup.vertices+=6,addLine(vertexArray,colorArray,offset,p1,p2,c1),addLine(vertexArray,colorArray,offset+6,p1a,p2a,c1),addLine(vertexArray,colorArray,offset+12,p1b,p2b,c1)):(geoGroup.vertices+=12,dir.multiplyScalar(.5),(mpa=p1a.clone()).add(dir),(mpb=p1b.clone()).add(dir),addLine(vertexArray,colorArray,offset,p1,mp,c1),addLine(vertexArray,colorArray,offset+6,mp,p2,c2),addLine(vertexArray,colorArray,offset+12,p1a,mpa,c1),addLine(vertexArray,colorArray,offset+18,mpa,p2a,c2),addLine(vertexArray,colorArray,offset+24,p1b,mpb,c1),addLine(vertexArray,colorArray,offset+30,mpb,p2b,c2)))}else c1==c2?(geoGroup.vertices+=2,addLine(vertexArray,colorArray,offset,p1,p2,c1)):(geoGroup.vertices+=4,addLine(vertexArray,colorArray,offset,p1,mp,c1),addLine(vertexArray,colorArray,offset+6,mp,p2,c2))}}}}},defaultStickRadius=.25,drawAtomSphere=function(atom,geo){if(atom.style.sphere){var style=atom.style.sphere;if(!style.hidden){var C=$3Dmol.getColorFromStyle(atom,style),radius=getRadiusFromStyle(atom,style);if((!0===atom.clickable||atom.hoverable)&&void 0!==atom.intersectionShape){var center=new $3Dmol.Vector3(atom.x,atom.y,atom.z);atom.intersectionShape.sphere.push(new $3Dmol.Sphere(center,radius))}$3Dmol.GLDraw.drawSphere(geo,atom,radius,C)}}},drawAtomClickSphere=function(atom){if(atom.style.clicksphere){var style=atom.style.clicksphere;if(!style.hidden){var radius=getRadiusFromStyle(atom,style);if((!0===atom.clickable||atom.hoverable)&&void 0!==atom.intersectionShape){var center=new $3Dmol.Vector3(atom.x,atom.y,atom.z);atom.intersectionShape.sphere.push(new $3Dmol.Sphere(center,radius))}}}},drawAtomInstanced=function(atom,geo){if(atom.style.sphere){var style=atom.style.sphere;if(!style.hidden){var radius=getRadiusFromStyle(atom,style),C=$3Dmol.getColorFromStyle(atom,style),geoGroup=geo.updateGeoGroup(1),startv=geoGroup.vertices,start=3*startv,vertexArray=geoGroup.vertexArray,colorArray=geoGroup.colorArray,radiusArray=geoGroup.radiusArray;if(vertexArray[start]=atom.x,vertexArray[start+1]=atom.y,vertexArray[start+2]=atom.z,colorArray[start]=C.r,colorArray[start+1]=C.g,colorArray[start+2]=C.b,radiusArray[startv]=radius,(!0===atom.clickable||atom.hoverable)&&void 0!==atom.intersectionShape){var center=new $3Dmol.Vector3(atom.x,atom.y,atom.z);atom.intersectionShape.sphere.push(new $3Dmol.Sphere(center,radius))}geoGroup.vertices+=1}}},drawSphereImposter=function(geo,center,radius,C){var geoGroup=geo.updateGeoGroup(4),i,startv=geoGroup.vertices,start=3*startv,vertexArray=geoGroup.vertexArray,colorArray=geoGroup.colorArray;for(i=0;i<4;i++)vertexArray[start+3*i]=center.x,vertexArray[start+3*i+1]=center.y,vertexArray[start+3*i+2]=center.z;var normalArray=geoGroup.normalArray;for(i=0;i<4;i++)colorArray[start+3*i]=C.r,colorArray[start+3*i+1]=C.g,colorArray[start+3*i+2]=C.b;normalArray[start+0]=-radius,normalArray[start+1]=radius,normalArray[start+2]=0,normalArray[start+3]=-radius,normalArray[start+4]=-radius,normalArray[start+5]=0,normalArray[start+6]=radius,normalArray[start+7]=-radius,normalArray[start+8]=0,normalArray[start+9]=radius,normalArray[start+10]=radius,normalArray[start+11]=0,geoGroup.vertices+=4;var faceArray=geoGroup.faceArray,faceoffset=geoGroup.faceidx;faceArray[faceoffset+0]=startv,faceArray[faceoffset+1]=startv+1,faceArray[faceoffset+2]=startv+2,faceArray[faceoffset+3]=startv+2,faceArray[faceoffset+4]=startv+3,faceArray[faceoffset+5]=startv,geoGroup.faceidx+=6},drawAtomImposter=function(atom,geo){if(atom.style.sphere){var style=atom.style.sphere;if(!style.hidden){var radius=getRadiusFromStyle(atom,style),C=$3Dmol.getColorFromStyle(atom,style);if((!0===atom.clickable||atom.hoverable)&&void 0!==atom.intersectionShape){var center=new $3Dmol.Vector3(atom.x,atom.y,atom.z);atom.intersectionShape.sphere.push(new $3Dmol.Sphere(center,radius))}drawSphereImposter(geo,atom,radius,C)}}},drawStickImposter=function(geo,from,to,radius,color){for(var geoGroup=geo.updateGeoGroup(4),startv=geoGroup.vertices,start=3*startv,vertexArray=geoGroup.vertexArray,colorArray=geoGroup.colorArray,radiusArray=geoGroup.radiusArray,normalArray=geoGroup.normalArray,r=color.r,g=color.g,b=color.b,negateColor=function(c){var n=-c;return 0==n&&(n=-1e-4),n},pos=start,i=0;i<4;i++)vertexArray[pos]=from.x,normalArray[pos]=to.x,colorArray[pos]=r,vertexArray[++pos]=from.y,normalArray[pos]=to.y,colorArray[pos]=g,vertexArray[++pos]=from.z,normalArray[pos]=to.z,colorArray[pos]=i<2?b:negateColor(b),pos++;geoGroup.vertices+=4,radiusArray[startv]=-radius,radiusArray[startv+1]=radius,radiusArray[startv+2]=-radius,radiusArray[startv+3]=radius;var faceArray=geoGroup.faceArray,faceoffset=geoGroup.faceidx;faceArray[faceoffset+0]=startv,faceArray[faceoffset+1]=startv+1,faceArray[faceoffset+2]=startv+2,faceArray[faceoffset+3]=startv+2,faceArray[faceoffset+4]=startv+3,faceArray[faceoffset+5]=startv,geoGroup.faceidx+=6},drawBondSticks=function(atom,atoms,geo){if(atom.style.stick){var style=atom.style.stick;if(!style.hidden){var atomBondR=style.radius||.25,bondR=atomBondR,atomSingleBond=style.singleBonds||!1,fromCap=0,toCap=0,atomneedsi,atom2needsi,i,singleBond,bstyle,cylinder1a,cylinder1b,cylinder1c,cylinder2a,cylinder2b,cylinder2c,C1=$3Dmol.getColorFromStyle(atom,style),mp,mp2,mp3;!atom.capDrawn&&atom.bonds.length<4&&(fromCap=2);var drawCyl=$3Dmol.GLDraw.drawCylinder;for(geo.imposter&&(drawCyl=drawStickImposter),i=0;i<atom.bonds.length;i++){var j,atom2=atoms[atom.bonds[i]];if(atom.index<atom2.index){var style2=atom2.style;if(!style2.stick||style2.stick.hidden)continue;var C2=$3Dmol.getColorFromStyle(atom2,style2.stick);if(bondR=atomBondR,singleBond=atomSingleBond,atom.bondStyles&&atom.bondStyles[i]){if((bstyle=atom.bondStyles[i]).iswire)continue;bstyle.radius&&(bondR=bstyle.radius),bstyle.singleBond&&(singleBond=!0),void 0!==bstyle.color1&&(C1=$3Dmol.CC.color(bstyle.color1)),void 0!==bstyle.color2&&(C2=$3Dmol.CC.color(bstyle.color2))}var p1=new $3Dmol.Vector3(atom.x,atom.y,atom.z),p2=new $3Dmol.Vector3(atom2.x,atom2.y,atom2.z);if(1===atom.bondOrder[i]||singleBond||atom.bondOrder[i]>3){if(!atom2.capDrawn&&atom2.bonds.length<4&&(toCap=2),C1!=C2?(drawCyl(geo,p1,mp=(new $3Dmol.Vector3).addVectors(p1,p2).multiplyScalar(.5),bondR,C1,fromCap,0),drawCyl(geo,mp,p2,bondR,C2,0,toCap)):drawCyl(geo,p1,p2,bondR,C1,fromCap,toCap),atomneedsi=atom.clickable||atom.hoverable,atom2needsi=atom2.clickable||atom2.hoverable,atomneedsi||atom2needsi){if(mp||(mp=(new $3Dmol.Vector3).addVectors(p1,p2).multiplyScalar(.5)),atomneedsi){var cylinder1=new $3Dmol.Cylinder(p1,mp,bondR),sphere1=new $3Dmol.Sphere(p1,bondR);atom.intersectionShape.cylinder.push(cylinder1),atom.intersectionShape.sphere.push(sphere1)}if(atom2needsi){var cylinder2=new $3Dmol.Cylinder(p2,mp,bondR),sphere2=new $3Dmol.Sphere(p2,bondR);atom2.intersectionShape.cylinder.push(cylinder2),atom2.intersectionShape.sphere.push(sphere2)}}}else if(atom.bondOrder[i]>1){var mfromCap=0,mtoCap=0;bondR!=atomBondR&&(mfromCap=2,mtoCap=2);var dir=p2.clone(),v=null,r,p1a,p1b,p2a,p2b;dir.sub(p1),v=getSideBondV(atom,atom2,i),2==atom.bondOrder[i]?(r=bondR/2.5,v.multiplyScalar(1.5*r),(p1a=p1.clone()).add(v),(p1b=p1.clone()).sub(v),(p2a=p1a.clone()).add(dir),(p2b=p1b.clone()).add(dir),C1!=C2?(mp=(new $3Dmol.Vector3).addVectors(p1a,p2a).multiplyScalar(.5),mp2=(new $3Dmol.Vector3).addVectors(p1b,p2b).multiplyScalar(.5),drawCyl(geo,p1a,mp,r,C1,mfromCap,0),drawCyl(geo,mp,p2a,r,C2,0,mtoCap),drawCyl(geo,p1b,mp2,r,C1,mfromCap,0),drawCyl(geo,mp2,p2b,r,C2,0,mtoCap)):(drawCyl(geo,p1a,p2a,r,C1,mfromCap,mtoCap),drawCyl(geo,p1b,p2b,r,C1,mfromCap,mtoCap)),atomneedsi=atom.clickable||atom.hoverable,atom2needsi=atom2.clickable||atom2.hoverable,(atomneedsi||atom2needsi)&&(mp||(mp=(new $3Dmol.Vector3).addVectors(p1a,p2a).multiplyScalar(.5)),mp2||(mp2=(new $3Dmol.Vector3).addVectors(p1b,p2b).multiplyScalar(.5)),atomneedsi&&(cylinder1a=new $3Dmol.Cylinder(p1a,mp,r),cylinder1b=new $3Dmol.Cylinder(p1b,mp2,r),atom.intersectionShape.cylinder.push(cylinder1a),atom.intersectionShape.cylinder.push(cylinder1b)),atom2needsi&&(cylinder2a=new $3Dmol.Cylinder(p2a,mp,r),cylinder2b=new $3Dmol.Cylinder(p2b,mp2,r),atom2.intersectionShape.cylinder.push(cylinder2a),atom2.intersectionShape.cylinder.push(cylinder2b)))):3==atom.bondOrder[i]&&(r=bondR/4,v.cross(dir),v.normalize(),v.multiplyScalar(3*r),(p1a=p1.clone()).add(v),(p1b=p1.clone()).sub(v),(p2a=p1a.clone()).add(dir),(p2b=p1b.clone()).add(dir),C1!=C2?(mp=(new $3Dmol.Vector3).addVectors(p1a,p2a).multiplyScalar(.5),mp2=(new $3Dmol.Vector3).addVectors(p1b,p2b).multiplyScalar(.5),mp3=(new $3Dmol.Vector3).addVectors(p1,p2).multiplyScalar(.5),drawCyl(geo,p1a,mp,r,C1,mfromCap,0),drawCyl(geo,mp,p2a,r,C2,0,mtoCap),drawCyl(geo,p1,mp3,r,C1,fromCap,0),drawCyl(geo,mp3,p2,r,C2,0,toCap),drawCyl(geo,p1b,mp2,r,C1,mfromCap,0),drawCyl(geo,mp2,p2b,r,C2,0,mtoCap)):(drawCyl(geo,p1a,p2a,r,C1,mfromCap,mtoCap),drawCyl(geo,p1,p2,r,C1,fromCap,toCap),drawCyl(geo,p1b,p2b,r,C1,mfromCap,mtoCap)),atomneedsi=atom.clickable||atom.hoverable,atom2needsi=atom2.clickable||atom2.hoverable,(atomneedsi||atom2needsi)&&(mp||(mp=(new $3Dmol.Vector3).addVectors(p1a,p2a).multiplyScalar(.5)),mp2||(mp2=(new $3Dmol.Vector3).addVectors(p1b,p2b).multiplyScalar(.5)),mp3||(mp3=(new $3Dmol.Vector3).addVectors(p1,p2).multiplyScalar(.5)),atomneedsi&&(cylinder1a=new $3Dmol.Cylinder(p1a.clone(),mp.clone(),r),cylinder1b=new $3Dmol.Cylinder(p1b.clone(),mp2.clone(),r),cylinder1c=new $3Dmol.Cylinder(p1.clone(),mp3.clone(),r),atom.intersectionShape.cylinder.push(cylinder1a),atom.intersectionShape.cylinder.push(cylinder1b),atom.intersectionShape.cylinder.push(cylinder1c)),atom2needsi&&(cylinder2a=new $3Dmol.Cylinder(p2a.clone(),mp.clone(),r),cylinder2b=new $3Dmol.Cylinder(p2b.clone(),mp2.clone(),r),cylinder2c=new $3Dmol.Cylinder(p2.clone(),mp3.clone(),r),atom2.intersectionShape.cylinder.push(cylinder2a),atom2.intersectionShape.cylinder.push(cylinder2b),atom2.intersectionShape.cylinder.push(cylinder2c))))}}}var drawSphere=!1,numsinglebonds=0,differentradii=!1;for(i=0;i<atom.bonds.length;i++)singleBond=atomSingleBond,atom.bondStyles&&atom.bondStyles[i]&&((bstyle=atom.bondStyles[i]).singleBond&&(singleBond=!0),bstyle.radius&&bstyle.radius!=atomBondR&&(differentradii=!0)),(singleBond||1==atom.bondOrder[i])&&numsinglebonds++;differentradii?numsinglebonds>0&&(drawSphere=!0):0==numsinglebonds&&atom.bonds.length>0&&(drawSphere=!0),drawSphere&&(bondR=atomBondR,geo.imposter?drawSphereImposter(geo.sphereGeometry,atom,bondR,C1):$3Dmol.GLDraw.drawSphere(geo,atom,bondR,C1))}}},createMolObj=function(atoms,options){options=options||{};var ret=new $3Dmol.Object3D,cartoonAtoms=[],lineGeometries={},crossGeometries={},drawSphereFunc=drawAtomSphere,sphereGeometry=null,stickGeometry=null,i,j,n,testOpacities;options.supportsImposters?(drawSphereFunc=drawAtomImposter,(sphereGeometry=new $3Dmol.Geometry(!0)).imposter=!0,(stickGeometry=new $3Dmol.Geometry(!0,!0)).imposter=!0,stickGeometry.sphereGeometry=new $3Dmol.Geometry(!0),stickGeometry.sphereGeometry.imposter=!0,stickGeometry.drawnCaps={}):options.supportsAIA?(drawSphereFunc=drawAtomInstanced,(sphereGeometry=new $3Dmol.Geometry(!1,!0,!0)).instanced=!0,stickGeometry=new $3Dmol.Geometry(!0)):(sphereGeometry=new $3Dmol.Geometry(!0),stickGeometry=new $3Dmol.Geometry(!0));var opacities={},range=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],linewidth;for(i=0,n=atoms.length;i<n;i++){var atom=atoms[i];if(atom&&atom.style){for(j in(atom.clickable||atom.hoverable)&&void 0===atom.intersectionShape&&(atom.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),testOpacities={line:void 0,cross:void 0,stick:void 0,sphere:void 0})atom.style[j]?atom.style[j].opacity?testOpacities[j]=parseFloat(atom.style[j].opacity):testOpacities[j]=1:testOpacities[j]=void 0,opacities[j]?null!=testOpacities[j]&&opacities[j]!=testOpacities[j]&&(console.log("Warning: "+j+" opacity is ambiguous"),opacities[j]=1):opacities[j]=testOpacities[j];drawSphereFunc(atom,sphereGeometry),drawAtomClickSphere(atom),drawAtomCross(atom,crossGeometries),drawBondLines(atom,atoms,lineGeometries),drawBondSticks(atom,atoms,stickGeometry),void 0===atom.style.cartoon||atom.style.cartoon.hidden||("spectrum"!==atom.style.cartoon.color||"number"!=typeof atom.resi||atom.hetflag||(atom.resi<range[0]&&(range[0]=atom.resi),atom.resi>range[1]&&(range[1]=atom.resi)),cartoonAtoms.push(atom))}}if(cartoonAtoms.length>0&&$3Dmol.drawCartoon(ret,cartoonAtoms,range,defaultCartoonQuality),sphereGeometry&&sphereGeometry.vertices>0){sphereGeometry.initTypedArrays();var sphereMaterial=null,sphere=null;sphereGeometry.imposter?sphereMaterial=new $3Dmol.SphereImposterMaterial({ambient:0,vertexColors:!0,reflectivity:0}):sphereGeometry.instanced?(sphere=new $3Dmol.Geometry(!0),$3Dmol.GLDraw.drawSphere(sphere,{x:0,y:0,z:0},1,new $3Dmol.Color(.5,.5,.5)),sphere.initTypedArrays(),sphereMaterial=new $3Dmol.InstancedMaterial({sphereMaterial:new $3Dmol.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),sphere:sphere})):sphereMaterial=new $3Dmol.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),opacities.sphere<1&&opacities.sphere>=0&&(sphereMaterial.transparent=!0,sphereMaterial.opacity=opacities.sphere),sphere=new $3Dmol.Mesh(sphereGeometry,sphereMaterial),ret.add(sphere)}if(stickGeometry.vertices>0){var stickMaterial=null,ballMaterial=null,balls=stickGeometry.sphereGeometry;balls&&void 0!==balls.vertices&&0!=balls.vertices||(balls=null),stickGeometry.initTypedArrays(),balls&&balls.initTypedArrays();var matvals={ambient:0,vertexColors:!0,reflectivity:0};stickGeometry.imposter?(stickMaterial=new $3Dmol.StickImposterMaterial(matvals),ballMaterial=new $3Dmol.SphereImposterMaterial(matvals)):(stickMaterial=new $3Dmol.MeshLambertMaterial(matvals),ballMaterial=new $3Dmol.MeshLambertMaterial(matvals),stickMaterial.wireframe&&(stickGeometry.setUpWireframe(),balls&&balls.setUpWireframe())),opacities.stick<1&&opacities.stick>=0&&(stickMaterial.transparent=!0,stickMaterial.opacity=opacities.stick,ballMaterial.transparent=!0,ballMaterial.opacity=opacities.stick);var sticks=new $3Dmol.Mesh(stickGeometry,stickMaterial);if(ret.add(sticks),balls){var stickspheres=new $3Dmol.Mesh(balls,ballMaterial);ret.add(stickspheres)}}for(i in lineGeometries)if(lineGeometries.hasOwnProperty(i)){linewidth=i;var lineMaterial=new $3Dmol.LineBasicMaterial({linewidth:linewidth,vertexColors:!0});opacities.line<1&&opacities.line>=0&&(lineMaterial.transparent=!0,lineMaterial.opacity=opacities.line),lineGeometries[i].initTypedArrays();var line=new $3Dmol.Line(lineGeometries[i],lineMaterial,$3Dmol.LinePieces);ret.add(line)}for(i in crossGeometries)if(crossGeometries.hasOwnProperty(i)){linewidth=i;var crossMaterial=new $3Dmol.LineBasicMaterial({linewidth:linewidth,vertexColors:!0});opacities.cross<1&&opacities.cross>=0&&(crossMaterial.transparent=!0,crossMaterial.opacity=opacities.cross),crossGeometries[i].initTypedArrays();var cross=new $3Dmol.Line(crossGeometries[i],crossMaterial,$3Dmol.LinePieces);ret.add(cross)}if(dontDuplicateAtoms&&modelData.symmetries&&modelData.symmetries.length>0){var finalRet=new $3Dmol.Object3D,t;for(t=0;t<modelData.symmetries.length;t++){var transformedRet=new $3Dmol.Object3D;(transformedRet=ret.clone()).matrix.copy(modelData.symmetries[t]),transformedRet.matrixAutoUpdate=!1,finalRet.add(transformedRet)}return finalRet}return ret};this.getInternalState=function(){return{atoms:atoms,frames:frames}},this.setInternalState=function(state){atoms=state.atoms,frames=state.frames,molObj=null},this.getCrystData=function(){if(modelData.cryst){if(!modelData.cryst.matrix){const cryst=modelData.cryst;modelData.cryst.matrix=$3Dmol.conversionMatrix3(cryst.a,cryst.b,cryst.c,cryst.alpha,cryst.beta,cryst.gamma)}return modelData.cryst}return null},this.setCrystData=function(a,b,c,alpha,beta,gamma){a=a||1,b=b||1,c=c||1,alpha=alpha||90,beta=beta||90,gamma=gamma||90;const matrix=$3Dmol.conversionMatrix3(a,b,c,alpha,beta,gamma);modelData.cryst={a:a,b:b,c:c,alpha:alpha,beta:beta,gamma:gamma,matrix:matrix}},this.setCrystMatrix=function(matrix){matrix=matrix||new $3Dmol.Matrix3(1,0,0,0,1,0,0,0,1),modelData.cryst={matrix:matrix}},this.getSymmetries=function(){return void 0===modelData.symmetries&&(modelData.symmetries=[idMatrix]),modelData.symmetries},this.setSymmetries=function(list){modelData.symmetries=void 0===list?[idMatrix]:list},this.getID=function(){return id},this.getNumFrames=function(){return null!=frames.numFrames?frames.numFrames:frames.length};var adjustCoord=function(x1,x2,margin,adjust){var dist=x2-x1;return dist<-margin?x2+adjust:dist>margin?x2-adjust:x2},adjustCoordinatesToBox=function(){if(box&&atomdfs)for(var bx=box[0],by=box[1],bz=box[2],mx=.9*bx,my=.9*by,mz=.9*bz,c=0;c<atomdfs.length;c++)for(var component=atomdfs[c],i=1;i<component.length;i++){var atom=atoms[component[i][0]],prev=atoms[component[i][1]];atom.x=adjustCoord(prev.x,atom.x,mx,bx),atom.y=adjustCoord(prev.y,atom.y,my,by),atom.z=adjustCoord(prev.z,atom.z,mz,bz)}};this.setFrame=function(framenum,viewer){var numFrames=this.getNumFrames();let model=this;return new Promise((function(resolve,reject){if(0==numFrames&&resolve(),(framenum<0||framenum>=numFrames)&&(framenum=numFrames-1),null!=frames.url){var url=frames.url;$3Dmol.getbin(url+"/traj/frame/"+framenum+"/"+frames.path,null,"POST").then((function(buffer){for(var values=new Float32Array(buffer,44),count=0,i=0;i<atoms.length;i++)atoms[i].x=values[count++],atoms[i].y=values[count++],atoms[i].z=values[count++];box&&atomdfs&&adjustCoordinatesToBox(),resolve()})).catch(reject)}else atoms=frames[framenum],resolve();molObj=null,modelDatas&&framenum<modelDatas.length&&(modelData=modelDatas[framenum],model.unitCellObjects&&viewer&&(viewer.removeUnitCell(model),viewer.addUnitCell(model)))}))},this.addFrame=function(atoms){frames.push(atoms)},this.vibrate=function(numFrames,amplitude,bothWays,viewer,arrowSpec){amplitude=amplitude||1;var start=0,end=numFrames=numFrames||10;bothWays&&(start=-numFrames,end=numFrames),start<end&&(frames=[]);for(var i=start;i<end;i++){var newAtoms=[],currframe=frames.length;if(0!=i||arrowSpec){for(var j=0;j<atoms.length;j++){var dx=$3Dmol.getAtomProperty(atoms[j],"dx"),dy=$3Dmol.getAtomProperty(atoms[j],"dy"),dz=$3Dmol.getAtomProperty(atoms[j],"dz"),newVector=new $3Dmol.Vector3(dx,dy,dz),starting=new $3Dmol.Vector3(atoms[j].x,atoms[j].y,atoms[j].z),mult=i*amplitude/numFrames;newVector.multiplyScalar(mult),starting.add(newVector);var newAtom={};for(var k in atoms[j])newAtom[k]=atoms[j][k];if(newAtom.x=starting.x,newAtom.y=starting.y,newAtom.z=starting.z,newAtoms.push(newAtom),viewer&&arrowSpec){var spec=$3Dmol.extend({},arrowSpec),arrowend=new $3Dmol.Vector3(dx,dy,dz);if(arrowend.multiplyScalar(amplitude),arrowend.add(starting),spec.start=starting,spec.end=arrowend,spec.frame=currframe,!spec.color){var s=newAtom.style.sphere;s||(s=newAtom.style.stick),s||(s=newAtom.style.line),spec.color=$3Dmol.getColorFromStyle(newAtom,s)}viewer.addArrow(spec)}}frames.push(newAtoms)}else frames.push(atoms)}},this.setAtomDefaults=function(atoms){for(var i=0;i<atoms.length;i++){var atom=atoms[i];atom&&(atom.style=atom.style||$3Dmol.deepCopy(defaultAtomStyle),atom.color=atom.color||ElementColors[atom.elem]||defaultColor,atom.model=id,(atom.clickable||atom.hoverable)&&(atom.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}))}},this.addMolData=function(data,format,options){options=options||{};var parsedAtoms=$3Dmol.GLModel.parseMolData(data,format,options);dontDuplicateAtoms=!options.duplicateAssemblyAtoms;var mData=parsedAtoms.modelData;if(mData&&(Array.isArray(mData)?(modelData=mData[0],options.frames&&(modelDatas=mData)):modelData=mData),box=parsedAtoms.box?parsedAtoms.box:null,0==frames.length){for(let i=0;i<parsedAtoms.length;i++)0!=parsedAtoms[i].length&&frames.push(parsedAtoms[i]);frames[0]&&(atoms=frames[0])}else if(options.frames)for(let i=0;i<parsedAtoms.length;i++)frames.push(parsedAtoms[i]);else for(var i=0;i<parsedAtoms.length;i++)this.addAtoms(parsedAtoms[i]);for(let i=0;i<frames.length;i++)this.setAtomDefaults(frames[i],id);options.vibrate&&options.vibrate.frames&&options.vibrate.amplitude&&this.vibrate(options.vibrate.frames,options.vibrate.amplitude),options.style&&this.setStyle({},options.style)},this.setDontDuplicateAtoms=function(dup){dontDuplicateAtoms=dup},this.setModelData=function(mData){modelData=mData};var propertyMatches=function(atomval,val){if(atomval==val)return!0;if("string"==typeof val&&"number"==typeof atomval){var match=val.match(/(-?\d+)\s*-\s*(-?\d+)/);if(match){var lo=parseInt(match[1]),hi=parseInt(match[2]);if(match&&atomval>=lo&&atomval<=hi)return!0}}return!1};const deepCopyAndCache=function(selobject,model){if("object"!=typeof selobject)return selobject;if(selobject.__cache_created)return selobject;const copy={};for(const key in selobject){const item=selobject[key];if(Array.isArray(item)){copy[key]=[];for(let i=0;i<item.length;i++)copy[key].push(deepCopyAndCache(item[i],model))}else copy[key]="object"==typeof item&&"properties"!=key?deepCopyAndCache(item,model):item;if("and"==key||"or"==key){const results=[];for(const subSelection of copy[key]){const set=new Set;for(const match of model.selectedAtoms(subSelection))set.add(match.index);results.push(set)}if("and"==key){const intersect=function(first,other){const result=new Set;for(const elem of other)first.has(elem)&&result.add(elem);return result};let intersection=new Set(results[0]);for(const set of results.splice(1))intersection=intersect(intersection,set);copy[key].__cached_results=intersection}else if("or"==key){const union=new Set;for(const set of results)for(const elem of set)union.add(elem);copy[key].__cached_results=union}}}return copy.__cache_created=!0,copy};this.atomIsSelected=function(atom,sel){if(void 0===sel)return!0;var invert=!!sel.invert,ret=!0;for(var key in sel)if("and"==key||"or"==key||"not"==key){if("not"==key){if(this.atomIsSelected(atom,sel[key])){ret=!1;break}}else if(void 0===sel[key].__cached_results&&(sel=deepCopyAndCache(sel,this)),!(ret=sel[key].__cached_results.has(atom.index)))break}else if("predicate"===key){if(!sel.predicate(atom)){ret=!1;break}}else if("properties"==key&&atom[key]){for(var propkey in sel.properties)if(!propkey.startsWith("__cache")){if(void 0===atom.properties[propkey]){ret=!1;break}if(atom.properties[propkey]!=sel.properties[propkey]){ret=!1;break}}}else if(sel.hasOwnProperty(key)&&"props"!=key&&"invert"!=key&&"model"!=key&&"byres"!=key&&"expand"!=key&&"within"!=key&&"and"!=key&&"or"!=key&&"not"!=key&&!key.startsWith("__cache")){if(void 0===atom[key]){ret=!1;break}var isokay=!1,val;if("bonds"===key){if(sel[key]!=atom.bonds.length){ret=!1;break}}else if(Array.isArray(sel[key])){var valarr=sel[key],atomval=atom[key];for(let i=0;i<valarr.length;i++)if(propertyMatches(atomval,valarr[i])){isokay=!0;break}if(!isokay){ret=!1;break}}else{let val=sel[key];if(!propertyMatches(atom[key],val)){ret=!1;break}}}return invert?!ret:ret};const squaredDistance=function(atom1,atom2){var xd=atom2.x-atom1.x,yd=atom2.y-atom1.y,zd=atom2.z-atom1.z;return xd*xd+yd*yd+zd*zd};var expandAtomList=function(atomList,amt){if(amt<=0)return atomList;for(var pb=$3Dmol.getExtent(atomList),nb=[[],[],[]],i=0;i<3;i++)nb[0][i]=pb[0][i]-amt,nb[1][i]=pb[1][i]+amt,nb[2][i]=pb[2][i];var expand=[];for(let i=0;i<atoms.length;i++){var x=atoms[i].x,y=atoms[i].y,z=atoms[i].z;x>=nb[0][0]&&x<=nb[1][0]&&y>=nb[0][1]&&y<=nb[1][1]&&z>=nb[0][2]&&z<=nb[1][2]&&(x>=pb[0][0]&&x<=pb[1][0]&&y>=pb[0][1]&&y<=pb[1][1]&&z>=pb[0][2]&&z<=pb[1][2]||expand.push(atoms[i]))}return expand};this.selectedAtoms=function(sel,from){var ret=[];sel=deepCopyAndCache(sel||{},this),from||(from=atoms);for(var aLength=from.length,i=0;i<aLength;i++){var atom=from[i];atom&&this.atomIsSelected(atom,sel)&&ret.push(atom)}if(sel.hasOwnProperty("expand")){const exdist=parseFloat(sel.expand);let expand=expandAtomList(ret,exdist),retlen=ret.length;const thresh=exdist*exdist;for(let i=0;i<expand.length;i++)for(let j=0;j<retlen;j++){var dist=squaredDistance(expand[i],ret[j]);dist<thresh&&dist>0&&ret.push(expand[i])}}if(sel.hasOwnProperty("within")&&sel.within.hasOwnProperty("sel")&&sel.within.hasOwnProperty("distance")){var sel2=this.selectedAtoms(sel.within.sel,atoms),within={};const dist=parseFloat(sel.within.distance),thresh=dist*dist;for(let i=0;i<sel2.length;i++)for(let j=0;j<ret.length;j++){let dist=squaredDistance(sel2[i],ret[j]);dist<thresh&&dist>0&&(within[j]=1)}var newret=[];if(sel.within.invert)for(let j=0;j<ret.length;j++)within[j]||newret.push(ret[j]);else for(let j in within)newret.push(ret[j]);ret=newret}if(sel.hasOwnProperty("byres")){var vResis={},vAtoms=[],stack=[];for(let i=0;i<ret.length;i++){let atom=ret[i];var c=atom.chain,r=atom.resi;if(void 0===vResis[c]&&(vResis[c]={}),atom.hasOwnProperty("resi")&&void 0===vResis[c][r])for(vResis[c][r]=!0,stack.push(atom);stack.length>0;)if(atom=stack.pop(),c=atom.chain,r=atom.resi,void 0===vAtoms[atom.index]){vAtoms[atom.index]=!0;for(var j=0;j<atom.bonds.length;j++){var atom2=atoms[atom.bonds[j]];void 0===vAtoms[atom2.index]&&atom2.hasOwnProperty("resi")&&atom2.chain==c&&atom2.resi==r&&(stack.push(atom2),ret.push(atom2))}}}}return ret},this.addAtoms=function(newatoms){molObj=null;var start=atoms.length,indexmap=[],i;for(i=0;i<newatoms.length;i++)void 0===newatoms[i].index&&(newatoms[i].index=i),void 0===newatoms[i].serial&&(newatoms[i].serial=i),indexmap[newatoms[i].index]=start+i;for(i=0;i<newatoms.length;i++){var olda=newatoms[i],nindex=indexmap[olda.index],a=$3Dmol.extend({},olda);a.index=nindex,a.bonds=[],a.bondOrder=[],a.model=id,a.style=a.style||$3Dmol.deepCopy(defaultAtomStyle),void 0===a.color&&(a.color=ElementColors[a.elem]||defaultColor);for(var nbonds=olda.bonds?olda.bonds.length:0,j=0;j<nbonds;j++){var neigh=indexmap[olda.bonds[j]];void 0!==neigh&&(a.bonds.push(neigh),a.bondOrder.push(olda.bondOrder?olda.bondOrder[j]:1))}atoms.push(a)}},this.removeAtoms=function(badatoms){molObj=null;var baddies=[],i;for(i=0;i<badatoms.length;i++)baddies[badatoms[i].index]=!0;var newatoms=[];for(i=0;i<atoms.length;i++){var a=atoms[i];baddies[a.index]||newatoms.push(a)}atoms=[],this.addAtoms(newatoms)},this.setStyle=function(sel,style,add){var s;for(s in void 0===style&&void 0===add&&(style=sel,sel={}),sel)GLModel.validAtomSelectionSpecs.hasOwnProperty(s)||console.log("Unknown selector "+s);for(s in style)GLModel.validAtomStyleSpecs.hasOwnProperty(s)||console.log("Unknown style "+s);var changedAtoms=!1,that=this,setStyleHelper=function(atomArr){var selected=that.selectedAtoms(sel,atomArr);for(let i=0;i<atomArr.length;i++)atomArr[i]&&(atomArr[i].capDrawn=!1);for(let i=0;i<selected.length;i++){changedAtoms=!0,(selected[i].clickable||selected[i].hoverable)&&(selected[i].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),add||(selected[i].style={});for(let s in style)style.hasOwnProperty(s)&&(selected[i].style[s]=selected[i].style[s]||{},Object.assign(selected[i].style[s],style[s]))}};setStyleHelper(atoms);for(var i=0;i<frames.length;i++)frames[i]!==atoms&&setStyleHelper(frames[i]);changedAtoms&&(molObj=null)},this.setClickable=function(sel,clickable,callback){var s;for(s in sel)GLModel.validAtomSelectionSpecs.hasOwnProperty(s)||console.log("Unknown selector "+s);if(clickable=!!clickable,callback&&"function"!=typeof callback)console.log("Callback is not a function");else{var i,selected=this.selectedAtoms(sel,atoms),len=selected.length;for(i=0;i<len;i++)selected[i].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},selected[i].clickable=clickable,callback&&(selected[i].callback=callback);len>0&&(molObj=null)}},this.setHoverable=function(sel,hoverable,hover_callback,unhover_callback){var s;for(s in sel)GLModel.validAtomSelectionSpecs.hasOwnProperty(s)||console.log("Unknown selector "+s);if(hoverable=!!hoverable,hover_callback&&"function"!=typeof hover_callback)console.log("Hover_callback is not a function");else if(unhover_callback&&"function"!=typeof unhover_callback)console.log("Unhover_callback is not a function");else{var i,selected=this.selectedAtoms(sel,atoms),len=selected.length;for(i=0;i<len;i++)selected[i].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},selected[i].hoverable=hoverable,hover_callback&&(selected[i].hover_callback=hover_callback),unhover_callback&&(selected[i].unhover_callback=unhover_callback);len>0&&(molObj=null)}},this.setColorByElement=function(sel,colors){if(null===molObj||!sameObj(colors,lastColors)){lastColors=colors;var atoms=this.selectedAtoms(sel,atoms);atoms.length>0&&(molObj=null);for(var i=0;i<atoms.length;i++){var a=atoms[i];void 0!==colors[a.elem]&&(a.color=colors[a.elem])}}},this.setColorByProperty=function(sel,prop,scheme,range){var i,a,atoms=this.selectedAtoms(sel,atoms);for(lastColors=null,atoms.length>0&&(molObj=null),void 0!==$3Dmol.Gradient.builtinGradients[scheme]&&(scheme=new $3Dmol.Gradient.builtinGradients[scheme]),range||(range=scheme.range()),range||(range=$3Dmol.getPropertyRange(atoms,prop)),i=0;i<atoms.length;i++){var val;a=atoms[i],null!=$3Dmol.getAtomProperty(a,prop)&&(a.color=scheme.valueToHex(parseFloat(a.properties[prop]),range))}},this.setColorByFunction=function(sel,colorfun){var atoms=this.selectedAtoms(sel,atoms);if("function"==typeof colorfun){lastColors=null,atoms.length>0&&(molObj=null);for(let i=0;i<atoms.length;i++){let a=atoms[i];a.color=colorfun(a)}}},this.toCDObject=function(includeStyles){var out={a:[],b:[]};includeStyles&&(out.s=[]);for(var i=0;i<atoms.length;i++){var atomJSON={},atom=atoms[i];if(atomJSON.x=atom.x,atomJSON.y=atom.y,atomJSON.z=atom.z,"C"!=atom.elem&&(atomJSON.l=atom.elem),includeStyles){for(var s=0;s<out.s.length&&JSON.stringify(atom.style)!==JSON.stringify(out.s[s]);)s++;s===out.s.length&&out.s.push(atom.style),0!==s&&(atomJSON.s=s)}out.a.push(atomJSON);for(var b=0;b<atom.bonds.length;b++){var firstAtom=i,secondAtom=atom.bonds[b];if(!(firstAtom>=secondAtom)){var bond={b:firstAtom,e:secondAtom},bondOrder=atom.bondOrder[b];1!=bondOrder&&(bond.o=bondOrder),out.b.push(bond)}}}return out},this.globj=function(group,options){(null===molObj||options.regen)&&(molObj=createMolObj(atoms,options),renderedMolObj&&(group.remove(renderedMolObj),renderedMolObj=null),renderedMolObj=molObj.clone(),hidden&&(renderedMolObj.setVisible(!1),molObj.setVisible(!1)),group.add(renderedMolObj))},this.exportVRML=function(){var tmpobj;return createMolObj(atoms,{supportsImposters:!1,supportsAIA:!1}).vrml()},this.removegl=function(group){renderedMolObj&&(void 0!==renderedMolObj.geometry&&renderedMolObj.geometry.dispose(),void 0!==renderedMolObj.material&&renderedMolObj.material.dispose(),group.remove(renderedMolObj),renderedMolObj=null),molObj=null},this.hide=function(){hidden=!0,renderedMolObj&&renderedMolObj.setVisible(!1),molObj&&molObj.setVisible(!1)},this.show=function(){hidden=!1,renderedMolObj&&renderedMolObj.setVisible(!0),molObj&&molObj.setVisible(!0)},this.addPropertyLabels=function(prop,sel,viewer,style){for(var atoms=this.selectedAtoms(sel,atoms),mystyle=$3Dmol.deepCopy(style),i=0;i<atoms.length;i++){var a=atoms[i],label=null;void 0!==a[prop]?label=String(a[prop]):(a.properties[prop],label=String(a.properties[prop])),null!=label&&(mystyle.position=a,viewer.addLabel(label,mystyle))}},this.addResLabels=function(sel,viewer,style,byframe){var created_labels=[],helper=function(model,framenum){for(var atoms=model.selectedAtoms(sel,atoms),bylabel={},i=0;i<atoms.length;i++){var a=atoms[i],c=a.chain,resn,resi,label=a.resn+""+a.resi;bylabel[c]||(bylabel[c]={}),bylabel[c][label]||(bylabel[c][label]=[]),bylabel[c][label].push(a)}var mystyle=$3Dmol.deepCopy(style);for(let c in bylabel)if(bylabel.hasOwnProperty(c)){var labels=bylabel[c];for(let label in labels)if(labels.hasOwnProperty(label)){let atoms=labels[label],sum=new $3Dmol.Vector3(0,0,0);for(let i=0;i<atoms.length;i++){let a=atoms[i];sum.x+=a.x,sum.y+=a.y,sum.z+=a.z}sum.divideScalar(atoms.length),mystyle.position=sum,mystyle.frame=framenum;let l=viewer.addLabel(label,mystyle,void 0,!0);created_labels.push(l)}}};if(byframe){var n=this.getNumFrames();let savedatoms=atoms;for(let i=0;i<n;i++)frames[i]&&(atoms=frames[i],helper(this,i));atoms=savedatoms}else helper(this);return created_labels};var setupDFS=function(){atomdfs=[];var visited=new Int8Array(atoms.length);visited.fill(0);for(var search=function(i,prev,component){component.push([i,prev]);var atom=atoms[i];visited[i]=1;for(var b=0;b<atom.bonds.length;b++){var nexti=atom.bonds[b];atoms[nexti]&&!visited[nexti]&&search(nexti,i,component)}},i=0;i<atoms.length;i++){var atom;if(atoms[i]&&!visited[i]){var component=[];search(i,-1,component),atomdfs.push(component)}}};this.setCoordinatesFromURL=function(url,path){frames=[];var self=this;return box&&setupDFS(),new Promise((function(resolve,reject){url.startsWith("http://")||(url="http://"+url),$.get(url+"/traj/numframes/"+path,(function(numFrames){isNaN(parseInt(numFrames))||(frames.push(atoms),frames.numFrames=numFrames,frames.url=url,frames.path=path,self.setFrame(0).then((function(){resolve()})).catch(reject))}))}))},this.setCoordinates=function(str,format){if(!str)return[];if(/\.gz$/.test(format=format||"")){format=format.replace(/\.gz$/,"");try{str=pako.inflate(str,{to:"string"})}catch(err){console.log(err)}}var supportedFormats;if({mdcrd:"",inpcrd:"",pdb:"",netcdf:""}.hasOwnProperty(format)){frames=[];for(var atomCount=atoms.length,values=GLModel.parseCrd(str,format),count=0;count<values.length;){for(var temp=[],i=0;i<atomCount;i++){var newAtom={};for(var k in atoms[i])newAtom[k]=atoms[i][k];temp[i]=newAtom,temp[i].x=values[count++],temp[i].y=values[count++],temp[i].z=values[count++]}frames.push(temp)}return atoms=frames[0],frames}return[]},this.addAtomSpecs=function(customAtomSpecs){for(var i=0;i<customAtomSpecs.length;i++)GLModel.validAtomSelectionSpecs.hasOwnProperty(customAtomSpecs[i])||(GLModel.validAtomSelectionSpecs[customAtomSpecs[i]]={})}}return GLModel.parseCrd=function(data,format){var values=[],counter=0;if("pdb"==format)for(var index=data.indexOf("\nATOM");-1!=index;){for(;"\nATOM"==data.slice(index,index+5)||"\nHETATM"==data.slice(index,index+7);)values[counter++]=parseFloat(data.slice(index+31,index+39)),values[counter++]=parseFloat(data.slice(index+39,index+47)),values[counter++]=parseFloat(data.slice(index+47,index+55)),index=data.indexOf("\n",index+54),"\nTER"==data.slice(index,index+4)&&(index=data.indexOf("\n",index+5));index=data.indexOf("\nATOM",index)}else if("netcdf"==format){var reader=new netcdfjs(data);values=[].concat.apply([],reader.getDataVariable("coordinates"))}else{let index=data.indexOf("\n");"inpcrd"==format&&(index=data.indexOf("\n",index+1)),values=(data=data.slice(index+1)).match(/\S+/g).map(parseFloat)}return values},GLModel.parseMolData=function(data,format,options){if(!data)return[];if(/\.gz$/.test(format=format||"")){format=format.replace(/\.gz$/,"");try{data=pako.inflate(data,{to:"string"})}catch(err){console.log(err)}}var parse,parsedAtoms;return void 0===$3Dmol.Parsers[format]&&(format=format.split(".").pop(),void 0===$3Dmol.Parsers[format]&&(console.log("Unknown format: "+format),format=data instanceof Uint8Array?"mmtf":data.match(/^@<TRIPOS>MOLECULE/gm)?"mol2":data.match(/^data_/gm)&&data.match(/^loop_/gm)?"cif":data.match(/^HETATM/gm)||data.match(/^ATOM/gm)?"pdb":data.match(/ITEM: TIMESTEP/gm)?"lammpstrj":data.match(/^.*\n.*\n.\s*(\d+)\s+(\d+)/gm)?"sdf":data.match(/^%VERSION\s+\VERSION_STAMP/gm)?"prmtop":"xyz",console.log("Best guess: "+format))),(0,$3Dmol.Parsers[format])(data,options)},GLModel}(),$3Dmol.GLShape=function(){var ISDONE=2,finalizeGeo=function(geo){var geoGroup=geo.updateGeoGroup(0);geoGroup.vertices>0&&geoGroup.truncateArrayBuffers(!0,!0)},updateColor=function(geo,color){var r,g,b;for(var gg in color=color||$3Dmol.CC.color(color),geo.colorsNeedUpdate=!0,color.constructor!==Array&&(r=color.r,g=color.g,b=color.b),geo.geometryGroups)for(var geoGroup=geo.geometryGroups[gg],colorArr=geoGroup.colorArray,i=0,il=geoGroup.vertices;i<il;++i){if(color.constructor===Array){var c=color[i];r=c.r,g=c.g,b=c.b}colorArr[3*i]=r,colorArr[3*i+1]=g,colorArr[3*i+2]=b}},drawArrow=function(shape,geo,spec){var from=spec.start,end=spec.end,radius=spec.radius,radiusRatio=spec.radiusRatio,mid=spec.mid,midoffset=spec.midpos;if(from&&end){var geoGroup=geo.updateGeoGroup(51),dir=end.clone().sub(from);if(midoffset){let length=dir.length();mid=midoffset>0?midoffset/length:(length+midoffset)/length}dir.multiplyScalar(mid);var to=from.clone().add(dir),negDir=dir.clone().negate();shape.intersectionShape.cylinder.push(new $3Dmol.Cylinder(from.clone(),to.clone(),radius)),shape.intersectionShape.sphere.push(new $3Dmol.Sphere(from.clone(),radius));var nvecs=[];nvecs[0]=dir.clone(),Math.abs(nvecs[0].x)>1e-4?nvecs[0].y+=1:nvecs[0].x+=1,nvecs[0].cross(dir),nvecs[0].normalize(),nvecs[0]=nvecs[0],nvecs[4]=nvecs[0].clone(),nvecs[4].crossVectors(nvecs[0],dir),nvecs[4].normalize(),nvecs[8]=nvecs[0].clone().negate(),nvecs[12]=nvecs[4].clone().negate(),nvecs[2]=nvecs[0].clone().add(nvecs[4]).normalize(),nvecs[6]=nvecs[4].clone().add(nvecs[8]).normalize(),nvecs[10]=nvecs[8].clone().add(nvecs[12]).normalize(),nvecs[14]=nvecs[12].clone().add(nvecs[0]).normalize(),nvecs[1]=nvecs[0].clone().add(nvecs[2]).normalize(),nvecs[3]=nvecs[2].clone().add(nvecs[4]).normalize(),nvecs[5]=nvecs[4].clone().add(nvecs[6]).normalize(),nvecs[7]=nvecs[6].clone().add(nvecs[8]).normalize(),nvecs[9]=nvecs[8].clone().add(nvecs[10]).normalize(),nvecs[11]=nvecs[10].clone().add(nvecs[12]).normalize(),nvecs[13]=nvecs[12].clone().add(nvecs[14]).normalize(),nvecs[15]=nvecs[14].clone().add(nvecs[0]).normalize();var start=geoGroup.vertices,vertexArray=geoGroup.vertexArray,faceArray=geoGroup.faceArray,normalArray=geoGroup.normalArray,lineArray=geoGroup.lineArray,offset,i,n,face,norm,faceoffset,lineoffset,t1,t2,t2b,t3,t3b,t4,t1offset,t2offset,t2boffset,t3offset,t3boffset,t4offset,n1,n2,n3,n4;for(i=0,n=nvecs.length;i<n;++i){offset=3*(start+3*i);var bottom=nvecs[i].clone().multiplyScalar(radius).add(from),top=nvecs[i].clone().multiplyScalar(radius).add(to),conebase=nvecs[i].clone().multiplyScalar(radius*radiusRatio).add(to);if(vertexArray[offset]=bottom.x,vertexArray[offset+1]=bottom.y,vertexArray[offset+2]=bottom.z,vertexArray[offset+3]=top.x,vertexArray[offset+4]=top.y,vertexArray[offset+5]=top.z,vertexArray[offset+6]=conebase.x,vertexArray[offset+7]=conebase.y,vertexArray[offset+8]=conebase.z,i>0){var prev_x=vertexArray[offset-3],prev_y=vertexArray[offset-2],prev_z=vertexArray[offset-1],c=new $3Dmol.Vector3(prev_x,prev_y,prev_z),b=end.clone(),b2=to.clone(),a=new $3Dmol.Vector3(conebase.x,conebase.y,conebase.z);shape.intersectionShape.triangle.push(new $3Dmol.Triangle(a,b,c)),shape.intersectionShape.triangle.push(new $3Dmol.Triangle(c.clone(),b2,a.clone()))}}geoGroup.vertices+=48,vertexArray[offset=3*geoGroup.vertices]=from.x,vertexArray[offset+1]=from.y,vertexArray[offset+2]=from.z,vertexArray[offset+3]=to.x,vertexArray[offset+4]=to.y,vertexArray[offset+5]=to.z,vertexArray[offset+6]=end.x,vertexArray[offset+7]=end.y,vertexArray[offset+8]=end.z,geoGroup.vertices+=3;var fromi=geoGroup.vertices-3,toi=geoGroup.vertices-2,endi=geoGroup.vertices-1,fromoffset=3*fromi,tooffset=3*toi,endoffset=3*endi;for(i=0,n=nvecs.length-1;i<n;++i){var ti=start+3*i;offset=3*ti,faceoffset=geoGroup.faceidx,lineoffset=geoGroup.lineidx,t1offset=3*(t1=ti),t2offset=3*(t2=ti+1),t2boffset=3*(t2b=ti+2),t3offset=3*(t3=ti+4),t3boffset=3*(t3b=ti+5),t4offset=3*(t4=ti+3),norm=[nvecs[i],nvecs[i],nvecs[i+1],nvecs[i+1]],n1=n2=nvecs[i],n3=n4=nvecs[i+1],normalArray[t1offset]=n1.x,normalArray[t2offset]=n2.x,normalArray[t4offset]=n4.x,normalArray[t1offset+1]=n1.y,normalArray[t2offset+1]=n2.y,normalArray[t4offset+1]=n4.y,normalArray[t1offset+2]=n1.z,normalArray[t2offset+2]=n2.z,normalArray[t4offset+2]=n4.z,normalArray[t2offset]=n2.x,normalArray[t3offset]=n3.x,normalArray[t4offset]=n4.x,normalArray[t2offset+1]=n2.y,normalArray[t3offset+1]=n3.y,normalArray[t4offset+1]=n4.y,normalArray[t2offset+2]=n2.z,normalArray[t3offset+2]=n3.z,normalArray[t4offset+2]=n4.z,normalArray[t2boffset]=n2.x,normalArray[t3boffset]=n3.x,normalArray[t2boffset+1]=n2.y,normalArray[t3boffset+1]=n3.y,normalArray[t2boffset+2]=n2.z,normalArray[t3boffset+2]=n3.z,faceArray[faceoffset]=t1,faceArray[faceoffset+1]=t2,faceArray[faceoffset+2]=t4,faceArray[faceoffset+3]=t2,faceArray[faceoffset+4]=t3,faceArray[faceoffset+5]=t4,faceArray[faceoffset+6]=t1,faceArray[faceoffset+7]=t4,faceArray[faceoffset+8]=fromi,faceArray[faceoffset+9]=t2b,faceArray[faceoffset+10]=toi,faceArray[faceoffset+11]=t3b,faceArray[faceoffset+12]=t2b,faceArray[faceoffset+13]=endi,faceArray[faceoffset+14]=t3b,lineArray[lineoffset]=t1,lineArray[lineoffset+1]=t2,lineArray[lineoffset+2]=t1,lineArray[lineoffset+3]=t4,lineArray[lineoffset+4]=t3,lineArray[lineoffset+5]=t4,lineArray[lineoffset+6]=t1,lineArray[lineoffset+7]=t4,lineArray[lineoffset+8]=t2b,lineArray[lineoffset+9]=t2,lineArray[lineoffset+10]=t2b,lineArray[lineoffset+11]=t3b,lineArray[lineoffset+12]=t3,lineArray[lineoffset+13]=t3b,lineArray[lineoffset+14]=t2b,lineArray[lineoffset+15]=endi,lineArray[lineoffset+16]=t2b,lineArray[lineoffset+17]=t3b,lineArray[lineoffset+18]=endi,lineArray[lineoffset+19]=t3b,geoGroup.faceidx+=15,geoGroup.lineidx+=20}face=[start+45,start+46,start+1,start,start+47,start+2],norm=[nvecs[15],nvecs[15],nvecs[0],nvecs[0]],faceoffset=geoGroup.faceidx,lineoffset=geoGroup.lineidx,t1offset=3*(t1=face[0]),t2offset=3*(t2=face[1]),t2boffset=3*(t2b=face[4]),t3offset=3*(t3=face[2]),t3boffset=3*(t3b=face[5]),t4offset=3*(t4=face[3]),n1=n2=nvecs[15],n3=n4=nvecs[0],normalArray[t1offset]=n1.x,normalArray[t2offset]=n2.x,normalArray[t4offset]=n4.x,normalArray[t1offset+1]=n1.y,normalArray[t2offset+1]=n2.y,normalArray[t4offset+1]=n4.y,normalArray[t1offset+2]=n1.z,normalArray[t2offset+2]=n2.z,normalArray[t4offset+2]=n4.z,normalArray[t2offset]=n2.x,normalArray[t3offset]=n3.x,normalArray[t4offset]=n4.x,normalArray[t2offset+1]=n2.y,normalArray[t3offset+1]=n3.y,normalArray[t4offset+1]=n4.y,normalArray[t2offset+2]=n2.z,normalArray[t3offset+2]=n3.z,normalArray[t4offset+2]=n4.z,normalArray[t2boffset]=n2.x,normalArray[t3boffset]=n3.x,normalArray[t2boffset+1]=n2.y,normalArray[t3boffset+1]=n3.y,normalArray[t2boffset+2]=n2.z,normalArray[t3boffset+2]=n3.z,dir.normalize(),negDir.normalize(),normalArray[fromoffset]=negDir.x,normalArray[tooffset]=normalArray[endoffset]=dir.x,normalArray[fromoffset+1]=negDir.y,normalArray[tooffset+1]=normalArray[endoffset+1]=dir.y,normalArray[fromoffset+2]=negDir.z,normalArray[tooffset+2]=normalArray[endoffset+2]=dir.z,faceArray[faceoffset]=t1,faceArray[faceoffset+1]=t2,faceArray[faceoffset+2]=t4,faceArray[faceoffset+3]=t2,faceArray[faceoffset+4]=t3,faceArray[faceoffset+5]=t4,faceArray[faceoffset+6]=t1,faceArray[faceoffset+7]=t4,faceArray[faceoffset+8]=fromi,faceArray[faceoffset+9]=t2b,faceArray[faceoffset+10]=toi,faceArray[faceoffset+11]=t3b,faceArray[faceoffset+12]=t2b,faceArray[faceoffset+13]=endi,faceArray[faceoffset+14]=t3b,lineArray[lineoffset]=t1,lineArray[lineoffset+1]=t2,lineArray[lineoffset+2]=t1,lineArray[lineoffset+3]=t4,lineArray[lineoffset+4]=t3,lineArray[lineoffset+5]=t4,lineArray[lineoffset+6]=t1,lineArray[lineoffset+7]=t4,lineArray[lineoffset+8]=t2b,lineArray[lineoffset+9]=t2,lineArray[lineoffset+10]=t2b,lineArray[lineoffset+11]=t3b,lineArray[lineoffset+12]=t3,lineArray[lineoffset+13]=t3b,lineArray[lineoffset+14]=t2b,lineArray[lineoffset+15]=endi,lineArray[lineoffset+16]=t2b,lineArray[lineoffset+17]=t3b,lineArray[lineoffset+18]=endi,lineArray[lineoffset+19]=t3b,geoGroup.faceidx+=15,geoGroup.lineidx+=20}},updateBoundingFromPoints=function(sphere,components,points,numPoints){var i,il;if(sphere.center.set(0,0,0),components.length>0){for(i=0,il=components.length;i<il;++i){var centroid=components[i].centroid;sphere.center.add(centroid)}sphere.center.divideScalar(components.length)}var maxRadiusSq=sphere.radius*sphere.radius;for(points.length/3<numPoints&&(numPoints=points.length/3),i=0,il=numPoints;i<il;i++){var x=points[3*i],y=points[3*i+1],z=points[3*i+2],radiusSq=sphere.center.distanceToSquared({x:x,y:y,z:z});maxRadiusSq=Math.max(maxRadiusSq,radiusSq)}sphere.radius=Math.sqrt(maxRadiusSq)},addCustomGeo=function(shape,geo,mesh,color,clickable){var geoGroup=geo.addGeoGroup(),vertexArr=mesh.vertexArr,normalArr=mesh.normalArr,faceArr=mesh.faceArr,offset,v,a,b,c,i,il,r,g;geoGroup.vertices=vertexArr.length,geoGroup.faceidx=faceArr.length;var vertexArray=geoGroup.vertexArray,colorArray=geoGroup.colorArray;for(color.constructor!==Array&&(r=color.r,g=color.g,b=color.b),i=0,il=geoGroup.vertices;i<il;++i)offset=3*i,v=vertexArr[i],vertexArray[offset]=v.x,vertexArray[offset+1]=v.y,vertexArray[offset+2]=v.z,color.constructor===Array&&(r=(c=color[i]).r,g=c.g,b=c.b),colorArray[offset]=r,colorArray[offset+1]=g,colorArray[offset+2]=b;if(clickable)for(i=0,il=geoGroup.faceidx/3;i<il;++i){a=faceArr[offset=3*i],b=faceArr[offset+1],c=faceArr[offset+2];var vA=new $3Dmol.Vector3,vB=new $3Dmol.Vector3,vC=new $3Dmol.Vector3;shape.intersectionShape.triangle.push(new $3Dmol.Triangle(vA.copy(vertexArr[a]),vB.copy(vertexArr[b]),vC.copy(vertexArr[c])))}if(clickable){var center=new $3Dmol.Vector3(0,0,0),cnt=0;for(let g=0;g<geo.geometryGroups.length;g++)center.add(geo.geometryGroups[g].getCentroid()),cnt++;center.divideScalar(cnt),updateBoundingFromPoints(shape.boundingSphere,{centroid:center},vertexArray,geoGroup.vertices)}if(geoGroup.faceArray=new Uint16Array(faceArr),geoGroup.truncateArrayBuffers(!0,!0),normalArr.length<geoGroup.vertices)geoGroup.setNormals();else{var normalArray=geoGroup.normalArray=new Float32Array(3*geoGroup.vertices),n;for(i=0,il=geoGroup.vertices;i<il;++i)offset=3*i,n=normalArr[i],normalArray[offset]=n.x,normalArray[offset+1]=n.y,normalArray[offset+2]=n.z}geoGroup.setLineIndices(),geoGroup.lineidx=geoGroup.lineArray.length},drawCustom=function(shape,geo,customSpec){var mesh=customSpec,vertexArr=mesh.vertexArr,faceArr=mesh.faceArr;0!==vertexArr.length&&0!==faceArr.length||console.warn("Error adding custom shape component: No vertices and/or face indices supplied!");var color=customSpec.color;void 0===color&&(color=shape.color),color=$3Dmol.CC.color(color);for(var splits=$3Dmol.splitMesh(mesh),i=0,n=splits.length;i<n;i++)addCustomGeo(shape,geo,splits[i],splits[i].colorArr?splits[i].colorArr:color,customSpec.clickable)},updateFromStyle=function(shape,stylespec){void 0!==stylespec.color?(shape.color=stylespec.color||new $3Dmol.Color,stylespec.color instanceof $3Dmol.Color||(shape.color=$3Dmol.CC.color(stylespec.color))):shape.color=$3Dmol.CC.color(0),shape.wireframe=!!stylespec.wireframe,shape.opacity=stylespec.alpha?$3Dmol.Math.clamp(stylespec.alpha,0,1):1,void 0!==stylespec.opacity&&(shape.opacity=$3Dmol.Math.clamp(stylespec.opacity,0,1)),shape.side=void 0!==stylespec.side?stylespec.side:$3Dmol.DoubleSide,shape.linewidth=void 0===stylespec.linewidth?1:stylespec.linewidth,shape.clickable=!!stylespec.clickable,shape.callback="function"==typeof stylespec.callback?stylespec.callback:null,shape.hoverable=!!stylespec.hoverable,shape.hover_callback="function"==typeof stylespec.hover_callback?stylespec.hover_callback:null,shape.unhover_callback="function"==typeof stylespec.unhover_callback?stylespec.unhover_callback:null,shape.hidden=stylespec.hidden,shape.frame=stylespec.frame};function GLShape(stylespec){stylespec=stylespec||{},$3Dmol.ShapeIDCount++,this.boundingSphere=new $3Dmol.Sphere,this.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},updateFromStyle(this,stylespec);var components=[],shapeObj=null,renderedShapeObj=null,geo=new $3Dmol.Geometry(!0),linegeo=new $3Dmol.Geometry(!0);this.updateStyle=function(newspec){for(var prop in newspec)stylespec[prop]=newspec[prop];updateFromStyle(this,stylespec)},this.addCustom=function(customSpec){customSpec.vertexArr=customSpec.vertexArr||[],customSpec.faceArr=customSpec.faceArr||[],customSpec.normalArr=customSpec.normalArr||[],drawCustom(this,geo,customSpec)},this.addSphere=function(sphereSpec){sphereSpec.center=sphereSpec.center||{x:0,y:0,z:0},sphereSpec.radius=sphereSpec.radius?$3Dmol.Math.clamp(sphereSpec.radius,0,1/0):1.5,sphereSpec.color=$3Dmol.CC.color(sphereSpec.color),this.intersectionShape.sphere.push(new $3Dmol.Sphere(sphereSpec.center,sphereSpec.radius)),$3Dmol.GLDraw.drawSphere(geo,sphereSpec.center,sphereSpec.radius,sphereSpec.color),components.push({centroid:new $3Dmol.Vector3(sphereSpec.center.x,sphereSpec.center.y,sphereSpec.center.z)});var geoGroup=geo.updateGeoGroup(0);updateBoundingFromPoints(this.boundingSphere,components,geoGroup.vertexArray,geoGroup.vertices)},this.addBox=function(boxSpec){var dim=boxSpec.dimensions||{w:1,h:1,d:1},w=dim.w;"number"==typeof dim.w&&(w={x:dim.w,y:0,z:0});var h=dim.h;"number"==typeof dim.h&&(h={x:0,y:dim.h,z:0});var d=dim.d;"number"==typeof dim.d&&(d={x:0,y:0,z:dim.d});var c=boxSpec.corner;null==c&&(c=void 0!==boxSpec.center?{x:boxSpec.center.x-.5*(w.x+h.x+d.x),y:boxSpec.center.y-.5*(w.y+h.y+d.y),z:boxSpec.center.z-.5*(w.z+h.z+d.z)}:{x:0,y:0,z:0});var uv=[{x:c.x,y:c.y,z:c.z},{x:c.x+w.x,y:c.y+w.y,z:c.z+w.z},{x:c.x+h.x,y:c.y+h.y,z:c.z+h.z},{x:c.x+w.x+h.x,y:c.y+w.y+h.y,z:c.z+w.z+h.z},{x:c.x+d.x,y:c.y+d.y,z:c.z+d.z},{x:c.x+w.x+d.x,y:c.y+w.y+d.y,z:c.z+w.z+d.z},{x:c.x+h.x+d.x,y:c.y+h.y+d.y,z:c.z+h.z+d.z},{x:c.x+w.x+h.x+d.x,y:c.y+w.y+h.y+d.y,z:c.z+w.z+h.z+d.z}],verts=[],faces=[];verts.splice(verts.length,0,uv[0],uv[1],uv[2],uv[3]),faces.splice(faces.length,0,0,2,1,1,2,3);var foff=4;verts.splice(verts.length,0,uv[2],uv[3],uv[6],uv[7]),faces.splice(faces.length,0,foff+0,foff+2,foff+1,foff+1,foff+2,foff+3),foff+=4,verts.splice(verts.length,0,uv[4],uv[5],uv[0],uv[1]),faces.splice(faces.length,0,foff+0,foff+2,foff+1,foff+1,foff+2,foff+3),foff+=4,verts.splice(verts.length,0,uv[6],uv[7],uv[4],uv[5]),faces.splice(faces.length,0,foff+0,foff+2,foff+1,foff+1,foff+2,foff+3),foff+=4,verts.splice(verts.length,0,uv[3],uv[1],uv[7],uv[5]),faces.splice(faces.length,0,foff+0,foff+2,foff+1,foff+1,foff+2,foff+3),foff+=4,verts.splice(verts.length,0,uv[2],uv[6],uv[0],uv[4]),faces.splice(faces.length,0,foff+0,foff+2,foff+1,foff+1,foff+2,foff+3),foff+=4;var spec=$3Dmol.extend({},boxSpec);spec.vertexArr=verts,spec.faceArr=faces,spec.normalArr=[],drawCustom(this,geo,spec);var centroid=new $3Dmol.Vector3;components.push({centroid:centroid.addVectors(uv[0],uv[7]).multiplyScalar(.5)});var geoGroup=geo.updateGeoGroup(0);updateBoundingFromPoints(this.boundingSphere,components,geoGroup.vertexArray,geoGroup.vertices)},this.addCylinder=function(cylinderSpec){cylinderSpec.start=cylinderSpec.start||{},cylinderSpec.end=cylinderSpec.end||{};var start=new $3Dmol.Vector3(cylinderSpec.start.x||0,cylinderSpec.start.y||0,cylinderSpec.start.z||0),end=new $3Dmol.Vector3(cylinderSpec.end.x,cylinderSpec.end.y||0,cylinderSpec.end.z||0);void 0===end.x&&(end.x=3);var radius=cylinderSpec.radius||.1,color=$3Dmol.CC.color(cylinderSpec.color);this.intersectionShape.cylinder.push(new $3Dmol.Cylinder(start,end,radius)),$3Dmol.GLDraw.drawCylinder(geo,start,end,radius,color,cylinderSpec.fromCap,cylinderSpec.toCap);var centroid=new $3Dmol.Vector3;components.push({centroid:centroid.addVectors(start,end).multiplyScalar(.5)});var geoGroup=geo.updateGeoGroup(0);updateBoundingFromPoints(this.boundingSphere,components,geoGroup.vertexArray,geoGroup.vertices)},this.addDashedCylinder=function(cylinderSpec){cylinderSpec.start=cylinderSpec.start||{},cylinderSpec.end=cylinderSpec.end||{},cylinderSpec.dashLength=cylinderSpec.dashLength||.25,cylinderSpec.gapLength=cylinderSpec.gapLength||.25;var start=new $3Dmol.Vector3(cylinderSpec.start.x||0,cylinderSpec.start.y||0,cylinderSpec.start.z||0),end=new $3Dmol.Vector3(cylinderSpec.end.x,cylinderSpec.end.y||0,cylinderSpec.end.z||0);void 0===end.x&&(end.x=3);for(var radius=cylinderSpec.radius||.1,color=$3Dmol.CC.color(cylinderSpec.color),cylinderLength=Math.sqrt(Math.pow(start.x-end.x,2)+Math.pow(start.y-end.y,2)+Math.pow(start.z-end.z,2)),count=cylinderLength/(cylinderSpec.gapLength+cylinderSpec.dashLength),new_start=new $3Dmol.Vector3(cylinderSpec.start.x||0,cylinderSpec.start.y||0,cylinderSpec.start.z||0),new_end=new $3Dmol.Vector3(cylinderSpec.end.x,cylinderSpec.end.y||0,cylinderSpec.end.z||0),gapVector=new $3Dmol.Vector3((end.x-start.x)/(cylinderLength/cylinderSpec.gapLength),(end.y-start.y)/(cylinderLength/cylinderSpec.gapLength),(end.z-start.z)/(cylinderLength/cylinderSpec.gapLength)),dashVector=new $3Dmol.Vector3((end.x-start.x)/(cylinderLength/cylinderSpec.dashLength),(end.y-start.y)/(cylinderLength/cylinderSpec.dashLength),(end.z-start.z)/(cylinderLength/cylinderSpec.dashLength)),place=0;place<count;place++)new_end=new $3Dmol.Vector3(new_start.x+dashVector.x,new_start.y+dashVector.y,new_start.z+dashVector.z),this.intersectionShape.cylinder.push(new $3Dmol.Cylinder(new_start,new_end,radius)),$3Dmol.GLDraw.drawCylinder(geo,new_start,new_end,radius,color,cylinderSpec.fromCap,cylinderSpec.toCap),new_start=new $3Dmol.Vector3(new_end.x+gapVector.x,new_end.y+gapVector.y,new_end.z+gapVector.z);var centroid=new $3Dmol.Vector3;components.push({centroid:centroid.addVectors(start,end).multiplyScalar(.5)});var geoGroup=geo.updateGeoGroup(0);updateBoundingFromPoints(this.boundingSphere,components,geoGroup.vertexArray,geoGroup.vertices)},this.addCurve=function(curveSpec){curveSpec.points=curveSpec.points||[],curveSpec.smooth=curveSpec.smooth||10,void 0===curveSpec.fromCap&&(curveSpec.fromCap=2),void 0===curveSpec.toCap&&(curveSpec.toCap=2);var points=$3Dmol.subdivide_spline(curveSpec.points,curveSpec.smooth);if(points.length<3)console.log("Too few points in addCurve");else{var radius=curveSpec.radius||.1,color=$3Dmol.CC.color(curveSpec.color),start=0,end=points.length-1,segmentlen=points[0].distanceTo(points[1]),npts=Math.ceil(2*radius/segmentlen);if(curveSpec.toArrow){let arrowspec={start:points[end-=npts],end:points[points.length-1],radius:radius,color:color,mid:1e-4};this.addArrow(arrowspec)}if(curveSpec.fromArrow){let arrowspec={start:points[start+=npts],end:points[0],radius:radius,color:color,mid:1e-4};this.addArrow(arrowspec)}for(var midway=Math.ceil(points.length/2),middleSpec={radius:radius,color:color,fromCap:2,toCap:2},i=start;i<end;i++)middleSpec.start=points[i],middleSpec.end=points[i+1],middleSpec.fromCap=2,middleSpec.toCap=2,i<midway?(middleSpec.fromCap=2,middleSpec.toCap=0):i>midway?(middleSpec.fromCap=0,middleSpec.toCap=2):(middleSpec.fromCap=2,middleSpec.toCap=2),this.addCylinder(middleSpec)}},this.addLine=function(lineSpec){lineSpec.start=lineSpec.start||{},lineSpec.end=lineSpec.end||{};var start=new $3Dmol.Vector3(lineSpec.start.x||0,lineSpec.start.y||0,lineSpec.start.z||0),end=new $3Dmol.Vector3(lineSpec.end.x,lineSpec.end.y||0,lineSpec.end.z||0);void 0===end.x&&(end.x=3);var geoGroup=geo.updateGeoGroup(2),vstart=geoGroup.vertices,i=3*vstart,vertexArray=geoGroup.vertexArray;vertexArray[i]=start.x,vertexArray[i+1]=start.y,vertexArray[i+2]=start.z,vertexArray[i+3]=end.x,vertexArray[i+4]=end.y,vertexArray[i+5]=end.z,geoGroup.vertices+=2;var lineArray=geoGroup.lineArray,li=geoGroup.lineidx;lineArray[li]=vstart,lineArray[li+1]=vstart+1,geoGroup.lineidx+=2;var centroid=new $3Dmol.Vector3;components.push({centroid:centroid.addVectors(start,end).multiplyScalar(.5)}),geoGroup=geo.updateGeoGroup(0),updateBoundingFromPoints(this.boundingSphere,components,geoGroup.vertexArray,geoGroup.vertices)},this.addArrow=function(arrowSpec){if(arrowSpec.start=arrowSpec.start||{},arrowSpec.end=arrowSpec.end||{},arrowSpec.start=new $3Dmol.Vector3(arrowSpec.start.x||0,arrowSpec.start.y||0,arrowSpec.start.z||0),arrowSpec.dir instanceof $3Dmol.Vector3&&"number"==typeof arrowSpec.length){var end=arrowSpec.dir.clone().multiplyScalar(arrowSpec.length).add(arrowSpec.start);arrowSpec.end=end}else arrowSpec.end=new $3Dmol.Vector3(arrowSpec.end.x,arrowSpec.end.y||0,arrowSpec.end.z||0),void 0===arrowSpec.end.x&&(arrowSpec.end.x=3);arrowSpec.radius=arrowSpec.radius||.1,arrowSpec.radiusRatio=arrowSpec.radiusRatio||1.618034,arrowSpec.mid=0<arrowSpec.mid&&arrowSpec.mid<1?arrowSpec.mid:.618034,drawArrow(this,geo,arrowSpec);var centroid=new $3Dmol.Vector3;components.push({centroid:centroid.addVectors(arrowSpec.start,arrowSpec.end).multiplyScalar(.5)});var geoGroup=geo.updateGeoGroup(0);updateBoundingFromPoints(this.boundingSphere,components,geoGroup.vertexArray,geoGroup.vertices)};var distance_from=function(c1,c2){return Math.sqrt(Math.pow(c1.x-c2.x,2)+Math.pow(c1.y-c2.y,2)+Math.pow(c1.z-c2.z,2))},inSelectedRegion=function(coordinate,selectedRegion,radius){for(var i=0;i<selectedRegion.length;i++)if(distance_from(selectedRegion[i],coordinate)<=radius)return!0;return!1};this.addIsosurface=function(data,volSpec,callback){var isoval=void 0!==volSpec.isoval&&"number"==typeof volSpec.isoval?volSpec.isoval:0,voxel=!!volSpec.voxel,smoothness=void 0===volSpec.smoothness?1:volSpec.smoothness,nX=data.size.x,nY=data.size.y,nZ=data.size.z,vertnums=new Int16Array(nX*nY*nZ),vals=data.data,i,il;for(i=0,il=vertnums.length;i<il;++i)vertnums[i]=-1;var bitdata=new Uint8Array(nX*nY*nZ);for(i=0,il=vals.length;i<il;++i){var val;(isoval>=0?vals[i]-isoval:isoval-vals[i])>0&&(bitdata[i]|=2)}var verts=[],faces=[];$3Dmol.MarchingCube.march(bitdata,verts,faces,{fulltable:!0,voxel:voxel,unitCube:data.unit,origin:data.origin,matrix:data.matrix,nX:nX,nY:nY,nZ:nZ}),!voxel&&smoothness>0&&$3Dmol.MarchingCube.laplacianSmooth(smoothness,verts,faces);var vertexmapping=[],newvertices=[],newfaces=[];if(volSpec.selectedRegion&&void 0===volSpec.coords&&(volSpec.coords=volSpec.selectedRegion),void 0!==volSpec.coords){var xmax=volSpec.coords[0].x,ymax=volSpec.coords[0].y,zmax=volSpec.coords[0].z,xmin=volSpec.coords[0].x,ymin=volSpec.coords[0].y,zmin=volSpec.coords[0].z;for(let i=0;i<volSpec.coords.length;i++)volSpec.coords[i].x>xmax?xmax=volSpec.coords[i].x:volSpec.coords[i].x<xmin&&(xmin=volSpec.coords[i].x),volSpec.coords[i].y>ymax?ymax=volSpec.coords[i].y:volSpec.coords[i].y<ymin&&(ymin=volSpec.coords[i].y),volSpec.coords[i].z>zmax?zmax=volSpec.coords[i].z:volSpec.coords[i].z<zmin&&(zmin=volSpec.coords[i].z);var rad=2;void 0!==volSpec.radius&&(rad=volSpec.radius),void 0!==volSpec.selectedOffset&&(rad=volSpec.selectedOffset),void 0!==volSpec.seldist&&(rad=volSpec.seldist),xmin-=rad,xmax+=rad,ymin-=rad,ymax+=rad,zmin-=rad,zmax+=rad;for(let i=0;i<verts.length;i++)verts[i].x>xmin&&verts[i].x<xmax&&verts[i].y>ymin&&verts[i].y<ymax&&verts[i].z>zmin&&verts[i].z<zmax&&inSelectedRegion(verts[i],volSpec.coords,rad)?(vertexmapping.push(newvertices.length),newvertices.push(verts[i])):vertexmapping.push(-1);for(let i=0;i+2<faces.length;i+=3)-1!==vertexmapping[faces[i]]&&-1!==vertexmapping[faces[i+1]]&&-1!==vertexmapping[faces[i+2]]&&(newfaces.push(faces[i]-(faces[i]-vertexmapping[faces[i]])),newfaces.push(faces[i+1]-(faces[i+1]-vertexmapping[faces[i+1]])),newfaces.push(faces[i+2]-(faces[i+2]-vertexmapping[faces[i+2]])));verts=newvertices,faces=newfaces}drawCustom(this,geo,{vertexArr:verts,faceArr:faces,normalArr:[],clickable:volSpec.clickable,hoverable:volSpec.hoverable}),this.updateStyle(volSpec);var origin=new $3Dmol.Vector3(data.origin.x,data.origin.y,data.origin.z),size=new $3Dmol.Vector3(data.size.x*data.unit.x,data.size.y*data.unit.y,data.size.z*data.unit.z),total=new $3Dmol.Vector3(0,0,0),maxv=origin.clone(),minv=origin.clone().add(size);for(let i=0;i<verts.length;i++)total.add(verts[i]),maxv.max(verts[i]),minv.min(verts[i]);total.divideScalar(verts.length);var len1=total.distanceTo(minv),len2=total.distanceTo(maxv);this.boundingSphere.center=total,this.boundingSphere.radius=Math.max(len1,len2),"function"==typeof callback&&callback()},this.addVolumetricData=function(data,fmt,volSpec){data=new $3Dmol.VolumeData(data,fmt),this.addIsosurface(data,volSpec)},this.finalize=function(){return finalizeGeo(geo),geo.initTypedArrays(),geo},this.globj=function(group){if(renderedShapeObj&&(group.remove(renderedShapeObj),renderedShapeObj=null),!this.hidden){finalizeGeo(geo),geo.initTypedArrays(),this.wireframe&&geo.setUpWireframe(),void 0!==this.color&&updateColor(geo,this.color),shapeObj=new $3Dmol.Object3D;var material=null;material=this.side==$3Dmol.DoubleSide?new $3Dmol.MeshDoubleLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth}):new $3Dmol.MeshLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth});var mesh=new $3Dmol.Mesh(geo,material);shapeObj.add(mesh);var lineMaterial=new $3Dmol.LineBasicMaterial({linewidth:this.linewidth,color:this.color}),line=new $3Dmol.Line(linegeo,lineMaterial,$3Dmol.LinePieces);shapeObj.add(line),renderedShapeObj=shapeObj.clone(),group.add(renderedShapeObj)}},this.removegl=function(group){renderedShapeObj&&(void 0!==renderedShapeObj.geometry&&renderedShapeObj.geometry.dispose(),void 0!==renderedShapeObj.material&&renderedShapeObj.material.dispose(),group.remove(renderedShapeObj),renderedShapeObj=null),shapeObj=null}}return Object.defineProperty(GLShape.prototype,"position",{get:function(){return this.boundingSphere.center}}),Object.defineProperty(GLShape.prototype,"x",{get:function(){return this.boundingSphere.center.x}}),Object.defineProperty(GLShape.prototype,"y",{get:function(){return this.boundingSphere.center.y}}),Object.defineProperty(GLShape.prototype,"z",{get:function(){return this.boundingSphere.center.z}}),GLShape}(),$3Dmol.ShapeIDCount=0,$3Dmol.splitMesh=function(mesh){var MAXVERT=64e3;if(mesh.vertexArr.length<64e3)return[mesh];var slices=[{vertexArr:[],normalArr:[],faceArr:[]}];mesh.colorArr&&(slices.colorArr=[]);var vertSlice=[],vertIndex=[],currentSlice=0,faces=mesh.faceArr;for(let i=0,nf=faces.length;i<nf;i+=3){let slice=slices[currentSlice];for(let j=0;j<3;j++){var v=faces[i+j];vertSlice[v]!==currentSlice&&(vertSlice[v]=currentSlice,vertIndex[v]=slice.vertexArr.length,slice.vertexArr.push(mesh.vertexArr[v]),mesh.normalArr&&mesh.normalArr[v]&&slice.normalArr.push(mesh.normalArr[v]),mesh.colorArr&&mesh.colorArr[v]&&slice.colorArr.push(mesh.colorArr[v])),slice.faceArr.push(vertIndex[v])}slice.vertexArr.length>=64e3&&(slices.push({vertexArr:[],normalArr:[],faceArr:[]}),mesh.colorArr&&(slices.colorArr=[]),currentSlice++)}return slices},$3Dmol.GLViewer=function(){var numWorkers=4,maxVolume=64e3;function GLViewer(element,config){var callback=(config=config||{}).callback,defaultcolors=config.defaultcolors;defaultcolors||(defaultcolors=$3Dmol.elementColors.defaultColors);var nomouse=config.nomouse,bgColor=0;config.backgroundColor=config.backgroundColor||"#ffffff",null!=typeof config.backgroundColor&&(bgColor=$3Dmol.CC.color(config.backgroundColor).getHex());var camerax=0;null!=typeof config.camerax&&(camerax=parseFloat(config.camerax));var _viewer=this,container=$(element),glDOM=null,models=[],surfaces={},shapes=[],labels=[],fixed_labels=[],clickables=[],hoverables=[],current_hover=null,hoverDuration=500,viewer_frame=0;null!=config.hoverDuration&&(hoverDuration=config.hoverDuration),void 0===config.antialias&&(config.antialias=!0),void 0===config.cartoonQuality&&(config.cartoonQuality=5);var getRect=function(){let div=container[0],rect=div.getBoundingClientRect();if(0==rect.width&&0==rect.height&&"none"===div.style.display){let oldpos=div.style.position,oldvis=div.style.visibility;div.style.display="block",div.style.visibility="hidden",div.style.position="absolute",rect=div.getBoundingClientRect(),div.style.display="none",div.style.visibility=oldvis,div.style.position=oldpos}return rect},getWidth=function(){return getRect().width},getHeight=function(){return getRect().height},WIDTH=getWidth(),HEIGHT=getHeight(),viewChangeCallback=null,stateChangeCallback=null,NEAR=1,FAR=800,CAMERA_Z=150,fov=20,linkedViewers=[],renderer=new $3Dmol.Renderer({antialias:config.antialias,preserveDrawingBuffer:!0,premultipliedAlpha:!1,id:config.id,row:config.row,col:config.col,rows:config.rows,cols:config.cols,canvas:config.canvas,containerWidth:WIDTH,containerHeight:HEIGHT});renderer.domElement.style.width="100%",renderer.domElement.style.height="100%",renderer.domElement.style.padding="0",renderer.domElement.style.position="absolute",renderer.domElement.style.top="0px",renderer.domElement.style.left="0px",renderer.domElement.style.zIndex="0";var row=config.row,col=config.col,cols=config.cols,rows=config.rows,viewers=config.viewers,control_all=config.control_all,ASPECT=renderer.getAspect(WIDTH,HEIGHT),camera=new $3Dmol.Camera(20,ASPECT,1,800,config.orthographic);camera.position=new $3Dmol.Vector3(camerax,0,150);var lookingAt=new $3Dmol.Vector3;camera.lookAt(lookingAt);var raycaster=new $3Dmol.Raycaster(new $3Dmol.Vector3(0,0,0),new $3Dmol.Vector3(0,0,0)),projector=new $3Dmol.Projector,scene=null,rotationGroup=null,modelGroup=null,fogStart=.4,slabNear=-50,slabFar=50,cq=new $3Dmol.Quaternion(0,0,0,1),dq=new $3Dmol.Quaternion(0,0,0,1),animated=0,animationTimers=new Set,isDragging=!1,mouseStartX=0,mouseStartY=0,touchDistanceStart=0,currentModelPos=0,cz=0,cslabNear=0,cslabFar=0,decAnim=function(){--animated<0&&(animated=0)},incAnim=function(){animated++},nextSurfID=function(){var max=0;for(var i in surfaces)if(surfaces.hasOwnProperty(i)){var val=parseInt(i);isNaN(val)||(i=val),i>max&&(max=i)}return max+1},setSlabAndFog=function(){var center=camera.position.z-rotationGroup.position.z;center<1&&(center=1),camera.near=center+slabNear,camera.near<1&&(camera.near=1),camera.far=center+slabFar,camera.near+1>camera.far&&(camera.far=camera.near+1),camera.fov=20,camera.right=center*Math.tan(Math.PI/180*20),camera.left=-camera.right,camera.top=camera.right/ASPECT,camera.bottom=-camera.top,camera.updateProjectionMatrix(),scene.fog.near=camera.near+.4*(camera.far-camera.near),scene.fog.far=camera.far,config.disableFog&&(scene.fog.near=scene.fog.far)},show=function(nolink){if(renderer.setViewport(),scene&&(setSlabAndFog(),renderer.render(scene,camera),viewChangeCallback&&viewChangeCallback(_viewer.getView()),!nolink&&linkedViewers.length>0))for(var view=_viewer.getView(),i=0;i<linkedViewers.length;i++){var other;linkedViewers[i].setView(view,!0)}},initializeScene;(function(){(scene=new $3Dmol.Scene).fog=new $3Dmol.Fog(bgColor,100,200),modelGroup=new $3Dmol.Object3D,(rotationGroup=new $3Dmol.Object3D).useQuaternion=!0,rotationGroup.quaternion=new $3Dmol.Quaternion(0,0,0,1),rotationGroup.add(modelGroup),scene.add(rotationGroup);var directionalLight=new $3Dmol.Light(16777215);directionalLight.position=new $3Dmol.Vector3(.2,.2,1).normalize(),directionalLight.intensity=1,scene.add(directionalLight)})(),renderer.setClearColorHex(bgColor,1),scene.fog.color=$3Dmol.CC.color(bgColor);var clickedAtom=null,updateClickables=function(){clickables.splice(0,clickables.length),hoverables.splice(0,hoverables.length);for(let i=0,il=models.length;i<il;i++){var model=models[i];if(model){let atoms=model.selectedAtoms({clickable:!0}),hoverable_atoms=model.selectedAtoms({hoverable:!0});Array.prototype.push.apply(hoverables,hoverable_atoms),Array.prototype.push.apply(clickables,atoms)}}for(let i=0,il=shapes.length;i<il;i++){let shape=shapes[i];shape&&shape.clickable&&clickables.push(shape),shape&&shape.hoverable&&hoverables.push(shape)}},handleClickSelection=function(mouseX,mouseY,event){if(0!=clickables.length){var mouse={x:mouseX,y:mouseY,z:-1};raycaster.setFromCamera(mouse,camera);var intersects=[];if((intersects=raycaster.intersectObjects(modelGroup,clickables)).length){var selected=intersects[0].clickable;void 0!==selected.callback&&"function"==typeof selected.callback&&selected.callback(selected,_viewer,event,container)}}},setHover=function(selected,event){current_hover!=selected&&(current_hover&&current_hover.unhover_callback(current_hover,_viewer,event,container),current_hover=selected,selected&&void 0!==selected.hover_callback&&"function"==typeof selected.hover_callback&&selected.hover_callback(selected,_viewer,event,container))},handleHoverSelection=function(mouseX,mouseY){if(0!=hoverables.length){var mouse={x:mouseX,y:mouseY,z:-1};raycaster.setFromCamera(mouse,camera);var intersects=[];if((intersects=raycaster.intersectObjects(modelGroup,hoverables)).length){var selected=intersects[0].clickable;setHover(selected),current_hover=selected}else setHover(null)}},handleHoverContinue=function(mouseX,mouseY){var mouse={x:mouseX,y:mouseY,z:-1};raycaster.setFromCamera(mouse,camera);var intersects=[];0!=(intersects=raycaster.intersectObjects(modelGroup,hoverables)).length&&void 0!==intersects[0]||setHover(null),void 0!==intersects[0]&&intersects[0].clickable!==current_hover&&setHover(null)},calcTouchDistance=function(ev){var xdiff=ev.originalEvent.targetTouches[0].pageX-ev.originalEvent.targetTouches[1].pageX,ydiff=ev.originalEvent.targetTouches[0].pageY-ev.originalEvent.targetTouches[1].pageY;return Math.sqrt(xdiff*xdiff+ydiff*ydiff)},getX=function(ev){var x=ev.pageX;return null==x&&(x=ev.originalEvent.pageX),ev.originalEvent.targetTouches&&ev.originalEvent.targetTouches[0]?x=ev.originalEvent.targetTouches[0].pageX:ev.originalEvent.changedTouches&&ev.originalEvent.changedTouches[0]&&(x=ev.originalEvent.changedTouches[0].pageX),x},getY=function(ev){var y=ev.pageY;return null==y&&(y=ev.originalEvent.pageY),ev.originalEvent.targetTouches&&ev.originalEvent.targetTouches[0]?y=ev.originalEvent.targetTouches[0].pageY:ev.originalEvent.changedTouches&&ev.originalEvent.changedTouches[0]&&(y=ev.originalEvent.changedTouches[0].pageY),y},screenXY2model=function(x,y){var dx=x/WIDTH,dy=y/HEIGHT,zpos=rotationGroup.position.z,q=rotationGroup.quaternion,t=new $3Dmol.Vector3(0,0,zpos);return projector.projectVector(t,camera),t.x+=2*dx,t.y-=2*dy,projector.unprojectVector(t,camera),t.z=0,t.applyQuaternion(q),t},canvasOffset=function(){let canvas=glDOM.get(0),rect=canvas.getBoundingClientRect(),doc=canvas.ownerDocument,docElem=doc.documentElement,win=doc.defaultView;return{top:rect.top+win.pageYOffset-docElem.clientTop,left:rect.left+win.pageXOffset-docElem.clientLeft}},isInViewer=function(x,y){if(null!=viewers&&!control_all){var width=WIDTH/cols,height=HEIGHT/rows,offset=canvasOffset(),relx=x-offset.left,rely=y-offset.top,r=rows-Math.floor(rely/height)-1,c=Math.floor(relx/width);if(r!=row||c!=col)return!1}return!0};$("body").bind("mouseup touchend",(function(ev){if(isDragging&&scene){var x=getX(ev),y=getY(ev);if(x==mouseStartX&&y==mouseStartY){var offset=canvasOffset(),mouseX=(x-offset.left)/WIDTH*2-1,mouseY=-(y-offset.top)/HEIGHT*2+1;handleClickSelection(mouseX,mouseY,ev,container)}}isDragging=!1}));var adjustZoomToLimits=function(z){if(config.lowerZoomLimit&&config.lowerZoomLimit>0){var lower=150-config.lowerZoomLimit;z>lower&&(z=lower)}if(config.upperZoomLimit&&config.upperZoomLimit>0){var upper=150-config.upperZoomLimit;z<upper&&(z=upper)}return z>150&&(z=149.85),z},mouseButton;this.setViewChangeCallback=function(callback){"function"!=typeof callback&&null!=callback||(viewChangeCallback=callback)},this.setStateChangeCallback=function(callback){"function"!=typeof callback&&null!=callback||(stateChangeCallback=callback)},this.getInternalState=function(){var ret={models:[],surfaces:[],shapes:[],labels:[]};for(let i=0;i<models.length;i++)models[i]&&(ret.models[i]=models[i].getInternalState());return ret},this.setInternalState=function(state){this.clear();var newm=state.models;for(let i=0;i<newm.length;i++)newm[i]&&(models[i]=new $3Dmol.GLModel(i),models[i].setInternalState(newm[i]));this.render()},this.setZoomLimits=function(lower,upper){void 0!==lower&&(config.lowerZoomLimit=lower),upper&&(config.upperZoomLimit=upper),rotationGroup.position.z=adjustZoomToLimits(rotationGroup.position.z),show()};var _handleMouseDown=this._handleMouseDown=function(ev){if(ev.preventDefault(),scene){var x=getX(ev),y=getY(ev);void 0!==x&&(isDragging=!0,clickedAtom=null,mouseButton=ev.which,mouseStartX=x,mouseStartY=y,touchDistanceStart=0,ev.originalEvent.targetTouches&&2==ev.originalEvent.targetTouches.length&&(touchDistanceStart=calcTouchDistance(ev)),cq=rotationGroup.quaternion.clone(),cz=rotationGroup.position.z,currentModelPos=modelGroup.position.clone(),cslabNear=slabNear,cslabFar=slabFar)}},_handleMouseScroll=this._handleMouseScroll=function(ev){if(ev.preventDefault(),scene){var x=getX(ev),y=getY(ev);if(void 0!==x&&isInViewer(x,y)){var scaleFactor=.85*(150-rotationGroup.position.z),mult=1;ev.originalEvent.ctrlKey&&(mult=-1),ev.originalEvent.detail?rotationGroup.position.z+=mult*scaleFactor*ev.originalEvent.detail/10:ev.originalEvent.wheelDelta&&(rotationGroup.position.z-=mult*scaleFactor*ev.originalEvent.wheelDelta/400),rotationGroup.position.z=adjustZoomToLimits(rotationGroup.position.z),show()}}},hoverTimeout;this.pngURI=function(){return this.getCanvas().toDataURL("image/png")},this.getCanvas=function(){return glDOM.get(0)},this.getRenderer=function(){return renderer},this.setHoverDuration=function(duration){hoverDuration=duration};var _handleMouseMove=this._handleMouseMove=function(ev){clearTimeout(hoverTimeout);var offset=canvasOffset(),mouseX=(getX(ev)-offset.left)/WIDTH*2-1,mouseY=-(getY(ev)-offset.top)/HEIGHT*2+1;if(null!==current_hover&&handleHoverContinue(mouseX,mouseY,ev),hoverables.length>0&&(hoverTimeout=setTimeout((function(){handleHoverSelection(mouseX,mouseY)}),hoverDuration)),ev.preventDefault(),scene&&isDragging){var mode=0,x=getX(ev),y=getY(ev);if(void 0!==x&&isInViewer(x,y)){var dx=(x-mouseStartX)/WIDTH,dy=(y-mouseStartY)/HEIGHT,newdist;if(0!=touchDistanceStart&&ev.originalEvent.targetTouches&&2==ev.originalEvent.targetTouches.length)mode=2,dy=2*(calcTouchDistance(ev)-touchDistanceStart)/(WIDTH+HEIGHT);else ev.originalEvent.targetTouches&&3==ev.originalEvent.targetTouches.length&&(mode=1);var ratioX=renderer.getXRatio(),ratioY=renderer.getYRatio();dx*=ratioX,dy*=ratioY;var r=Math.sqrt(dx*dx+dy*dy),scaleFactor;if(3==mode||3==mouseButton&&ev.ctrlKey)slabNear=cslabNear+100*dx,slabFar=cslabFar-100*dy;else if(2==mode||3==mouseButton||ev.shiftKey)(scaleFactor=.85*(150-rotationGroup.position.z))<80&&(scaleFactor=80),rotationGroup.position.z=cz+dy*scaleFactor,rotationGroup.position.z=adjustZoomToLimits(rotationGroup.position.z);else if(1==mode||2==mouseButton||ev.ctrlKey){var t=screenXY2model(ratioX*(x-mouseStartX),ratioY*(y-mouseStartY));modelGroup.position.addVectors(currentModelPos,t)}else if((0===mode||1==mouseButton)&&0!==r){var rs=Math.sin(r*Math.PI)/r;dq.x=Math.cos(r*Math.PI),dq.y=0,dq.z=rs*dx,dq.w=-rs*dy,rotationGroup.quaternion.set(1,0,0,0),rotationGroup.quaternion.multiply(dq),rotationGroup.quaternion.multiply(cq)}show()}}},initContainer=function(element){container=element,WIDTH=getWidth(),HEIGHT=getHeight(),ASPECT=renderer.getAspect(WIDTH,HEIGHT),renderer.setSize(WIDTH,HEIGHT),container.append(renderer.domElement),glDOM=$(renderer.domElement),nomouse||(glDOM.bind("mousedown touchstart",_handleMouseDown),glDOM.bind("DOMMouseScroll mousewheel",_handleMouseScroll),glDOM.bind("mousemove touchmove",_handleMouseMove),glDOM.bind("contextmenu",(function(ev){ev.preventDefault()})))},divwatcher;(initContainer(container),this.setContainer=function(element){return"string"==typeof element&&(element=$("#"+element)),element||(element=container),initContainer(element),this},this.setBackgroundColor=function(hex,a){void 0===a?a=1:(a<0||a>1)&&(a=1);var c=$3Dmol.CC.color(hex);return scene.fog.color=c,bgColor=c.getHex(),renderer.setClearColorHex(c.getHex(),a),show(),this},this.setProjection=function(proj){camera.ortho="orthographic"===proj,setSlabAndFog()},this.setViewStyle=function(parameters){if("outline"===parameters.style){var params={};parameters.color&&(params.color=$3Dmol.CC.color(parameters.color)),parameters.width&&(params.width=parameters.width),renderer.enableOutline(params)}else renderer.disableOutline();return this},config.style&&this.setViewStyle(config),this.setWidth=function(w){return WIDTH=w||WIDTH,renderer.setSize(WIDTH,HEIGHT),this},this.setHeight=function(h){return HEIGHT=h||HEIGHT,renderer.setSize(WIDTH,HEIGHT),this},this.resize=function(){return WIDTH=getWidth(),HEIGHT=getHeight(),ASPECT=renderer.getAspect(WIDTH,HEIGHT),renderer.setSize(WIDTH,HEIGHT),camera.aspect=ASPECT,camera.updateProjectionMatrix(),show(),this},$(window).resize(this.resize),void 0!==typeof window.ResizeObserver)&&new window.ResizeObserver(this.resize).observe(container[0]);this.getModel=function(id){return void 0===id?0==models.length?null:models[models.length-1]:id instanceof $3Dmol.GLModel?id:id in models?models[id]:0==models.length?null:models[models.length-1]};var slerp=function(v0,v1,t){if(1==t)return v1;if(0==t)return v0;var dot=v0.x*v1.x+v0.y*v1.y+v0.z*v1.z+v0.w*v1.w;if(dot>.9995){var result=new $3Dmol.Quaternion(v0.x+t*(v1.x-v0.x),v0.y+t*(v1.y-v0.y),v0.z+t*(v1.z-v0.z),v0.w+t*(v1.w-v0.w));return result.normalize(),result}dot<0&&(v1=v1.clone().multiplyScalar(-1),dot=-dot),dot>1?dot=1:dot<-1&&(dot=-1);var theta_0,theta=Math.acos(dot)*t,v2=v1.clone();v2.sub(v0.clone().multiplyScalar(dot)),v2.normalize();var c=Math.cos(theta),s=Math.sin(theta),ret=new $3Dmol.Quaternion(v0.x*c+v2.x*s,v0.y*c+v2.y*s,v0.z*c+v2.z*s,v0.w*c+v2.w*s);return ret.normalize(),ret},spinInterval;this.spin=function(axis){if(clearInterval(spinInterval),void 0===axis&&(axis="y"),"boolean"==typeof axis){if(!axis)return;axis="y"}Array.isArray(axis)&&(axis={x:axis[0],y:axis[1],z:axis[2]});var viewer=this;spinInterval=setInterval((function(){viewer.rotate(1,axis)}),25)};var animateMotion=function(duration,fixed,mpos,rz,rot,cam){var interval=20,steps=Math.ceil(duration/20);steps<1&&(steps=1),incAnim();var curr={mpos:modelGroup.position.clone(),rz:rotationGroup.position.z,rot:rotationGroup.quaternion.clone(),cam:lookingAt.clone()};if(fixed){for(var n=(steps=new Array(steps)).length,i=0;i<n;i++){let frac=(i+1)/n,next={mpos:curr.mpos,rz:curr.rz,rot:curr.rot};mpos&&(next.mpos=mpos.clone().sub(curr.mpos).multiplyScalar(frac).add(curr.mpos)),void 0!==rz&&null!=rz&&(next.rz=curr.rz+frac*(rz-curr.rz)),rot&&(next.rot=slerp(curr.rot,rot,frac)),cam&&(next.cam=cam.clone().sub(curr.cam).multiplyScalar(frac).add(curr.cam)),steps[i]=next}let step=0,callback=function(){var p=steps[step];step+=1,p.mpos&&(modelGroup.position=p.mpos),p.rz&&(rotationGroup.position.z=p.rz),p.rot&&(rotationGroup.quaternion=p.rot),p.cam&&camera.lookAt(p.cam),step<steps.length?setTimeout(callback,20):decAnim(),show()};setTimeout(callback,20)}else{var delta={};let frac=1/steps;if(mpos&&(delta.mpos=mpos.clone().sub(curr.mpos).multiplyScalar(frac)),void 0!==rz&&null!=rz&&(delta.rz=frac*(rz-curr.rz)),rot){var next=slerp(curr.rot,rot,frac);delta.rot=curr.rot.clone().inverse().multiply(next)}cam&&(delta.cam=cam.clone().sub(curr.cam).multiplyScalar(frac));let step=0,callback=function(){step+=1,delta.mpos&&modelGroup.position.add(delta.mpos),delta.rz&&(rotationGroup.position.z+=delta.rz),delta.rot&&rotationGroup.quaternion.multiply(delta.rot),delta.cam&&(lookingAt.add(delta.cam),camera.lookAt(lookingAt)),step<steps?setTimeout(callback,20):decAnim(),show()};setTimeout(callback,20)}};function getModelList(sel){var ms=[];if(void 0===sel||void 0===sel.model)for(let i=0;i<models.length;i++)models[i]&&ms.push(models[i]);else{ms=sel.model,Array.isArray(ms)||(ms=[ms]);for(let i=0;i<ms.length;i++)if("number"==typeof ms[i]){var index=ms[i];index<0&&(index+=models.length),ms[i]=models[index]}}return ms}function getAtomsFromSel(sel){var atoms=[];void 0===sel&&(sel={});for(var ms=getModelList(sel),i=0;i<ms.length;i++)atoms=atoms.concat(ms[i].selectedAtoms(sel));return atoms}function atomIsSelected(atom,sel){void 0===sel&&(sel={});for(var ms=getModelList(sel),i=0;i<ms.length;i++)if(ms[i].atomIsSelected(atom,sel))return!0;return!1}this.rotate=function(angle,axis,animationDuration,fixedPath){if(animationDuration=void 0!==animationDuration?animationDuration:0,void 0===axis&&(axis="y"),"x"==axis?axis={x:1,y:0,z:0}:"y"==axis?axis={x:0,y:1,z:0}:"z"==axis&&(axis={x:0,y:0,z:1}),"vx"==axis?axis={vx:1,vy:0,vz:0}:"vy"==axis?axis={vx:0,vy:1,vz:0}:"vz"==axis&&(axis={vx:0,vy:0,vz:1}),void 0!==axis.vx){var vaxis=new $3Dmol.Vector3(axis.vx,axis.vy,axis.vz);vaxis.applyQuaternion(rotationGroup.quaternion),axis={x:vaxis.x,y:vaxis.y,z:vaxis.z}}var qFromAngle,rangle,q=function(rangle){var s=Math.sin(rangle/2),c=Math.cos(rangle/2),i=0,j=0,k=0;return i=axis.x*s,j=axis.y*s,k=axis.z*s,new $3Dmol.Quaternion(i,j,k,c).normalize()}(Math.PI*angle/180);if(animationDuration){var final=(new $3Dmol.Quaternion).copy(rotationGroup.quaternion).multiply(q);animateMotion(animationDuration,fixedPath,modelGroup.position,rotationGroup.position.z,final,lookingAt)}else rotationGroup.quaternion.multiply(q),show();return this},this.surfacesFinished=function(){for(var key in surfaces)if(!surfaces[key][0].done)return!1;return!0},this.getView=function(){if(!modelGroup)return[0,0,0,0,0,0,0,1];var pos=modelGroup.position,q=rotationGroup.quaternion;return[pos.x,pos.y,pos.z,rotationGroup.position.z,q.x,q.y,q.z,q.w]},this.setView=function(arg,nolink){return void 0!==arg&&(arg instanceof Array||8!==arg.length)&&modelGroup&&rotationGroup?(modelGroup.position.x=arg[0],modelGroup.position.y=arg[1],modelGroup.position.z=arg[2],rotationGroup.position.z=arg[3],rotationGroup.quaternion.x=arg[4],rotationGroup.quaternion.y=arg[5],rotationGroup.quaternion.z=arg[6],rotationGroup.quaternion.w=arg[7],void 0!==arg[8]&&(rotationGroup.position.x=arg[8],rotationGroup.position.y=arg[9]),show(nolink),this):this},this.render=function(callback,exts){renderer.setViewport(),updateClickables();var view=this.getView(),i,n;for(stateChangeCallback&&stateChangeCallback(this.getInternalState()),exts||(exts=renderer.supportedExtensions()),i=0;i<models.length;i++)models[i]&&models[i].globj(modelGroup,exts);for(i=0;i<shapes.length;i++)shapes[i]&&(void 0===shapes[i].frame||viewer_frame<0||shapes[i].frame<0||shapes[i].frame==viewer_frame?shapes[i].globj(modelGroup,exts):shapes[i].removegl(modelGroup));for(i=0;i<labels.length;i++)labels[i]&&void 0!==labels[i].frame&&labels[i].frame>=0&&(modelGroup.remove(labels[i].sprite),(viewer_frame<0||labels[i].frame==viewer_frame)&&modelGroup.add(labels[i].sprite));for(i in surfaces)if(surfaces.hasOwnProperty(i)){var surfArr=surfaces[i];for(n=0;n<surfArr.length;n++)if(surfArr.hasOwnProperty(n)){var geo=surfArr[n].geo;if(!surfArr[n].finished||exts.regen){geo.verticesNeedUpdate=!0,geo.elementsNeedUpdate=!0,geo.normalsNeedUpdate=!0,geo.colorsNeedUpdate=!0,geo.buffersNeedUpdate=!0,geo.boundingSphere=null,surfArr[n].done&&(surfArr[n].finished=!0),surfArr[n].lastGL&&modelGroup.remove(surfArr[n].lastGL);var smesh=null;if(smesh=surfArr[n].mat instanceof $3Dmol.LineBasicMaterial?new $3Dmol.Line(geo,surfArr[n].mat):new $3Dmol.Mesh(geo,surfArr[n].mat),surfArr[n].mat.transparent&&0==surfArr[n].mat.opacity?smesh.visible=!1:smesh.visible=!0,surfArr[n].symmetries.length>1||1==surfArr[n].symmetries.length&&!surfArr[n].symmetries[n].isIdentity()){var j,tmeshes=new $3Dmol.Object3D;for(j=0;j<surfArr[n].symmetries.length;j++){var tmesh=smesh.clone();tmesh.matrix=surfArr[n].symmetries[j],tmesh.matrixAutoUpdate=!1,tmeshes.add(tmesh)}surfArr[n].lastGL=tmeshes,modelGroup.add(tmeshes)}else surfArr[n].lastGL=smesh,modelGroup.add(smesh)}}}return this.setView(view),"function"==typeof callback&&callback(this),this},this.selectedAtoms=function(sel){return getAtomsFromSel(sel)},this.getUniqueValues=function(attribute,sel){void 0===sel&&(sel={});var atoms=getAtomsFromSel(sel),values={};for(var atom in atoms){var value;if(atoms[atom].hasOwnProperty(attribute))values[atoms[atom][attribute]]=!0}return Object.keys(values)},this.pdbData=function(sel){for(var atoms=getAtomsFromSel(sel),ret="",i=0,n=atoms.length;i<n;++i)ret+=atoms[i].pdbline+"\n";return ret},this.zoom=function(factor,animationDuration,fixedPath){factor=factor||2,animationDuration=void 0!==animationDuration?animationDuration:0;var scale,final_z=150-(150-rotationGroup.position.z)/factor;return animationDuration>0?animateMotion(animationDuration,fixedPath,modelGroup.position,adjustZoomToLimits(final_z),rotationGroup.quaternion,lookingAt):(rotationGroup.position.z=adjustZoomToLimits(final_z),show()),this},this.translate=function(x,y,animationDuration,fixedPath){animationDuration=void 0!==animationDuration?animationDuration:0;var dx=x/WIDTH,dy=y/HEIGHT,v=new $3Dmol.Vector3(0,0,-150);projector.projectVector(v,camera),v.x-=dx,v.y-=dy,projector.unprojectVector(v,camera),v.z=0;var final_position=lookingAt.clone().add(v);return animationDuration>0?animateMotion(animationDuration,fixedPath,modelGroup.position,rotationGroup.position.z,rotationGroup.quaternion,final_position):(lookingAt=final_position,camera.lookAt(lookingAt),show()),this},this.translateScene=function(x,y,animationDuration,fixedPath){animationDuration=void 0!==animationDuration?animationDuration:0;var t=screenXY2model(x,y),final_position=modelGroup.position.clone().add(t);return animationDuration>0?animateMotion(animationDuration,fixedPath,modelGroup.position,rotationGroup.position.z,rotationGroup.quaternion,lookingAt):(modelGroup.position=final_position,show()),this},this.fitSlab=function(sel){var atoms=getAtomsFromSel(sel=sel||{}),tmp=$3Dmol.getExtent(atoms),x=tmp[1][0]-tmp[0][0],y=tmp[1][1]-tmp[0][1],z=tmp[1][2]-tmp[0][2],maxD=Math.sqrt(x*x+y*y+z*z);return maxD<5&&(maxD=5),slabNear=-maxD/1.9,slabFar=maxD/2,this},this.center=function(sel,animationDuration,fixedPath){var allatoms,alltmp;animationDuration=void 0!==animationDuration?animationDuration:0;var atoms=getAtomsFromSel(sel=sel||{}),tmp=$3Dmol.getExtent(atoms);$3Dmol.isEmptyObject(sel)?(shapes.forEach(shape=>{if(shape&&shape.boundingSphere&&shape.boundingSphere.center){var c=shape.boundingSphere.center,r=shape.boundingSphere.radius;r>0?(atoms.push(new $3Dmol.Vector3(c.x+r,c.y,c.z)),atoms.push(new $3Dmol.Vector3(c.x-r,c.y,c.z)),atoms.push(new $3Dmol.Vector3(c.x,c.y+r,c.z)),atoms.push(new $3Dmol.Vector3(c.x,c.y-r,c.z)),atoms.push(new $3Dmol.Vector3(c.x,c.y,c.z+r)),atoms.push(new $3Dmol.Vector3(c.x,c.y,c.z-r))):atoms.push(c)}}),tmp=$3Dmol.getExtent(atoms),allatoms=atoms,alltmp=tmp):(allatoms=getAtomsFromSel({}),alltmp=$3Dmol.getExtent(allatoms));var center=new $3Dmol.Vector3(tmp[2][0],tmp[2][1],tmp[2][2]),x=alltmp[1][0]-alltmp[0][0],y=alltmp[1][1]-alltmp[0][1],z=alltmp[1][2]-alltmp[0][2],maxD=Math.sqrt(x*x+y*y+z*z);maxD<5&&(maxD=5),slabNear=-maxD/1.9,slabFar=maxD/2,x=tmp[1][0]-tmp[0][0],y=tmp[1][1]-tmp[0][1],z=tmp[1][2]-tmp[0][2],(maxD=Math.sqrt(x*x+y*y+z*z))<5&&(maxD=5);for(var maxDsq=25,i=0;i<atoms.length;i++)if(atoms[i]){var dsq=center.distanceToSquared(atoms[i]);dsq>maxDsq&&(maxDsq=dsq)}maxD=2*Math.sqrt(maxDsq);var finalpos=center.clone().multiplyScalar(-1);return animationDuration>0?animateMotion(animationDuration,fixedPath,finalpos,rotationGroup.position.z,rotationGroup.quaternion,lookingAt):(modelGroup.position=finalpos,show()),this},this.zoomTo=function(sel,animationDuration,fixedPath){var allatoms,alltmp;animationDuration=void 0!==animationDuration?animationDuration:0;var atoms=getAtomsFromSel(sel=sel||{}),tmp=$3Dmol.getExtent(atoms);$3Dmol.isEmptyObject(sel)?(shapes.forEach(shape=>{if(shape&&shape.boundingSphere&&shape.boundingSphere.center){var c=shape.boundingSphere.center,r=shape.boundingSphere.radius;r>0?(atoms.push(new $3Dmol.Vector3(c.x+r,c.y,c.z)),atoms.push(new $3Dmol.Vector3(c.x-r,c.y,c.z)),atoms.push(new $3Dmol.Vector3(c.x,c.y+r,c.z)),atoms.push(new $3Dmol.Vector3(c.x,c.y-r,c.z)),atoms.push(new $3Dmol.Vector3(c.x,c.y,c.z+r)),atoms.push(new $3Dmol.Vector3(c.x,c.y,c.z-r))):atoms.push(c)}}),tmp=$3Dmol.getExtent(atoms),allatoms=atoms,alltmp=tmp):(allatoms=getAtomsFromSel({}),alltmp=$3Dmol.getExtent(allatoms));var center=new $3Dmol.Vector3(tmp[2][0],tmp[2][1],tmp[2][2]),x=alltmp[1][0]-alltmp[0][0],y=alltmp[1][1]-alltmp[0][1],z=alltmp[1][2]-alltmp[0][2],maxD=Math.sqrt(x*x+y*y+z*z);maxD<5&&(maxD=5),slabNear=-maxD/1.9,slabFar=maxD/2,0===Object.keys(sel).length&&(slabNear=-999999,slabFar=999999);var MAXD=config.minimumZoomToDistance||5;x=tmp[1][0]-tmp[0][0],y=tmp[1][1]-tmp[0][1],z=tmp[1][2]-tmp[0][2],(maxD=Math.sqrt(x*x+y*y+z*z))<MAXD&&(maxD=MAXD);for(var maxDsq=MAXD*MAXD,i=0;i<atoms.length;i++)if(atoms[i]){var dsq=center.distanceToSquared(atoms[i]);dsq>maxDsq&&(maxDsq=dsq)}maxD=2*Math.sqrt(maxDsq);var finalpos=center.clone().multiplyScalar(-1),finalz=-(.5*maxD/Math.tan(Math.PI/180*camera.fov/2)-150);return finalz=adjustZoomToLimits(finalz),animationDuration>0?animateMotion(animationDuration,fixedPath,finalpos,finalz,rotationGroup.quaternion,lookingAt):(modelGroup.position=finalpos,rotationGroup.position.z=finalz,show()),this},this.setSlab=function(near,far){slabNear=near,slabFar=far},this.getSlab=function(){return{near:slabNear,far:slabFar}},this.addLabel=function(text,options,sel,noshow){if(options=options||{},sel){var extent=$3Dmol.getExtent(getAtomsFromSel(sel));options.position={x:extent[2][0],y:extent[2][1],z:extent[2][2]}}var label=new $3Dmol.Label(text,options);return label.setContext(),modelGroup.add(label.sprite),options.fixed&&fixed_labels.push(labels.length),labels.push(label),noshow||show(),label},this.addResLabels=function(sel,style,byframe){let start=labels.length;return applyToModels("addResLabels",sel,this,style,byframe),show(),labels.slice(start)},this.addPropertyLabels=function(prop,sel,style){return applyToModels("addPropertyLabels",prop,sel,this,style),show(),this},this.removeLabel=function(label){for(var i=0;i<labels.length;i++)if(labels[i]==label){labels.splice(i,1),label.dispose(),modelGroup.remove(label.sprite);break}return show(),this},this.removeAllLabels=function(){for(var i=0;i<labels.length;i++)labels[i]&&labels[i].sprite&&modelGroup.remove(labels[i].sprite);return labels.splice(0,labels.length),show(),this},this.setLabelStyle=function(label,stylespec){return modelGroup.remove(label.sprite),label.dispose(),label.stylespec=stylespec,label.setContext(),modelGroup.add(label.sprite),show(),label},this.setLabelText=function(label,text){return modelGroup.remove(label.sprite),label.dispose(),label.text=text,label.setContext(),modelGroup.add(label.sprite),show(),label},this.addShape=function(shapeSpec){shapeSpec=shapeSpec||{};var shape=new $3Dmol.GLShape(shapeSpec);return shape.shapePosition=shapes.length,shapes.push(shape),shape},this.removeShape=function(shape){if(!shape)return this;for(shape.removegl(modelGroup),delete shapes[shape.shapePosition];shapes.length>0&&void 0===shapes[shapes.length-1];)shapes.pop();return this},this.removeAllShapes=function(){for(var i=0;i<shapes.length;i++){var shape=shapes[i];shape&&shape.removegl(modelGroup)}return shapes.splice(0,shapes.length),this};var getSelectionCenter=function(spec){if(spec.hasOwnProperty("x")&&spec.hasOwnProperty("y")&&spec.hasOwnProperty("z"))return spec;var atoms=getAtomsFromSel(spec);if(0==atoms.length)return{x:0,y:0,z:0};var extent=$3Dmol.getExtent(atoms);return{x:extent[0][0]+(extent[1][0]-extent[0][0])/2,y:extent[0][1]+(extent[1][1]-extent[0][1])/2,z:extent[0][2]+(extent[1][2]-extent[0][2])/2}};function addLineDashed(spec,s){spec.dashLength=spec.dashLength||.5,spec.gapLength=spec.gapLength||.5,spec.start=spec.start||{},spec.end=spec.end||{};var p1=new $3Dmol.Vector3(spec.start.x||0,spec.start.y||0,spec.start.z||0),p2=new $3Dmol.Vector3(spec.end.x,spec.end.y||0,spec.end.z||0),dir=new $3Dmol.Vector3,dash=new $3Dmol.Vector3,gap=new $3Dmol.Vector3,length,dashAmt,gapAmt,temp=p1.clone(),drawn=0;for(dir.subVectors(p2,p1),length=dir.length(),dir.normalize(),dash=dir.clone(),gap=dir.clone(),dash.multiplyScalar(spec.dashLength),gap.multiplyScalar(spec.gapLength),dashAmt=dash.length(),gapAmt=gap.length();drawn<length;){if(drawn+dashAmt>length){spec.start=p1,spec.end=p2,s.addLine(spec);break}temp.addVectors(p1,dash),spec.start=p1,spec.end=temp,s.addLine(spec),p1=temp.clone(),drawn+=dashAmt,temp.addVectors(p1,gap),p1=temp.clone(),drawn+=gapAmt}return s.finalize(),s}function applyToModels(func,sel,value1,value2,value3,value4,value5){for(var ms=getModelList(sel),i=0;i<ms.length;i++)ms[i][func](sel,value1,value2,value3,value4,value5)}this.addSphere=function(spec){(spec=spec||{}).center=getSelectionCenter(spec.center);var s=new $3Dmol.GLShape(spec);return s.shapePosition=shapes.length,s.addSphere(spec),shapes.push(s),s.finalize(),s},this.addBox=function(spec){null!=(spec=spec||{}).corner&&(spec.corner=getSelectionCenter(spec.corner)),null!=spec.center&&(spec.center=getSelectionCenter(spec.center));var s=new $3Dmol.GLShape(spec);return s.shapePosition=shapes.length,s.addBox(spec),shapes.push(s),s.finalize(),s},this.addArrow=function(spec){(spec=spec||{}).start=getSelectionCenter(spec.start),spec.end=getSelectionCenter(spec.end);var s=new $3Dmol.GLShape(spec);return s.shapePosition=shapes.length,s.addArrow(spec),shapes.push(s),s.finalize(),s},this.addCylinder=function(spec){(spec=spec||{}).start=getSelectionCenter(spec.start),spec.end=getSelectionCenter(spec.end);var s=new $3Dmol.GLShape(spec);return s.shapePosition=shapes.length,spec.dashed?s.addDashedCylinder(spec):s.addCylinder(spec),shapes.push(s),s.finalize(),s},this.addCurve=function(spec){spec=spec||{};var s=new $3Dmol.GLShape(spec);return s.shapePosition=shapes.length,s.addCurve(spec),shapes.push(s),s.finalize(),s},this.addLine=function(spec){(spec=spec||{}).start=getSelectionCenter(spec.start),spec.end=getSelectionCenter(spec.end),spec.wireframe=!0;var s=new $3Dmol.GLShape(spec);return s.shapePosition=shapes.length,spec.dashed?s=addLineDashed(spec,s):s.addLine(spec),shapes.push(s),s.finalize(),s},this.addUnitCell=function(model,spec){model=this.getModel(model),(spec=spec||{alabel:"a",blabel:"b",clabel:"c"}).box=spec.box||{},spec.astyle=spec.astyle||{color:"red",radius:.1,midpos:-1},spec.bstyle=spec.bstyle||{color:"green",radius:.1,midpos:-1},spec.cstyle=spec.cstyle||{color:"blue",radius:.1,midpos:-1},spec.alabelstyle=spec.alabelstyle||{fontColor:"red",showBackground:!1,alignment:"center",inFront:!1},spec.blabelstyle=spec.blabelstyle||{fontColor:"green",showBackground:!1,alignment:"center",inFront:!1},spec.clabelstyle=spec.clabelstyle||{fontColor:"blue",showBackground:!1,alignment:"center",inFront:!1},model.unitCellObjects&&this.removeUnitCell(model),model.unitCellObjects={shapes:[],labels:[]};var data=model.getCrystData(),matrix=null;if(data){if(data.matrix)matrix=data.matrix;else{var a=data.a,b=data.b,c=data.c,alpha=data.alpha,beta=data.beta,gamma=data.gamma,u,v,w;alpha=alpha*Math.PI/180,beta=beta*Math.PI/180,gamma=gamma*Math.PI/180,u=Math.cos(beta),v=(Math.cos(alpha)-Math.cos(beta)*Math.cos(gamma))/Math.sin(gamma),w=Math.sqrt(Math.max(0,1-u*u-v*v)),matrix=new $3Dmol.Matrix3(a,b*Math.cos(gamma),c*u,0,b*Math.sin(gamma),c*v,0,0,c*w)}for(var points=[new $3Dmol.Vector3(0,0,0),new $3Dmol.Vector3(1,0,0),new $3Dmol.Vector3(0,1,0),new $3Dmol.Vector3(0,0,1),new $3Dmol.Vector3(1,1,0),new $3Dmol.Vector3(0,1,1),new $3Dmol.Vector3(1,0,1),new $3Dmol.Vector3(1,1,1)],i=0;i<points.length;i++)points[i]=points[i].applyMatrix3(matrix);if(spec.box&&!spec.box.hidden){spec.box.wireframe=!0;var s=new $3Dmol.GLShape(spec.box);s.shapePosition=shapes.length,s.addLine({start:points[0],end:points[1]}),s.addLine({start:points[0],end:points[2]}),s.addLine({start:points[1],end:points[4]}),s.addLine({start:points[2],end:points[4]}),s.addLine({start:points[0],end:points[3]}),s.addLine({start:points[3],end:points[5]}),s.addLine({start:points[2],end:points[5]}),s.addLine({start:points[1],end:points[6]}),s.addLine({start:points[4],end:points[7]}),s.addLine({start:points[6],end:points[7]}),s.addLine({start:points[3],end:points[6]}),s.addLine({start:points[5],end:points[7]}),shapes.push(s),model.unitCellObjects.shapes.push(s),s.finalize()}if(!spec.astyle.hidden){spec.astyle.start=points[0],spec.astyle.end=points[1];let arrow=this.addArrow(spec.astyle);model.unitCellObjects.shapes.push(arrow)}if(!spec.bstyle.hidden){spec.bstyle.start=points[0],spec.bstyle.end=points[2];let arrow=this.addArrow(spec.bstyle);model.unitCellObjects.shapes.push(arrow)}if(!spec.cstyle.hidden){spec.cstyle.start=points[0],spec.cstyle.end=points[3];let arrow=this.addArrow(spec.cstyle);model.unitCellObjects.shapes.push(arrow)}if(spec.alabel){spec.alabelstyle.position=points[1];let label=this.addLabel(spec.alabel,spec.alabelstyle);model.unitCellObjects.labels.push(label)}if(spec.blabel){spec.blabelstyle.position=points[2];let label=this.addLabel(spec.blabel,spec.blabelstyle);model.unitCellObjects.labels.push(label)}if(spec.clabel){spec.clabelstyle.position=points[3];let label=this.addLabel(spec.clabel,spec.clabelstyle);model.unitCellObjects.labels.push(label)}}},this.removeUnitCell=function(model){if((model=this.getModel(model)).unitCellObjects){let viewer=this;model.unitCellObjects.shapes.forEach((function(s){viewer.removeShape(s)})),model.unitCellObjects.labels.forEach((function(l){viewer.removeLabel(l)}))}delete model.unitCellObjects},this.replicateUnitCell=function(A,B,C,model){A=A||3,B=B||A,C=C||B;let cryst=(model=this.getModel(model)).getCrystData();if(cryst){const atoms=model.selectedAtoms({}),matrix=cryst.matrix;let makeoff=function(I){return I%2==0?-I/2:Math.ceil(I/2)};for(let i=0;i<A;i++)for(let j=0;j<B;j++)for(let k=0;k<C;k++){if(0==i&&0==j&&0==k)continue;let offset=new $3Dmol.Vector3(makeoff(i),makeoff(j),makeoff(k));offset.applyMatrix3(matrix);let newatoms=[];for(let a=0;a<atoms.length;a++){let newAtom={};for(let p in atoms[a])newAtom[p]=atoms[a][p];newAtom.x+=offset.x,newAtom.y+=offset.y,newAtom.z+=offset.z,newatoms.push(newAtom)}model.addAtoms(newatoms)}}},this.addCustom=function(spec){spec=spec||{};var s=new $3Dmol.GLShape(spec);return s.shapePosition=shapes.length,s.addCustom(spec),shapes.push(s),s.finalize(),s},this.addVolumetricData=function(data,format,spec){spec=spec||{};var voldata=new $3Dmol.VolumeData(data,format);return spec.transferfn?this.addVolumetricRender(voldata,spec):this.addIsosurface(voldata,spec)},this.addIsosurface=function(data,spec,callback){spec=spec||{};var s=new $3Dmol.GLShape(spec);return s.shapePosition=shapes.length,s.addIsosurface(data,spec,callback),shapes.push(s),s},this.addVolumetricRender=function(data,spec){spec=spec||{};var s=new $3Dmol.GLVolumetricRender(data,spec);return s.shapePosition=shapes.length,shapes.push(s),s},this.hasVolumetricRender=function(){return renderer.supportsVolumetric()},this.enableFog=function(fog){fog?scene.fog=new $3Dmol.Fog(bgColor,100,200):(config.disableFog=!0,show())},this.setFrame=function(framenum){viewer_frame=framenum;let viewer=this;return new Promise((function(resolve){var modelMap=models.map((function(model){return model.setFrame(framenum,viewer)}));Promise.all(modelMap).then((function(){resolve()}))}))},this.getFrame=function(){return viewer_frame},this.getNumFrames=function(){var mostFrames=0;for(let i=0;i<models.length;i++)models[i].getNumFrames()>mostFrames&&(mostFrames=models[i].getNumFrames());for(let i=0;i<shapes.length;i++)shapes[i].frame&&shapes[i].frame>=mostFrames&&(mostFrames=shapes[i].frame+1);for(let i=0;i<labels.length;i++)labels[i].frame&&labels[i].frame>=mostFrames&&(mostFrames=labels[i].frame+1);return mostFrames},this.animate=function(options){incAnim();var interval=100,loop="forward",reps=0;(options=options||{}).interval&&(interval=options.interval),options.loop&&(loop=options.loop),options.reps&&(reps=options.reps);var mostFrames=this.getNumFrames(),that=this,currFrame=0,inc=1;options.step&&(reps/=inc=options.step);var displayCount=0,displayMax=mostFrames*reps,time=new Date,resolve,intervalID,display=function(direction){time=new Date,"forward"==direction?that.setFrame(currFrame).then((function(){currFrame=(currFrame+inc)%mostFrames,resolve()})):"backward"==direction?that.setFrame(mostFrames-1-currFrame).then((function(){currFrame=(currFrame+inc)%mostFrames,resolve()})):that.setFrame(currFrame).then((function(){inc*=(currFrame+=inc)%(mostFrames-1)==0?-1:1,resolve()}))};return resolve=function(){if(that.render(),++displayCount!=displayMax&&that.isAnimated()){var newInterval=interval-(new Date-time);newInterval=newInterval>0?newInterval:0,animationTimers.delete(intervalID),intervalID=setTimeout(display,newInterval,loop),animationTimers.add(intervalID)}else clearTimeout(intervalID),animationTimers.delete(intervalID),decAnim()},intervalID=setTimeout(display,0,loop),animationTimers.add(intervalID),this},this.stopAnimate=function(){return animated=0,animationTimers.forEach((function(timer){clearTimeout(timer)})),animationTimers=new Set,this},this.isAnimated=function(){return animated>0},this.addModel=function(data,format,options){options&&!options.defaultcolors?(options.defaultcolors=defaultcolors,options.cartoonQuality=config.cartoonQuality):void 0===options&&(options={defaultcolors:defaultcolors,cartoonQuality:config.cartoonQuality});var m=new $3Dmol.GLModel(models.length,options);return m.addMolData(data,format,options),models.push(m),m},this.addModels=function(data,format,options){(options=options||{}).multimodel=!0,options.frames=!0;for(var modelatoms=$3Dmol.GLModel.parseMolData(data,format,options),i=0;i<modelatoms.length;i++){var newModel=new $3Dmol.GLModel(models.length,defaultcolors);newModel.setAtomDefaults(modelatoms[i]),newModel.addFrame(modelatoms[i]),newModel.setFrame(0),modelatoms.modelData&&newModel.setModelData(modelatoms.modelData[i]),newModel.setDontDuplicateAtoms(!options.duplicateAssemblyAtoms),models.push(newModel)}return models},this.addModelsAsFrames=function(data,format,options){(options=options||{}).multimodel=!0,options.frames=!0;var m=new $3Dmol.GLModel(models.length,defaultcolors);return m.addMolData(data,format,options),models.push(m),m},this.addAsOneMolecule=function(data,format,options){(options=options||{}).multimodel=!0,options.onemol=!0;var m=new $3Dmol.GLModel(models.length,defaultcolors);return m.addMolData(data,format,options),models.push(m),m},this.removeModel=function(model){if(model=this.getModel(model)){for(model.removegl(modelGroup),delete models[model.getID()];models.length>0&&void 0===models[models.length-1];)models.pop();return this}},this.removeAllModels=function(){for(var i=0;i<models.length;i++){var model=models[i];model&&model.removegl(modelGroup)}return models.splice(0,models.length),this},this.exportJSON=function(includeStyles,modelID){var object={};return object.m=void 0===modelID?models.map((function(model){return model.toCDObject(includeStyles)})):[models[modelID].toCDObject()],JSON.stringify(object)},this.exportVRML=function(){var savedmodelGroup=modelGroup;applyToModels("removegl",modelGroup),modelGroup=new $3Dmol.Object3D,this.render(null,{supportsImposters:!1,supportsAIA:!1,regen:!0});var ret="#VRML V2.0 utf8\n"+modelGroup.vrml()+"\n";return applyToModels("removegl",modelGroup),modelGroup=savedmodelGroup,ret},this.createModelFrom=function(sel,extract){for(var m=new $3Dmol.GLModel(models.length,defaultcolors),i=0;i<models.length;i++)if(models[i]){var atoms=models[i].selectedAtoms(sel);m.addAtoms(atoms),extract&&models[i].removeAtoms(atoms)}return models.push(m),m},this.setStyle=function(sel,style){return void 0===style&&(style=sel,sel={}),applyToModels("setStyle",sel,style,!1),this},this.addStyle=function(sel,style){return void 0===style&&(style=sel,sel={}),applyToModels("setStyle",sel,style,!0),this},this.setClickable=function(sel,clickable,callback){return applyToModels("setClickable",sel,clickable,callback),this},this.setHoverable=function(sel,hoverable,hover_callback,unhover_callback){return applyToModels("setHoverable",sel,hoverable,hover_callback,unhover_callback),this},this.vibrate=function(numFrames,amplitude,bothways,arrowSpec){return applyToModels("vibrate",numFrames,amplitude,bothways,this,arrowSpec),this},this.setColorByProperty=function(sel,prop,scheme,range){return applyToModels("setColorByProperty",sel,prop,scheme,range),this},this.setColorByElement=function(sel,colors){return applyToModels("setColorByElement",sel,colors),this};var getAtomsWithin=function(atomlist,extent){for(var ret=[],i=0;i<atomlist.length;i++){var atom=atomlist[i];void 0!==atom&&(atom.x<extent[0][0]||atom.x>extent[1][0]||atom.y<extent[0][1]||atom.y>extent[1][1]||atom.z<extent[0][2]||atom.z>extent[1][2]||ret.push(atom))}return ret},volume=function(extent){var w,h,d;return(extent[1][0]-extent[0][0])*(extent[1][1]-extent[0][1])*(extent[1][2]-extent[0][2])},carveUpExtent=function(extent,atomlist,atomstoshow){for(var ret=[],index2atomlist={},i=0,n=atomlist.length;i<n;i++)index2atomlist[atomlist[i].index]=i;var atomsToListIndex=function(atoms){for(var ret=[],i=0,n=atoms.length;i<n;i++)atoms[i].index in index2atomlist&&ret.push(index2atomlist[atoms[i].index]);return ret},copyExtent=function(extent){var ret=[];return ret[0]=[extent[0][0],extent[0][1],extent[0][2]],ret[1]=[extent[1][0],extent[1][1],extent[1][2]],ret},splitExtentR=function(extent){if(volume(extent)<64e3)return[extent];var w=extent[1][0]-extent[0][0],h=extent[1][1]-extent[0][1],d=extent[1][2]-extent[0][2],index;index=w>h&&w>d?0:h>w&&h>d?1:2;var a=copyExtent(extent),b=copyExtent(extent),mid=(extent[1][index]-extent[0][index])/2+extent[0][index];a[1][index]=mid,b[0][index]=mid;var alist=splitExtentR(a),blist=splitExtentR(b);return alist.concat(blist)},splits=splitExtentR(extent),off=6;for(let i=0,n=splits.length;i<n;i++){let e=copyExtent(splits[i]);e[0][0]-=6,e[0][1]-=6,e[0][2]-=6,e[1][0]+=6,e[1][1]+=6,e[1][2]+=6;var atoms=getAtomsWithin(atomlist,e),toshow=getAtomsWithin(atomstoshow,splits[i]);ret.push({extent:splits[i],atoms:atomsToListIndex(atoms),toshow:atomsToListIndex(toshow)})}return ret},generateSurfaceMesh=function(atoms,VandF,mat){var geo=new $3Dmol.Geometry(!0),geoGroup=geo.updateGeoGroup(0),colors=[];for(let i=0,il=atoms.length;i<il;i++){var atom=atoms[i];atom&&(void 0!==atom.surfaceColor?colors[i]=atom.surfaceColor:atom.color&&(colors[i]=$3Dmol.CC.color(atom.color)))}var vertexArray=geoGroup.vertexArray,v=VandF.vertices;for(let i=0,il=v.length;i<il;i++){let offset=3*geoGroup.vertices;vertexArray[offset]=v[i].x,vertexArray[offset+1]=v[i].y,vertexArray[offset+2]=v[i].z,geoGroup.vertices++}var colorArray=geoGroup.colorArray;if(mat.voldata&&mat.volscheme){var scheme=mat.volscheme,voldata=mat.voldata,range=scheme.range()||[-1,1];for(let i=0,il=v.length;i<il;i++){let val=voldata.getVal(v[i].x,v[i].y,v[i].z),col=$3Dmol.CC.color(scheme.valueToHex(val,range)),offset=3*i;colorArray[offset]=col.r,colorArray[offset+1]=col.g,colorArray[offset+2]=col.b}}else if(colors.length>0)for(let i=0,il=v.length;i<il;i++){let A=v[i].atomid,offsetA=3*i;colorArray[offsetA]=colors[A].r,colorArray[offsetA+1]=colors[A].g,colorArray[offsetA+2]=colors[A].b}var faces=VandF.faces;geoGroup.faceidx=faces.length,geo.initTypedArrays();var verts=geoGroup.vertexArray,normalArray=geoGroup.normalArray,vA,vB,vC,norm;for(let i=0,il=faces.length;i<il;i+=3){var a,b,c,offsetA=3*faces[i],offsetB=3*faces[i+1],offsetC=3*faces[i+2];vA=new $3Dmol.Vector3(verts[offsetA],verts[offsetA+1],verts[offsetA+2]),vB=new $3Dmol.Vector3(verts[offsetB],verts[offsetB+1],verts[offsetB+2]),(vC=new $3Dmol.Vector3(verts[offsetC],verts[offsetC+1],verts[offsetC+2])).subVectors(vC,vB),vA.subVectors(vA,vB),vC.cross(vA),(norm=vC).normalize(),normalArray[offsetA]+=norm.x,normalArray[offsetB]+=norm.x,normalArray[offsetC]+=norm.x,normalArray[offsetA+1]+=norm.y,normalArray[offsetB+1]+=norm.y,normalArray[offsetC+1]+=norm.y,normalArray[offsetA+2]+=norm.z,normalArray[offsetB+2]+=norm.z,normalArray[offsetC+2]+=norm.z}geoGroup.faceArray=new Uint16Array(faces);var mesh=new $3Dmol.Mesh(geo,mat);return mesh.doubleSided=!0,mesh},generateMeshSyncHelper=function(type,expandedExtent,extendedAtoms,atomsToShow,atoms,vol){var ps=new $3Dmol.ProteinSurface;return ps.initparm(expandedExtent,1!==type,vol),ps.fillvoxels(atoms,extendedAtoms),ps.buildboundary(),type!=$3Dmol.SurfaceType.SES&&type!=$3Dmol.SurfaceType.MS||(ps.fastdistancemap(),ps.boundingatom(!1),ps.fillvoxelswaals(atoms,extendedAtoms)),ps.marchingcube(type),ps.getFacesAndVertices(atomsToShow)};function getMatWithStyle(style){var mat=new $3Dmol.MeshLambertMaterial;for(var prop in mat.vertexColors=$3Dmol.VertexColors,style)"color"===prop||"map"===prop||style.hasOwnProperty(prop)&&(mat[prop]=style[prop]);return void 0!==style.opacity&&(1===style.opacity?mat.transparent=!1:mat.transparent=!0),mat}this.addMesh=function(mesh){var surfobj={geo:mesh.geometry,mat:mesh.material,done:!0,finished:!1},surfid=nextSurfID();return surfaces[surfid]=surfobj,surfid};var shallowCopy=function(l){var ret=[];let length=l.length;for(let i=0;i<length;i++)ret[i]=$3Dmol.extend({},l[i]);return ret},surfaceTypeMap={VDW:$3Dmol.SurfaceType.VDW,MS:$3Dmol.SurfaceType.MS,SAS:$3Dmol.SurfaceType.SAS,SES:$3Dmol.SurfaceType.SES},getGradient=function(grad){if(grad instanceof $3Dmol.Gradient)return grad;if(void 0!==grad.gradient&&$3Dmol.Gradient.builtinGradients[grad.gradient]){let min=void 0===grad.min?-1:grad.min,max=void 0===grad.max?1:grad.max;return void 0===grad.mid?new $3Dmol.Gradient.builtinGradients[grad.gradient](min,max):new $3Dmol.Gradient.builtinGradients[grad.gradient](min,max,grad.mid)}return grad};this.addSurface=function(type,style,atomsel,allsel,focus,surfacecallback){var surfid=nextSurfID(),mat=null;"string"==typeof type?void 0!==surfaceTypeMap[type]?type=surfaceTypeMap[type]:console.log("Surface type : "+type+" is not recognized"):void 0===type&&(type=$3Dmol.SurfaceType.VDW);var atomlist=null,focusSele=null,atomsToShow=shallowCopy(getAtomsFromSel(atomsel));atomlist=allsel?shallowCopy(getAtomsFromSel(allsel)):atomsToShow,!style||!style.volformat||style.voldata instanceof $3Dmol.VolumeData||(style.voldata=new $3Dmol.VolumeData(style.voldata,style.volformat)),style&&style.volscheme&&(style.volscheme=getGradient(style.volscheme));var symmetries=!1,n;for(n=0;n<models.length;n++)if(models[n]){var symMatrices=models[n].getSymmetries();if(symMatrices.length>1||1==symMatrices.length&&!symMatrices[0].isIdentity()){symmetries=!0;break}}var addSurfaceHelper=function addSurfaceHelper(surfobj,atomlist,atomsToShow){var atom;focusSele=focus?shallowCopy(getAtomsFromSel(focus)):atomsToShow;var extent=$3Dmol.getExtent(atomsToShow,!0);if(style.map&&style.map.prop){var prop=style.map.prop,scheme=style.map.scheme||style.map.gradient||new $3Dmol.Gradient.RWB,range=scheme.range();range||(range=$3Dmol.getPropertyRange(atomsToShow,prop)),style.colorscheme={prop:prop,gradient:scheme}}for(let i=0,il=atomlist.length;i<il;i++)(atom=atomlist[i]).surfaceColor=$3Dmol.getColorFromStyle(atom,style);var totalVol=volume(extent),extents=carveUpExtent(extent,atomlist,atomsToShow);if(focusSele&&focusSele.length&&focusSele.length>0){var seleExtent=$3Dmol.getExtent(focusSele,!0),sortFunc=function(a,b){var distSq=function(ex,sele){var e=ex.extent,x=e[1][0]-e[0][0],y=e[1][1]-e[0][1],z=e[1][2]-e[0][2],dx=x-sele[2][0];dx*=dx;var dy=y-sele[2][1];dy*=dy;var dz=z-sele[2][2];return dx+dy+(dz*=dz)},d1,d2;return distSq(a,seleExtent)-distSq(b,seleExtent)};extents.sort(sortFunc)}var reducedAtoms=[],sync;for(let i=0,il=atomlist.length;i<il;i++)atom=atomlist[i],reducedAtoms[i]={x:atom.x,y:atom.y,z:atom.z,serial:i,elem:atom.elem};if(!!$3Dmol.syncSurface){var callSyncHelper=function callSyncHelper(i){return new Promise((function(resolve){for(var VandF=generateMeshSyncHelper(type,extents[i].extent,extents[i].atoms,extents[i].toshow,reducedAtoms,totalVol),VandFs=$3Dmol.splitMesh({vertexArr:VandF.vertices,faceArr:VandF.faces}),vi=0,vl=VandFs.length;vi<vl;vi++){VandF={vertices:VandFs[vi].vertexArr,faces:VandFs[vi].faceArr};var mesh=generateSurfaceMesh(atomlist,VandF,mat);$3Dmol.mergeGeos(surfobj.geo,mesh)}_viewer.render(),resolve()}))},promises=[];for(let i=0;i<extents.length;i++)promises.push(callSyncHelper(i));return Promise.all(promises).then((function(){return surfobj.done=!0,Promise.resolve(surfid)}))}var workers=[];type<0&&(type=0);for(let i=0,il=4;i<il;i++){var w=new Worker($3Dmol.SurfaceWorker);workers.push(w),w.postMessage({type:-1,atoms:reducedAtoms,volume:totalVol})}return new Promise((function(resolve,reject){var cnt=0,rfunction=function(event){for(var VandFs=$3Dmol.splitMesh({vertexArr:event.data.vertices,faceArr:event.data.faces}),i=0,vl=VandFs.length;i<vl;i++){var VandF={vertices:VandFs[i].vertexArr,faces:VandFs[i].faceArr},mesh=generateSurfaceMesh(atomlist,VandF,mat);$3Dmol.mergeGeos(surfobj.geo,mesh)}_viewer.render(),++cnt==extents.length&&(surfobj.done=!0,resolve(surfid))},efunction=function(event){console.log(event.message+" ("+event.filename+":"+event.lineno+")"),reject(event)};for(let i=0;i<extents.length;i++){var worker=workers[i%workers.length];worker.onmessage=rfunction,worker.onerror=efunction,worker.postMessage({type:type,expandedExtent:extents[i].extent,extendedAtoms:extents[i].atoms,atomsToShow:extents[i].toshow})}}))};mat=getMatWithStyle(style=style||{});var surfobj=[],promise=null;if(symmetries){var modelsAtomList={},modelsAtomsToShow={};for(n=0;n<models.length;n++)modelsAtomList[n]=[],modelsAtomsToShow[n]=[];for(n=0;n<atomlist.length;n++)modelsAtomList[atomlist[n].model].push(atomlist[n]);for(n=0;n<atomsToShow.length;n++)modelsAtomsToShow[atomsToShow[n].model].push(atomsToShow[n]);var promises=[];for(n=0;n<models.length;n++)modelsAtomsToShow[n].length>0&&(surfobj.push({geo:new $3Dmol.Geometry(!0),mat:mat,done:!1,finished:!1,symmetries:models[n].getSymmetries()}),promises.push(addSurfaceHelper(surfobj[n],modelsAtomList[n],modelsAtomsToShow[n])));promise=Promise.all(promises)}else surfobj.push({geo:new $3Dmol.Geometry(!0),mat:mat,done:!1,finished:!1,symmetries:[new $3Dmol.Matrix4]}),promise=addSurfaceHelper(surfobj[surfobj.length-1],atomlist,atomsToShow);return surfaces[surfid]=surfobj,promise.surfid=surfid,surfacecallback&&"function"==typeof surfacecallback?(promise.then((function(surfid){surfacecallback(surfid)})),surfid):promise},this.setSurfaceMaterialStyle=function(surf,style){if(!style.volformat||style.voldata instanceof $3Dmol.VolumeData||(style.voldata=new $3Dmol.VolumeData(style.voldata,style.volformat)),style.volscheme&&(style.volscheme=getGradient(style.volscheme)),surfaces[surf])for(var surfArr=surfaces[surf],i=0;i<surfArr.length;i++){var mat=surfArr[i].mat=getMatWithStyle(style);if(surfArr[i].mat.side=$3Dmol.FrontSide,style.color){surfArr[i].mat.color=style.color,surfArr[i].geo.colorsNeedUpdate=!0;const c=$3Dmol.CC.color(style.color);surfArr[i].geo.setColors((function(){return c}))}else if(mat.voldata&&mat.volscheme){const scheme=mat.volscheme,voldata=mat.voldata,cc=$3Dmol.CC,range=scheme.range()||[-1,1];surfArr[i].geo.setColors((function(x,y,z){let val=voldata.getVal(x,y,z),col;return cc.color(scheme.valueToHex(val,range))}))}surfArr[i].finished=!1}return this},this.removeSurface=function(surf){for(var surfArr=surfaces[surf],i=0;i<surfArr.length;i++)surfArr[i]&&surfArr[i].lastGL&&(void 0!==surfArr[i].geo&&surfArr[i].geo.dispose(),void 0!==surfArr[i].mat&&surfArr[i].mat.dispose(),modelGroup.remove(surfArr[i].lastGL));return delete surfaces[surf],show(),this},this.removeAllSurfaces=function(){for(var n in surfaces)if(surfaces.hasOwnProperty(n)){for(var surfArr=surfaces[n],i=0;i<surfArr.length;i++)surfArr[i]&&surfArr[i].lastGL&&(void 0!==surfArr[i].geo&&surfArr[i].geo.dispose(),void 0!==surfArr[i].mat&&surfArr[i].mat.dispose(),modelGroup.remove(surfArr[i].lastGL));delete surfaces[n]}return show(),this},this.jmolMoveTo=function(){var pos=modelGroup.position,ret="center { "+-pos.x+" "+-pos.y+" "+-pos.z+" }; ",q=rotationGroup.quaternion;return ret+="moveto .5 quaternion { "+q.x+" "+q.y+" "+q.z+" "+q.w+" };"},this.clear=function(){return this.removeAllSurfaces(),this.removeAllModels(),this.removeAllLabels(),this.removeAllShapes(),show(),this},this.mapAtomProperties=function(props,sel){var atoms=getAtomsFromSel(sel=sel||{});if("function"==typeof props)for(let a=0,numa=atoms.length;a<numa;a++){let atom;props(atoms[a])}else for(let a=0,numa=atoms.length;a<numa;a++){var atom=atoms[a];for(let i=0,n=props.length;i<n;i++){let prop=props[i];if(prop.props)for(var p in prop.props)prop.props.hasOwnProperty(p)&&atomIsSelected(atom,prop)&&(atom.properties||(atom.properties={}),atom.properties[p]=prop.props[p])}}return this},this.linkViewer=function(otherviewer){return linkedViewers.push(otherviewer),this};try{"function"==typeof callback&&callback(this)}catch(e){console.log("error with glviewer callback: "+e)}this.getPerceivedDistance=function(){return 150-rotationGroup.position.z},this.setPerceivedDistance=function(dist){rotationGroup.position.z=150-dist},this.setAutoEyeSeparation=function(isright){var dist=this.getPerceivedDistance();return isright||camera.position.x>0?camera.position.x=dist*Math.tan(Math.PI/180*5):camera.position.x=-dist*Math.tan(Math.PI/180*5),camera.lookAt(new $3Dmol.Vector3(0,0,rotationGroup.position.z)),camera.position.x},this.setDefaultCartoonQuality=function(val){config.cartoonQuality=val}}return GLViewer}(),$3Dmol.glmolViewer=$3Dmol.GLViewer;var $3Dmol=$3Dmol||{};$3Dmol.Gradient=function(){},$3Dmol.Gradient.valueToHex=function(){},$3Dmol.Gradient.range=function(){},$3Dmol.Gradient.normalizeValue=function(lo,hi,val){return hi>=lo?(val<lo&&(val=lo),val>hi&&(val=hi),{lo:lo,hi:hi,val:val}):(val>lo&&(val=lo),val<hi&&(val=hi),{lo:hi,hi:lo,val:val=lo-val+hi})},$3Dmol.Gradient.RWB=function(min,max,mid){var mult=1;void 0===max&&Array.isArray(min)&&min.length>=2&&(max=min[1],min=min[0]),this.valueToHex=function(val,range){var lo,hi;if(val*=1,range?(lo=range[0],hi=range[1]):(lo=min,hi=max),void 0===val)return 16777215;var norm=$3Dmol.Gradient.normalizeValue(lo,hi,val);lo=norm.lo;var middle=((hi=norm.hi)+lo)/2,scale,color;return color=(val=norm.val)<=(middle=range&&void 0!==range[2]?range[2]:void 0!==mid?mid:(lo+hi)/2)?16711680+256*(scale=Math.floor(255*Math.sqrt((val-lo)/(middle-lo))))+scale:65536*(scale=Math.floor(255*Math.sqrt(1-(val-middle)/(hi-middle))))+256*scale+255},this.range=function(){return void 0!==min&&void 0!==max?[min,max]:null}},$3Dmol.Gradient.ROYGB=function(min,max){var mult=1;void 0===max&&Array.isArray(min)&&min.length>=2&&(max=min[1],min=min[0]),this.valueToHex=function(val,range){var lo,hi;if(val*=1,range?(lo=range[0],hi=range[1]):(lo=min,hi=max),void 0===val)return 16777215;var norm=$3Dmol.Gradient.normalizeValue(lo,hi,val),mid=((lo=norm.lo)+(hi=norm.hi))/2,q1=(lo+mid)/2,q3=(mid+hi)/2,scale,color;return color=(val=norm.val)<q1?16711680+256*(scale=Math.floor(255*Math.sqrt((val-lo)/(q1-lo))))+0:val<mid?65536*(scale=Math.floor(255*Math.sqrt(1-(val-q1)/(mid-q1))))+65280+0:val<q3?65280+1*(scale=Math.floor(255*Math.sqrt((val-mid)/(q3-mid)))):0+256*(scale=Math.floor(255*Math.sqrt(1-(val-q3)/(hi-q3))))+255},this.range=function(){return void 0!==min&&void 0!==max?[min,max]:null}},$3Dmol.Gradient.Sinebow=function(min,max){var mult=1;void 0===max&&Array.isArray(min)&&min.length>=2&&(max=min[1],min=min[0]),max<min&&(mult=-1,min*=-1,max*=-1),this.valueToHex=function(val,range){var lo,hi;if(val*=mult,range?(lo=range[0],hi=range[1]):(lo=min,hi=max),void 0===val)return 16777215;var norm=$3Dmol.Gradient.normalizeValue(lo,hi,val);lo=norm.lo,hi=norm.hi;var scale,h=5*(((val=norm.val)-lo)/(hi-lo))/6+.5,r=Math.sin(Math.PI*h);r*=255*r;var g=Math.sin(Math.PI*(h+1/3));g*=255*g;var b=Math.sin(Math.PI*(h+2/3));return b*=255*b,65536*Math.floor(r)+256*Math.floor(b)+1*Math.floor(g)},this.range=function(){return void 0!==min&&void 0!==max?[min,max]:null}},$3Dmol.Gradient.builtinGradients={rwb:$3Dmol.Gradient.RWB,roygb:$3Dmol.Gradient.ROYGB,sinebow:$3Dmol.Gradient.Sinebow},$3Dmol.LabelCount=0,$3Dmol.Label=function(text,parameters){this.id=$3Dmol.LabelCount++,this.stylespec=parameters||{},this.canvas=document.createElement("canvas"),this.canvas.width=134,this.canvas.height=35,this.context=this.canvas.getContext("2d"),this.sprite=new $3Dmol.Sprite,this.text=text,this.frame=this.stylespec.frame},$3Dmol.Label.prototype={constructor:$3Dmol.Label,getStyle:function(){return this.stylespec},setContext:function(){var roundRect=function(ctx,x,y,w,h,r,drawBorder){ctx.beginPath(),ctx.moveTo(x+r,y),ctx.lineTo(x+w-r,y),ctx.quadraticCurveTo(x+w,y,x+w,y+r),ctx.lineTo(x+w,y+h-r),ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h),ctx.lineTo(x+r,y+h),ctx.quadraticCurveTo(x,y+h,x,y+h-r),ctx.lineTo(x,y+r),ctx.quadraticCurveTo(x,y,x+r,y),ctx.closePath(),ctx.fill(),drawBorder&&ctx.stroke()},getColor=function(style,stylealpha,init){var ret=init;return void 0!==style&&(style instanceof $3Dmol.Color?ret=style.scaled():void 0!==(ret=$3Dmol.CC.color(style)).scaled&&(ret=ret.scaled())),void 0!==stylealpha&&(ret.a=parseFloat(stylealpha)),ret};return function(){var style=this.stylespec,useScreen=void 0!==style.useScreen&&style.useScreen,showBackground=style.showBackground;"0"!==showBackground&&"false"!==showBackground||(showBackground=!1),void 0===showBackground&&(showBackground=!0);var font=style.font?style.font:"sans-serif",fontSize=parseInt(style.fontSize)?parseInt(style.fontSize):18,fontColor=getColor(style.fontColor,style.fontOpacity,{r:255,g:255,b:255,a:1}),padding=style.padding?style.padding:4,borderThickness=style.borderThickness?style.borderThickness:0,backgroundColor=getColor(style.backgroundColor,style.backgroundOpacity,{r:0,g:0,b:0,a:1}),borderColor=getColor(style.borderColor,style.borderOpacity,backgroundColor),position=style.position?style.position:{x:-10,y:1,z:1},inFront=void 0===style.inFront||style.inFront;"false"!==inFront&&"0"!==inFront||(inFront=!1);var spriteAlignment=style.alignment||$3Dmol.SpriteAlignment.topLeft;"string"==typeof spriteAlignment&&spriteAlignment in $3Dmol.SpriteAlignment&&(spriteAlignment=$3Dmol.SpriteAlignment[spriteAlignment]);var bold="";style.bold&&(bold="bold "),this.context.font=bold+fontSize+"px  "+font;var metrics,textWidth=this.context.measureText(this.text).width;showBackground||(borderThickness=0);var width=textWidth+2.5*borderThickness+2*padding,height=1.25*fontSize+2*borderThickness+2*padding;if(style.backgroundImage){var img=style.backgroundImage,w=style.backgroundWidth?style.backgroundWidth:img.width,h=style.backgroundHeight?style.backgroundHeight:img.height;w>width&&(width=w),h>height&&(height=h)}if(this.canvas.width=width,this.canvas.height=height,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),bold="",style.bold&&(bold="bold "),this.context.font=bold+fontSize+"px  "+font,this.context.fillStyle="rgba("+backgroundColor.r+","+backgroundColor.g+","+backgroundColor.b+","+backgroundColor.a+")",this.context.strokeStyle="rgba("+borderColor.r+","+borderColor.g+","+borderColor.b+","+borderColor.a+")",this.context.lineWidth=borderThickness,showBackground&&roundRect(this.context,borderThickness,borderThickness,width-2*borderThickness,height-2*borderThickness,6,borderThickness>0),style.backgroundImage){let img=style.backgroundImage,w=style.backgroundWidth?style.backgroundWidth:img.width,h=style.backgroundHeight?style.backgroundHeight:img.height;this.context.drawImage(img,0,0,w,h)}this.context.fillStyle="rgba("+fontColor.r+","+fontColor.g+","+fontColor.b+","+fontColor.a+")",this.context.fillText(this.text,borderThickness+padding,fontSize+borderThickness+padding,textWidth);var texture=new $3Dmol.Texture(this.canvas);texture.needsUpdate=!0,this.sprite.material=new $3Dmol.SpriteMaterial({map:texture,useScreenCoordinates:useScreen,alignment:spriteAlignment,depthTest:!inFront}),this.sprite.scale.set(1,1,1),this.sprite.position.set(position.x,position.y,position.z)}}(),dispose:function(){void 0!==this.sprite.material.map&&this.sprite.material.map.dispose(),void 0!==this.sprite.material&&this.sprite.material.dispose()}},$3Dmol=$3Dmol||{},$3Dmol.MarchingCubeInitializer=function(){var ISDONE=2,my={},edgeTable,edgeTable2,triTable,triTable2;return my.march=function(data,verts,faces,spec){var fulltable=!!spec.fulltable,origin=spec.hasOwnProperty("origin")&&spec.origin.hasOwnProperty("x")?spec.origin:{x:0,y:0,z:0},voxel=!!spec.voxel,transform=spec.matrix,nX=spec.nX||0,nY=spec.nY||0,nZ=spec.nZ||0,scale=spec.scale||1,unitCube=null;unitCube=spec.unitCube?spec.unitCube:{x:scale,y:scale,z:scale};var vertnums=new Int32Array(nX*nY*nZ),i,il;for(i=0,il=vertnums.length;i<il;++i)vertnums[i]=-1;var getVertex=function(i,j,k,code,p1,p2){var pt={x:0,y:0,z:0},val1,val2,p=p1;!!!(code&1<<p1)&&!!(code&1<<p2)&&(p=p2),1&p&&k++,2&p&&j++,4&p&&i++,transform?pt={x:(pt=(pt=new $3Dmol.Vector3(i,j,k)).applyMatrix4(transform)).x,y:pt.y,z:pt.z}:(pt.x=origin.x+unitCube.x*i,pt.y=origin.y+unitCube.y*j,pt.z=origin.z+unitCube.z*k);var index=(nY*i+j)*nZ+k;return voxel?(verts.push(pt),verts.length-1):(vertnums[index]<0&&(vertnums[index]=verts.length,verts.push(pt)),vertnums[index])},intersects=new Int32Array(12),etable=fulltable?edgeTable2:edgeTable,tritable=fulltable?triTable2:triTable;for(i=0;i<nX-1;++i)for(var j=0;j<nY-1;++j)for(var k=0;k<nZ-1;++k){for(var code=0,p=0;p<8;++p){var index,val;code|=!!(2&data[(nY*(i+((4&p)>>2))+j+((2&p)>>1))*nZ+k+(1&p)])<<p}if(0!==code&&255!==code){var ecode=etable[code];if(0!==ecode){var ttable=tritable[code];1&ecode&&(intersects[0]=getVertex(i,j,k,code,0,1)),2&ecode&&(intersects[1]=getVertex(i,j,k,code,1,3)),4&ecode&&(intersects[2]=getVertex(i,j,k,code,3,2)),8&ecode&&(intersects[3]=getVertex(i,j,k,code,2,0)),16&ecode&&(intersects[4]=getVertex(i,j,k,code,4,5)),32&ecode&&(intersects[5]=getVertex(i,j,k,code,5,7)),64&ecode&&(intersects[6]=getVertex(i,j,k,code,7,6)),128&ecode&&(intersects[7]=getVertex(i,j,k,code,6,4)),256&ecode&&(intersects[8]=getVertex(i,j,k,code,0,4)),512&ecode&&(intersects[9]=getVertex(i,j,k,code,1,5)),1024&ecode&&(intersects[10]=getVertex(i,j,k,code,3,7)),2048&ecode&&(intersects[11]=getVertex(i,j,k,code,2,6));for(var t=0;t<ttable.length;t+=3){var a=intersects[ttable[t]],b=intersects[ttable[t+1]],c=intersects[ttable[t+2]];voxel&&t>=3&&(verts.push(verts[a]),a=verts.length-1,verts.push(verts[b]),b=verts.length-1,verts.push(verts[c]),c=verts.length-1),faces.push(a),faces.push(b),faces.push(c)}}}}},my.laplacianSmooth=function(numiter,verts,faces){var tps=new Array(verts.length),i,il,j,jl,k;for(i=0,il=verts.length;i<il;i++)tps[i]={x:0,y:0,z:0};var vertdeg=new Array(20),flagvert;for(i=0;i<20;i++)vertdeg[i]=new Array(verts.length);for(i=0,il=verts.length;i<il;i++)vertdeg[0][i]=0;for(i=0,il=faces.length/3;i<il;i++){var aoffset=3*i,boffset=3*i+1,coffset=3*i+2;for(flagvert=!0,j=0,jl=vertdeg[0][faces[aoffset]];j<jl;j++)if(faces[boffset]==vertdeg[j+1][faces[aoffset]]){flagvert=!1;break}for(flagvert&&(vertdeg[0][faces[aoffset]]++,vertdeg[vertdeg[0][faces[aoffset]]][faces[aoffset]]=faces[boffset]),flagvert=!0,j=0,jl=vertdeg[0][faces[aoffset]];j<jl;j++)if(faces[coffset]==vertdeg[j+1][faces[aoffset]]){flagvert=!1;break}for(flagvert&&(vertdeg[0][faces[aoffset]]++,vertdeg[vertdeg[0][faces[aoffset]]][faces[aoffset]]=faces[coffset]),flagvert=!0,j=0,jl=vertdeg[0][faces[boffset]];j<jl;j++)if(faces[aoffset]==vertdeg[j+1][faces[boffset]]){flagvert=!1;break}for(flagvert&&(vertdeg[0][faces[boffset]]++,vertdeg[vertdeg[0][faces[boffset]]][faces[boffset]]=faces[aoffset]),flagvert=!0,j=0,jl=vertdeg[0][faces[boffset]];j<jl;j++)if(faces[coffset]==vertdeg[j+1][faces[boffset]]){flagvert=!1;break}for(flagvert&&(vertdeg[0][faces[boffset]]++,vertdeg[vertdeg[0][faces[boffset]]][faces[boffset]]=faces[coffset]),flagvert=!0,j=0;j<vertdeg[0][faces[coffset]];j++)if(faces[aoffset]==vertdeg[j+1][faces[coffset]]){flagvert=!1;break}for(flagvert&&(vertdeg[0][faces[coffset]]++,vertdeg[vertdeg[0][faces[coffset]]][faces[coffset]]=faces[aoffset]),flagvert=!0,j=0,jl=vertdeg[0][faces[coffset]];j<jl;j++)if(faces[boffset]==vertdeg[j+1][faces[coffset]]){flagvert=!1;break}flagvert&&(vertdeg[0][faces[coffset]]++,vertdeg[vertdeg[0][faces[coffset]]][faces[coffset]]=faces[boffset])}var wt=1,wt2=.5;for(k=0;k<numiter;k++){for(i=0,il=verts.length;i<il;i++)if(vertdeg[0][i]<3)tps[i].x=verts[i].x,tps[i].y=verts[i].y,tps[i].z=verts[i].z;else if(3==vertdeg[0][i]||4==vertdeg[0][i]){for(tps[i].x=0,tps[i].y=0,tps[i].z=0,j=0,jl=vertdeg[0][i];j<jl;j++)tps[i].x+=verts[vertdeg[j+1][i]].x,tps[i].y+=verts[vertdeg[j+1][i]].y,tps[i].z+=verts[vertdeg[j+1][i]].z;tps[i].x+=.5*verts[i].x,tps[i].y+=.5*verts[i].y,tps[i].z+=.5*verts[i].z,tps[i].x/=.5+vertdeg[0][i],tps[i].y/=.5+vertdeg[0][i],tps[i].z/=.5+vertdeg[0][i]}else{for(tps[i].x=0,tps[i].y=0,tps[i].z=0,j=0,jl=vertdeg[0][i];j<jl;j++)tps[i].x+=verts[vertdeg[j+1][i]].x,tps[i].y+=verts[vertdeg[j+1][i]].y,tps[i].z+=verts[vertdeg[j+1][i]].z;tps[i].x+=1*verts[i].x,tps[i].y+=1*verts[i].y,tps[i].z+=1*verts[i].z,tps[i].x/=1+vertdeg[0][i],tps[i].y/=1+vertdeg[0][i],tps[i].z/=1+vertdeg[0][i]}for(i=0,il=verts.length;i<il;i++)verts[i].x=tps[i].x,verts[i].y=tps[i].y,verts[i].z=tps[i].z}},my.edgeTable=[0,0,0,0,0,0,0,2816,0,0,0,1792,0,3328,3584,3840,0,0,0,138,0,21,0,134,0,0,0,652,0,2067,3865,3600,0,0,0,42,0,0,0,294,0,0,21,28,0,3875,1049,3360,0,168,162,170,0,645,2475,2210,0,687,293,172,4010,3747,3497,3232,0,0,0,0,0,69,0,900,0,0,0,1792,138,131,1608,1920,0,81,0,2074,84,85,84,86,0,81,0,3676,330,1105,1881,1616,0,0,0,42,0,69,0,502,0,0,21,3580,138,2035,1273,1520,2816,104,2337,106,840,581,367,102,2816,3695,3429,3180,1898,1635,1385,1120,0,0,0,0,0,0,0,3910,0,0,69,588,42,2083,41,2880,0,0,0,1722,0,2293,4095,3830,0,255,757,764,2538,2291,3065,2800,0,0,81,338,0,3925,1119,3414,84,855,85,340,2130,2899,89,2384,1792,712,194,1162,4036,3781,3535,3270,708,719,197,204,3018,2755,2505,2240,0,0,0,0,168,420,168,1958,162,162,676,2988,170,163,680,928,3328,3096,3328,3642,52,53,1855,1590,2340,2111,2869,2620,298,51,825,560,3584,3584,3090,3482,1668,1941,1183,1430,146,2975,2069,2460,154,915,153,400,3840,3592,3329,3082,1796,1541,1295,1030,2818,2575,2309,2060,778,515,265,0],edgeTable=new Uint32Array(my.edgeTable),triTable=my.triTable=[[],[],[],[],[],[],[],[11,9,8],[],[],[],[8,10,9],[],[10,8,11],[9,11,10],[8,10,9,8,11,10],[],[],[],[1,7,3],[],[4,2,0],[],[2,1,7],[],[],[],[2,7,3,2,9,7],[],[1,4,11,1,0,4],[3,8,0,11,9,4,11,10,9],[4,11,9,11,10,9],[],[],[],[5,3,1],[],[],[],[2,5,8,2,1,5],[],[],[2,4,0],[3,2,4],[],[0,9,1,8,10,5,8,11,10],[3,4,0,3,10,4],[5,8,10,8,11,10],[],[3,5,7],[7,1,5],[1,7,3,1,5,7],[],[9,2,0,9,7,2],[0,3,8,1,7,11,1,5,7],[11,1,7,1,5,7],[],[9,1,0,5,3,2,5,7,3],[8,2,5,8,0,2],[2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[],[],[],[],[],[0,6,2],[],[7,2,9,7,9,8],[],[],[],[8,10,9],[7,1,3],[7,1,0],[6,9,3,6,10,9],[7,10,8,10,9,8],[],[6,0,4],[],[11,1,4,11,3,1],[2,4,6],[2,0,4,2,4,6],[2,4,6],[1,4,2,4,6,2],[],[6,0,4],[],[2,11,3,6,9,4,6,10,9],[8,6,1,8,1,3],[10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[],[],[],[5,3,1],[],[0,6,2],[],[7,4,8,5,2,1,5,6,2],[],[],[2,4,0],[7,4,8,2,11,3,10,5,6],[7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[9,11,8],[3,5,6],[0,5,11,0,11,8],[6,3,5,3,1,5],[3,9,6,3,8,9],[9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[],[],[],[],[],[],[],[1,10,2,9,11,6,9,8,11],[],[],[6,0,2],[3,6,9,3,2,6],[3,5,1],[0,5,1,0,11,5],[0,3,5],[6,9,11,9,8,11],[],[],[],[4,5,9,7,1,10,7,3,1],[],[11,6,7,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[],[],[0,6,4],[8,6,4,8,1,6],[],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[4,2,6],[1,0,9,2,4,8,2,6,4],[2,4,0,2,6,4],[8,2,4,2,6,4],[11,4,1,11,6,4],[0,9,1,4,11,6,4,8,11],[3,6,0,6,4,0],[8,6,4,8,11,6],[10,8,9],[6,3,9,6,7,3],[6,7,1],[10,7,1,7,3,1],[7,11,6,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2],[1,0,9,3,6,7,3,2,6],[7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[],[],[],[],[5,3,7],[8,5,2,8,7,5],[5,3,7],[1,10,2,5,8,7,5,9,8],[1,7,5],[1,7,5],[9,2,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[0,7,1,7,5,1],[9,3,5,3,7,5],[9,7,5,9,8,7],[8,10,11],[3,4,10,3,10,11],[8,10,11],[5,9,4,1,11,3,1,10,11],[2,4,5],[5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[2,8,5,2,11,8],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[11,9,10],[11,9,10],[1,11,4,1,10,11],[8,7,4,11,1,10,11,3,1],[2,7,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[1,7,4],[3,2,11,4,8,7,9,1,0],[11,4,2,4,0,2],[2,11,3,7,4,8],[4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[3,9,11,9,10,11],[0,10,8,10,11,8],[10,3,1,10,11,3],[2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]],edgeTable2=[0,265,515,778,2060,2309,2575,2822,1030,1295,1541,1804,3082,3331,3593,3840,400,153,915,666,2460,2197,2975,2710,1430,1183,1941,1692,3482,3219,3993,3728,560,825,51,314,2620,2869,2111,2358,1590,1855,1077,1340,3642,3891,3129,3376,928,681,419,170,2988,2725,2479,2214,1958,1711,1445,1196,4010,3747,3497,3232,2240,2505,2755,3018,204,453,719,966,3270,3535,3781,4044,1226,1475,1737,1984,2384,2137,2899,2650,348,85,863,598,3414,3167,3925,3676,1370,1107,1881,1616,2800,3065,2291,2554,764,1013,255,502,3830,4095,3317,3580,1786,2035,1273,1520,2912,2665,2403,2154,876,613,367,102,3942,3695,3429,3180,1898,1635,1385,1120,1120,1385,1635,1898,3180,3429,3695,3942,102,367,613,876,2154,2403,2665,2912,1520,1273,2035,1786,3580,3317,4095,3830,502,255,1013,764,2554,2291,3065,2800,1616,1881,1107,1370,3676,3925,3167,3414,598,863,85,348,2650,2899,2137,2384,1984,1737,1475,1226,4044,3781,3535,3270,966,719,453,204,3018,2755,2505,2240,3232,3497,3747,4010,1196,1445,1711,1958,2214,2479,2725,2988,170,419,681,928,3376,3129,3891,3642,1340,1077,1855,1590,2358,2111,2869,2620,314,51,825,560,3728,3993,3219,3482,1692,1941,1183,1430,2710,2975,2197,2460,666,915,153,400,3840,3593,3331,3082,1804,1541,1295,1030,2822,2575,2309,2060,778,515,265,0],triTable2=[[],[8,3,0],[9,0,1],[8,3,1,8,1,9],[11,2,3],[11,2,0,11,0,8],[11,2,3,0,1,9],[2,1,11,1,9,11,11,9,8],[10,1,2],[8,3,0,1,2,10],[9,0,2,9,2,10],[3,2,8,2,10,8,8,10,9],[10,1,3,10,3,11],[1,0,10,0,8,10,10,8,11],[0,3,9,3,11,9,9,11,10],[8,10,9,8,11,10],[8,4,7],[3,0,4,3,4,7],[1,9,0,8,4,7],[9,4,1,4,7,1,1,7,3],[2,3,11,7,8,4],[7,11,4,11,2,4,4,2,0],[3,11,2,4,7,8,9,0,1],[2,7,11,2,1,7,1,4,7,1,9,4],[10,1,2,8,4,7],[2,10,1,0,4,7,0,7,3],[4,7,8,0,2,10,0,10,9],[2,7,3,2,9,7,7,9,4,2,10,9],[8,4,7,11,10,1,11,1,3],[11,4,7,1,4,11,1,11,10,1,0,4],[3,8,0,7,11,4,11,9,4,11,10,9],[7,11,4,4,11,9,11,10,9],[9,5,4],[3,0,8,4,9,5],[5,4,0,5,0,1],[4,8,5,8,3,5,5,3,1],[11,2,3,9,5,4],[9,5,4,8,11,2,8,2,0],[3,11,2,1,5,4,1,4,0],[8,5,4,2,5,8,2,8,11,2,1,5],[2,10,1,9,5,4],[0,8,3,5,4,9,10,1,2],[10,5,2,5,4,2,2,4,0],[3,4,8,3,2,4,2,5,4,2,10,5],[5,4,9,1,3,11,1,11,10],[0,9,1,4,8,5,8,10,5,8,11,10],[3,4,0,3,10,4,4,10,5,3,11,10],[4,8,5,5,8,10,8,11,10],[9,5,7,9,7,8],[0,9,3,9,5,3,3,5,7],[8,0,7,0,1,7,7,1,5],[1,7,3,1,5,7],[11,2,3,8,9,5,8,5,7],[9,2,0,9,7,2,2,7,11,9,5,7],[0,3,8,2,1,11,1,7,11,1,5,7],[2,1,11,11,1,7,1,5,7],[1,2,10,5,7,8,5,8,9],[9,1,0,10,5,2,5,3,2,5,7,3],[5,2,10,8,2,5,8,5,7,8,0,2],[10,5,2,2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[11,7,6],[0,8,3,11,7,6],[9,0,1,11,7,6],[7,6,11,3,1,9,3,9,8],[2,3,7,2,7,6],[8,7,0,7,6,0,0,6,2],[1,9,0,3,7,6,3,6,2],[7,6,2,7,2,9,2,1,9,7,9,8],[1,2,10,6,11,7],[2,10,1,7,6,11,8,3,0],[11,7,6,10,9,0,10,0,2],[7,6,11,3,2,8,8,2,10,8,10,9],[6,10,7,10,1,7,7,1,3],[6,10,1,6,1,7,7,1,0,7,0,8],[9,0,3,6,9,3,6,10,9,6,3,7],[6,10,7,7,10,8,10,9,8],[8,4,6,8,6,11],[11,3,6,3,0,6,6,0,4],[0,1,9,4,6,11,4,11,8],[1,9,4,11,1,4,11,3,1,11,4,6],[3,8,2,8,4,2,2,4,6],[2,0,4,2,4,6],[1,9,0,3,8,2,2,8,4,2,4,6],[9,4,1,1,4,2,4,6,2],[10,1,2,11,8,4,11,4,6],[10,1,2,11,3,6,6,3,0,6,0,4],[0,2,10,0,10,9,4,11,8,4,6,11],[2,11,3,6,9,4,6,10,9],[8,4,6,8,6,1,6,10,1,8,1,3],[1,0,10,10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[9,5,4,7,6,11],[4,9,5,3,0,8,11,7,6],[6,11,7,4,0,1,4,1,5],[6,11,7,4,8,5,5,8,3,5,3,1],[4,9,5,6,2,3,6,3,7],[9,5,4,8,7,0,0,7,6,0,6,2],[4,0,1,4,1,5,6,3,7,6,2,3],[7,4,8,5,2,1,5,6,2],[6,11,7,1,2,10,9,5,4],[11,7,6,8,3,0,1,2,10,9,5,4],[11,7,6,10,5,2,2,5,4,2,4,0],[7,4,8,2,11,3,10,5,6],[4,9,5,6,10,7,7,10,1,7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[5,6,9,6,11,9,9,11,8],[0,9,5,0,5,3,3,5,6,3,6,11],[0,1,5,0,5,11,5,6,11,0,11,8],[11,3,6,6,3,5,3,1,5],[9,5,6,3,9,6,3,8,9,3,6,2],[5,6,9,9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[1,2,10,5,6,9,9,6,11,9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[10,6,5],[8,3,0,10,6,5],[0,1,9,5,10,6],[10,6,5,9,8,3,9,3,1],[3,11,2,10,6,5],[6,5,10,2,0,8,2,8,11],[1,9,0,6,5,10,11,2,3],[1,10,2,5,9,6,9,11,6,9,8,11],[1,2,6,1,6,5],[0,8,3,2,6,5,2,5,1],[5,9,6,9,0,6,6,0,2],[9,6,5,3,6,9,3,9,8,3,2,6],[11,6,3,6,5,3,3,5,1],[0,5,1,0,11,5,5,11,6,0,8,11],[0,5,9,0,3,5,3,6,5,3,11,6],[5,9,6,6,9,11,9,8,11],[10,6,5,4,7,8],[5,10,6,7,3,0,7,0,4],[5,10,6,0,1,9,8,4,7],[4,5,9,6,7,10,7,1,10,7,3,1],[7,8,4,2,3,11,10,6,5],[11,6,7,10,2,5,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[7,8,4,5,1,2,5,2,6],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,8,0,7,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,4,5,8,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[10,6,4,10,4,9],[8,3,0,9,10,6,9,6,4],[1,10,0,10,6,0,0,6,4],[8,6,4,8,1,6,6,1,10,8,3,1],[2,3,11,6,4,9,6,9,10],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,11,6,3,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[9,1,4,1,2,4,4,2,6],[1,0,9,3,2,8,2,4,8,2,6,4],[2,4,0,2,6,4],[3,2,8,8,2,4,2,6,4],[1,4,9,11,4,1,11,1,3,11,6,4],[0,9,1,4,11,6,4,8,11],[11,6,3,3,6,0,6,4,0],[8,6,4,8,11,6],[6,7,10,7,8,10,10,8,9],[9,3,0,6,3,9,6,9,10,6,7,3],[6,1,10,6,7,1,7,0,1,7,8,0],[6,7,10,10,7,1,7,3,1],[7,11,6,3,8,2,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2,2,9,1,7,8,9],[1,0,9,3,6,7,3,2,6],[8,0,7,7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[11,7,5,11,5,10],[3,0,8,7,5,10,7,10,11],[9,0,1,10,11,7,10,7,5],[3,1,9,3,9,8,7,10,11,7,5,10],[10,2,5,2,3,5,5,3,7],[5,10,2,8,5,2,8,7,5,8,2,0],[9,0,1,10,2,5,5,2,3,5,3,7],[1,10,2,5,8,7,5,9,8],[2,11,1,11,7,1,1,7,5],[0,8,3,2,11,1,1,11,7,1,7,5],[9,0,2,9,2,7,2,11,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[8,7,0,0,7,1,7,5,1],[0,3,9,9,3,5,3,7,5],[9,7,5,9,8,7],[4,5,8,5,10,8,8,10,11],[3,0,4,3,4,10,4,5,10,3,10,11],[0,1,9,4,5,8,8,5,10,8,10,11],[5,9,4,1,11,3,1,10,11],[3,8,4,3,4,2,2,4,5,2,5,10],[10,2,5,5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[8,4,5,2,8,5,2,11,8,2,5,1],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[4,5,8,8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[7,4,11,4,9,11,11,9,10],[3,0,8,7,4,11,11,4,9,11,9,10],[11,7,4,1,11,4,1,10,11,1,4,0],[8,7,4,11,1,10,11,3,1],[2,3,7,2,7,9,7,4,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[2,11,7,2,7,1,1,7,4,1,4,9],[3,2,11,4,8,7,9,1,0],[7,4,11,11,4,2,4,0,2],[2,11,3,7,4,8],[9,1,4,4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[0,9,3,3,9,11,9,10,11],[1,10,0,0,10,8,10,11,8],[10,3,1,10,11,3],[3,8,2,2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[2,11,1,1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]],my},$3Dmol.MarchingCube=$3Dmol.MarchingCubeInitializer(),$3Dmol.Parsers=function(){var parsers={},bondTable={H:.37,He:.32,Li:1.34,Be:.9,B:.82,C:.77,N:.75,O:.73,F:.71,Ne:.69,Na:1.54,Mg:1.3,Al:1.18,Si:1.11,P:1.06,S:1.02,Cl:.99,Ar:.97,K:1.96,Ca:1.74,Sc:1.44,Ti:1.56,V:1.25,Mn:1.39,Fe:1.25,Co:1.26,Ni:1.21,Cu:1.38,Zn:1.31,Ga:1.26,Ge:1.22,Se:1.16,Br:1.14,Kr:1.1,Rb:2.11,Sr:1.92,Y:1.62,Zr:1.48,Nb:1.37,Mo:1.45,Tc:1.56,Ru:1.26,Rh:1.35,Pd:1.31,Ag:1.53,Cd:1.48,In:1.44,Sn:1.41,Sb:1.38,Te:1.35,I:1.33,Xe:1.3,Cs:2.25,Ba:1.98,Lu:1.6,Hf:1.5,Ta:1.38,W:1.46,Re:1.59,Os:1.44,Ir:1.37,Pt:1.28,Au:1.44,Hg:1.49,Tl:1.48,Pb:1.47,Bi:1.46,Rn:1.45},bondLength=function(elem){return bondTable[elem]||1.6},areConnected=function(atom1,atom2){var maxsq=bondLength(atom1.elem)+bondLength(atom2.elem);maxsq+=.25,maxsq*=maxsq;var xdiff=atom1.x-atom2.x;if((xdiff*=xdiff)>maxsq)return!1;var ydiff=atom1.y-atom2.y;if((ydiff*=ydiff)>maxsq)return!1;var zdiff=atom1.z-atom2.z;if((zdiff*=zdiff)>maxsq)return!1;var distSquared=xdiff+ydiff+zdiff;return!isNaN(distSquared)&&(!(distSquared<.5)&&(!(distSquared>maxsq)&&(atom1.altLoc==atom2.altLoc||" "==atom1.altLoc||" "==atom2.altLoc)))},assignBonds=function(atoms){for(var i=0,n=atoms.length;i<n;i++)atoms[i].index||(atoms[i].index=i);for(var grid={},MAX_BOND_LENGTH=4.95,index=0;index<atoms.length;index++){var atom=atoms[index],x=Math.floor(atom.x/4.95),y=Math.floor(atom.y/4.95),z=Math.floor(atom.z/4.95);grid[x]||(grid[x]={}),grid[x][y]||(grid[x][y]={}),grid[x][y][z]||(grid[x][y][z]=[]),grid[x][y][z].push(atom)}var findConnections=function(points,otherPoints){for(var i=0;i<points.length;i++)for(var atom1=points[i],j=0;j<otherPoints.length;j++){var atom2=otherPoints[j];if(areConnected(atom1,atom2)){var a2i=atom1.bonds.indexOf(atom2.index),a1i=atom2.bonds.indexOf(atom1.index);-1==a2i&&-1==a1i?(atom1.bonds.push(atom2.index),atom1.bondOrder.push(1),atom2.bonds.push(atom1.index),atom2.bondOrder.push(1)):-1==a2i?(atom1.bonds.push(atom2.index),atom1.bondOrder.push(atom2.bondOrder[a1i])):-1==a1i&&(atom2.bonds.push(atom1.index),atom2.bondOrder.push(atom1.bondOrder[a2i]))}}},OFFSETS=[{x:0,y:0,z:1},{x:0,y:1,z:-1},{x:0,y:1,z:0},{x:0,y:1,z:1},{x:1,y:-1,z:-1},{x:1,y:-1,z:0},{x:1,y:-1,z:1},{x:1,y:0,z:-1},{x:1,y:0,z:0},{x:1,y:0,z:1},{x:1,y:1,z:-1},{x:1,y:1,z:0},{x:1,y:1,z:1}];for(let x in grid){x=parseInt(x);for(let y in grid[x]){y=parseInt(y);for(let z in grid[x][y]){z=parseInt(z);let points=grid[x][y][z];for(let i=0;i<points.length;i++){let atom1=points[i];for(let j=i+1;j<points.length;j++){let atom2=points[j];areConnected(atom1,atom2)&&-1==atom1.bonds.indexOf(atom2.index)&&(atom1.bonds.push(atom2.index),atom1.bondOrder.push(1),atom2.bonds.push(atom1.index),atom2.bondOrder.push(1))}}for(let o=0;o<OFFSETS.length;o++){let offset=OFFSETS[o],otherPoints;grid[x+offset.x]&&grid[x+offset.x][y+offset.y]&&grid[x+offset.x][y+offset.y][z+offset.z]&&findConnections(points,grid[x+offset.x][y+offset.y][z+offset.z])}}}}},standardResidues=new Set(["ABU","ACD","ALA","ALB","ALI","ARG","AR0","ASN","ASP","ASX","BAS","CYS","CYH","CYX","CSS","CSH","GLN","GLU","GLX","GLY","HIS","HIE","HID","HIP","HYP","ILE","ILU","LEU","LYS","MET","PCA","PGA","PHE","PR0","PRO","PRZ","SER","THR","TYR","VAL","A","1MA","C","5MC","OMC","G","1MG","2MG","M2G","7MG","OMG","YG","I","T","U","+U","H2U","5MU","PSU","ACE","F0R","H2O","HOH","WAT"]),assignPDBBonds=function(atomsarray){var protatoms=[],hetatoms=[],i,n;for(i=0,n=atomsarray.length;i<n;i++){var atom=atomsarray[i];atom.index=i,atom.hetflag||!standardResidues.has(atom.resn)?hetatoms.push(atom):protatoms.push(atom)}assignBonds(hetatoms),protatoms.sort((function(a,b){return a.chain!=b.chain?a.chain<b.chain?-1:1:a.resi-b.resi}));var currentResi=-1,reschain=-1,lastResConnected;for(i=0,n=protatoms.length;i<n;i++){var ai=protatoms[i];ai.resi!==currentResi&&(currentResi=ai.resi,lastResConnected||reschain++,lastResConnected=!1),ai.reschain=reschain;for(var j=i+1;j<protatoms.length;j++){var aj=protatoms[j];if(aj.chain!=ai.chain)break;if(aj.resi-ai.resi>1)break;areConnected(ai,aj)&&(-1===ai.bonds.indexOf(aj.index)&&(ai.bonds.push(aj.index),ai.bondOrder.push(1),aj.bonds.push(ai.index),aj.bondOrder.push(1)),ai.resi!==aj.resi&&(lastResConnected=!0))}}},assignBackboneHBonds=function(atomsarray){var maxlength=3.2,maxlengthSq=10.24,atoms=[],i,j,n;for(i=0,n=atomsarray.length;i<n;i++){atomsarray[i].index=i;var atom=atomsarray[i];atom.hetflag||"N"!==atom.atom&&"O"!==atom.atom||(atoms.push(atom),atom.hbondOther=null,atom.hbondDistanceSq=Number.POSITIVE_INFINITY)}for(atoms.sort((function(a,b){return a.z-b.z})),i=0,n=atoms.length;i<n;i++){var ai=atoms[i];for(j=i+1;j<n;j++){var aj=atoms[j],zdiff=aj.z-ai.z;if(zdiff>3.2)break;if(aj.atom!=ai.atom){var ydiff=Math.abs(aj.y-ai.y);if(!(ydiff>3.2)){var xdiff=Math.abs(aj.x-ai.x);if(!(xdiff>3.2)){var dist=xdiff*xdiff+ydiff*ydiff+zdiff*zdiff;dist>10.24||aj.chain==ai.chain&&Math.abs(aj.resi-ai.resi)<4||(dist<ai.hbondDistanceSq&&(ai.hbondOther=aj,ai.hbondDistanceSq=dist),dist<aj.hbondDistanceSq&&(aj.hbondOther=ai,aj.hbondDistanceSq=dist))}}}}}},computeSecondaryStructure=function(atomsarray){assignBackboneHBonds(atomsarray);var chres={},i,il,c,r,atom,val;for(i=0,il=atomsarray.length;i<il;i++)if(void 0===chres[(atom=atomsarray[i]).chain]&&(chres[atom.chain]=[]),isFinite(atom.hbondDistanceSq)){var other=atom.hbondOther;void 0===chres[other.chain]&&(chres[other.chain]=[]),4===Math.abs(other.resi-atom.resi)&&(chres[atom.chain][atom.resi]="h")}for(c in chres)for(r=1;r<chres[c].length-1;r++){var valbefore=chres[c][r-1],valafter=chres[c][r+1];val=chres[c][r],"h"==valbefore&&valbefore==valafter&&val!=valbefore&&(chres[c][r]=valbefore)}for(i=0,il=atomsarray.length;i<il;i++)atom=atomsarray[i],isFinite(atom.hbondDistanceSq)&&"h"!=chres[atom.chain][atom.resi]&&"h"!=atom.ss&&(chres[atom.chain][atom.resi]="maybesheet");for(let i=0,il=atomsarray.length;i<il;i++)if(atom=atomsarray[i],isFinite(atom.hbondDistanceSq)&&"maybesheet"==chres[atom.chain][atom.resi]){let other=atom.hbondOther,otherval=chres[other.chain][other.resi];"maybesheet"!=otherval&&"s"!=otherval||(chres[atom.chain][atom.resi]="s",chres[other.chain][other.resi]="s")}for(let c in chres){for(let r=1;r<chres[c].length-1;r++){let valbefore=chres[c][r-1],valafter=chres[c][r+1];val=chres[c][r],"s"==valbefore&&valbefore==valafter&&val!=valbefore&&(chres[c][r]=valbefore)}for(let r=0;r<chres[c].length;r++){let val=chres[c][r];"h"!=val&&"s"!=val||chres[c][r-1]!=val&&chres[c][r+1]!=val&&delete chres[c][r]}}for(i=0,il=atomsarray.length;i<il;i++)val=chres[(atom=atomsarray[i]).chain][atom.resi],delete atom.hbondOther,delete atom.hbondDistanceSq,void 0!==val&&"maybesheet"!=val&&(atom.ss=val,chres[atom.chain][atom.resi-1]!=val&&(atom.ssbegin=!0),chres[atom.chain][atom.resi+1]!=val&&(atom.ssend=!0))},validateBonds=function(atomsarray,serialToIndex){for(var i=0,n=atomsarray.length;i<n;i++)for(var atom=atomsarray[i],b=0;b<atom.bonds.length;b++){var a2i,atom2=atomsarray[atom.bonds[b]],atomi=serialToIndex[atom.serial],a1i;if(atom2&&atomi)atom2.bonds.indexOf(atomi)<0&&(atom2.bonds.push(atomi),atom2.bondOrder.push(atom.bondOrder[b]))}},processSymmetries=function(copyMatrices,atoms,options,cryst){var dontDuplicate=!options.duplicateAssemblyAtoms,end=atoms.length,offset=end,t,l,n;let modifiedIdentity=-1;if(options.normalizeAssembly&&cryst){let conversionMatrix=$3Dmol.conversionMatrix3(cryst.a,cryst.b,cryst.c,cryst.alpha,cryst.beta,cryst.gamma),toFrac=new $3Dmol.Matrix3;for(toFrac.getInverse3(conversionMatrix),t=0;t<copyMatrices.length;t++){let center=new $3Dmol.Vector3(0,0,0);for(n=0;n<end;n++){let xyz=new $3Dmol.Vector3(atoms[n].x,atoms[n].y,atoms[n].z);xyz.applyMatrix4(copyMatrices[t]),xyz.applyMatrix3(toFrac),center.add(xyz)}center.divideScalar(end),center=[center.x,center.y,center.z];let adjustment=[0,0,0];for(let i=0;i<3;i++){for(;center[i]<-.001;)center[i]+=1,adjustment[i]+=1;for(;center[i]>1.001;)center[i]-=1,adjustment[i]-=1}adjustment=new $3Dmol.Vector3(adjustment[0],adjustment[1],adjustment[2]),adjustment.applyMatrix3(conversionMatrix),copyMatrices[t].isNearlyIdentity()&&adjustment.lengthSq()>.001&&(modifiedIdentity=t),copyMatrices[t].translate(adjustment)}}if(dontDuplicate){if(copyMatrices.length>1)for(t=0;t<atoms.length;t++){var symmetries=[];for(l=0;l<copyMatrices.length;l++)if(!copyMatrices[l].isNearlyIdentity()){var newXYZ=new $3Dmol.Vector3;newXYZ.set(atoms[t].x,atoms[t].y,atoms[t].z),newXYZ.applyMatrix4(copyMatrices[l]),symmetries.push(newXYZ)}atoms[t].symmetries=symmetries}}else{for(n=0;n<end;n++)atoms[n].sym=-1;for(t=0;t<copyMatrices.length;t++)if(copyMatrices[t].isNearlyIdentity()||modifiedIdentity==t)for(n=0;n<end;n++)atoms[n].sym=t;else{let xyz=new $3Dmol.Vector3;for(n=0;n<end;n++){var bondsArr=[];for(l=0;l<atoms[n].bonds.length;l++)bondsArr.push(atoms[n].bonds[l]+offset);xyz.set(atoms[n].x,atoms[n].y,atoms[n].z),xyz.applyMatrix4(copyMatrices[t]);var newAtom={};for(var i in atoms[n])newAtom[i]=atoms[n][i];newAtom.x=xyz.x,newAtom.y=xyz.y,newAtom.z=xyz.z,newAtom.bonds=bondsArr,newAtom.sym=t,newAtom.index=atoms.length,atoms.push(newAtom)}offset=atoms.length}if(modifiedIdentity>=0){let xyz=new $3Dmol.Vector3;for(n=0;n<end;n++)xyz.set(atoms[n].x,atoms[n].y,atoms[n].z),xyz.applyMatrix4(copyMatrices[modifiedIdentity]),atoms[n].x=xyz.x,atoms[n].y=xyz.y,atoms[n].z=xyz.z}copyMatrices.length=0}};parsers.vasp=parsers.VASP=function(str){var atoms=[[]],lattice={},lines=str.replace(/^\s+/,"").split(/[\n\r]/);if(lines.length<3)return atoms;if(!lines[1].match(/\d+/))return console.log("Warning: second line of the vasp structure file must be a number"),atoms;if(lattice.length=parseFloat(lines[1]),lattice.length<0)return console.log("Warning: Vasp implementation for negative lattice lengths is not yet available"),atoms;lattice.xVec=new Float32Array(lines[2].replace(/^\s+/,"").split(/\s+/)),lattice.yVec=new Float32Array(lines[3].replace(/^\s+/,"").split(/\s+/)),lattice.zVec=new Float32Array(lines[4].replace(/^\s+/,"").split(/\s+/));var matrix=new $3Dmol.Matrix3(lattice.xVec[0],lattice.xVec[1],lattice.xVec[2],lattice.yVec[0],lattice.yVec[1],lattice.yVec[2],lattice.zVec[0],lattice.zVec[1],lattice.zVec[2]);matrix.multiplyScalar(lattice.length),atoms.modelData=[{symmetries:[],cryst:{matrix:matrix}}];var atomSymbols=lines[5].replace(/\s+/,"").replace(/\s+$/,"").split(/\s+/),atomSpeciesNumber=new Int16Array(lines[6].replace(/^\s+/,"").split(/\s+/)),vaspMode=lines[7].replace(/\s+/,"");if(vaspMode.match(/C/))vaspMode="cartesian";else{if(!vaspMode.match(/D/))return console.log("Warning: Unknown vasp mode in POSCAR file: mode must be either C(artesian) or D(irect)"),atoms;vaspMode="direct"}if(atomSymbols.length!=atomSpeciesNumber.length)return console.log("Warning: declaration of atomary species wrong:"),console.log(atomSymbols),console.log(atomSpeciesNumber),atoms;lines.splice(0,8);for(var atomCounter=0,i=0,len=atomSymbols.length;i<len;i++){for(var atomSymbol=atomSymbols[i],j=0,atomLen=atomSpeciesNumber[i];j<atomLen;j++){var coords=new Float32Array(lines[atomCounter+j].replace(/^\s+/,"").split(/\s+/)),atom={};atom.elem=atomSymbol,"cartesian"==vaspMode?(atom.x=lattice.length*coords[0],atom.y=lattice.length*coords[1],atom.z=lattice.length*coords[2]):(atom.x=lattice.length*(coords[0]*lattice.xVec[0]+coords[1]*lattice.yVec[0]+coords[2]*lattice.zVec[0]),atom.y=lattice.length*(coords[0]*lattice.xVec[1]+coords[1]*lattice.yVec[1]+coords[2]*lattice.zVec[1]),atom.z=lattice.length*(coords[0]*lattice.xVec[2]+coords[1]*lattice.yVec[2]+coords[2]*lattice.zVec[2])),atom.bonds=[],atoms[0].push(atom)}atomCounter+=atomSpeciesNumber[i]}return atoms},parsers.cube=parsers.CUBE=function(str){var atoms=[[]],lines=str.replace(/^\s+/,"").split(/\n\r|\r+/);if(lines.length<6)return atoms;var lineArr=lines[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),natoms=Math.abs(parseFloat(lineArr[0]));lineArr=lines[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var convFactor=parseFloat(lineArr[0])>0?.529177:1;lines=lines.splice(6,natoms);for(var start=atoms[atoms.length-1].length,end=start+lines.length,i=start;i<end;++i){var atom={};atom.serial=i;var line,tokens=lines[i-start].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");6==tokens[0]?atom.elem="C":1==tokens[0]?atom.elem="H":8==tokens[0]?atom.elem="O":17==tokens[0]&&(atom.elem="Cl"),atom.x=parseFloat(tokens[2])*convFactor,atom.y=parseFloat(tokens[3])*convFactor,atom.z=parseFloat(tokens[4])*convFactor,atom.hetflag=!0,atom.bonds=[],atom.bondOrder=[],atom.properties={},atoms[atoms.length-1].push(atom)}for(let i=0;i<atoms.length;i++)assignBonds(atoms[i]);return atoms},parsers.xyz=parsers.XYZ=function(str,options){for(var atoms=[[]],lines=str.split(/\r?\n|\r/);lines.length>0&&!(lines.length<3);){var atomCount=parseInt(lines[0]);if(isNaN(atomCount)||atomCount<=0)break;if(lines.length<atomCount+2)break;for(var offset=2,start=atoms[atoms.length-1].length,end=start+atomCount,i=start;i<end;i++){var line,tokens=lines[offset++].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),atom={};atom.serial=i;var elem=tokens[0];atom.atom=atom.elem=elem[0].toUpperCase()+elem.substr(1,1).toLowerCase(),atom.x=parseFloat(tokens[1]),atom.y=parseFloat(tokens[2]),atom.z=parseFloat(tokens[3]),atom.hetflag=!0,atom.bonds=[],atom.bondOrder=[],atom.properties={},atoms[atoms.length-1][i]=atom,tokens.length>=7&&(atom.dx=parseFloat(tokens[4]),atom.dy=parseFloat(tokens[5]),atom.dz=parseFloat(tokens[6]))}if(!options.multimodel)break;atoms.push([]),lines.splice(0,offset)}for(let i=0;i<atoms.length;i++)assignBonds(atoms[i]);if(options.onemol){var temp=atoms;(atoms=[]).push(temp[0]);for(let i=1;i<temp.length;i++){let offset=atoms[0].length;for(let j=0;j<temp[i].length;j++){let a=temp[i][j];for(let k=0;k<a.bonds.length;k++)a.bonds[k]=a.bonds[k]+offset;a.index=atoms[0].length,a.serial=atoms[0].length,atoms[0].push(a)}}}return atoms};var parseV2000=function(lines,options){var atoms=[[]],noH=!1;for(void 0!==options.keepH&&(noH=!options.keepH);lines.length>0&&!(lines.length<4);){var atomCount=parseInt(lines[3].substr(0,3));if(isNaN(atomCount)||atomCount<=0)break;var bondCount=parseInt(lines[3].substr(3,3)),offset=4;if(lines.length<4+atomCount+bondCount)break;var serialToIndex=[],start=atoms[atoms.length-1].length,end=start+atomCount,i,line;for(i=start;i<end;i++,offset++){var atom={},elem=(line=lines[offset]).substr(31,3).replace(/ /g,"");atom.atom=atom.elem=elem[0].toUpperCase()+elem.substr(1).toLowerCase(),"H"===atom.elem&&noH||(atom.serial=i,serialToIndex[i]=atoms[atoms.length-1].length,atom.x=parseFloat(line.substr(0,10)),atom.y=parseFloat(line.substr(10,10)),atom.z=parseFloat(line.substr(20,10)),atom.hetflag=!0,atom.bonds=[],atom.bondOrder=[],atom.properties={},atom.index=atoms[atoms.length-1].length,atoms[atoms.length-1].push(atom))}for(i=0;i<bondCount;i++,offset++){line=lines[offset];var from=serialToIndex[parseInt(line.substr(0,3))-1+start],to=serialToIndex[parseInt(line.substr(3,3))-1+start],order=parseInt(line.substr(6,3));void 0!==from&&void 0!==to&&(atoms[atoms.length-1][from].bonds.push(to),atoms[atoms.length-1][from].bondOrder.push(order),atoms[atoms.length-1][to].bonds.push(from),atoms[atoms.length-1][to].bondOrder.push(order))}if(!options.multimodel)break;for(options.onemol||atoms.push([]);"$$$$"!==lines[offset];)offset++;lines.splice(0,++offset)}return atoms},parseV3000=function(lines,options){var atoms=[[]],noH=!1;for(void 0!==options.keepH&&(noH=!options.keepH);lines.length>0&&!(lines.length<8)&&lines[4].startsWith("M  V30 BEGIN CTAB")&&lines[5].startsWith("M  V30 COUNTS")&&!(lines[5].length<14);){var counts=lines[5].substr(13).match(/\S+/g);if(counts.length<2)break;var atomCount=parseInt(counts[0]);if(isNaN(atomCount)||atomCount<=0)break;var bondCount=parseInt(counts[1]),offset=7;if(lines.length<8+atomCount+bondCount)break;var serialToIndex=[],start=atoms[atoms.length-1].length,end=start+atomCount,i,line;for(i=start;i<end;i++,offset++){var atomParts=(line=lines[offset]).substr(6).match(/\S+/g);if(atomParts.length>4){var atom={},elem=atomParts[1].replace(/ /g,"");atom.atom=atom.elem=elem[0].toUpperCase()+elem.substr(1).toLowerCase(),"H"===atom.elem&&noH||(atom.serial=i,serialToIndex[i]=atoms[atoms.length-1].length,atom.x=parseFloat(atomParts[2]),atom.y=parseFloat(atomParts[3]),atom.z=parseFloat(atomParts[4]),atom.hetflag=!0,atom.bonds=[],atom.bondOrder=[],atom.properties={},atom.index=atoms[atoms.length-1].length,atoms[atoms.length-1].push(atom))}}if("M  V30 END ATOM"!==lines[offset])break;if(offset++,0===bondCount||"M  V30 BEGIN BOND"!==lines[offset])break;for(offset++,i=0;i<bondCount;i++,offset++){var bondParts=(line=lines[offset]).substr(6).match(/\S+/g);if(bondParts.length>3){var from=serialToIndex[parseInt(bondParts[2])-1+start],to=serialToIndex[parseInt(bondParts[3])-1+start],order=parseInt(bondParts[1]);void 0!==from&&void 0!==to&&(atoms[atoms.length-1][from].bonds.push(to),atoms[atoms.length-1][from].bondOrder.push(order),atoms[atoms.length-1][to].bonds.push(from),atoms[atoms.length-1][to].bondOrder.push(order))}}if(!options.multimodel)break;for(options.onemol||atoms.push([]);"$$$$"!==lines[offset];)offset++;lines.splice(0,++offset)}return atoms};parsers.sdf=parsers.SDF=function(str,options){var molformat="V2000",lines=str.split(/\r?\n|\r/);return lines.length>3&&lines[3].length>38&&(molformat=lines[3].substr(34,5)),"V2000"===molformat?parseV2000(lines,options):"V3000"===molformat?parseV3000(lines,options):[[]]},parsers.cdjson=parsers.json=function(str,options){var atoms=[[]];"string"==typeof str&&(str=JSON.parse(str));for(var molecules=str.m,atomsInFile=molecules[0].a,bondsInFile=molecules[0].b,styles=molecules[0].s,parseStyle=void 0!==options&&void 0!==options.parseStyle?options.parseStyle:void 0!==styles,offset=atoms[atoms.length-1].length,i=0;i<atomsInFile.length;i++){var currentAtom=atomsInFile[i],atom={};atom.id=currentAtom.i,atom.x=currentAtom.x,atom.y=currentAtom.y,atom.z=currentAtom.z||0,atom.bonds=[],atom.bondOrder=[];var elem=currentAtom.l||"C";atom.elem=elem[0].toUpperCase()+elem.substr(1).toLowerCase(),atom.serial=atoms[atoms.length-1].length,parseStyle&&(atom.style=styles[currentAtom.s||0]),atoms[atoms.length-1].push(atom)}for(let i=0;i<bondsInFile.length;i++){let currentBond=bondsInFile[i],beginIndex=currentBond.b+offset,endIndex=currentBond.e+offset,bondOrder=currentBond.o||1,firstAtom=atoms[atoms.length-1][beginIndex],secondAtom=atoms[atoms.length-1][endIndex];firstAtom.bonds.push(endIndex),firstAtom.bondOrder.push(bondOrder),secondAtom.bonds.push(beginIndex),secondAtom.bondOrder.push(bondOrder)}return atoms},parsers.mcif=parsers.cif=function(str,options){var atoms=[],noAssembly=!options.doAssembly,modelData=atoms.modelData=[],fractionalToCartesian=function(cmat,x,y,z){return new $3Dmol.Vector3(x,y,z).applyMatrix3(cmat)};function splitRespectingQuotes(string,separator){for(var sections=[],sectionStart=0,sectionEnd=0;sectionEnd<string.length;){for(;string.substr(sectionEnd,separator.length)!==separator&&sectionEnd<string.length;){if("'"===string[sectionEnd])for(sectionEnd++;sectionEnd<string.length&&"'"!==string[sectionEnd];)sectionEnd++;else if('"'===string[sectionEnd])for(sectionEnd++;sectionEnd<string.length&&'"'!==string[sectionEnd];)sectionEnd++;sectionEnd++}sections.push(string.substr(sectionStart,sectionEnd-sectionStart)),sectionStart=sectionEnd+=separator.length}return sections}var lines=str.split(/\r?\n|\r/),linesFiltered=[],trimDisabled=!1;for(let lineNum=0;lineNum<lines.length;lineNum++){var line=lines[lineNum].split("#")[0];if(trimDisabled?";"===line[0]&&(trimDisabled=!1):";"===line[0]&&(trimDisabled=!0),trimDisabled||""!==line){if(!trimDisabled&&"_"===(line=line.trim())[0]){var dot=line.split(/\s/)[0].indexOf(".");dot>-1&&(line[dot]="_",line=line.substr(0,dot)+"_"+line.substr(dot+1))}linesFiltered.push(line)}}for(var lineNum=0;lineNum<linesFiltered.length;){for(;!linesFiltered[lineNum].startsWith("data_")||"data_global"===linesFiltered[lineNum];)lineNum++;lineNum++;for(var mmCIF={};lineNum<linesFiltered.length&&!linesFiltered[lineNum].startsWith("data_");)if(void 0===linesFiltered[lineNum][0])lineNum++;else if("_"===linesFiltered[lineNum][0]){var dataItemName=linesFiltered[lineNum].split(/\s/)[0].toLowerCase(),dataItem=mmCIF[dataItemName]=mmCIF[dataItemName]||[],restOfLine=linesFiltered[lineNum].substr(linesFiltered[lineNum].indexOf(dataItemName)+dataItemName.length);if(""===restOfLine)if(";"===linesFiltered[++lineNum][0]){var dataBlock=linesFiltered[lineNum].substr(1);for(lineNum++;";"!==linesFiltered[lineNum];)dataBlock=dataBlock+"\n"+linesFiltered[lineNum],lineNum++;dataItem.push(dataBlock)}else dataItem.push(linesFiltered[lineNum]);else dataItem.push(restOfLine.trim());lineNum++}else if("loop_"===linesFiltered[lineNum].substr(0,5)){lineNum++;for(var dataItems=[];""===linesFiltered[lineNum]||"_"===linesFiltered[lineNum][0];){if(""!==linesFiltered[lineNum]){let dataItemName=linesFiltered[lineNum].split(/\s/)[0].toLowerCase(),dataItem=mmCIF[dataItemName]=mmCIF[dataItemName]||[];dataItems.push(dataItem)}lineNum++}for(var currentDataItem=0;lineNum<linesFiltered.length&&"_"!==linesFiltered[lineNum][0]&&!linesFiltered[lineNum].startsWith("loop_")&&!linesFiltered[lineNum].startsWith("data_");){let line=splitRespectingQuotes(linesFiltered[lineNum]," ");for(var field=0;field<line.length;field++)""!==line[field]&&(dataItems[currentDataItem].push(line[field]),currentDataItem=(currentDataItem+1)%dataItems.length);lineNum++}}else lineNum++;modelData.push({symmetries:[]}),atoms.push([]);var atomCount=void 0!==mmCIF._atom_site_id?mmCIF._atom_site_id.length:mmCIF._atom_site_label.length,conversionMatrix;if(void 0!==mmCIF._cell_length_a){var a=parseFloat(mmCIF._cell_length_a),b=parseFloat(mmCIF._cell_length_b),c=parseFloat(mmCIF._cell_length_c),alpha_deg=parseFloat(mmCIF._cell_angle_alpha)||90,beta_deg=parseFloat(mmCIF._cell_angle_beta)||90,gamma_deg=parseFloat(mmCIF._cell_angle_gamma)||90;conversionMatrix=$3Dmol.conversionMatrix3(a,b,c,alpha_deg,beta_deg,gamma_deg),modelData[modelData.length-1].cryst={a:a,b:b,c:c,alpha:alpha_deg,beta:beta_deg,gamma:gamma_deg}}for(var i=0;i<atomCount;i++)if(void 0===mmCIF._atom_site_group_pdb||"TER"!==mmCIF._atom_site_group_pdb[i]){var atom={};if(void 0!==mmCIF._atom_site_cartn_x)atom.x=parseFloat(mmCIF._atom_site_cartn_x[i]),atom.y=parseFloat(mmCIF._atom_site_cartn_y[i]),atom.z=parseFloat(mmCIF._atom_site_cartn_z[i]);else{var coords=fractionalToCartesian(conversionMatrix,parseFloat(mmCIF._atom_site_fract_x[i]),parseFloat(mmCIF._atom_site_fract_y[i]),parseFloat(mmCIF._atom_site_fract_z[i]));atom.x=coords.x,atom.y=coords.y,atom.z=coords.z}atom.chain=mmCIF._atom_site_auth_asym_id?mmCIF._atom_site_auth_asym_id[i]:void 0,atom.resi=mmCIF._atom_site_auth_seq_id?parseInt(mmCIF._atom_site_auth_seq_id[i]):void 0,atom.resn=mmCIF._atom_site_auth_comp_id?mmCIF._atom_site_auth_comp_id[i].trim():void 0,atom.atom=mmCIF._atom_site_auth_atom_id?mmCIF._atom_site_auth_atom_id[i].replace(/"/gm,""):void 0,atom.hetflag=!mmCIF._atom_site_group_pdb||"HETA"===mmCIF._atom_site_group_pdb[i]||"HETATM"===mmCIF._atom_site_group_pdb[i];var elem="X";mmCIF._atom_site_type_symbol?elem=mmCIF._atom_site_type_symbol[i].replace(/\(?\+?\d+.*/,""):mmCIF._atom_site_label&&(elem=mmCIF._atom_site_label[i].split("_")[0].replace(/\(?\d+.*/,"")),atom.elem=elem[0].toUpperCase()+elem.substr(1,1).toLowerCase(),atom.bonds=[],atom.ss="c",atom.serial=i,atom.bondOrder=[],atom.properties={},atoms[atoms.length-1].push(atom)}if(void 0!==mmCIF._pdbx_struct_oper_list_id&&!noAssembly)for(let i=0;i<mmCIF._pdbx_struct_oper_list_id.length;i++){var matrix11=parseFloat(mmCIF["_pdbx_struct_oper_list_matrix[1][1]"][i]),matrix12=parseFloat(mmCIF["_pdbx_struct_oper_list_matrix[1][2]"][i]),matrix13=parseFloat(mmCIF["_pdbx_struct_oper_list_matrix[1][3]"][i]),vector1=parseFloat(mmCIF["_pdbx_struct_oper_list_vector[1]"][i]),matrix21=parseFloat(mmCIF["_pdbx_struct_oper_list_matrix[2][1]"][i]),matrix22=parseFloat(mmCIF["_pdbx_struct_oper_list_matrix[2][2]"][i]),matrix23=parseFloat(mmCIF["_pdbx_struct_oper_list_matrix[2][3]"][i]),vector2=parseFloat(mmCIF["_pdbx_struct_oper_list_vector[2]"][i]),matrix31=parseFloat(mmCIF["_pdbx_struct_oper_list_matrix[3][1]"][i]),matrix32=parseFloat(mmCIF["_pdbx_struct_oper_list_matrix[3][2]"][i]),matrix33=parseFloat(mmCIF["_pdbx_struct_oper_list_matrix[3][3]"][i]),vector3=parseFloat(mmCIF["_pdbx_struct_oper_list_vector[3]"][i]),matrix=new $3Dmol.Matrix4(matrix11,matrix12,matrix13,vector1,matrix21,matrix22,matrix23,vector2,matrix31,matrix32,matrix33,vector3);modelData[modelData.length-1].symmetries.push(matrix)}var parseTerm=function(term){var negative=term.match("-"),fractionParts=(term=term.replace(/[-xyz]/g,"")).split("/"),numerator,denominator;return denominator=void 0===fractionParts[1]?1:parseInt(fractionParts[1]),(numerator=""===fractionParts[0]?1:parseInt(fractionParts[0]))/denominator*(negative?-1:1)};if(void 0!==mmCIF._symmetry_equiv_pos_as_xyz&&!noAssembly)for(var sym=0;sym<mmCIF._symmetry_equiv_pos_as_xyz.length;sym++){var transform,componentStrings=mmCIF._symmetry_equiv_pos_as_xyz[sym].replace(/["' ]/g,"").split(",").map((function(val){return val.replace(/-/g,"+-")}));let matrix=new $3Dmol.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1);for(let coord=0;coord<3;coord++){var terms=componentStrings[coord].split("+");for(let t=0;t<terms.length;t++){var term=terms[t];if(""!==term){var coefficient=parseTerm(term);term.match("x")?matrix.elements[coord+0]=coefficient:term.match("y")?matrix.elements[coord+4]=coefficient:term.match("z")?matrix.elements[coord+8]=coefficient:matrix.elements[coord+12]=coefficient}}}var conversionMatrix4=conversionMatrix.getMatrix4(),conversionInverse=(new $3Dmol.Matrix4).getInverse(conversionMatrix4,!0);matrix=(new $3Dmol.Matrix4).multiplyMatrices(matrix,conversionInverse),matrix=(new $3Dmol.Matrix4).multiplyMatrices(conversionMatrix4,matrix),modelData[modelData.length-1].symmetries.push(matrix)}}for(let i=0;i<atoms.length;i++)assignBonds(atoms[i]),computeSecondaryStructure(atoms[i]),processSymmetries(modelData[i].symmetries,atoms[i],options,modelData[i].cryst),options.duplicateAssemblyAtoms&&!options.dontConnectDuplicatedAtoms&&assignBonds(atoms[i]);return atoms},parsers.mol2=parsers.MOL2=function(str,options){var atoms=[[]],noH=!1;void 0!==options.keepH&&(noH=!options.keepH);var mol_pos=str.search(/@<TRIPOS>MOLECULE/),atom_pos=str.search(/@<TRIPOS>ATOM/);if(-1==mol_pos||-1==atom_pos)return atoms;for(var lines=str.substr(mol_pos,str.length).split(/\r?\n|\r/);lines.length>0;){var serialToIndex=[],tokens=lines[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),natoms=parseInt(tokens[0]),nbonds=0;tokens.length>1&&(nbonds=parseInt(tokens[1]));var offset=4,i;for(i=3;i<lines.length;i++)if("@<TRIPOS>ATOM"==lines[i]){offset=i+1;break}var start=atoms[atoms.length-1].length,end=start+natoms,line;for(i=start;i<end;i++){var atom={},elem=(tokens=(line=lines[offset++]).replace(/^\s+/,"").replace(/\s+/g," ").split(" "))[5].split(".")[0];if(atom.atom=atom.elem=elem[0].toUpperCase()+elem.substr(1).toLowerCase(),"H"==atom.elem&&noH);else{var index=atoms[atoms.length-1].length,serial=parseInt(tokens[0]);atom.serial=serial,atom.x=parseFloat(tokens[2]),atom.y=parseFloat(tokens[3]),atom.z=parseFloat(tokens[4]),atom.atom=tokens[5];var charge=parseFloat(tokens[8]);atom.index=index,atom.bonds=[],atom.bondOrder=[],atom.properties={charge:charge,partialCharge:charge},serialToIndex[serial]=index,atoms[atoms.length-1].push(atom)}}for(var bonds_found=!1;offset<lines.length;)if("@<TRIPOS>BOND"==lines[offset++]){bonds_found=!0;break}if(bonds_found&&nbonds)for(i=0;i<nbonds;i++){tokens=(line=lines[offset++]).replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var from=parseInt(tokens[1]),fromAtom=atoms[atoms.length-1][serialToIndex[from]],to=parseInt(tokens[2]),toAtom=atoms[atoms.length-1][serialToIndex[to]],order=parseInt(tokens[3]);isNaN(order)&&(order=1),void 0!==fromAtom&&void 0!==toAtom&&(fromAtom.bonds.push(serialToIndex[to]),fromAtom.bondOrder.push(order),toAtom.bonds.push(serialToIndex[from]),toAtom.bondOrder.push(order))}if(!options.multimodel)break;options.onemol||atoms.push([]),lines.splice(0,offset),str=lines.join("\n")}return atoms};var isEmpty=function(obj){var name;for(name in obj)return!1;return!0},atomNameToElem=function(name,nothetero){var elem=name.replace(/ /g,"");return elem.length>0&&"H"==elem[0]&&"Hg"!=elem&&"He"!=elem&&"Hf"!=elem&&"Hs"!=elem&&"Ho"!=elem&&(elem="H"),elem.length>1&&(elem=elem[0].toUpperCase()+elem.substr(1).toLowerCase(),void 0===bondTable[elem]?elem=elem[0]:nothetero&&("Ca"==elem?elem="C":"Cd"==elem&&(elem="C"))),elem},getSinglePDB=function(lines,options,sslookup){var atoms=[],noH=!options.keepH,ignoreStruct=!!options.noSecondaryStructure,computeStruct=!options.noComputeSecondaryStructure,noAssembly=!options.doAssembly,selAltLoc=options.altLoc?options.altLoc:"A",modelData={symmetries:[]},atom,remainingLines=[],hasStruct=!1,serialToIndex=[],line,seenbonds={};for(let i=0;i<lines.length;i++){var recordName=(line=lines[i].replace(/^\s*/,"")).substr(0,6),startChain,startResi,endChain,endResi;if(0==recordName.indexOf("END")){if(remainingLines=lines.slice(i+1),"END"==recordName)for(var prop in sslookup)sslookup.hasOwnProperty(prop)&&delete sslookup[prop];break}if("ATOM  "==recordName||"HETATM"==recordName){var resn,chain,resi,icode,x,y,z,hetflag,elem,serial,altLoc,b;if(" "!=(altLoc=line.substr(16,1))&&altLoc!=selAltLoc&&"*"!=selAltLoc)continue;if(serial=parseInt(line.substr(6,5)),atom=line.substr(12,4).replace(/ /g,""),resn=line.substr(17,3).replace(/ /g,""),chain=line.substr(21,1),resi=parseInt(line.substr(22,4)),icode=line.substr(26,1),x=parseFloat(line.substr(30,8)),y=parseFloat(line.substr(38,8)),z=parseFloat(line.substr(46,8)),b=parseFloat(line.substr(60,8)),"H"==(elem=""===(elem=line.substr(76,2).replace(/ /g,""))||void 0===bondTable[elem]?atomNameToElem(line.substr(12,2),"A"==line[0]):elem[0].toUpperCase()+elem.substr(1).toLowerCase())&&noH)continue;hetflag="H"==recordName[0],serialToIndex[serial]=atoms.length,atoms.push({resn:resn,x:x,y:y,z:z,elem:elem,hetflag:hetflag,altLoc:altLoc,chain:chain,resi:resi,icode:icode,rescode:resi+(" "!=icode?"^"+icode:""),serial:serial,atom:atom,bonds:[],ss:"c",bondOrder:[],properties:{},b:b,pdbline:line})}else if("SHEET "==recordName){hasStruct=!0,startChain=line.substr(21,1),startResi=parseInt(line.substr(22,4)),endChain=line.substr(32,1),endResi=parseInt(line.substr(33,4)),startChain in sslookup||(sslookup[startChain]={}),sslookup[startChain][startResi]="s1";for(var res=startResi+1;res<endResi;res++)sslookup[startChain][res]="s";sslookup[startChain][endResi]="s2"}else if("CONECT"==recordName){var from,fromindex=serialToIndex[parseInt(line.substr(6,5))],fromAtom=atoms[fromindex],coffsets=[11,16,21,26];for(let j=0;j<4;j++){var to,toindex=serialToIndex[parseInt(line.substr(coffsets[j],5))],toAtom=atoms[toindex];if(void 0!==fromAtom&&void 0!==toAtom)if(seenbonds[[fromindex,toindex]]){seenbonds[[fromindex,toindex]]+=1;for(let bi=0;bi<fromAtom.bonds.length;bi++)if(fromAtom.bonds[bi]==toindex){var newbo=seenbonds[[fromindex,toindex]];fromAtom.bondOrder[bi]=newbo>=4?1:newbo}}else seenbonds[[fromindex,toindex]]=1,0!=fromAtom.bonds.length&&fromAtom.bonds[fromAtom.bonds.length-1]==toindex||(fromAtom.bonds.push(toindex),fromAtom.bondOrder.push(1))}}else if("HELIX "==recordName){hasStruct=!0,startChain=line.substr(19,1),startResi=parseInt(line.substr(21,4)),endChain=line.substr(31,1),endResi=parseInt(line.substr(33,4)),startChain in sslookup||(sslookup[startChain]={}),sslookup[startChain][startResi]="h1";for(let res=startResi+1;res<endResi;res++)sslookup[startChain][res]="h";sslookup[startChain][endResi]="h2"}else if(noAssembly||"REMARK"!=recordName||"BIOMT"!=line.substr(13,5)){if("CRYST1"==recordName){let a,b,c,alpha,beta,gamma;a=parseFloat(line.substr(7,8)),b=parseFloat(line.substr(16,8)),c=parseFloat(line.substr(25,8)),alpha=parseFloat(line.substr(34,6)),beta=parseFloat(line.substr(41,6)),gamma=parseFloat(line.substr(48,6)),modelData.cryst={a:a,b:b,c:c,alpha:alpha,beta:beta,gamma:gamma}}else if("ANISOU"==recordName){let serial;var anisouAtomIndex,anisouAtom=atoms[serialToIndex[parseInt(line.substr(6,5))]];if(anisouAtom){var vals=line.substr(30).trim().split(/\s+/),uMat={u11:parseInt(vals[0]),u22:parseInt(vals[1]),u33:parseInt(vals[2]),u12:parseInt(vals[3]),u13:parseInt(vals[4]),u23:parseInt(vals[5])};anisouAtom.uMat=uMat}}}else{var n,matrix=new $3Dmol.Matrix4;for(n=1;n<=3;n++)if(line=lines[i].replace(/^\s*/,""),parseInt(line.substr(18,1))==n)matrix.elements[n-1]=parseFloat(line.substr(23,10)),matrix.elements[n-1+4]=parseFloat(line.substr(33,10)),matrix.elements[n-1+8]=parseFloat(line.substr(43,10)),matrix.elements[n-1+12]=parseFloat(line.substr(53)),i++;else for(;"BIOMT"==line.substr(13,5);)i++,line=lines[i].replace(/^\s*/,"");matrix.elements[3]=0,matrix.elements[7]=0,matrix.elements[11]=0,matrix.elements[15]=1,modelData.symmetries.push(matrix),i--}}var starttime=(new Date).getTime();if(validateBonds(atoms,serialToIndex),assignPDBBonds(atoms),noAssembly||processSymmetries(modelData.symmetries,atoms,options,modelData.cryst),computeStruct&&!ignoreStruct&&(starttime=(new Date).getTime(),computeSecondaryStructure(atoms)),starttime=(new Date).getTime(),!isEmpty(sslookup))for(let i=0;i<atoms.length;i++)if(void 0!==(atom=atoms[i])&&atom.chain in sslookup&&atom.resi in sslookup[atom.chain]){var code=sslookup[atom.chain][atom.resi];atom.ss=code[0],code.length>1&&("1"==code[1]?atom.ssbegin=!0:"2"==code[1]&&(atom.ssend=!0))}return[atoms,modelData,remainingLines]};parsers.pdb=parsers.PDB=parsers.pdbqt=parsers.PDBQT=function(str,options){var atoms=[],sslookup={};atoms.modelData=[];for(var lines=str.split(/\r?\n|\r/);lines.length>0;){var pdbinfo=getSinglePDB(lines,options,sslookup),modelatoms=pdbinfo[0],modelData=pdbinfo[1];if(lines=pdbinfo[2],0!=modelatoms.length){if(options.multimodel&&options.onemol&&atoms.length>0)for(var inc=atoms[0].length,i=0;i<modelatoms.length;i++){var atom=modelatoms[i];atom.index=i;for(var b=0;b<atom.bonds.length;b++)atom.bonds[b]+=inc;atoms[0].push(atom)}else atoms.modelData.push(modelData),atoms.push(modelatoms);if(!options.multimodel)break}}return atoms},parsers.pqr=parsers.PQR=function(str,options){var atoms=[[]],computeStruct=!options.noSecondaryStructure;atoms.modelData=[{symmetries:[]}];var serialToIndex=[],lines=str.split(/\r?\n|\r/),line;for(let i=0;i<lines.length;i++){var recordName=(line=lines[i].replace(/^\s*/,"")).substr(0,6);if(0==recordName.indexOf("END")){if(options.multimodel){options.onemol||atoms.push([]);continue}break}if("ATOM  "==recordName||"HETATM"==recordName){var hetflag;let serial=parseInt(line.substr(6,5)),atom=line.substr(12,4).replace(/ /g,""),resn=line.substr(17,3).trim(),chain=line.substr(21,1),resi=parseInt(line.substr(22,4));var vals=line.substr(30).trim().split(/\s+/),x=parseFloat(vals[0]),y=parseFloat(vals[1]),z=parseFloat(vals[2]),charge=parseFloat(vals[3]),radius=parseFloat(vals[4]),elem=atom[0];atom.length>1&&atom[1].toUpperCase()!=atom[1]&&(elem=atom.substr(0,2)),hetflag="H"==line[0],serialToIndex[serial]=atoms[atoms.length-1].length,atoms[atoms.length-1].push({resn:resn,x:x,y:y,z:z,elem:elem,hetflag:hetflag,chain:chain,resi:resi,serial:serial,atom:atom,bonds:[],ss:"c",bondOrder:[],properties:{charge:charge,partialCharge:charge,radius:radius},pdbline:line})}else if("CONECT"==recordName){var from=parseInt(line.substr(6,5)),fromAtom=atoms[atoms.length-1][serialToIndex[from]];for(let j=0;j<4;j++){var to=parseInt(line.substr([11,16,21,26][j],5)),toAtom=atoms[atoms.length-1][serialToIndex[to]];void 0!==fromAtom&&void 0!==toAtom&&(fromAtom.bonds.push(serialToIndex[to]),fromAtom.bondOrder.push(1))}}}for(let i=0;i<atoms.length;i++)assignPDBBonds(atoms[i]),computeStruct&&computeSecondaryStructure(atoms[i]);return atoms};var fromCharCode=function(charCodeArray){return String.fromCharCode.apply(null,charCodeArray).replace(/\0/g,"")},convertSS=function(val){return 0==val||2==val||4==val?"h":3==val?"s":"c"};let mmtfHETATMtypes=new Set(["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","NON-POLYMER","OTHER","PEPTIDE-LIKE","SACCHARIDE"]);return parsers.mmtf=parsers.MMTF=function(bindata,options){var noH=!options.keepH,selAltLoc=options.altLoc?options.altLoc:"A",ignoreStruct=!!options.noSecondaryStructure,computeStruct=!options.noComputeSecondaryStructure,noAssembly=!options.doAssembly,assemblyIndex=options.assemblyIndex?options.assemblyIndex:0;"string"==typeof bindata&&(bindata=$3Dmol.base64ToArray(bindata));var mmtfData=MMTF.decode(bindata),atoms=[[]],modelData=atoms.modelData=[],modelIndex=0,chainIndex=0,groupIndex=0,atomIndex=0,secStructList=mmtfData.secStructList,insCodeList=mmtfData.insCodeList,sequenceIndexList=mmtfData.sequenceIndexList,bFactorList=mmtfData.bFactorList,altLocList=mmtfData.altLocList,occupancyList=mmtfData.occupancyList,bondAtomList=mmtfData.bondAtomList,bondOrderList=mmtfData.bondOrderList,numModels=mmtfData.numModels,i,j,k,kl,m,n;if(0==numModels)return atoms;options.multimodel||(numModels=1);var symmetries=[];if(!noAssembly&&mmtfData.bioAssemblyList&&mmtfData.bioAssemblyList.length>0){var transforms=mmtfData.bioAssemblyList[assemblyIndex].transformList;for(i=0,n=transforms.length;i<n;i++){var matrix=new $3Dmol.Matrix4(transforms[i].matrix);matrix.transpose(),symmetries.push(matrix)}}var unitCell=null;if(mmtfData.unitCell){var u=mmtfData.unitCell;unitCell={a:u[0],b:u[1],c:u[2],alpha:u[3],beta:u[4],gamma:u[5]}}let chainIsPolymer=[];mmtfData.entityList.forEach(entity=>{entity.chainIndexList.forEach(ch=>{chainIsPolymer[ch]="polymer"==entity.type})});var bondAtomListStart=0;for(m=0;m<numModels;m++){var modelChainCount=mmtfData.chainsPerModel[m],matoms=atoms[atoms.length-1],serialToIndex=[];for(modelData.push({symmetries:symmetries,cryst:unitCell}),i=0;i<modelChainCount;++i){var chainGroupCount=mmtfData.groupsPerChain[chainIndex],chainId=fromCharCode(mmtfData.chainIdList.subarray(4*chainIndex,4*chainIndex+4));mmtfData.chainNameList&&(chainId=fromCharCode(mmtfData.chainNameList.subarray(4*chainIndex,4*chainIndex+4)));var startGroup=groupIndex,prevSS="";for(j=0;j<chainGroupCount;++j){var groupData=mmtfData.groupList[mmtfData.groupTypeList[groupIndex]],groupAtomCount=groupData.atomNameList.length,secStruct=0,secStructBegin=!1,secStructEnd=!1;if(secStructList){secStruct=secStructList[groupIndex];var sscode=convertSS(secStruct);0!=groupIndex&&sscode==prevSS||(secStructBegin=!0),prevSS=sscode;var nextgroup=groupIndex+1;(nextgroup>=secStructList.length||convertSS(secStructList[nextgroup]!=sscode))&&(secStructEnd=!0)}var insCode=null;mmtfData.insCodeList&&(insCode=String.fromCharCode(insCodeList[groupIndex]));var sequenceIndex=null;sequenceIndexList&&(sequenceIndex=sequenceIndexList[groupIndex]);var groupId=mmtfData.groupIdList[groupIndex],groupName=groupData.groupName;let groupType=groupData.chemCompType;var startAtom=atomIndex;let isHETATM=mmtfHETATMtypes.has(groupType)||!chainIsPolymer[chainIndex];for(k=0;k<groupAtomCount;++k){var element=groupData.elementList[k];if(noH&&"H"==element)atomIndex+=1;else{var bFactor="";bFactorList&&(bFactor=bFactorList[atomIndex]);var altLoc="";altLocList&&altLocList[atomIndex]&&(altLoc=String.fromCharCode(altLocList[atomIndex]));var occupancy="";if(occupancyList&&(occupancy=occupancyList[atomIndex]),""==altLoc||altLoc==selAltLoc||"*"==selAltLoc){var atomId=mmtfData.atomIdList[atomIndex],atomName=groupData.atomNameList[k],atomCharge=0;groupData.atomChargeList&&(atomCharge=groupData.atomChargeList[k]);var xCoord=mmtfData.xCoordList[atomIndex],yCoord=mmtfData.yCoordList[atomIndex],zCoord=mmtfData.zCoordList[atomIndex];serialToIndex[atomIndex]=matoms.length,matoms.push({resn:groupName,x:xCoord,y:yCoord,z:zCoord,elem:element,hetflag:isHETATM,chain:chainId,resi:groupId,icode:altLoc,rescode:groupId+(" "!=altLoc?"^"+altLoc:""),serial:atomId,altLoc:altLoc,index:atomIndex,atom:atomName,bonds:[],ss:convertSS(secStruct),ssbegin:secStructBegin,ssend:secStructEnd,bondOrder:[],properties:{charge:atomCharge,occupancy:occupancy},b:bFactor}),atomIndex+=1}else atomIndex+=1}}var groupBondAtomList=groupData.bondAtomList;for(k=0,kl=groupData.bondOrderList.length;k<kl;++k){var atomIndex1=startAtom+groupBondAtomList[2*k],atomIndex2=startAtom+groupBondAtomList[2*k+1],bondOrder=groupData.bondOrderList[k],i1=serialToIndex[atomIndex1],i2=serialToIndex[atomIndex2],a1=matoms[i1],a2=matoms[i2];a1&&a2&&(a1.bonds.push(i2),a1.bondOrder.push(bondOrder),a2.bonds.push(i1),a2.bondOrder.push(bondOrder))}groupIndex+=1}for(groupIndex=startGroup,j=0;j<chainGroupCount;++j)groupIndex+=1;chainIndex+=1}if(bondAtomList)for(let k=bondAtomListStart,kl=bondAtomList.length;k<kl;k+=2){let atomIndex1=bondAtomList[k],atomIndex2=bondAtomList[k+1],bondOrder=bondOrderList?bondOrderList[k/2]:1;if(atomIndex1>=atomIndex){bondAtomListStart=k;break}let i1=serialToIndex[atomIndex1],i2=serialToIndex[atomIndex2],a1=matoms[i1],a2=matoms[i2];a1&&a2&&(a1.bonds.push(i2),a1.bondOrder.push(bondOrder),a2.bonds.push(i1),a2.bondOrder.push(bondOrder))}options.multimodel&&(options.onemol||atoms.push([])),modelIndex+=1}if(!noAssembly)for(let n=0;n<atoms.length;n++)processSymmetries(modelData[n].symmetries,atoms[n],options,modelData[n].cryst);return computeStruct&&!ignoreStruct&&computeSecondaryStructure(atoms),atoms},parsers.prmtop=parsers.PRMTOP=function(str){var atoms=[],atomIndex,count=0,lines=str.split(/\r?\n|\r/);if(!(lines.length>0&&lines[0].includes("VERSION")))return[];var sectionList=lines.filter((function(line){return line.includes("POINTERS")||line.includes("ATOM_NAME")||line.includes("CHARGE")||line.includes("RADII")||line.includes("BONDS_INC_HYDROGEN")||line.includes("BONDS_WITHOUT_HYDROGEN")})),index=getIndex("POINTERS");if(-1==index)return[];var col=getColEleSize(index),atomCount=parseInt(lines[index+1].slice(0,col[1]));if(isNaN(atomCount)||atomCount<=0)return[];if(-1==(index=getIndex("ATOM_NAME")))return[];var noOfCol=(col=getColEleSize(index))[0];for(let i=0;i<atomCount/col[0];i++){i==parseInt(atomCount/col[0])&&(noOfCol=atomCount%col[0]);for(let j=0;j<noOfCol;j++){let atom={},properties={charge:"",radii:""};atom.serial=count,atom.x=0,atom.y=0,atom.z=0,atom.atom=lines[index+1].slice(col[1]*j,col[1]*(j+1)),atom.elem=lines[index+1].slice(col[1]*j,col[1]*j+1),atom.properties=properties,atom.bonds=[],atom.bondOrder=[],atoms.push(atom),count++}index++}if(-1!=(index=getIndex("CHARGE"))){count=0,noOfCol=(col=getColEleSize(index))[0];for(let i=0;i<atomCount/col[0];i++){i==parseInt(atomCount/col[0])&&(noOfCol=atomCount%col[0]);for(let j=0;j<noOfCol;j++)atoms[count].properties.charge=parseFloat(lines[index+1].slice(col[1]*j,col[1]*(j+1))),count++;index++}}if(-1!=(index=getIndex("RADII"))){count=0,noOfCol=(col=getColEleSize(index))[0];for(let i=0;i<atomCount/col[0];i++){i==parseInt(atomCount/col[0])&&(noOfCol=atomCount%col[0]);for(let j=0;j<noOfCol;j++)atoms[count].properties.radii=parseFloat(lines[index+1].slice(col[1]*j,col[1]*(j+1))),count++;index++}}if(-1!=(index=getIndex("BONDS_WITHOUT_HYDROGEN")))for(count=0,noOfCol=(col=getColEleSize(index))[0],index+=1;!lines[index].match(/^%FLAG/);){lines[index+1].match(/^%FLAG/)&&(noOfCol=atomCount%col[0]);for(let j=0;j<noOfCol;j++)count%3==0?atomIndex=parseInt(lines[index].slice(col[1]*j,col[1]*(j+1))/3):count%3==1&&atoms[atomIndex].bonds.push(parseInt(lines[index].slice(col[1]*j,col[1]*(j+1))/3)),count++;index++}if(-1!=(index=getIndex("BONDS_INC_HYDROGEN")))for(count=0,noOfCol=(col=getColEleSize(index))[0],index+=1;!lines[index].match(/^%FLAG/);){lines[index+1].match(/^%FLAG/)&&(noOfCol=atomCount%col[0]);for(let j=0;j<noOfCol;j++)count%3==0?atomIndex=parseInt(lines[index].slice(col[1]*j,col[1]*(j+1))/3):count%3==1&&atoms[atomIndex].bonds.push(parseInt(lines[index].slice(col[1]*j,col[1]*(j+1))/3)),count++;index++}function getIndex(section){var index=lines.indexOf(sectionList.filter((function(line){return line.includes(section)}))[0]);if(Number.isInteger(index)&&index>0){for(;!lines[index].includes("FORMAT");)index++;return index}return-1}function getColEleSize(i){var numberOfCol=lines[i].match(/\((\d*)\S*/),elementSize=lines[i].match(/[a-zA-Z](\d*)\)\s*/);return null==elementSize&&(elementSize=lines[i].match(/[a-zA-Z](\d*)\.\d*\)\s*/)),[numberOfCol[1],elementSize[1]]}return[atoms]},parsers.gro=parsers.GRO=function(str){for(var allatoms=[],lines=str.split(/\r?\n|\r/);lines.length>0&&!(lines.length<3);){var atomCount=parseInt(lines[1]);if(isNaN(atomCount)||atomCount<=0)break;if(lines.length<atomCount+3)break;var atoms=[];allatoms.push(atoms);for(var offset=2,start=atoms.length,end=start+atomCount,i=start;i<end;i++){var line=lines[offset++],atom={};atom.serial=i,atom.atom=line.slice(10,15).trim(),atom.elem=atomNameToElem(atom.atom,!0),atom.x=10*parseFloat(line.slice(20,28)),atom.y=10*parseFloat(line.slice(28,36)),atom.z=10*parseFloat(line.slice(36,44)),atom.resi=parseInt(line.slice(0,5)),atom.resn=line.slice(5,10).trim(),atom.bonds=[],atom.bondOrder=[],atom.properties={},line.length>44&&(atom.dx=10*parseFloat(line.slice(44,52)),atom.dy=10*parseFloat(line.slice(52,60)),atom.dz=10*parseFloat(line.slice(60,68))),atoms[i]=atom}if(lines.length<=offset+3){var last,box=lines[offset++].trim().split(/\s+/);if(3==box.length){for(var b=0;b<3;b++)box[b]=10*parseFloat(box[b]);allatoms.box=box}}lines.splice(0,++offset)}for(let i=0;i<allatoms.length;i++)assignPDBBonds(allatoms[i]);return allatoms},parsers.lammpstrj=parsers.LAMMPSTRJ=function(str,options){for(var atoms=[],dic={id:"serial",type:"atom",element:"elem",q:"charge",radius:"radius",x:"x",xu:"x",xs:"x",xsu:"x",y:"y",yu:"y",ys:"y",ysu:"y",z:"z",zu:"z",zs:"z",zsu:"z"},lines=str.split(/\r?\n|\r/),offset=0,atomCount=0,start=0;start<lines.length-9;){for(var j=start;j<lines.length;j++)if(lines[j].match(/ITEM: NUMBER OF ATOMS/)&&(atomCount=parseInt(lines[j+1])),lines[j].match(/ITEM: ATOMS/)){offset=j+1;break}var types=lines[offset-1].replace("ITEM: ATOMS ","").split(" ");atoms.push([]);for(let j=offset;j<offset+atomCount;j++){for(var atom={},properties={},tokens=lines[j].split(" "),k=0;k<tokens.length;k++){var prop=dic[types[k]];null!=prop&&("serial"==prop?atom[prop]=parseInt(tokens[k]):"x"==prop||"y"==prop||"z"===prop?atom[prop]=parseFloat(tokens[k]):"charge"==prop||"radius"==prop?properties[prop]=parseFloat(tokens[k]):atom[prop]=tokens[k]),atom.properties=properties,atom.bonds=[],atom.bondOrder=[]}atoms[atoms.length-1][j-offset]=atom}start=offset+atomCount-1}if(options.assignbonds)for(var i=0;i<atoms.length;i++)assignBonds(atoms[i]);return atoms},parsers}();var $3Dmol=$3Dmol||{};$3Dmol.partialCharges={"ALA:N":-.15,"ALA:CA":.1,"ALA:CB":0,"ALA:C":.6,"ALA:O":-.55,"ARG:N":-.15,"ARG:CA":.1,"ARG:CB":0,"ARG:CG":0,"ARG:CD":.1,"ARG:NE":-.1,"ARG:CZ":.5,"ARG:NH1":.25,"ARG:NH2":.25,"ARG:C":.6,"ARG:O":-.55,"ASN:N":-.15,"ASN:CA":.1,"ASN:CB":0,"ASN:CG":.55,"ASN:OD1":-.55,"ASN:ND2":0,"ASN:C":.6,"ASN:O":-.55,"ASP:N":-.15,"ASP:CA":.1,"ASP:CB":0,"ASP:CG":.14,"ASP:OD1":-.57,"ASP:OD2":-.57,"ASP:C":.6,"ASP:O":-.55,"CYS:N":-.15,"CYS:CA":.1,"CYS:CB":.19,"CYS:SG":-.19,"CYS:C":.6,"CYS:O":-.55,"GLN:N":-.15,"GLN:CA":.1,"GLN:CB":0,"GLN:CG":0,"GLN:CD":.55,"GLN:OE1":-.55,"GLN:NE2":0,"GLN:C":.6,"GLN:O":-.55,"GLU:N":-.15,"GLU:CA":.1,"GLU:CB":0,"GLU:CG":0,"GLU:CD":.14,"GLU:OE1":-.57,"GLU:OE2":-.57,"GLU:C":.6,"GLU:O":-.55,"GLY:N":-.15,"GLY:CA":.1,"GLY:C":.6,"GLY:O":-.55,"HIS:N":-.15,"HIS:CA":.1,"HIS:CB":0,"HIS:CG":.1,"HIS:ND1":-.1,"HIS:CD2":.1,"HIS:NE2":-.4,"HIS:CE1":.3,"HIS:C":.6,"HIS:O":-.55,"ILE:N":-.15,"ILE:CA":.1,"ILE:CB":0,"ILE:CG2":0,"ILE:CG1":0,"ILE:CD":0,"ILE:C":.6,"ILE:O":-.55,"LEU:N":-.15,"LEU:CA":.1,"LEU:CB":0,"LEU:CG":0,"LEU:CD1":0,"LEU:CD2":0,"LEU:C":.6,"LEU:O":-.55,"LYS:N":-.15,"LYS:CA":.1,"LYS:CB":0,"LYS:CG":0,"LYS:CD":0,"LYS:CE":.25,"LYS:NZ":.75,"LYS:C":.6,"LYS:O":-.55,"MET:N":-.15,"MET:CA":.1,"MET:CB":0,"MET:CG":.06,"MET:SD":-.12,"MET:CE":.06,"MET:C":.6,"MET:O":-.55,"PHE:N":-.15,"PHE:CA":.1,"PHE:CB":0,"PHE:CG":0,"PHE:CD1":0,"PHE:CD2":0,"PHE:CE1":0,"PHE:CE2":0,"PHE:CZ":0,"PHE:C":.6,"PHE:O":-.55,"PRO:N":-.25,"PRO:CD":.1,"PRO:CA":.1,"PRO:CB":0,"PRO:CG":0,"PRO:C":.6,"PRO:O":-.55,"SER:N":-.15,"SER:CA":.1,"SER:CB":.25,"SER:OG":-.25,"SER:C":.6,"SER:O":-.55,"THR:N":-.15,"THR:CA":.1,"THR:CB":.25,"THR:OG1":-.25,"THR:CG2":0,"THR:C":.6,"THR:O":-.55,"TRP:N":-.15,"TRP:CA":.1,"TRP:CB":0,"TRP:CG":-.03,"TRP:CD2":.1,"TRP:CE2":-.04,"TRP:CE3":-.03,"TRP:CD1":.06,"TRP:NE1":-.06,"TRP:CZ2":0,"TRP:CZ3":0,"TRP:CH2":0,"TRP:C":.6,"TRP:O":-.55,"TYR:N":-.15,"TYR:CA":.1,"TYR:CB":0,"TYR:CG":0,"TYR:CD1":0,"TYR:CE1":0,"TYR:CD2":0,"TYR:CE2":0,"TYR:CZ":.25,"TYR:OH":-.25,"TYR:C":.6,"TYR:O":-.55,"VAL:N":-.15,"VAL:CA":.1,"VAL:CB":0,"VAL:CG1":0,"VAL:CG2":0,"VAL:C":.6,"VAL:O":-.55},$3Dmol.applyPartialCharges=function(atom,keepexisting){if((!keepexisting||void 0===atom.partialCharge)&&atom.resn&&atom.atom){var key=atom.resn+":"+atom.atom;atom.properties.partialCharge=$3Dmol.partialCharges[key]}},$3Dmol.VolumeData=function(str,format,options){if(this.unit={x:1,y:1,z:1},this.origin={x:0,y:0,z:0},this.size={x:0,y:0,z:0},this.data=new Float32Array([]),this.matrix=null,format=format.toLowerCase(),/\.gz$/.test(format)){format=format.replace(/\.gz$/,"");try{this[format]&&this[format].isbinary?("string"==typeof str&&(str=$3Dmol.base64ToArray(str)),str=pako.inflate(str)):str=new TextDecoder("utf-8").decode(pako.inflate(str))}catch(err){console.log(err)}}if(this[format]&&(this[format].isbinary&&"string"==typeof str&&(str=$3Dmol.base64ToArray(str)),this[format](str)),options){if(options.negate)for(let i=0,n=this.data.length;i<n;i++)this.data[i]=-this.data[i];if(options.normalize){var total=0;for(let i=0,n=this.data.length;i<n;i++)total+=this.data[i];var mean=total/this.data.length;console.log("computed mean: "+mean),total=0;for(let i=0,n=this.data.length;i<n;i++){var diff=this.data[i]-mean;total+=diff*diff}var variance=total/this.data.length;for(let i=0,n=this.data.length;i<n;i++)this.data[i]=(this.data[i]-mean)/variance}}},$3Dmol.VolumeData.prototype.getIndex=function(x,y,z){if(this.matrix){this.inversematrix||(this.inversematrix=(new $3Dmol.Matrix4).getInverse(this.matrix));var pt=new $3Dmol.Vector3(x,y,z);x=(pt=pt.applyMatrix4(this.inversematrix)).x,y=pt.y,z=pt.z}else x-=this.origin.x,y-=this.origin.y,z-=this.origin.z,x/=this.unit.x,y/=this.unit.y,z/=this.unit.z;return x=Math.round(x),y=Math.round(y),z=Math.round(z),x<0||x>=this.size.x?-1:y<0||y>=this.size.y?-1:z<0||z>=this.size.z?-1:x*this.size.y*this.size.z+y*this.size.z+z},$3Dmol.VolumeData.prototype.getVal=function(x,y,z){let i=this.getIndex(x,y,z);return i<0?0:this.data[i]},$3Dmol.VolumeData.prototype.getCoordinates=function(index){var x=index/(this.size.y*this.size.z),y=index%(this.size.y*this.size.z),z=index%this.size.z;return x*=this.unit.x,y*=this.unit.y,z*=this.unit.z,{x:x+=this.origin.x,y:y+=this.origin.y,z:z+=this.origin.z}},$3Dmol.VolumeData.prototype.vasp=function(str){var lines=str.replace(/^\s+/,"").split(/[\n\r]/),atomicData,natoms=$3Dmol.Parsers.vasp(str)[0].length;if(0==natoms)return console.log("No good formating of CHG or CHGCAR file, not atomic information provided in the file."),void(this.data=[]);var l_units=1.889725992,e_units=.036749309,convFactor=parseFloat(lines[1]),v;v=lines[2].replace(/^\s+/,"").split(/\s+/);var xVec=new $3Dmol.Vector3(parseFloat(v[0]),parseFloat(v[1]),parseFloat(v[2])).multiplyScalar(convFactor*l_units);v=lines[3].replace(/^\s+/,"").split(/\s+/);var yVec=new $3Dmol.Vector3(parseFloat(v[0]),parseFloat(v[1]),parseFloat(v[2])).multiplyScalar(convFactor*l_units);v=lines[4].replace(/^\s+/,"").split(/\s+/);var zVec=new $3Dmol.Vector3(parseFloat(v[0]),parseFloat(v[1]),parseFloat(v[2])).multiplyScalar(convFactor*l_units),vol=xVec.x*(yVec.y*zVec.z-zVec.y*yVec.z)-yVec.x*(xVec.y*zVec.z-zVec.y*xVec.z)+zVec.x*(xVec.y*yVec.z-yVec.y*xVec.z),vol_scale=1/(vol=Math.abs(vol)/Math.pow(l_units,3));lines.splice(0,8+natoms+1);var lineArr=lines[0].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),nX=Math.abs(lineArr[0]),nY=Math.abs(lineArr[1]),nZ=Math.abs(lineArr[2]),origin=this.origin=new $3Dmol.Vector3(0,0,0);this.size={x:nX,y:nY,z:nZ},this.unit=new $3Dmol.Vector3(xVec.x,yVec.y,zVec.z),xVec=xVec.multiplyScalar(1/(l_units*nX)),yVec=yVec.multiplyScalar(1/(l_units*nY)),zVec=zVec.multiplyScalar(1/(l_units*nZ)),0==xVec.y&&0==xVec.z&&0==yVec.x&&0==yVec.z&&0==zVec.x&&0==zVec.y||(this.matrix=new $3Dmol.Matrix4(xVec.x,yVec.x,zVec.x,0,xVec.y,yVec.y,zVec.y,0,xVec.z,yVec.z,zVec.z,0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,(new $3Dmol.Matrix4).makeTranslation(origin.x,origin.y,origin.z)),this.origin=new $3Dmol.Vector3(0,0,0),this.unit=new $3Dmol.Vector3(1,1,1)),lines.splice(0,1);var raw=lines.join(" ");(raw=(raw=raw.replace(/^\s+/,"")).split(/[\s\r]+/)).splice(nX*nY*nZ+1);for(var preConvertedData=new Float32Array(raw),i=0;i<preConvertedData.length;i++)preConvertedData[i]=preConvertedData[i]*vol_scale*e_units;this.data=preConvertedData},$3Dmol.VolumeData.prototype.dx=function(str){var lines=str.split(/[\n\r]+/),i,m,recounts=/gridpositions\s+counts\s+(\d+)\s+(\d+)\s+(\d+)/,reorig=/^origin\s+(\S+)\s+(\S+)\s+(\S+)/,redelta=/^delta\s+(\S+)\s+(\S+)\s+(\S+)/,follows=/data follows/;for(i=0;i<lines.length;i++){var line=lines[i];if(m=recounts.exec(line)){var nX=parseInt(m[1]),nY=parseInt(m[2]),nZ=parseInt(m[3]);this.size={x:nX,y:nY,z:nZ}}else if(m=redelta.exec(line)){var xunit=parseFloat(m[1]);if(0==parseFloat(m[2])&&0==parseFloat(m[3])||console.log("Non-orthogonal delta matrix not currently supported in dx format"),line=lines[i+=1],null==(m=redelta.exec(line)))return void console.log("Parse error in dx delta matrix");var yunit=parseFloat(m[2]);if(0==parseFloat(m[1])&&0==parseFloat(m[3])||console.log("Non-orthogonal delta matrix not currently supported in dx format"),line=lines[i+=1],null==(m=redelta.exec(line)))return void console.log("Parse error in dx delta matrix");var zunit=parseFloat(m[3]);0==parseFloat(m[1])&&0==parseFloat(m[2])||console.log("Non-orthogonal delta matrix not currently supported in dx format"),this.unit=new $3Dmol.Vector3(xunit,yunit,zunit)}else if(m=reorig.exec(line)){var xorig=parseFloat(m[1]),yorig=parseFloat(m[2]),zorig=parseFloat(m[3]);this.origin=new $3Dmol.Vector3(xorig,yorig,zorig)}else if(m=follows.exec(line))break}if(i+=1,this.size&&this.origin&&this.unit&&this.size){var raw=lines.splice(i).join(" ");raw=raw.split(/[\s\r]+/),this.data=new Float32Array(raw)}else console.log("Error parsing dx format")},$3Dmol.VolumeData.prototype.cube=function(str){var lines=str.replace(/^\s+/,"").split(/[\n\r]+/);if(!(lines.length<6)){var lineArr=lines[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),atomsnum=parseFloat(lineArr[0]),natoms=Math.abs(atomsnum),origin=this.origin=new $3Dmol.Vector3(parseFloat(lineArr[1]),parseFloat(lineArr[2]),parseFloat(lineArr[3])),convFactor=(lineArr=lines[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" "))[0]>0?.529177:1;origin.multiplyScalar(convFactor);var nX=Math.abs(lineArr[0]),xVec=new $3Dmol.Vector3(parseFloat(lineArr[1]),parseFloat(lineArr[2]),parseFloat(lineArr[3])).multiplyScalar(convFactor);lineArr=lines[4].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var nY=Math.abs(lineArr[0]),yVec=new $3Dmol.Vector3(parseFloat(lineArr[1]),parseFloat(lineArr[2]),parseFloat(lineArr[3])).multiplyScalar(convFactor);lineArr=lines[5].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var nZ=Math.abs(lineArr[0]),zVec=new $3Dmol.Vector3(parseFloat(lineArr[1]),parseFloat(lineArr[2]),parseFloat(lineArr[3])).multiplyScalar(convFactor);this.size={x:nX,y:nY,z:nZ},this.unit=new $3Dmol.Vector3(xVec.x,yVec.y,zVec.z),0==xVec.y&&0==xVec.z&&0==yVec.x&&0==yVec.z&&0==zVec.x&&0==zVec.y||(this.matrix=new $3Dmol.Matrix4(xVec.x,yVec.x,zVec.x,0,xVec.y,yVec.y,zVec.y,0,xVec.z,yVec.z,zVec.z,0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,(new $3Dmol.Matrix4).makeTranslation(origin.x,origin.y,origin.z)),this.origin=new $3Dmol.Vector3(0,0,0),this.unit=new $3Dmol.Vector3(1,1,1));var headerlines=6;atomsnum<0&&headerlines++;var raw=lines.splice(natoms+headerlines).join(" ");raw=(raw=raw.replace(/^\s+/,"")).split(/[\s\r]+/),this.data=new Float32Array(raw)}},$3Dmol.VolumeData.prototype.ccp4=function(bin){var header={};bin=new Int8Array(bin);var intView=new Int32Array(bin.buffer,0,56),floatView=new Float32Array(bin.buffer,0,56),dv=new DataView(bin.buffer);if(header.MAP=String.fromCharCode(dv.getUint8(208),dv.getUint8(209),dv.getUint8(210),dv.getUint8(211)),header.MACHST=[dv.getUint8(212),dv.getUint8(213)],17===header.MACHST[0]&&17===header.MACHST[1])for(var n=bin.byteLength,i=0;i<n;i+=4)dv.setFloat32(i,dv.getFloat32(i),!0);header.NX=intView[0],header.NY=intView[1],header.NZ=intView[2],header.MODE=intView[3],header.NXSTART=intView[4],header.NYSTART=intView[5],header.NZSTART=intView[6],header.MX=intView[7],header.MY=intView[8],header.MZ=intView[9],header.xlen=floatView[10],header.ylen=floatView[11],header.zlen=floatView[12],header.alpha=floatView[13],header.beta=floatView[14],header.gamma=floatView[15],header.MAPC=intView[16],header.MAPR=intView[17],header.MAPS=intView[18],header.DMIN=floatView[19],header.DMAX=floatView[20],header.DMEAN=floatView[21],header.ISPG=intView[22],header.NSYMBT=intView[23],header.LSKFLG=intView[24],header.originX=floatView[49],header.originY=floatView[50],header.originZ=floatView[51],header.ARMS=floatView[54];var h=header,basisX=[h.xlen,0,0],basisY=[h.ylen*Math.cos(Math.PI/180*h.gamma),h.ylen*Math.sin(Math.PI/180*h.gamma),0],basisZ=[h.zlen*Math.cos(Math.PI/180*h.beta),h.zlen*(Math.cos(Math.PI/180*h.alpha)-Math.cos(Math.PI/180*h.gamma)*Math.cos(Math.PI/180*h.beta))/Math.sin(Math.PI/180*h.gamma),0];basisZ[2]=Math.sqrt(h.zlen*h.zlen*Math.sin(Math.PI/180*h.beta)*Math.sin(Math.PI/180*h.beta)-basisZ[1]*basisZ[1]);var basis=[0,basisX,basisY,basisZ],nxyz=[0,h.MX,h.MY,h.MZ],mapcrs=[0,h.MAPC,h.MAPR,h.MAPS];this.matrix=new $3Dmol.Matrix4,this.matrix.set(basis[mapcrs[1]][0]/nxyz[mapcrs[1]],basis[mapcrs[2]][0]/nxyz[mapcrs[2]],basis[mapcrs[3]][0]/nxyz[mapcrs[3]],0,basis[mapcrs[1]][1]/nxyz[mapcrs[1]],basis[mapcrs[2]][1]/nxyz[mapcrs[2]],basis[mapcrs[3]][1]/nxyz[mapcrs[3]],0,basis[mapcrs[1]][2]/nxyz[mapcrs[1]],basis[mapcrs[2]][2]/nxyz[mapcrs[2]],basis[mapcrs[3]][2]/nxyz[mapcrs[3]],0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,(new $3Dmol.Matrix4).makeTranslation(h.NXSTART+h.originX,h.NYSTART+h.originY,h.NZSTART+h.originZ)),this.origin=new $3Dmol.Vector3(0,0,0),this.unit=new $3Dmol.Vector3(1,1,1),this.size={x:header.NX,y:header.NY,z:header.NZ},this.dimensionorder=[header.MAPC,header.MAPR,header.MAPS];var data=new Float32Array(bin.buffer,1024+header.NSYMBT),NX=header.NX,NY=header.NY,NZ=header.NZ;this.data=new Float32Array(NX*NY*NZ);for(let i=0;i<NX;i++)for(let j=0;j<NY;j++)for(let k=0;k<NZ;k++)this.data[(i*NY+j)*NZ+k]=data[(k*NY+j)*NX+i]},$3Dmol.VolumeData.prototype.ccp4.isbinary=!0,$3Dmol.GLVolumetricRender=function(){function interpolateArray(data,fitCount){function linearInterpolate(before,after,atPoint){return before+(after-before)*atPoint}var newData=[],springFactor=(data.length-1)/(fitCount-1);newData[0]=data[0];for(var i=1;i<fitCount-1;i++){var tmp=i*springFactor,before=Math.floor(tmp).toFixed(),after=Math.ceil(tmp).toFixed(),atPoint=tmp-before;newData[i]=linearInterpolate(data[before],data[after],atPoint)}return newData[fitCount-1]=data[data.length-1],newData}function GLVolumetricRender(data,spec){spec=spec||{};var transferfn=Object.assign([],spec.transferfn),shapeObj=null,renderedShapeObj=null,subsamples=spec.subsamples||5;let TRANSFER_BUFFER_SIZE=256;var transferfunctionbuffer=[];transferfn.forEach((function(a){a.value=parseFloat(a.value)})),transferfn.sort((function(a,b){return a.value-b.value}));let min=transferfn[0].value;0==transferfn.length&&transferfn.push(transferfn[0]);let max=transferfn[transferfn.length-1].value;var pos1,pos2,color1,color2,R,G,B,A,alpha1,alpha2;for(let i=0;i<transferfn.length-1;i++)if(color1=$3Dmol.CC.color(transferfn[i].color),color2=$3Dmol.CC.color(transferfn[i+1].color),alpha1=transferfn[i].opacity,alpha2=transferfn[i+1].opacity,(pos1=Math.floor(256*(transferfn[i].value-min)/(max-min)))!=(pos2=Math.floor(256*(transferfn[i+1].value-min)/(max-min)))){R=interpolateArray([255*color1.r,255*color2.r],pos2-pos1),G=interpolateArray([255*color1.g,255*color2.g],pos2-pos1),B=interpolateArray([255*color1.b,255*color2.b],pos2-pos1),A=interpolateArray([255*alpha1,255*alpha2],pos2-pos1);for(let j=0;j<R.length;j++)transferfunctionbuffer.push(R[j]),transferfunctionbuffer.push(G[j]),transferfunctionbuffer.push(B[j]),transferfunctionbuffer.push(A[j])}transferfunctionbuffer=new Uint8ClampedArray(transferfunctionbuffer);var texmatrix=(new $3Dmol.Matrix4).identity(),xoff=data.unit.x*data.size.x,yoff=data.unit.y*data.size.y,zoff=data.unit.z*data.size.z;texmatrix.makeTranslation(-data.origin.x/xoff,-data.origin.y/yoff,-data.origin.z/zoff),texmatrix.scale({x:1/xoff,y:1/yoff,z:1/zoff});var minunit=Math.min(Math.min(data.unit.x,data.unit.y),data.unit.z),extent=[[data.origin.x,data.origin.y,data.origin.z],[data.origin.x+xoff,data.origin.y+yoff,data.origin.z+zoff]],maxdepth=Math.sqrt(xoff*xoff+yoff*yoff+zoff*zoff),shape=new $3Dmol.GLShape;data.matrix?console.log("ERROR: Non-orthonombic boxes (or file formats that specify transformation matrices) are not supported with volumetric rendering yet."):shape.addBox({corner:data.origin,dimensions:{w:xoff,h:yoff,d:zoff}});var geo=shape.finalize();this.boundingSphere=new $3Dmol.Sphere,this.boundingSphere.center={x:data.origin.x+xoff/2,y:data.origin.y+yoff/2,z:data.origin.z+zoff/2},this.boundingSphere.radius=Math.sqrt(xoff*xoff+yoff*yoff+zoff*zoff)/2,void 0!==spec.coords&&spec.seldist,this.globj=function(group){if(renderedShapeObj&&(group.remove(renderedShapeObj),renderedShapeObj=null),!this.hidden){shapeObj=new $3Dmol.Object3D;var material=null,texture=new $3Dmol.Texture(data,!0),transfertexture=new $3Dmol.Texture(transferfunctionbuffer,!1);texture.needsUpdate=!0,transfertexture.needsUpdate=!0,transfertexture.flipY=!1,material=new $3Dmol.VolumetricMaterial({transferfn:transfertexture,transfermin:min,transfermax:max,map:texture,extent:extent,maxdepth:maxdepth,texmatrix:texmatrix,unit:minunit,subsamples:subsamples});var mesh=new $3Dmol.Mesh(geo,material);shapeObj.add(mesh),renderedShapeObj=shapeObj.clone(),group.add(renderedShapeObj)}},this.removegl=function(group){renderedShapeObj&&(void 0!==renderedShapeObj.geometry&&renderedShapeObj.geometry.dispose(),void 0!==renderedShapeObj.material&&renderedShapeObj.material.dispose(),group.remove(renderedShapeObj),renderedShapeObj=null),shapeObj=null}}return Object.defineProperty(GLVolumetricRender.prototype,"position",{get:function(){return this.boundingSphere.center}}),Object.defineProperty(GLVolumetricRender.prototype,"x",{get:function(){return this.boundingSphere.center.x}}),Object.defineProperty(GLVolumetricRender.prototype,"y",{get:function(){return this.boundingSphere.center.y}}),Object.defineProperty(GLVolumetricRender.prototype,"z",{get:function(){return this.boundingSphere.center.z}}),GLVolumetricRender}(),$3Dmol.workerString=function(){self.onmessage=function(oEvent){var obj=oEvent.data,type=obj.type;if(type<0)self.atomData=obj.atoms,self.volume=obj.volume,self.ps=new ProteinSurface;else{var ps=self.ps;ps.initparm(obj.expandedExtent,1!=type,self.volume),ps.fillvoxels(self.atomData,obj.extendedAtoms),ps.buildboundary(),4!==type&&2!==type||(ps.fastdistancemap(),ps.boundingatom(!1),ps.fillvoxelswaals(self.atomData,obj.extendedAtoms)),ps.marchingcube(type);var VandF=ps.getFacesAndVertices(obj.atomsToShow);self.postMessage(VandF)}}}.toString().replace(/(^.*?\{|\}$)/g,""),$3Dmol.workerString+="; var ProteinSurface="+$3Dmol.ProteinSurface.toString().replace(/[a-zA-Z_$]{1}[0-9a-zA-Z_$]*.MarchingCube./g,"MarchingCube."),$3Dmol.workerString+=",MarchingCube=("+$3Dmol.MarchingCubeInitializer.toString()+")();",$3Dmol.SurfaceWorker=window.URL?window.URL.createObjectURL(new Blob([$3Dmol.workerString],{type:"text/javascript"})):{postMessage:function(){}},$3Dmol.workerString=$3Dmol.workerString,$3Dmol.SurfaceWorker=$3Dmol.SurfaceWorker;